{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/utils/phoenix-utils.js","webpack:///./src/utils/history.js","webpack:///./src/utils/avatar-utils.js","webpack:///./src/utils/media-url-utils.js","webpack:///./src/materials/MobileStandardMaterial.js","webpack:///./src/storage/media-search-store.js","webpack:///./src/components/gltf-model-plus.js","webpack:///./src/utils/promisify-worker.js","webpack:///./src/components/hoverable-visuals.js","webpack:///./src/avatar.js","webpack:///./src/components/environment-map.js","webpack:///./src/utils/media-highlight-frag.glsl","webpack:///./src/assets/images/cubemap/posx.jpg","webpack:///./src/assets/images/cubemap/negx.jpg","webpack:///./src/assets/images/cubemap/posy.jpg","webpack:///./src/assets/images/cubemap/negy.jpg","webpack:///./src/assets/images/cubemap/posz.jpg","webpack:///./src/assets/images/cubemap/negz.jpg","webpack:///./src/utils/disable-ios-zoom.js","webpack:///./src/App.js","webpack:///./src/assets/images/warning_icon.png","webpack:///./src/assets/images/warning_icon@2x.png","webpack:///./src/react-components/avatar-preview.js","webpack:///./src/loaders/HubsTextureLoader.js","webpack:///./src/utils/media-utils.js","webpack:///./src/assets/stylesheets/avatar-preview.scss","webpack:///./src/assets/stylesheets/avatar.scss","webpack:///./src/utils/qs_truthy.js","webpack:///./src/everyspace/helmet.js","webpack:///./src/everyspace/airtable.js","webpack:///./src/everyspace/messages.js","webpack:///./src/everyspace/customization.js","webpack:///./src/utils/i18n.js","webpack:///./src/utils/logging.js","webpack:///./src/utils/three-utils.js","webpack:///./src/utils/material-utils.js","webpack:///./src/utils/identity.js","webpack:///./src/storage/store.js","webpack:///./src/assets/images/hub-preview-white.png","webpack:///./src/object-types.js","webpack:///./src/assets/avatars/avatars.js","webpack:///./src/utils/image-bitmap-utils.js","webpack:///./src/utils/next-tick.js","webpack:///./src/utils/permissions-utils.js"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","4","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","document","createElement","getReticulumFetchUrl","path","absolute","reticulumMeta","invalidatedReticulumMetaThisSession","invalidateReticulumMeta","_invalidateReticulumMeta","this","arguments","getReticulumMeta","_getReticulumMeta","querySelector","version","getAttribute","pool","phx_host","fetch","then","_ref2","_asyncToGenerator","res","json","_x6","phxHostOverride","URLSearchParams","location","search","connectToReticulum","_connectToReticulum","debug","params","qs","getNewSocketUrl","_ref3","socketProtocol","protocol","socketHost","socketPort","process","RETICULUM_SOCKET_SERVER","URL","port","socketUrl","console","log","socketSettings","logger","kind","msg","socket","Socket","connect","onError","endPointPath","endPoint","pathname","newEndPoint","getLandingPageForPhoto","photoUrl","parsedUrl","replace","fetchReticulumAuthenticated","url","method","payload","token","APP","store","state","credentials","retUrl","headers","content-type","authorization","body","JSON","stringify","_ref","text","parse","e","_x","createAndRedirectToNewHub","_x2","_x3","_x4","_x5","_createAndRedirectToNewHub","sceneId","sceneUrl","createUrl","assets","Name","SceneUrl","hub","getAirtableAssets","default_environment_gltf_bundle_url","Store","error","update","email","creatorAssignmentToken","creator_assignment_token","creatorAssignmentTokens","hubId","hub_id","embedToken","embed_token","embedTokens","host","getPresenceEntryForSession","presences","sessionId","presence","entries","find","k","metas","getPresenceContextForSession","context","getPresenceProfileForSession","profile","migrateChannelToSocket","oldChannel","channel","topic","bindings","item","on","event","callback","pushBuffer","timeout","oldJoinPush","joinPush","join","recHooks","receive","status","Promise","resolve","discordBridgesForPresences","channels","values","discordBridges","Array","map","b","pushOrUpdateHistory","history","v","detail","newPathname","newSearch","newLength","__historyLength","_objectSpread","__duplicate","undefined","isDuplicate","pushHistoryState","replaceHistoryState","pushHistoryPath","clearHistoryState","popToBeginningOfHubHistory","navigateToPriorPage","len","unsubscribe","listen","go","sluglessPath","split","withSlug","AVATAR_TYPES","LEGACY","SKINNABLE","legacyAvatarIds","avatars","a","id","getAvatarType","avatarId","indexOf","startsWith","resp","fetchAvatar","_fetchAvatar","avatar_id","gltf_url","avatar","model","fetchSkinnableAvatar","proxiedUrlFor","getAvatarSrc","fetchAvatarGltfUrl","getAvatarThumbnailUrl","_getAvatarThumbnailUrl","thumbnail","files","__webpack_exports__","scaledThumbnailUrlFor","getCustomGLTFParserURLResolver","guessContentType","isHubsSceneUrl","isHubsRoomUrl","isHubsDestinationUrl","isHubsAvatarUrl","nonCorsProxyDomains","CORS_PROXY_SERVER","commonKnownContentTypes","gltf","glb","png","jpg","jpeg","pdf","mp4","mp3","farsparkEncodeUrl","str","btoa","encodeURIComponent","_","p1","String","fromCharCode","b64EncodeUnicode","width","height","farsparkUrl","urlHostname","hostname","index","hasIndex","domain","endsWith","gltfUrl","test","corsProxyPrefix","originalUrlParts","decodeURIComponent","substring","dataUrlRegex","matches","match","extension","pop","hubsSceneRegex","hubsAvatarRegex","hubsRoomRegex","VERTEX_SHADER","FRAGMENT_SHADER","MobileStandardMaterial","THREE","ShaderMaterial","[object Object]","args","super","_defineProperty","material","parameters","vertexShader","fragmentShader","uniforms","uvTransform","Matrix3","diffuse","color","opacity","aoMapIntensity","aoMap","emissive","emissiveMap","fog","lights","transparent","alphaTest","skinning","morphTargets","vertexColors","mobileMaterial","clone","fromStandardMaterial","SOURCES","EMPTY_RESULT","meta","URL_SOURCE_TO_TO_API_SOURCE","scenes","images","videos","youtube","gifs","sketchfab","poly","twitch","favorites","MEDIA_SOURCE_DEFAULT_FILTERS","SEARCH_CONTEXT_PARAMS","MediaSearchStore","EventTarget","constructor","_this","dispatchEvent","CustomEvent","urlSource","getUrlMediaSource","previousSource","urlParams","requestIndex","currentRequestIndex","searchParams","locationSearchParams","isMy","param","set","source","navigator","languages","singular","credentialsAccountId","toString","lastSavedUrl","isFetching","nextCursor","next_cursor","lastFetchedUrl","legacyAvatar","type","preview","gltfs","delta","goBack","filter","query","delete","keepSource","keepNav","_stashedParams","_stashedSource","q","_sourceNavigate","hideNav","useLastStashedParams","currentQuery","getSearchClearedSearchParams","useValue","hasAccountWithAvatars","_hasAccountWithAvatars","stashLastSearchParams","_stashLastSearchParams","hasMediaPath","setHistory","_update","Mesh","raycast","acceleratedRaycast","gltfCache","Map","src","cache","count","retain","has","cacheItem","release","scene","traverse","disposeNode","inflightGltfs","extractZipFile","promisifyWorker","SketchfabZipWorker","defaultInflator","el","componentName","componentData","AFRAME","components","Error","multiple","isArray","setAttribute","cloneSkinnedMesh","cloneLookup","parallelTraverse","children","sourceNode","clonedNode","isMesh","geometry","boundsTree","sourceMesh","isSkinnedMesh","sourceBones","skeleton","bones","clonedMesh","sourceBone","bindMatrix","cloneGltf","animations","getHubsComponents","node","hubsComponents","userData","gltfExtensions","MOZ_hubs_components","HUBS_components","legacyComponents","GLTFModelPlus","registerComponent","componentKey","inflator","inflateEntities","indexToEntityMap","templates","isRoot","modelToWorldScale","childEntities","child","entityComponents","append","className","uuid","classList","add","rotation","order","setFromQuaternion","quaternion","object3D","position","copy","scale","multiplyScalar","matrixNeedsUpdate","matrixAutoUpdate","matrix","identity","decompose","setObject3D","toLowerCase","parent","gltfIndex","attachTemplate","root","templateRoot","targetEls","querySelectorAll","cloneNode","attributes","appendChild","loadGLTF","_loadGLTF","contentType","preferredTechnique","onProgress","jsonPreprocessor","fileMap","includes","loadingManager","LoadingManager","setURLModifier","gltfLoader","GLTFLoader","parser","reject","createParser","textureLoader","extensions","oldHeightfieldNode","nodes","heightfield","runMigration","materials","MOZ_alt_materials","altMaterialIndex","extras","Object3D","DefaultMatrixAutoUpdate","mapMaterials","isMeshStandardMaterial","keys","forEach","revokeObjectURL","schema","useCache","default","inflate","batch","init","quality","loadTemplates","applySrc","remove","sceneEl","systems","batchManagerSystem","removeObject","object3DMap","mesh","templateEl","importNode","firstElementChild","content","loadModel","technique","promise","_this2","charAt","assetEl","getElementById","lastSrc","inflatedEl","warn","disposeLastInflatedEl","emit","addObject","initMixer","obj","hasBufferGeometry","isBufferGeometry","hasBoundsTree","geo","triCount","MeshBVH","strategy","maxDepth","object3DToSet","nextTick","inflatedEntity","prop","inflateComponents","rewires","environmentMapComponent","applyEnvironmentMap","f","format","parentNode","removeChild","x","dispose","removeAttribute","worker","nextItemId","outstanding","onmessage","err","handlers","transfer","postMessage","validMaterials","_utils_material_utils__WEBPACK_IMPORTED_MODULE_0__","_utils_permissions_utils__WEBPACK_IMPORTED_MODULE_1__","interactorOneTransform","interactorTwoTransform","enableSweepingEffect","boundingSphere","Sphere","sweepParams","boundingBox","forEachMaterial","contains","meshToEl","tick","time","isFrozen","is","showEffect","showHoverEffect","interactorOne","interactorTwo","interaction","leftHand","hovered","held","options","entity","rightRemote","rightHand","matrixWorld","toArray","worldY","elements","scaledRadius","y","radius","uniform","hubs_EnableSweepingEffect","hubs_IsFrozen","hubs_SweepParams","hubs_HighlightInteractorOne","hubs_InteractorOnePos","hubs_HighlightInteractorTwo","hubs_InteractorTwoPos","hubs_Time","BUILD_VERSION","addLocaleData","en","disableiOSZoom","App","AvatarUI","React","Component","props","airtableAssets","setState","forceUpdate","preventDefault","airtableAssetsInitialState","componentDidMount","addEventListener","storeUpdated","refetchAvatar","fetchAirtableAssets","componentWillUnmount","removeEventListener","render","react__WEBPACK_IMPORTED_MODULE_5___default","styles","avatarLanding","classNames","box","darkened","selectedAvatarId","isSelected","onSubmit","setAvatar","_everyspace_helmet__WEBPACK_IMPORTED_MODULE_3__","page","title","attributions","creator","_react_components_avatar_preview__WEBPACK_IMPORTED_MODULE_13__","avatarGltfUrl","selectedMessage","react_intl__WEBPACK_IMPORTED_MODULE_8__","disabled","formSubmit","logo","DarkLogo","PropTypes","string","intl","ReactDOM","locale","lang","messages","createDefaultEnvironmentMap","_createDefaultEnvironmentMap","urls","cubeMapPosX","cubeMapNegX","cubeMapPosY","cubeMapNegY","cubeMapPosZ","cubeMapNegZ","texture","CubeTextureLoader","load","RGBFormat","environmentMap","updateEnvironmentMap","envMap","needsUpdate","detect_browser__WEBPACK_IMPORTED_MODULE_0__","detectOS","userAgent","lastTouchAtMs","ev","now","Date","getTime","isDoubleTouch","_storage_store__WEBPACK_IMPORTED_MODULE_0__","_storage_media_search_store__WEBPACK_IMPORTED_MODULE_1__","mediaSearchStore","setQuality","TEXTURE_PROPS","base_map","emissive_map","normal_map","orm_map","ALL_MAPS","createRenderer","canvas","alpha","useDevicePixelRatio","getContext","depth","antialias","premultipliedAlpha","preserveDrawingBuffer","powerPreference","renderer","WebGLRenderer","gammaOutput","gammaFactor","physicallyCorrectLights","setPixelRatio","devicePixelRatio","createImageBitmapFromURL","blob","createImageBitmap","ORBIT_ANGLE","Euler","Math","DEG2RAD","DEFAULT_MARGIN","fitBoxInFrustum","camera","center","margin","halfYExtents","max","min","halfVertFOV","degToRad","fov","tan","z","applyEuler","lookAt","AvatarPreview","Scene","PerspectiveCamera","clientWidth","clientHeight","controls","OrbitControls","enablePan","light","DirectionalLight","HemisphereLight","target","loadPreviewAvatar","clock","Clock","snapshotCanvas","snapshotCamera","snapshotRenderer","setClearAlpha","previewRenderer","setClearColor","setAnimationLoop","dt","getDelta","mixer","resize","parentElement","offsetWidth","offsetHeight","setSize","aspect","updateProjectionMatrix","resetCamera","loading","Box3","Vector3","setFromObject","getCenter","domElement","imageBitmaps","img","disposeImageBitmap","oldProps","applyMaps","previewMesh","getObjectByName","idleAnimation","AnimationMixer","action","clipAction","enabled","setLoop","LoopRepeat","Infinity","play","idleAnimationAction","getImage","onUpdate","image","originalMaps","all","bm","stop","toBlob","newProps","mapName","applyMap","applyMapToPreview","File","revertMap","react__WEBPACK_IMPORTED_MODULE_2___default","_assets_images_warning_icon_png__WEBPACK_IMPORTED_MODULE_0___default","srcSet","_assets_images_warning_icon_2x_png__WEBPACK_IMPORTED_MODULE_1___default","react_intl__WEBPACK_IMPORTED_MODULE_4__","ref","injectIntl","withRef","HubsTextureLoader","manager","DefaultLoadingManager","onLoad","Texture","loadTextureAsync","catch","imageLoader","ImageBitmapLoader","flipY","ImageLoader","setCrossOrigin","crossOrigin","setPath","cacheKey","resolveURL","loader","loadAsync","Cache","close","mediaAPIEndpoint","resolveUrlCache","resolveUrl","media_utils_asyncToGenerator","resultPromise","Content-Type","media","response","ok","message","statusText","upload","file","desiredContentType","formData","FormData","interactableId","addMedia","template","contentOrigin","contentSubtype","animate","needsToBeUploaded","fileIsOwned","fireLoadingTimeout","setTimeout","eventName","clearTimeout","once","orientation","reader","FileReader","onload","view","DataView","getUint16","byteLength","offset","marker","getUint32","little","tags","readAsArrayBuffer","getOrientation","srcUrl","raw","access_token","href","fileId","file_id","uploadPromotionTokens","promotionToken","promotion_token","MediaStream","NAF","clientId","objectType","objectTypeForOriginAndContentType","injectCustomShaderChunks","vertexRegex","fragRegex","shaderUniforms","newMaterial","onBeforeCompile","shader","vlines","vindex","findIndex","line","unshift","flines","findex","mediaHighlightFrag","getPromotionTokenForFile","mediaPos","addAndArrangeMedia","snapCount","mirrorOrientation","pos","rotateY","PI","idx","cos","sin","localToWorld","visible","handler","dur","from","to","easing","eventType","createImageTexture","_createImageTexture","encoding","sRGBEncoding","anisotropy","avatar-landing","form-submit","selected-message","qsTruthy","val","HelmetComponent","react_helmet__WEBPACK_IMPORTED_MODULE_0__","react__WEBPACK_IMPORTED_MODULE_1__","react__WEBPACK_IMPORTED_MODULE_1___default","pageTitle","titleRoot","Page_Title_Root","rel","sizes","Favicon","Social_Description","Social_Image","Twitter_Handle","Airtable","configure","endpointUrl","apiKey","base","Icon","select","firstPage","fields","records","modifiedTranslations","i18n_messages","navigatorLang","language","userLanguage","localeData","debug__WEBPACK_IMPORTED_MODULE_0__","debug__WEBPACK_IMPORTED_MODULE_0___default","_qs_truthy__WEBPACK_IMPORTED_MODULE_1__","isDebug","logFilter","enable","getLastWorldPosition","getLastWorldQuaternion","setMatrixWorld","tempVector3","Quaternion","updateMatrices","setFromMatrixPosition","disposeMaterial","mtrl","lightMap","bumpMap","normalMap","specularMap","materialArray","MeshFaceMaterial","MultiMaterial","getInverse","multiply","fn","names","selectRandom","arr","floor","random","avatarIds","av","generateDefaultProfile","LOCAL_STORE_KEY","STORE_STATE_CACHE_KEY","OAUTH_FLOW_CREDENTIALS_KEY","validator","Validator","SCHEMA","definitions","additionalProperties","properties","displayName","pattern","personalAvatarId","activity","hasFoundFreeze","hasChangedName","hasAcceptedProfile","lastEnteredAt","hasPinned","hasRotated","hasRecentered","hasScaled","hasHoveredInWorldHud","hasOpenedShare","entryCount","settings","lastUsedMicDeviceId","confirmedDiscordRooms","items","confirmedBroadcastedRooms","onLoadActions","$ref","localStorage","getItem","setItem","oauthFlowCredentials","Cookies","getJSON","resetToRandomLegacyAvatar","jwtDecode","sub","resetConfirmedBroadcastedRooms","clearStoredArray","resetTipActivityFlags","bumpEntryCount","currentEntryCount","enqueueOnLoadAction","executeOnLoadActions","clearOnLoadActions","arrayMerge","destinationArray","sourceArray","newState","mergeOpts","finalState","merge","valid","validate","ObjectContentOrigins","ObjectTypes","FILE","CLIPBOARD","SPAWNER","URL_IMAGE","URL_VIDEO","URL_MODEL","URL_PDF","URL_AUDIO","FILE_IMAGE","FILE_VIDEO","FILE_MODEL","FILE_PDF","FILE_AUDIO","CLIPBOARD_IMAGE","CLIPBOARD_VIDEO","CLIPBOARD_MODEL","CLIPBOARD_PDF","CLIPBOARD_AUDIO","SPAWNER_IMAGE","SPAWNER_VIDEO","SPAWNER_MODEL","SPAWNER_PDF","SPAWNER_AUDIO","CAMERA","UNKNOWN","objectTypeForOrigin","urlType","fileType","clipboardType","spawnerType","objectTypeMimePrefixLookupMap","image/","model/","application/x-zip-compressed","video/","application/vnd.apple.mpegurl","application/x-mpegurl","audio/","application/pdf","srcSuffixLookupMap",".m3u8","prefix","suffix","Blob","createObjectURL","ctx","putImageData","toDataURL","imageBitmap","HTMLImageElement","isPinned","pinnable","pinned","isSpawner","canMove","hubChannel","can","networkedTemplate","networked","isCamera","isPen"],"mappings":"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","file":"assets/js/avatar-e0772402c040144fd602.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t4: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([1983,1,0]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import { Socket } from \"phoenix\";\nimport { generateHubName } from \"../utils/name-generation\";\nimport { getAirtableAssets, airtableAssetsInitialState } from '../everyspace/airtable'\n\nimport Store from \"../storage/store\";\n\nconst resolverLink = document.createElement(\"a\");\nexport function getReticulumFetchUrl(path, absolute = false) {\n  if (process.env.RETICULUM_SERVER) {\n    return `https://${process.env.RETICULUM_SERVER}${path}`;\n  } else if (absolute) {\n    resolverLink.href = path;\n    return resolverLink.href;\n  } else {\n    return path;\n  }\n}\n\nlet reticulumMeta = null;\nlet invalidatedReticulumMetaThisSession = false;\n\nexport async function invalidateReticulumMeta() {\n  invalidatedReticulumMetaThisSession = true;\n  reticulumMeta = null;\n}\n\nexport async function getReticulumMeta() {\n  if (!reticulumMeta) {\n    // Initially look up version based upon page, avoiding round-trip, otherwise fetch.\n    if (!invalidatedReticulumMetaThisSession && document.querySelector(\"meta[name='ret:version']\")) {\n      reticulumMeta = {\n        version: document.querySelector(\"meta[name='ret:version']\").getAttribute(\"value\"),\n        pool: document.querySelector(\"meta[name='ret:pool']\").getAttribute(\"value\"),\n        phx_host: document.querySelector(\"meta[name='ret:phx_host']\").getAttribute(\"value\")\n      };\n    } else {\n      await fetch(getReticulumFetchUrl(\"/api/v1/meta\")).then(async res => {\n        reticulumMeta = await res.json();\n      });\n    }\n  }\n\n  const qs = new URLSearchParams(location.search);\n  const phxHostOverride = qs.get(\"phx_host\");\n\n  if (phxHostOverride) {\n    reticulumMeta.phx_host = phxHostOverride;\n  }\n\n  return reticulumMeta;\n}\n\nexport async function connectToReticulum(debug = false, params = null) {\n  const qs = new URLSearchParams(location.search);\n\n  const getNewSocketUrl = async () => {\n    const socketProtocol = qs.get(\"phx_protocol\") || (document.location.protocol === \"https:\" ? \"wss:\" : \"ws:\");\n    let socketHost = qs.get(\"phx_host\");\n    let socketPort = qs.get(\"phx_port\");\n\n    const reticulumMeta = await getReticulumMeta();\n    socketHost = socketHost || process.env.RETICULUM_SOCKET_SERVER || reticulumMeta.phx_host;\n    socketPort =\n      socketPort ||\n      (process.env.RETICULUM_SERVER ? new URL(`${socketProtocol}//${process.env.RETICULUM_SERVER}`).port : \"443\");\n    return `${socketProtocol}//${socketHost}${socketPort ? `:${socketPort}` : \"\"}`;\n  };\n\n  const socketUrl = await getNewSocketUrl();\n  console.log(`Phoenix Socket URL: ${socketUrl}`);\n\n  const socketSettings = {};\n\n  if (debug) {\n    socketSettings.logger = (kind, msg, data) => {\n      console.log(`${kind}: ${msg}`, data);\n    };\n  }\n\n  if (params) {\n    socketSettings.params = params;\n  }\n\n  const socket = new Socket(`${socketUrl}/socket`, socketSettings);\n  socket.connect();\n  socket.onError(async () => {\n    // On error, underlying reticulum node may have died, so rebalance by\n    // fetching a new healthy node to connect to.\n    invalidateReticulumMeta();\n\n    const endPointPath = new URL(socket.endPoint).pathname;\n    const newSocketUrl = await getNewSocketUrl();\n    const newEndPoint = `${newSocketUrl}${endPointPath}`;\n    console.log(`Socket error, changed endpoint to ${newEndPoint}`);\n    socket.endPoint = newEndPoint;\n  });\n\n  return socket;\n}\n\nexport function getLandingPageForPhoto(photoUrl) {\n  const parsedUrl = new URL(photoUrl);\n  return getReticulumFetchUrl(parsedUrl.pathname.replace(\".png\", \".html\") + parsedUrl.search, true);\n}\n\nexport function fetchReticulumAuthenticated(url, method = \"GET\", payload) {\n  const { token } = window.APP.store.state.credentials;\n  const retUrl = getReticulumFetchUrl(url);\n  const params = {\n    headers: { \"content-type\": \"application/json\" },\n    method\n  };\n  if (token) {\n    params.headers.authorization = `bearer ${token}`;\n  }\n  if (payload) {\n    params.body = JSON.stringify(payload);\n  }\n  return fetch(retUrl, params).then(async r => {\n    const result = await r.text();\n    try {\n      return JSON.parse(result);\n    } catch (e) {\n      // Some reticulum responses, particularly DELETE requests, don't return json.\n      return result;\n    }\n  });\n}\n\nexport async function createAndRedirectToNewHub(name, sceneId, sceneUrl, replace) {\n  const createUrl = getReticulumFetchUrl(\"/api/v1/hubs\");\n\n  let assets = {Name: \"Test\", SceneUrl: null};\n    \n  assets = await getAirtableAssets();\n  \n  // const record = await airtableAssets.find('recHqITRS7cBMwn9i')\n\n  // if (record) assets = record.fields;\n  \n  // const payload = { hub: { name: name || generateHubName() } };\n  const payload = { hub: { name: assets.Name } };\n  \n\n  // if (sceneId) {\n    // payload.hub.scene_id = sceneId;\n  // } else {\n    // payload.hub.default_environment_gltf_bundle_url = sceneUrl;\n  // }\n    \n  payload.hub.default_environment_gltf_bundle_url = assets.SceneUrl;\n    \n\n  const headers = { \"content-type\": \"application/json\" };\n  const store = new Store();\n  if (store.state && store.state.credentials.token) {\n    headers.authorization = `bearer ${store.state.credentials.token}`;\n  }\n\n  let res = await fetch(createUrl, {\n    body: JSON.stringify(payload),\n    headers,\n    method: \"POST\"\n  }).then(r => r.json());\n\n  if (res.error === \"invalid_token\") {\n    // Clear the invalid token from store.\n    store.update({ credentials: { token: null, email: null } });\n\n    // Create hub anonymously\n    delete headers.authorization;\n    res = await fetch(createUrl, {\n      body: JSON.stringify(payload),\n      headers,\n      method: \"POST\"\n    }).then(r => r.json());\n  }\n\n  const hub = res;\n  let url = hub.url;\n\n  const creatorAssignmentToken = hub.creator_assignment_token;\n  if (creatorAssignmentToken) {\n    store.update({ creatorAssignmentTokens: [{ hubId: hub.hub_id, creatorAssignmentToken: creatorAssignmentToken }] });\n\n    // Don't need to store the embed token if there's no creator assignment token, since that means\n    // we are the owner and will get the embed token on page load.\n    const embedToken = hub.embed_token;\n\n    if (embedToken) {\n      store.update({ embedTokens: [{ hubId: hub.hub_id, embedToken: embedToken }] });\n    }\n  }\n\n  if (process.env.RETICULUM_SERVER && document.location.host !== process.env.RETICULUM_SERVER) {\n    url = `/hub.html?hub_id=${hub.hub_id}`;\n  }\n\n  if (replace) {\n    document.location.replace(url);\n  } else {\n    document.location = url;\n  }\n}\n\nexport function getPresenceEntryForSession(presences, sessionId) {\n  const entry = Object.entries(presences || {}).find(([k]) => k === sessionId) || [];\n  const presence = entry[1];\n  return (presence && presence.metas && presence.metas[0]) || {};\n}\n\nexport function getPresenceContextForSession(presences, sessionId) {\n  return (getPresenceEntryForSession(presences, sessionId) || {}).context || {};\n}\n\nexport function getPresenceProfileForSession(presences, sessionId) {\n  return (getPresenceEntryForSession(presences, sessionId) || {}).profile || {};\n}\n\n// Takes the given channel, and creates a new channel with the same bindings\n// with the given socket, joins it, and leaves the old channel after joining.\n//\n// NOTE: This function relies upon phoenix channel object internals, so this\n// function will need to be reviewed if/when we ever update phoenix.js\nexport function migrateChannelToSocket(oldChannel, socket, params) {\n  const channel = socket.channel(oldChannel.topic, params || oldChannel.params);\n\n  for (let i = 0, l = oldChannel.bindings.length; i < l; i++) {\n    const item = oldChannel.bindings[i];\n    channel.on(item.event, item.callback);\n  }\n\n  for (let i = 0, l = oldChannel.pushBuffer.length; i < l; i++) {\n    const item = oldChannel.pushBuffer[i];\n    channel.push(item.event, item.payload, item.timeout);\n  }\n\n  const oldJoinPush = oldChannel.joinPush;\n  const joinPush = channel.join();\n\n  for (let i = 0, l = oldJoinPush.recHooks.length; i < l; i++) {\n    const item = oldJoinPush.recHooks[i];\n    joinPush.receive(item.status, item.callback);\n  }\n\n  return new Promise(resolve => {\n    joinPush.receive(\"ok\", () => {\n      // Clear all event handlers first so no duplicate messages come in.\n      oldChannel.bindings = [];\n      resolve(channel);\n    });\n  });\n}\n\nexport function discordBridgesForPresences(presences) {\n  const channels = [];\n  for (const p of Object.values(presences)) {\n    for (const m of p.metas) {\n      if (m.profile && m.profile.discordBridges) {\n        Array.prototype.push.apply(channels, m.profile.discordBridges.map(b => b.channel.name));\n      }\n    }\n  }\n  return channels;\n}\n","// Utilities for manipulating state history. This provides a number of functions which\n// need to be used to manipulate history state so we can deal with edge cases around\n// entry back button and refreshes once entered.\n//\n// These functions also transparently deal with the room slug, so incoming calls can ignore\n// dealing with it, and provides APIs for getting the non-slug part of the path.\n//\n// The slug cannot be part of the basename for history, because the slug changes intra-session\n// if the room is renamed.\n\n// This pushes/replaces a new k, v pair into the history, while maintaining all the other\n// keys, or clears state if k if null.\n//\n// Also maintains a length key that can be used to find the length of the history chain\n// (across refreshes) for the current room.\nfunction pushOrUpdateHistory(history, replace, k, v, detail, newPathname, newSearch) {\n  let state = {};\n  const newLength = ((history.location.state && history.location.state.__historyLength) || 0) + (replace ? 0 : 1);\n\n  if (k || newPathname || newSearch) {\n    state = history.location.state ? { ...history.location.state } : {};\n    delete state.__duplicate;\n\n    if (k) {\n      state[k] = v;\n      state.key = k;\n      state.value = v;\n      state.detail = detail;\n    }\n  }\n\n  const pathname =\n    newPathname !== undefined ? newPathname : history.location.pathname === \"/\" ? \"\" : history.location.pathname;\n\n  const search = newSearch !== undefined ? newSearch : history.location.search;\n\n  // If popToBeginningOfHubHistory was previously used, there is a duplicate entry\n  // at the top of the history stack (which was needed to wipe out forward history)\n  // so we use this opportunity to replace it.\n  const isDuplicate = history.location.state && history.location.state.__duplicate;\n  const method = replace || isDuplicate ? history.replace : history.push;\n  state.__historyLength = newLength;\n\n  method({ pathname, search, state });\n}\n\nexport function pushHistoryState(history, k, v, detail) {\n  pushOrUpdateHistory(history, false, k, v, detail);\n}\n\nexport function replaceHistoryState(history, k, v, detail) {\n  pushOrUpdateHistory(history, true, k, v, detail);\n}\n\nexport function pushHistoryPath(history, path, search) {\n  pushOrUpdateHistory(history, false, null, null, null, path, search);\n}\n\nexport function clearHistoryState(history) {\n  pushOrUpdateHistory(history, false);\n}\n\n// This will pop the browser history to the first entry that was for this hubs room,\n// and then push a duplicate entry onto the history stack in order to wipe out forward\n// history.\nexport function popToBeginningOfHubHistory(history, navigateToPriorPage) {\n  if (!history.location.state || history.location.state.__historyLength === undefined) return;\n\n  const len = history.location.state.__historyLength;\n  if (len === 0) return;\n\n  return new Promise(resolve => {\n    // After the go() completes, we push a duplicate history entry onto the stack\n    // in order to wipe out forward history. We also optionally go back -2 if we wanted\n    // to go back to the prior page.\n    const unsubscribe = history.listen(() => {\n      unsubscribe();\n      history.push({\n        pathname: history.location.pathname,\n        search: history.location.search,\n        state: { __historyLength: 0, __duplicate: true }\n      });\n      if (navigateToPriorPage) history.go(-2); // Go back to history entry before beginning.\n      resolve();\n    });\n\n    history.go(-len);\n  });\n}\n\n// This will pop the browser history to the entry before the first entry for this hubs room.\nexport function navigateToPriorPage(history) {\n  popToBeginningOfHubHistory(history, true);\n}\n\n// Returns the part of the pathname that does not include the slug\nexport function sluglessPath(location) {\n  const parts = location.pathname.split(\"/\");\n  return `/${parts.slice(2).join(\"/\")}`;\n}\n\n// Returns a new path that includes the current slug as a prefix to the\n// provided path.\nexport function withSlug(location, path) {\n  const parts = location.pathname.split(\"/\");\n  return `/${parts[1]}${path}`;\n}\n","import { fetchReticulumAuthenticated } from \"./phoenix-utils\";\nimport { proxiedUrlFor } from \"./media-url-utils\";\nimport { avatars } from \"../assets/avatars/avatars\";\n\nexport const AVATAR_TYPES = {\n  LEGACY: \"legacy\",\n  SKINNABLE: \"skinnable\",\n  URL: \"url\"\n};\n\nconst legacyAvatarIds = avatars.map(a => a.id);\nexport function getAvatarType(avatarId) {\n  if (!avatarId || legacyAvatarIds.indexOf(avatarId) !== -1) return AVATAR_TYPES.LEGACY;\n  if (avatarId.startsWith(\"http\")) return AVATAR_TYPES.URL;\n  return AVATAR_TYPES.SKINNABLE;\n}\n\nasync function fetchSkinnableAvatar(avatarId) {\n  const resp = await fetchReticulumAuthenticated(`/api/v1/avatars/${avatarId}`);\n  return resp && resp.avatars && resp.avatars[0];\n}\n\nexport async function fetchAvatar(avatarId) {\n  switch (getAvatarType(avatarId)) {\n    case AVATAR_TYPES.LEGACY:\n      return {\n        avatar_id: avatarId,\n        gltf_url: avatars.find(avatar => avatar.id === avatarId).model\n      };\n    case AVATAR_TYPES.SKINNABLE:\n      return fetchSkinnableAvatar(avatarId);\n    case AVATAR_TYPES.URL:\n      return {\n        avatar_id: avatarId,\n        gltf_url: proxiedUrlFor(avatarId)\n      };\n  }\n}\n\nasync function fetchAvatarGltfUrl(avatarId) {\n  return fetchAvatar(avatarId).then(avatar => avatar && avatar.gltf_url);\n}\n\nexport function getAvatarSrc(avatarId) {\n  switch (getAvatarType(avatarId)) {\n    case AVATAR_TYPES.LEGACY:\n      return `#${avatarId}`;\n    case AVATAR_TYPES.SKINNABLE:\n      return fetchAvatarGltfUrl(avatarId);\n    case AVATAR_TYPES.URL:\n      return proxiedUrlFor(avatarId);\n    default:\n      return avatarId;\n  }\n}\n\nexport async function getAvatarThumbnailUrl(avatarId) {\n  switch (getAvatarType(avatarId)) {\n    case AVATAR_TYPES.LEGACY:\n      return avatars.find(avatar => avatar.id === avatarId).thumbnail;\n    case AVATAR_TYPES.SKINNABLE:\n      return fetchAvatar(avatarId).then(avatar => avatar.files.thumbnail);\n    default:\n      return \"https://asset-bundles-prod.reticulum.io/bots/avatar_unavailable.png\";\n  }\n}\n","const nonCorsProxyDomains = (process.env.NON_CORS_PROXY_DOMAINS || \"\").split(\",\");\nif (process.env.CORS_PROXY_SERVER) {\n  nonCorsProxyDomains.push(process.env.CORS_PROXY_SERVER);\n}\n\nconst commonKnownContentTypes = {\n  gltf: \"model/gltf\",\n  glb: \"model/gltf-binary\",\n  png: \"image/png\",\n  jpg: \"image/jpeg\",\n  jpeg: \"image/jpeg\",\n  pdf: \"application/pdf\",\n  mp4: \"video/mp4\",\n  mp3: \"audio/mpeg\"\n};\n\n// thanks to https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding\nfunction b64EncodeUnicode(str) {\n  // first we use encodeURIComponent to get percent-encoded UTF-8, then we convert the percent-encodings\n  // into raw bytes which can be fed into btoa.\n  const CHAR_RE = /%([0-9A-F]{2})/g;\n  return btoa(encodeURIComponent(str).replace(CHAR_RE, (_, p1) => String.fromCharCode(\"0x\" + p1)));\n}\n\nconst farsparkEncodeUrl = url => {\n  // farspark doesn't know how to read '=' base64 padding characters\n  // translate base64 + to - and / to _ for URL safety\n  return b64EncodeUnicode(url)\n    .replace(/=+$/g, \"\")\n    .replace(/\\+/g, \"-\")\n    .replace(/\\//g, \"_\");\n};\n\nexport const scaledThumbnailUrlFor = (url, width, height) => {\n  const farsparkUrl = `https://${process.env.FARSPARK_SERVER}/thumbnail/${farsparkEncodeUrl(\n    url\n  )}?w=${width}&h=${height}`;\n\n  try {\n    const urlHostname = new URL(url).hostname;\n\n    if (process.env.RETICULUM_SERVER) {\n      const retHostname = new URL(`https://${process.env.RETICULUM_SERVER}`).hostname;\n      if (retHostname === urlHostname) return url;\n    }\n  } catch (e) {\n    return farsparkUrl;\n  }\n\n  return farsparkUrl;\n};\n\nexport const proxiedUrlFor = (url, index = null) => {\n  if (!(url.startsWith(\"http:\") || url.startsWith(\"https:\"))) return url;\n\n  const hasIndex = index !== null;\n\n  if (!hasIndex) {\n    // Skip known domains that do not require CORS proxying.\n    try {\n      const parsedUrl = new URL(url);\n      if (nonCorsProxyDomains.find(domain => parsedUrl.hostname.endsWith(domain))) return url;\n    } catch (e) {\n      // Ignore\n    }\n  }\n\n  if (hasIndex || !process.env.CORS_PROXY_SERVER) {\n    const method = hasIndex ? \"extract\" : \"raw\";\n    return `https://${process.env.FARSPARK_SERVER}/0/${method}/0/0/0/${index || 0}/${farsparkEncodeUrl(url)}`;\n  } else {\n    return `https://${process.env.CORS_PROXY_SERVER}/${url}`;\n  }\n};\n\nexport const getCustomGLTFParserURLResolver = gltfUrl => url => {\n  if (typeof url !== \"string\" || url === \"\") return \"\";\n  if (/^(https?:)?\\/\\//i.test(url)) return url;\n  if (/^data:.*,.*$/i.test(url)) return url;\n  if (/^blob:.*$/i.test(url)) return url;\n\n  if (process.env.CORS_PROXY_SERVER) {\n    // For absolute paths with a CORS proxied gltf URL, re-write the url properly to be proxied\n    const corsProxyPrefix = `https://${process.env.CORS_PROXY_SERVER}/`;\n\n    if (gltfUrl.startsWith(corsProxyPrefix)) {\n      const originalUrl = decodeURIComponent(gltfUrl.substring(corsProxyPrefix.length));\n      const originalUrlParts = originalUrl.split(\"/\");\n\n      // Drop the .gltf filename\n      const path = new URL(url).pathname;\n      const assetUrl = originalUrlParts.slice(0, originalUrlParts.length - 1).join(\"/\") + \"/\" + path;\n      return corsProxyPrefix + assetUrl;\n    }\n  }\n\n  return url;\n};\n\nconst dataUrlRegex = /data:([a-zA-Z0-9]+\\/[a-zA-Z0-9-.+]+).*,.*/;\n\nexport const guessContentType = url => {\n  if (url.startsWith(\"hubs://\") && url.endsWith(\"/video\")) return \"video/vnd.hubs-webrtc\";\n  if (url.startsWith(\"data:\")) {\n    const matches = dataUrlRegex.match(url);\n    if (matches.length > 0) {\n      matches[1];\n    }\n  }\n  const extension = new URL(url, window.location).pathname.split(\".\").pop();\n  return commonKnownContentTypes[extension];\n};\nconst hubsSceneRegex = /https?:\\/\\/(hubs.local(:\\d+)?|(smoke-)?hubs.mozilla.com|(dev\\.)?reticulum.io)\\/scenes\\/(\\w+)\\/?\\S*/;\nconst hubsAvatarRegex = /https?:\\/\\/(hubs.local(:\\d+)?|(smoke-)?hubs.mozilla.com|(dev\\.)?reticulum.io)\\/avatars\\/(\\w+)\\/?\\S*/;\nconst hubsRoomRegex = /https?:\\/\\/(hubs.local(:\\d+)?|(smoke-)?hubs.mozilla.com|(dev\\.)?reticulum.io)\\/(\\w+)\\/?\\S*/;\nexport const isHubsSceneUrl = hubsSceneRegex.test.bind(hubsSceneRegex);\nexport const isHubsRoomUrl = url => !isHubsSceneUrl(url) && hubsRoomRegex.test(url);\nexport const isHubsDestinationUrl = url => isHubsSceneUrl(url) || isHubsRoomUrl(url);\nexport const isHubsAvatarUrl = hubsAvatarRegex.test.bind(hubsAvatarRegex);\n","const VERTEX_SHADER = `\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n  #include <uv_vertex>\n  #include <uv2_vertex>\n  #include <color_vertex>\n  #include <skinbase_vertex>\n\n  #include <begin_vertex>\n  #include <morphtarget_vertex>\n  #include <skinning_vertex>\n  #include <project_vertex>\n  #include <logdepthbuf_vertex>\n\n  #include <worldpos_vertex>\n  #include <clipping_planes_vertex>\n  #include <fog_vertex>\n}\n`;\n\nconst FRAGMENT_SHADER = `\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <aomap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n  #include <clipping_planes_fragment>\n\n  vec4 diffuseColor = vec4(diffuse, opacity);\n  ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n  vec3 totalEmissiveRadiance = emissive;\n\n  #include <logdepthbuf_fragment>\n  #include <map_fragment>\n  #include <color_fragment>\n  #include <alphatest_fragment>\n  #include <emissivemap_fragment>\n\n  reflectedLight.indirectDiffuse += vec3(1.0);\n\n  #include <aomap_fragment>\n\n  reflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n  vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n  gl_FragColor = vec4(outgoingLight, diffuseColor.a);\n\n  #include <premultiplied_alpha_fragment>\n  #include <tonemapping_fragment>\n  #include <encodings_fragment>\n  #include <fog_fragment>\n}\n`;\n\nexport default class MobileStandardMaterial extends THREE.ShaderMaterial {\n  type = \"MobileStandardMaterial\";\n  isMobileStandardMaterial = true;\n  static fromStandardMaterial(material) {\n    const parameters = {\n      vertexShader: VERTEX_SHADER,\n      fragmentShader: FRAGMENT_SHADER,\n      uniforms: {\n        uvTransform: { value: new THREE.Matrix3() },\n        diffuse: { value: material.color },\n        opacity: { value: material.opacity },\n        map: { value: material.map },\n        aoMapIntensity: { value: material.aoMapIntensity },\n        aoMap: { value: material.aoMap },\n        emissive: { value: material.emissive },\n        emissiveMap: { value: material.emissiveMap }\n      },\n      fog: true,\n      lights: false,\n      opacity: material.opacity,\n      transparent: material.transparent,\n      alphaTest: material.alphaTest,\n      skinning: material.skinning,\n      morphTargets: material.morphTargets,\n      vertexColors: material.vertexColors\n    };\n\n    const mobileMaterial = new MobileStandardMaterial(parameters);\n\n    mobileMaterial.color = material.color;\n    mobileMaterial.map = material.map;\n    mobileMaterial.aoMap = material.aoMap;\n    mobileMaterial.aoMapIntensity = material.aoMapIntensity;\n    mobileMaterial.emissive = material.emissive;\n    mobileMaterial.emissiveMap = material.emissiveMap;\n\n    return mobileMaterial;\n  }\n  clone() {\n    return MobileStandardMaterial.fromStandardMaterial(this);\n  }\n}\n","import { EventTarget } from \"event-target-shim\";\nimport { getReticulumFetchUrl, fetchReticulumAuthenticated } from \"../utils/phoenix-utils\";\nimport { pushHistoryPath, sluglessPath, withSlug } from \"../utils/history\";\n\nexport const SOURCES = [\"poly\", \"sketchfab\", \"videos\", \"scenes\", \"gifs\", \"images\", \"twitch\"];\n\nconst EMPTY_RESULT = { entries: [], meta: {} };\n\nconst URL_SOURCE_TO_TO_API_SOURCE = {\n  scenes: \"scene_listings\",\n  images: \"bing_images\",\n  videos: \"bing_videos\",\n  youtube: \"youtube_videos\",\n  gifs: \"tenor\",\n  sketchfab: \"sketchfab\",\n  poly: \"poly\",\n  twitch: \"twitch\",\n  favorites: \"favorites\"\n};\n\nexport const MEDIA_SOURCE_DEFAULT_FILTERS = {\n  gifs: \"trending\",\n  sketchfab: \"featured\",\n  scenes: \"featured\",\n  favorites: \"my-favorites\"\n};\n\nconst SEARCH_CONTEXT_PARAMS = [\"q\", \"filter\", \"cursor\"];\n\n// This class is responsible for fetching and storing media search results and provides a\n// convenience API for performing history updates relevant to search navigation.\nexport default class MediaSearchStore extends EventTarget {\n  constructor() {\n    super();\n\n    this.requestIndex = 0;\n  }\n\n  setHistory(history) {\n    this.history = history;\n\n    this._update(this.history.location);\n\n    this.history.listen(location => {\n      this._update(location);\n    });\n  }\n\n  _update = async location => {\n    this.result = null;\n    this.dispatchEvent(new CustomEvent(\"statechanged\"));\n\n    const urlSource = this.getUrlMediaSource(location);\n    if (!urlSource) return;\n\n    if (!this.previousSource || this.previousSource !== urlSource) {\n      this.dispatchEvent(new CustomEvent(\"sourcechanged\"));\n      this.previousSource = urlSource;\n    }\n\n    const urlParams = new URLSearchParams(location.search);\n\n    this.requestIndex++;\n    const currentRequestIndex = this.requestIndex;\n    const searchParams = new URLSearchParams();\n    const locationSearchParams = new URLSearchParams(location.search);\n    const isMy = locationSearchParams.get(\"filter\") && locationSearchParams.get(\"filter\").startsWith(\"my-\");\n\n    for (const param of SEARCH_CONTEXT_PARAMS) {\n      if (!urlParams.get(param)) continue;\n      searchParams.set(param, urlParams.get(param));\n    }\n\n    searchParams.get(\"locale\", navigator.languages[0]);\n\n    let source;\n    if (urlSource === \"avatars\" || urlSource === \"scenes\") {\n      // Avatars + scenes are special since we request them from a different source based on the facet.\n      const singular = urlSource === \"avatars\" ? \"avatar\" : \"scene\";\n      source = isMy ? `${singular}s` : `${singular}_listings`;\n    } else {\n      source = URL_SOURCE_TO_TO_API_SOURCE[urlSource];\n    }\n    searchParams.set(\"source\", source);\n\n    let fetch = true;\n\n    if (source === \"avatars\" || source === \"scenes\" || source === \"favorites\") {\n      if (isMy) {\n        if (window.APP.store.credentialsAccountId) {\n          searchParams.set(\"user\", window.APP.store.credentialsAccountId);\n        } else {\n          fetch = false; // Don't fetch my-* if not signed in\n        }\n      }\n    }\n\n    const path = `/api/v1/media/search?${searchParams.toString()}`;\n    const url = getReticulumFetchUrl(path);\n    if (this.lastSavedUrl === url) return;\n\n    this.isFetching = true;\n    this.dispatchEvent(new CustomEvent(\"statechanged\"));\n    const result = fetch ? await fetchReticulumAuthenticated(path) : EMPTY_RESULT;\n\n    if (this.requestIndex != currentRequestIndex) return;\n\n    this.result = result;\n    this.nextCursor = this.result && this.result.meta && this.result.meta.next_cursor;\n    this.lastFetchedUrl = url;\n    this.isFetching = false;\n    this.dispatchEvent(new CustomEvent(\"statechanged\"));\n  };\n\n  _legacyAvatarToSearchEntry = legacyAvatar => {\n    return {\n      id: legacyAvatar.id,\n      type: \"avatar_listing\",\n      url: legacyAvatar.url,\n      images: { preview: { url: legacyAvatar.thumbnail, width: 720, height: 1280 } },\n      gltfs: { avatar: legacyAvatar.model }\n    };\n  };\n\n  pageNavigate = delta => {\n    if (delta === -1) {\n      this.history.goBack();\n    } else {\n      const location = this.history.location;\n      const searchParams = new URLSearchParams(location.search);\n      searchParams.set(\"cursor\", this.nextCursor);\n      pushHistoryPath(this.history, location.pathname, searchParams.toString());\n    }\n  };\n\n  filterQueryNavigate = (filter, query) => {\n    const location = this.history.location;\n    const searchParams = new URLSearchParams(location.search);\n\n    if (query) {\n      searchParams.set(\"q\", query);\n    } else {\n      searchParams.delete(\"q\");\n    }\n\n    if (filter) {\n      searchParams.set(\"filter\", filter);\n    } else {\n      searchParams.delete(\"filter\");\n    }\n\n    if (filter) {\n      searchParams.set(\"cursor\", filter);\n    } else {\n      searchParams.delete(\"cursor\");\n    }\n\n    pushHistoryPath(this.history, location.pathname, searchParams.toString());\n  };\n\n  getSearchClearedSearchParams = (location, keepSource, keepNav) => {\n    const searchParams = new URLSearchParams(location.search);\n\n    // Strip browsing query params\n    searchParams.delete(\"q\");\n    searchParams.delete(\"filter\");\n    searchParams.delete(\"cursor\");\n\n    if (!keepNav) {\n      searchParams.delete(\"media_nav\");\n    }\n\n    if (!keepSource) {\n      searchParams.delete(\"media_source\");\n    }\n\n    return searchParams;\n  };\n\n  _stashLastSearchParams = location => {\n    const searchParams = new URLSearchParams(location.search);\n\n    this._stashedParams = {};\n    this._stashedSource = null;\n\n    const source = this.getUrlMediaSource(location);\n\n    // HACK for now do not stash favorite search, since that ends up being a source\n    // we do not reveal in the media browser UX. Revisit the rules here when we have a\n    // proper favorites browser. Then, we should have two separate stashes.\n    if (source === \"favorites\") return;\n    this._stashedSource = source;\n\n    for (const param of SEARCH_CONTEXT_PARAMS) {\n      const value = searchParams.get(param);\n\n      if (value) {\n        this._stashedParams[param] = value;\n      }\n    }\n  };\n\n  clearStashedQuery = () => {\n    if (!this._stashedParams) return;\n    delete this._stashedParams.q;\n  };\n\n  sourceNavigate = source => {\n    this._sourceNavigate(source, false, true);\n  };\n\n  sourceNavigateToDefaultSource = () => {\n    this._sourceNavigate(this._stashedSource ? this._stashedSource : SOURCES[0], false, true);\n  };\n\n  sourceNavigateWithNoNav = source => {\n    this._sourceNavigate(source, true, false);\n  };\n\n  _sourceNavigate = async (source, hideNav, useLastStashedParams) => {\n    const currentQuery = new URLSearchParams(this.history.location.search).get(\"q\");\n    const searchParams = this.getSearchClearedSearchParams(this.history.location);\n\n    if (currentQuery) {\n      searchParams.set(\"q\", currentQuery);\n    } else {\n      if (useLastStashedParams && this._stashedParams) {\n        for (const param of SEARCH_CONTEXT_PARAMS) {\n          const value = this._stashedParams[param];\n\n          // Only q param is compatible across sources, so keep it if is stashed.\n          const useValue = param === \"q\" || this._stashedSource === source;\n\n          if (value && useValue) {\n            searchParams.set(param, value);\n          }\n        }\n      } else {\n        if (source === \"avatars\") {\n          const hasAccountWithAvatars = await this._hasAccountWithAvatars();\n          searchParams.set(\"filter\", hasAccountWithAvatars ? \"my-avatars\" : \"featured\");\n        } else if (MEDIA_SOURCE_DEFAULT_FILTERS[source]) {\n          searchParams.set(\"filter\", MEDIA_SOURCE_DEFAULT_FILTERS[source]);\n        }\n      }\n    }\n\n    this._stashedParams = null;\n    this._stashedSource = null;\n\n    if (hideNav) {\n      searchParams.set(\"media_nav\", \"false\");\n    }\n\n    if (process.env.RETICULUM_SERVER && document.location.host !== process.env.RETICULUM_SERVER) {\n      searchParams.set(\"media_source\", source);\n      pushHistoryPath(this.history, this.history.location.pathname, searchParams.toString());\n    } else {\n      pushHistoryPath(this.history, withSlug(this.history.location, `/media/${source}`), searchParams.toString());\n    }\n  };\n\n  _hasAccountWithAvatars = async () => {\n    const { credentialsAccountId } = window.APP.store;\n    if (!credentialsAccountId) return false;\n\n    const searchParams = new URLSearchParams();\n    const source = \"avatars\";\n    searchParams.set(\"source\", source);\n    searchParams.set(\"user\", credentialsAccountId);\n    const result = await fetchReticulumAuthenticated(`/api/v1/media/search?${searchParams.toString()}`);\n    return !!(result && result.entries) && result.entries.length > 0;\n  };\n\n  getUrlMediaSource = location => {\n    const { search } = location;\n    const urlParams = new URLSearchParams(search);\n    const pathname = sluglessPath(location);\n\n    if (!pathname.startsWith(\"/media\") && !urlParams.get(\"media_source\")) return null;\n    return urlParams.get(\"media_source\") || pathname.substring(7);\n  };\n\n  pushExitMediaBrowserHistory = (history, stashLastSearchParams = true) => {\n    if (!history) history = this.history;\n\n    if (stashLastSearchParams) this._stashLastSearchParams(history.location);\n\n    const { pathname } = history.location;\n    const hasMediaPath = sluglessPath(history.location).startsWith(\"/media\");\n    pushHistoryPath(\n      history,\n      hasMediaPath ? withSlug(history.location, \"/\") : pathname,\n      this.getSearchClearedSearchParams(history.location).toString()\n    );\n    this.dispatchEvent(new CustomEvent(\"media-exit\"));\n  };\n}\n","import nextTick from \"../utils/next-tick\";\nimport { mapMaterials } from \"../utils/material-utils\";\nimport SketchfabZipWorker from \"../workers/sketchfab-zip.worker.js\";\nimport MobileStandardMaterial from \"../materials/MobileStandardMaterial\";\nimport { textureLoader } from \"../utils/media-utils\";\nimport { getCustomGLTFParserURLResolver } from \"../utils/media-url-utils\";\nimport { promisifyWorker } from \"../utils/promisify-worker.js\";\nimport { MeshBVH, acceleratedRaycast } from \"three-mesh-bvh\";\nimport { disposeNode } from \"../utils/three-utils\";\n\nTHREE.Mesh.prototype.raycast = acceleratedRaycast;\n\nclass GLTFCache {\n  cache = new Map();\n\n  set(src, gltf) {\n    this.cache.set(src, {\n      gltf,\n      count: 0\n    });\n    return this.retain(src);\n  }\n\n  has(src) {\n    return this.cache.has(src);\n  }\n\n  get(src) {\n    return this.cache.get(src);\n  }\n\n  retain(src) {\n    const cacheItem = this.cache.get(src);\n    cacheItem.count++;\n    return cacheItem;\n  }\n\n  release(src) {\n    const cacheItem = this.cache.get(src);\n\n    if (!cacheItem) {\n      console.error(`Releasing uncached gltf ${src}`);\n      return;\n    }\n\n    cacheItem.count--;\n    if (cacheItem.count <= 0) {\n      cacheItem.gltf.scene.traverse(disposeNode);\n      this.cache.delete(src);\n    }\n  }\n}\nconst gltfCache = new GLTFCache();\nconst inflightGltfs = new Map();\n\nconst extractZipFile = promisifyWorker(new SketchfabZipWorker());\n\nfunction defaultInflator(el, componentName, componentData) {\n  if (!AFRAME.components[componentName]) {\n    throw new Error(`Inflator failed. \"${componentName}\" component does not exist.`);\n  }\n  if (AFRAME.components[componentName].multiple && Array.isArray(componentData)) {\n    for (let i = 0; i < componentData.length; i++) {\n      el.setAttribute(componentName + \"__\" + i, componentData[i]);\n    }\n  } else {\n    el.setAttribute(componentName, componentData);\n  }\n}\n\nAFRAME.GLTFModelPlus = {\n  // eslint-disable-next-line no-unused-vars\n  components: {},\n  registerComponent(componentKey, componentName, inflator) {\n    inflator = inflator || defaultInflator;\n    AFRAME.GLTFModelPlus.components[componentKey] = { inflator, componentName };\n  }\n};\n\nfunction parallelTraverse(a, b, callback) {\n  callback(a, b);\n\n  for (let i = 0; i < a.children.length; i++) {\n    parallelTraverse(a.children[i], b.children[i], callback);\n  }\n}\n\nfunction generateMeshBVH(object3D) {\n  object3D.traverse(obj => {\n    // note that we might already have a bounds tree if this was a clone of an object with one\n    const hasBufferGeometry = obj.isMesh && obj.geometry.isBufferGeometry;\n    const hasBoundsTree = hasBufferGeometry && obj.geometry.boundsTree;\n    if (hasBufferGeometry && !hasBoundsTree && obj.geometry.attributes.position) {\n      const geo = obj.geometry;\n      const triCount = geo.index ? geo.index.count / 3 : geo.attributes.position.count / 3;\n      // only bother using memory and time making a BVH if there are a reasonable number of tris,\n      // and if there are too many it's too painful and large to tolerate doing it (at least until\n      // we put this in a web worker)\n      if (triCount > 1000 && triCount < 1000000) {\n        // note that bounds tree construction creates an index as a side effect if one doesn't already exist\n        geo.boundsTree = new MeshBVH(obj.geometry, { strategy: 0, maxDepth: 30 });\n      }\n    }\n  });\n}\n\n// Modified version of Don McCurdy's AnimationUtils.clone\n// https://github.com/mrdoob/three.js/pull/14494\nfunction cloneSkinnedMesh(source) {\n  const cloneLookup = new Map();\n\n  const clone = source.clone();\n\n  parallelTraverse(source, clone, function(sourceNode, clonedNode) {\n    cloneLookup.set(sourceNode, clonedNode);\n    if (sourceNode.isMesh && sourceNode.geometry.boundsTree) {\n      clonedNode.geometry.boundsTree = sourceNode.geometry.boundsTree;\n    }\n  });\n\n  source.traverse(function(sourceMesh) {\n    if (!sourceMesh.isSkinnedMesh) return;\n\n    const sourceBones = sourceMesh.skeleton.bones;\n    const clonedMesh = cloneLookup.get(sourceMesh);\n\n    clonedMesh.skeleton = sourceMesh.skeleton.clone();\n\n    clonedMesh.skeleton.bones = sourceBones.map(function(sourceBone) {\n      if (!cloneLookup.has(sourceBone)) {\n        throw new Error(\"Required bones are not descendants of the given object.\");\n      }\n\n      return cloneLookup.get(sourceBone);\n    });\n\n    clonedMesh.bind(clonedMesh.skeleton, sourceMesh.bindMatrix);\n  });\n\n  return clone;\n}\n\nfunction cloneGltf(gltf) {\n  return {\n    animations: gltf.animations,\n    scene: cloneSkinnedMesh(gltf.scene)\n  };\n}\n\nfunction getHubsComponents(node) {\n  const hubsComponents =\n    node.userData.gltfExtensions &&\n    (node.userData.gltfExtensions.MOZ_hubs_components || node.userData.gltfExtensions.HUBS_components);\n\n  // We can remove support for legacy components when our environment, avatar and interactable models are\n  // updated to match Spoke output.\n  const legacyComponents = node.userData.components;\n\n  return hubsComponents || legacyComponents;\n}\n\n/// Walks the tree of three.js objects starting at the given node, using the GLTF data\n/// and template data to construct A-Frame entities and components when necessary.\n/// (It's unnecessary to construct entities for subtrees that have no component data\n/// or templates associated with any of their nodes.)\n///\n/// Returns the A-Frame entity associated with the given node, if one was constructed.\nconst inflateEntities = function(indexToEntityMap, node, templates, isRoot, modelToWorldScale = 1) {\n  // TODO: Remove this once we update the legacy avatars to the new node names\n  if (node.name === \"Chest\") {\n    node.name = \"Spine\";\n  } else if (node.name === \"Root Scene\") {\n    node.name = \"AvatarRoot\";\n  } else if (node.name === \"Bot_Skinned\") {\n    node.name = \"AvatarMesh\";\n  }\n\n  // inflate subtrees first so that we can determine whether or not this node needs to be inflated\n  const childEntities = [];\n  const children = node.children.slice(0); // setObject3D mutates the node's parent, so we have to copy\n  for (const child of children) {\n    const el = inflateEntities(indexToEntityMap, child, templates);\n    if (el) {\n      childEntities.push(el);\n    }\n  }\n\n  const entityComponents = getHubsComponents(node);\n\n  const nodeHasBehavior = !!entityComponents || node.name in templates;\n  if (!nodeHasBehavior && !childEntities.length && !isRoot) {\n    return null; // we don't need an entity for this node\n  }\n\n  const el = document.createElement(\"a-entity\");\n  el.append.apply(el, childEntities);\n\n  // Remove invalid CSS class name characters.\n  const className = (node.name || node.uuid).replace(/[^\\w-]/g, \"\");\n  el.classList.add(className);\n\n  // AFRAME rotation component expects rotations in YXZ, convert it\n  if (node.rotation.order !== \"YXZ\") {\n    node.rotation.setFromQuaternion(node.quaternion, \"YXZ\");\n  }\n\n  // Copy over the object's transform to the THREE.Group and reset the actual transform of the Object3D\n  // all updates to the object should be done through the THREE.Group wrapper\n  el.object3D.position.copy(node.position);\n  el.object3D.rotation.copy(node.rotation);\n  el.object3D.scale.copy(node.scale).multiplyScalar(modelToWorldScale);\n  el.object3D.matrixNeedsUpdate = true;\n\n  node.matrixAutoUpdate = false;\n  node.matrix.identity();\n  node.matrix.decompose(node.position, node.rotation, node.scale);\n\n  el.setObject3D(node.type.toLowerCase(), node);\n  if (entityComponents && \"nav-mesh\" in entityComponents) {\n    el.setObject3D(\"mesh\", node);\n  }\n\n  // Set the name of the `THREE.Group` to match the name of the node,\n  // so that `THREE.PropertyBinding` will find (and later animate)\n  // the group. See `PropertyBinding.findNode`:\n  // https://github.com/mrdoob/three.js/blob/dev/src/animation/PropertyBinding.js#L211\n  el.object3D.name = node.name;\n  if (node.animations) {\n    // Pass animations up to the group object so that when we can pass the group as\n    // the optional root in `THREE.AnimationMixer.clipAction` and use the hierarchy\n    // preserved under the group (but not the node). Otherwise `clipArray` will be\n    // `null` in `THREE.AnimationClip.findByName`.\n    node.parent.animations = node.animations;\n  }\n\n  const gltfIndex = node.userData.gltfIndex;\n  if (gltfIndex !== undefined) {\n    indexToEntityMap[gltfIndex] = el;\n  }\n\n  return el;\n};\n\nfunction inflateComponents(inflatedEntity, indexToEntityMap) {\n  inflatedEntity.object3D.traverse(object3D => {\n    const entityComponents = getHubsComponents(object3D);\n    const el = object3D.el;\n\n    if (entityComponents && el) {\n      for (const prop in entityComponents) {\n        if (entityComponents.hasOwnProperty(prop) && AFRAME.GLTFModelPlus.components.hasOwnProperty(prop)) {\n          const { componentName, inflator } = AFRAME.GLTFModelPlus.components[prop];\n          inflator(el, componentName, entityComponents[prop], entityComponents, indexToEntityMap);\n        }\n      }\n    }\n  });\n}\n\nfunction attachTemplate(root, name, templateRoot) {\n  const targetEls = root.querySelectorAll(\".\" + name);\n  for (const el of targetEls) {\n    const root = templateRoot.cloneNode(true);\n    // Merge root element attributes with the target element\n    for (const { name, value } of root.attributes) {\n      el.setAttribute(name, value);\n    }\n\n    // Append all child elements\n    while (root.children.length > 0) {\n      el.appendChild(root.children[0]);\n    }\n  }\n}\n\nfunction runMigration(version, json) {\n  if (version < 2) {\n    //old heightfields will be on the same node as the nav-mesh, delete those\n    const oldHeightfieldNode = json.nodes.find(node => {\n      let components = null;\n      if (node.extensions && node.extensions.MOZ_hubs_components) {\n        components = node.extensions.MOZ_hubs_components;\n      } else if (node.extensions && node.extensions.HUBS_components) {\n        components = node.extensions.HUBS_components;\n      }\n      return components && components.heightfield && components[\"nav-mesh\"];\n    });\n    if (oldHeightfieldNode) {\n      if (oldHeightfieldNode.extensions.MOZ_hubs_components) {\n        delete oldHeightfieldNode.extensions.MOZ_hubs_components.heightfield;\n      } else if (oldHeightfieldNode.extensions.HUBS_components) {\n        delete oldHeightfieldNode.extensions.HUBS_components.heightfield;\n      }\n    }\n  }\n}\n\nexport async function loadGLTF(src, contentType, preferredTechnique, onProgress, jsonPreprocessor) {\n  let gltfUrl = src;\n  let fileMap;\n\n  if (contentType.includes(\"model/gltf+zip\") || contentType.includes(\"application/x-zip-compressed\")) {\n    fileMap = await extractZipFile(gltfUrl);\n    gltfUrl = fileMap[\"scene.gtlf\"];\n  }\n\n  const loadingManager = new THREE.LoadingManager();\n  loadingManager.setURLModifier(getCustomGLTFParserURLResolver(gltfUrl));\n  const gltfLoader = new THREE.GLTFLoader(loadingManager);\n\n  const parser = await new Promise((resolve, reject) => gltfLoader.createParser(gltfUrl, resolve, onProgress, reject));\n\n  parser.textureLoader = textureLoader;\n\n  if (jsonPreprocessor) {\n    parser.json = jsonPreprocessor(parser.json);\n  }\n\n  let version = 0;\n  if (\n    parser.json.extensions &&\n    parser.json.extensions.MOZ_hubs_components &&\n    parser.json.extensions.MOZ_hubs_components.hasOwnProperty(\"version\")\n  ) {\n    version = parser.json.extensions.MOZ_hubs_components.version;\n  }\n  runMigration(version, parser.json);\n\n  const materials = parser.json.materials;\n  if (materials) {\n    for (let i = 0; i < materials.length; i++) {\n      const material = materials[i];\n\n      if (\n        material.extensions &&\n        material.extensions.MOZ_alt_materials &&\n        material.extensions.MOZ_alt_materials[preferredTechnique] !== undefined\n      ) {\n        const altMaterialIndex = material.extensions.MOZ_alt_materials[preferredTechnique];\n        materials[i] = materials[altMaterialIndex];\n      }\n    }\n  }\n\n  const nodes = parser.json.nodes;\n\n  if (nodes) {\n    for (let i = 0; i < nodes.length; i++) {\n      const node = nodes[i];\n\n      if (!node.extras) {\n        node.extras = {};\n      }\n\n      node.extras.gltfIndex = i;\n    }\n  }\n\n  const gltf = await new Promise(parser.parse.bind(parser));\n\n  gltf.scene.traverse(object => {\n    // GLTFLoader sets matrixAutoUpdate on animated objects, we want to keep the defaults\n    object.matrixAutoUpdate = THREE.Object3D.DefaultMatrixAutoUpdate;\n\n    object.material = mapMaterials(object, material => {\n      if (material.isMeshStandardMaterial && preferredTechnique === \"KHR_materials_unlit\") {\n        return MobileStandardMaterial.fromStandardMaterial(material);\n      }\n\n      return material;\n    });\n  });\n\n  if (fileMap) {\n    // The GLTF is now cached as a THREE object, we can get rid of the original blobs\n    Object.keys(fileMap).forEach(URL.revokeObjectURL);\n  }\n\n  return gltf;\n}\n\n/**\n * Loads a GLTF model, optionally recursively \"inflates\" the child nodes of a model into a-entities and sets\n * whitelisted components on them if defined in the node's extras.\n * @namespace gltf\n * @component gltf-model-plus\n */\nAFRAME.registerComponent(\"gltf-model-plus\", {\n  schema: {\n    src: { type: \"string\" },\n    contentType: { type: \"string\" },\n    useCache: { default: true },\n    inflate: { default: false },\n    batch: { default: false },\n    modelToWorldScale: { type: \"number\", default: 1 }\n  },\n\n  init() {\n    this.preferredTechnique =\n      window.APP && window.APP.quality === \"low\" ? \"KHR_materials_unlit\" : \"pbrMetallicRoughness\";\n\n    // This can be set externally if a consumer wants to do some node preprocssing.\n    this.jsonPreprocessor = null;\n\n    this.loadTemplates();\n  },\n\n  update() {\n    this.applySrc(this.data.src, this.data.contentType);\n  },\n\n  remove() {\n    if (this.data.batch && this.model) {\n      this.el.sceneEl.systems[\"hubs-systems\"].batchManagerSystem.removeObject(this.el.object3DMap.mesh);\n    }\n    if (this.data.src) {\n      gltfCache.release(this.data.src);\n    }\n  },\n\n  loadTemplates() {\n    this.templates = {};\n    this.el.querySelectorAll(\":scope > template\").forEach(templateEl => {\n      const root = document.importNode(templateEl.firstElementChild || templateEl.content.firstElementChild, true);\n      this.templates[templateEl.getAttribute(\"data-name\")] = root;\n    });\n  },\n\n  async loadModel(src, contentType, technique, useCache) {\n    if (useCache) {\n      if (gltfCache.has(src)) {\n        gltfCache.retain(src);\n        return cloneGltf(gltfCache.get(src).gltf);\n      } else {\n        if (inflightGltfs.has(src)) {\n          const gltf = await inflightGltfs.get(src);\n          gltfCache.retain(src);\n          return cloneGltf(gltf);\n        } else {\n          const promise = loadGLTF(src, contentType, technique, null, this.jsonPreprocessor);\n          inflightGltfs.set(src, promise);\n          const gltf = await promise;\n          inflightGltfs.delete(src);\n          gltfCache.set(src, gltf);\n          return cloneGltf(gltf);\n        }\n      }\n    } else {\n      return loadGLTF(src, contentType, technique, null, this.jsonPreprocessor);\n    }\n  },\n\n  async applySrc(src, contentType) {\n    try {\n      // If the src attribute is a selector, get the url from the asset item.\n      if (src && src.charAt(0) === \"#\") {\n        const assetEl = document.getElementById(src.substring(1));\n        src = assetEl.getAttribute(\"src\");\n      }\n\n      if (src === this.lastSrc) return;\n\n      const lastSrc = this.lastSrc;\n      this.lastSrc = src;\n\n      if (!src) {\n        if (this.inflatedEl) {\n          console.warn(\"gltf-model-plus set to an empty source, unloading inflated model.\");\n          this.disposeLastInflatedEl();\n        }\n        return;\n      }\n\n      this.el.emit(\"model-loading\");\n      const gltf = await this.loadModel(src, contentType, this.preferredTechnique, this.data.useCache);\n\n      // If we started loading something else already\n      // TODO: there should be a way to cancel loading instead\n      if (src != this.lastSrc) return;\n\n      // If we had inflated something already before, clean that up\n      this.disposeLastInflatedEl();\n\n      this.model = gltf.scene || gltf.scenes[0];\n      this.model.animations = gltf.animations;\n\n      if (this.data.batch) {\n        this.el.sceneEl.systems[\"hubs-systems\"].batchManagerSystem.addObject(this.model);\n      }\n\n      if (gltf.animations.length > 0) {\n        this.el.setAttribute(\"animation-mixer\", {});\n        this.el.components[\"animation-mixer\"].initMixer(gltf.animations);\n      } else {\n        generateMeshBVH(this.model);\n      }\n\n      const indexToEntityMap = {};\n\n      let object3DToSet = this.model;\n      if (\n        this.data.inflate &&\n        (this.inflatedEl = inflateEntities(\n          indexToEntityMap,\n          this.model,\n          this.templates,\n          true,\n          this.data.modelToWorldScale\n        ))\n      ) {\n        this.el.appendChild(this.inflatedEl);\n\n        object3DToSet = this.inflatedEl.object3D;\n        // TODO: Still don't fully understand the lifecycle here and how it differs between browsers, we should dig in more\n        // Wait one tick for the appended custom elements to be connected before attaching templates\n        await nextTick();\n        if (src != this.lastSrc) return; // TODO: there must be a nicer pattern for this\n\n        inflateComponents(this.inflatedEl, indexToEntityMap);\n\n        for (const name in this.templates) {\n          attachTemplate(this.el, name, this.templates[name]);\n        }\n      }\n\n      // The call to setObject3D below recursively clobbers any `el` backreferences to entities\n      // in the entire inflated entity graph to point to `object3DToSet`.\n      //\n      // We don't want those overwritten, since lots of code assumes `object3d.el` points to the relevant\n      // A-Frame entity for that three.js object, so we back them up and re-wire them here. If we didn't do\n      // this, all the `el` properties on these object3ds would point to the `object3DToSet` which is either\n      // the model or the root GLTF inflated entity.\n      const rewires = [];\n\n      object3DToSet.traverse(o => {\n        const el = o.el;\n        if (el) rewires.push(() => (o.el = el));\n      });\n\n      const environmentMapComponent = this.el.sceneEl.components[\"environment-map\"];\n\n      if (environmentMapComponent) {\n        environmentMapComponent.applyEnvironmentMap(object3DToSet);\n      }\n\n      if (lastSrc) {\n        gltfCache.release(lastSrc);\n      }\n      this.el.setObject3D(\"mesh\", object3DToSet);\n\n      rewires.forEach(f => f());\n\n      this.el.emit(\"model-loaded\", { format: \"gltf\", model: this.model });\n    } catch (e) {\n      gltfCache.release(src);\n      console.error(\"Failed to load glTF model\", e, this);\n      this.el.emit(\"model-error\", { format: \"gltf\", src });\n    }\n  },\n\n  disposeLastInflatedEl() {\n    if (this.inflatedEl) {\n      this.inflatedEl.parentNode.removeChild(this.inflatedEl);\n\n      this.inflatedEl.object3D.traverse(x => {\n        if (x.material && x.material.dispose) {\n          x.material.dispose();\n        }\n\n        if (x.geometry) {\n          if (x.geometry.dispose) {\n            x.geometry.dispose();\n          }\n\n          x.geometry.boundsTree = null;\n        }\n      });\n\n      delete this.inflatedEl;\n\n      this.el.removeAttribute(\"animation-mixer\");\n    }\n  }\n});\n","// Wrapper for a worker which accepts work items and responds with results.\n//\n// The worker must receive messages with data of the shape { id, payload }, and then respond\n// with messages containing matching IDs of the shape { id, result, err }.\n//\n// Returns a function that accepts a work item, sends it to the worker, and returns a promise that\n// will resolve with the result or reject with the error.\n//\nexport function promisifyWorker(worker) {\n  let nextItemId = 0;\n  const outstanding = {}; // item ID: { resolve, reject }\n\n  worker.onmessage = msg => {\n    const { id, result, err } = msg.data;\n    const handlers = outstanding[id];\n    if (handlers == null) {\n      console.error(`Unknown message with ID ${id} received from ${worker}.`);\n    } else {\n      delete outstanding[id];\n      if (err != null) {\n        handlers.reject(new Error(err));\n      } else {\n        handlers.resolve(result);\n      }\n    }\n  };\n\n  return function(data, transfer) {\n    const id = nextItemId++;\n    const promise = new Promise((resolve, reject) => {\n      outstanding[id] = { resolve, reject };\n    });\n    worker.postMessage({ id, payload: data }, transfer);\n    return promise;\n  };\n}\n","import { forEachMaterial } from \"../utils/material-utils\";\nimport { showHoverEffect } from \"../utils/permissions-utils\";\n\nconst interactorOneTransform = [];\nconst interactorTwoTransform = [];\n\nexport const validMaterials = [\"MeshStandardMaterial\", \"MeshBasicMaterial\", \"MobileStandardMaterial\"];\n/**\n * Applies effects to a hoverable based on hover state.\n * @namespace interactables\n * @component hoverable-visuals\n */\nAFRAME.registerComponent(\"hoverable-visuals\", {\n  schema: {\n    enableSweepingEffect: { type: \"boolean\", default: true }\n  },\n  init() {\n    // uniforms and boundingSphere are set from the component responsible for loading the mesh.\n    this.uniforms = null;\n    this.boundingSphere = new THREE.Sphere();\n\n    this.sweepParams = [0, 0];\n  },\n  remove() {\n    this.uniforms = null;\n    this.boundingBox = null;\n\n    // Used when the object is batched\n    const batchManagerSystem = AFRAME.scenes[0].systems[\"hubs-systems\"].batchManagerSystem;\n    this.el.object3D.traverse(object => {\n      if (!object.material) return;\n      forEachMaterial(object, material => {\n        if (\n          !validMaterials.includes(material.type) ||\n          object.el.classList.contains(\"ui\") ||\n          object.el.classList.contains(\"hud\") ||\n          object.el.getAttribute(\"text-button\")\n        )\n          return;\n\n        batchManagerSystem.meshToEl.delete(object);\n      });\n    });\n  },\n  tick(time) {\n    if (!this.uniforms || !this.uniforms.length) return;\n\n    const isFrozen = this.el.sceneEl.is(\"frozen\");\n    const showEffect = showHoverEffect(this.el);\n\n    let interactorOne, interactorTwo;\n    const interaction = AFRAME.scenes[0].systems.interaction;\n    if (interaction.state.leftHand.hovered === this.el && !interaction.state.leftHand.held) {\n      interactorOne = interaction.options.leftHand.entity.object3D;\n    }\n    if (interaction.state.rightRemote.hovered === this.el && !interaction.state.rightRemote.held) {\n      interactorTwo = interaction.options.rightRemote.entity.object3D;\n    }\n    if (interaction.state.rightHand.hovered === this.el && !interaction.state.rightHand.held) {\n      interactorTwo = interaction.options.rightHand.entity.object3D;\n    }\n\n    if (interactorOne) {\n      interactorOne.matrixWorld.toArray(interactorOneTransform);\n    }\n    if (interactorTwo) {\n      interactorTwo.matrixWorld.toArray(interactorTwoTransform);\n    }\n\n    if (interactorOne || interactorTwo || isFrozen) {\n      const worldY = this.el.object3D.matrixWorld.elements[13];\n      const scaledRadius = this.el.object3D.scale.y * this.boundingSphere.radius;\n      this.sweepParams[0] = worldY - scaledRadius;\n      this.sweepParams[1] = worldY + scaledRadius;\n    }\n\n    for (let i = 0, l = this.uniforms.length; i < l; i++) {\n      const uniform = this.uniforms[i];\n      uniform.hubs_EnableSweepingEffect.value = this.data.enableSweepingEffect && showEffect;\n      uniform.hubs_IsFrozen.value = isFrozen;\n      uniform.hubs_SweepParams.value = this.sweepParams;\n\n      uniform.hubs_HighlightInteractorOne.value = !!interactorOne && showEffect;\n      uniform.hubs_InteractorOnePos.value[0] = interactorOneTransform[12];\n      uniform.hubs_InteractorOnePos.value[1] = interactorOneTransform[13];\n      uniform.hubs_InteractorOnePos.value[2] = interactorOneTransform[14];\n\n      uniform.hubs_HighlightInteractorTwo.value = !!interactorTwo && showEffect;\n      uniform.hubs_InteractorTwoPos.value[0] = interactorTwoTransform[12];\n      uniform.hubs_InteractorTwoPos.value[1] = interactorTwoTransform[13];\n      uniform.hubs_InteractorTwoPos.value[2] = interactorTwoTransform[14];\n\n      if (interactorOne || interactorTwo || isFrozen) {\n        uniform.hubs_Time.value = time;\n      }\n    }\n  }\n});\n","console.log(`Hubs version: ${process.env.BUILD_VERSION || \"?\"}`);\n\n// We should technically be able to just include three here, but our dependancies are tangled such that not having aframe is a bit difficult\nimport \"aframe\";\nimport \"./utils/logging\";\n\nimport { getAirtableAssets, airtableAssetsInitialState } from './everyspace/airtable';\nimport { HelmetComponent } from './everyspace/helmet';\n\nimport ReactDOM from \"react-dom\";\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport classNames from \"classnames\";\n\nimport { IntlProvider, FormattedMessage, addLocaleData } from \"react-intl\";\nimport en from \"react-intl/locale-data/en\";\nimport { lang, messages } from \"./utils/i18n\";\naddLocaleData([...en]);\n\nimport { disableiOSZoom } from \"./utils/disable-ios-zoom\";\ndisableiOSZoom();\n\nimport { App } from \"./App\";\n\nimport AvatarPreview from \"./react-components/avatar-preview\";\n\nimport { fetchAvatar } from \"./utils/avatar-utils\";\n\nimport styles from \"./assets/stylesheets/avatar.scss\";\nimport hubLogo from \"./assets/images/hub-preview-white.png\";\n\nconst qs = new URLSearchParams(location.search);\nwindow.APP = new App();\n\nclass AvatarUI extends React.Component {\n  static propTypes = {\n    avatarId: PropTypes.string,\n    store: PropTypes.object,\n    intl: PropTypes.object\n  };\n\n  constructor(props) {\n    super(props);\n    this.state = {airtableAssets: airtableAssetsInitialState};\n  }\n\n  componentDidMount() {\n    this.props.store.addEventListener(\"statechanged\", this.storeUpdated);\n    this.refetchAvatar();\n\n    this.fetchAirtableAssets()\n  }\n\n  fetchAirtableAssets = async () => {\n    const airtableAssets = await getAirtableAssets()\n    if (airtableAssets) this.setState({ airtableAssets })\n  }\n\n  componentWillUnmount() {\n    this.props.store.removeEventListener(\"statechanged\", this.storeUpdated);\n  }\n\n  storeUpdated = () => this.forceUpdate();\n\n  refetchAvatar = async () => {\n    const avatar = await fetchAvatar(this.props.avatarId);\n    this.setState({ avatar });\n  };\n\n  setAvatar = e => {\n    e && e.preventDefault();\n    this.props.store.update({\n      profile: { avatarId: this.state.avatar.avatar_id }\n    });\n  };\n\n  render() {\n    const { avatar } = this.state;\n    if (!avatar) {\n      return (\n        <div className={styles.avatarLanding}>\n          <div className={classNames([styles.box, styles.darkened])}>Loading</div>\n        </div>\n      );\n    }\n\n    const selectedAvatarId = this.props.store.state.profile.avatarId;\n    const isSelected = avatar.avatar_id === selectedAvatarId;\n\n    return (\n      <form onSubmit={this.setAvatar} className={styles.avatarLanding}>\n        <div className={classNames([styles.box, styles.darkened])}>\n          <HelmetComponent assets={this.state.airtableAssets} page=\"Avatar\" />\n          <label className={styles.title}>\n            <span>{avatar.name}</span>\n          </label>\n          <div className={styles.attributions}>\n            {avatar.attributions && avatar.attributions.creator && <span>{`by ${avatar.attributions.creator}`}</span>}\n          </div>\n          <div className={styles.preview}>{avatar && <AvatarPreview avatarGltfUrl={avatar.gltf_url} />}</div>\n          {isSelected ? (\n            <span className={styles.selectedMessage}>\n              <FormattedMessage id=\"avatar-landing.selected\" />\n            </span>\n          ) : (\n            <button disabled={isSelected} className={styles.formSubmit} type=\"submit\">\n              <FormattedMessage id=\"avatar-landing.select\" />\n            </button>\n          )}\n        </div>\n        <img className={styles.logo} src={this.state.airtableAssets.DarkLogo} />\n      </form>\n    );\n  }\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  const avatarId = qs.get(\"avatar_id\") || document.location.pathname.substring(1).split(\"/\")[1];\n  console.log(`Avatar ID: ${avatarId}`);\n  ReactDOM.render(\n    <IntlProvider locale={lang} messages={messages}>\n      <AvatarUI avatarId={avatarId} store={window.APP.store} />\n    </IntlProvider>,\n    document.getElementById(\"ui-root\")\n  );\n});\n","import { forEachMaterial } from \"../utils/material-utils\";\nimport cubeMapPosX from \"../assets/images/cubemap/posx.jpg\";\nimport cubeMapNegX from \"../assets/images/cubemap/negx.jpg\";\nimport cubeMapPosY from \"../assets/images/cubemap/posy.jpg\";\nimport cubeMapNegY from \"../assets/images/cubemap/negy.jpg\";\nimport cubeMapPosZ from \"../assets/images/cubemap/posz.jpg\";\nimport cubeMapNegZ from \"../assets/images/cubemap/negz.jpg\";\n\nexport async function createDefaultEnvironmentMap() {\n  const urls = [cubeMapPosX, cubeMapNegX, cubeMapPosY, cubeMapNegY, cubeMapPosZ, cubeMapNegZ];\n  const texture = await new Promise((resolve, reject) =>\n    new THREE.CubeTextureLoader().load(urls, resolve, undefined, reject)\n  );\n  texture.format = THREE.RGBFormat;\n  return texture;\n}\n\nAFRAME.registerComponent(\"environment-map\", {\n  init() {\n    this.environmentMap = null;\n\n    this.updateEnvironmentMap = this.updateEnvironmentMap.bind(this);\n  },\n\n  updateEnvironmentMap(environmentMap) {\n    this.environmentMap = environmentMap;\n    this.applyEnvironmentMap(this.el.object3D);\n  },\n\n  applyEnvironmentMap(object3D) {\n    object3D.traverse(object => {\n      forEachMaterial(object, material => {\n        if (material.isMeshStandardMaterial) {\n          material.envMap = this.environmentMap;\n          material.needsUpdate = true;\n        }\n      });\n    });\n  }\n});\n","module.exports = \"if (hubs_HighlightInteractorOne || hubs_HighlightInteractorTwo || hubs_IsFrozen) {\\n  float ratio = 0.0;\\n\\n  if (hubs_EnableSweepingEffect) {\\n    float size = hubs_SweepParams.t - hubs_SweepParams.s;\\n    float line = mod(hubs_Time / 500.0 * size, size * 3.0) + hubs_SweepParams.s - size / 3.0;\\n\\n    if (hubs_WorldPosition.y < line) {\\n      // Highlight with a sweeping gradient.\\n      ratio = max(0.0, 1.0 - (line - hubs_WorldPosition.y) / (size * 1.5));\\n    }\\n  }\\n\\n  // Highlight with a gradient falling off with distance.\\n  float pulse = 9.0 + 3.0 * (sin(hubs_Time / 1000.0) + 1.0);\\n\\n  if (hubs_HighlightInteractorOne) {\\n    float dist1 = distance(hubs_WorldPosition, hubs_InteractorOnePos);\\n    ratio += -min(1.0, pow(dist1 * pulse, 3.0)) + 1.0;\\n  } \\n\\n  if (hubs_HighlightInteractorTwo) {\\n    float dist2 = distance(hubs_WorldPosition, hubs_InteractorTwoPos);\\n    ratio += -min(1.0, pow(dist2 * pulse, 3.0)) + 1.0;\\n  }\\n\\n  ratio = min(1.0, ratio);\\n\\n  // Gamma corrected highlight color\\n  vec3 highlightColor = vec3(0.184, 0.499, 0.933);\\n\\n  gl_FragColor.rgb = (gl_FragColor.rgb * (1.0 - ratio)) + (highlightColor * ratio);\\n}\\n\"","module.exports = __webpack_public_path__ + \"assets/images/cubemap/posx-d235fb97df77b607be04b84125f40e7c.jpg\";","module.exports = __webpack_public_path__ + \"assets/images/cubemap/negx-35034574e114423babdea92b6a2eb97a.jpg\";","module.exports = __webpack_public_path__ + \"assets/images/cubemap/posy-d0c4e1e7979d75923d4d8b49c191bc6e.jpg\";","module.exports = __webpack_public_path__ + \"assets/images/cubemap/negy-35808d21d1d17ac1b84d3184e365093b.jpg\";","module.exports = __webpack_public_path__ + \"assets/images/cubemap/posz-de29aa8396196e4b040cd5305e351dbe.jpg\";","module.exports = __webpack_public_path__ + \"assets/images/cubemap/negz-d73d18a8b7994524dc39a6ea3fcf43fc.jpg\";","import { detectOS } from \"detect-browser\";\n\nexport function disableiOSZoom() {\n  if (detectOS(navigator.userAgent) !== \"iOS\") return;\n\n  let lastTouchAtMs = 0;\n\n  document.addEventListener(\"touchmove\", ev => {\n    if (ev.scale === 1) return;\n\n    ev.preventDefault();\n  });\n\n  document.addEventListener(\"touchend\", ev => {\n    const now = new Date().getTime();\n    const isDoubleTouch = now - lastTouchAtMs <= 300;\n    lastTouchAtMs = now;\n\n    if (isDoubleTouch) {\n      ev.preventDefault();\n    }\n  });\n}\n","import Store from \"./storage/store\";\nimport MediaSearchStore from \"./storage/media-search-store\";\n\nexport class App {\n  constructor() {\n    this.scene = null;\n    this.quality = \"low\";\n    this.store = new Store();\n    this.mediaSearchStore = new MediaSearchStore();\n  }\n\n  setQuality(quality) {\n    if (this.quality === quality) {\n      return false;\n    }\n\n    this.quality = quality;\n\n    if (this.scene) {\n      this.scene.dispatchEvent(new CustomEvent(\"quality-changed\", { detail: quality }));\n    }\n\n    return true;\n  }\n}\n","module.exports = __webpack_public_path__ + \"assets/images/warning_icon-739d2a2ea906737505bcbc2cb51123a8.png\";","module.exports = __webpack_public_path__ + \"assets/images/warning_icon@2x-706e4a4db33f9456bac320e956b4120d.png\";","import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { injectIntl, FormattedMessage } from \"react-intl\";\nimport classNames from \"classnames\";\nimport \"three/examples/js/controls/OrbitControls\";\n\nimport { createDefaultEnvironmentMap } from \"../components/environment-map\";\nimport { loadGLTF } from \"../components/gltf-model-plus\";\nimport { disposeNode } from \"../utils/three-utils\";\nimport { createImageBitmap, disposeImageBitmap } from \"../utils/image-bitmap-utils\";\nimport styles from \"../assets/stylesheets/avatar-preview.scss\";\n\nconst TEXTURE_PROPS = {\n  base_map: [\"map\"],\n  emissive_map: [\"emissiveMap\"],\n  normal_map: [\"normalMap\"],\n  orm_map: [\"aoMap\", \"roughnessMap\", \"metalnessMap\"]\n};\n\nconst ALL_MAPS = Object.keys(TEXTURE_PROPS);\n\n// This should match our aframe renderer=\"antialias: true; colorManagement: true; sortObjects: true;\n// physicallyCorrectLights: true; webgl2: true; multiview: false;\"\nfunction createRenderer(canvas, alpha = false, useDevicePixelRatio = true) {\n  const context = canvas.getContext(\"webgl2\", {\n    alpha,\n    depth: true,\n    antialias: true,\n    premultipliedAlpha: true,\n    preserveDrawingBuffer: false,\n    powerPreference: \"default\"\n  });\n\n  const renderer = new THREE.WebGLRenderer({ alpha, canvas, context });\n  renderer.gammaOutput = true;\n  renderer.gammaFactor = 2.2;\n  renderer.physicallyCorrectLights = true;\n  if (useDevicePixelRatio) {\n    renderer.setPixelRatio(window.devicePixelRatio);\n  }\n  return renderer;\n}\n\nconst createImageBitmapFromURL = url =>\n  fetch(url)\n    .then(r => r.blob())\n    .then(createImageBitmap);\n\nconst ORBIT_ANGLE = new THREE.Euler(-30 * THREE.Math.DEG2RAD, 30 * THREE.Math.DEG2RAD, 0);\nconst DEFAULT_MARGIN = 1;\n\nfunction fitBoxInFrustum(camera, box, center, margin = DEFAULT_MARGIN) {\n  const halfYExtents = Math.max(box.max.y - center.y, center.y - box.min.y);\n  const halfVertFOV = THREE.Math.degToRad(camera.fov / 2);\n  camera.position.set(0, 0, (halfYExtents / Math.tan(halfVertFOV) + box.max.z) * margin);\n  camera.position.applyEuler(ORBIT_ANGLE);\n  camera.position.add(center);\n  camera.lookAt(center);\n}\n\nclass AvatarPreview extends Component {\n  static propTypes = {\n    avatarGltfUrl: PropTypes.string,\n    className: PropTypes.string\n  };\n  constructor(props) {\n    super(props);\n    this.state = { loading: true, error: null };\n    this.avatar = null;\n    this.imageBitmaps = {};\n  }\n\n  componentDidMount = () => {\n    this.scene = new THREE.Scene();\n\n    this.camera = new THREE.PerspectiveCamera(55, this.canvas.clientWidth / this.canvas.clientHeight, 0.1, 1000);\n    this.controls = new THREE.OrbitControls(this.camera, this.canvas);\n    this.controls.enablePan = false;\n\n    const light = new THREE.DirectionalLight(0xf7f6ef, 1);\n    light.position.set(0, 10, 10);\n    this.scene.add(light);\n    this.scene.add(new THREE.HemisphereLight(0xb1e3ff, 0xb1e3ff, 2.5));\n\n    this.camera.position.set(-0.2, 0.5, 0.5);\n    this.camera.matrixAutoUpdate = true;\n\n    this.controls.target.set(0, 0.45, 0);\n    this.controls.update();\n\n    if (this.props.avatarGltfUrl) {\n      this.loadPreviewAvatar(this.props.avatarGltfUrl).then(this.setAvatar);\n    }\n\n    const clock = new THREE.Clock();\n\n    this.snapshotCanvas = document.createElement(\"canvas\");\n    this.snapshotCanvas.width = 720;\n    this.snapshotCanvas.height = 1280;\n    this.snapshotCamera = new THREE.PerspectiveCamera(55, 720 / 1280, 0.1, 1000);\n    this.snapshotCamera.matrixAutoUpdate = true;\n    this.snapshotRenderer = createRenderer(this.snapshotCanvas, true, false);\n    this.snapshotRenderer.setClearAlpha(0);\n\n    this.previewRenderer = createRenderer(this.canvas);\n    this.previewRenderer.setClearColor(0xeaeaea);\n    this.previewRenderer.setAnimationLoop(() => {\n      const dt = clock.getDelta();\n      this.mixer && this.mixer.update(dt);\n      this.previewRenderer.render(this.scene, this.camera);\n    });\n    window.addEventListener(\"resize\", this.resize);\n    this.resize();\n  };\n\n  resize = () => {\n    const width = this.canvas.parentElement.offsetWidth;\n    const height = this.canvas.parentElement.offsetHeight;\n    this.previewRenderer.setSize(width, height);\n    this.camera.aspect = width / height;\n    this.camera.updateProjectionMatrix();\n  };\n\n  setAvatar = avatar => {\n    if (!avatar) return;\n    this.avatar = avatar;\n    this.scene.add(avatar);\n    this.resetCamera();\n    this.setState({ error: null, loading: false });\n  };\n\n  resetCamera = (() => {\n    const box = new THREE.Box3();\n    const center = new THREE.Vector3();\n    return () => {\n      box.setFromObject(this.avatar);\n      box.getCenter(center);\n\n      // Shift the center vertically in order to frame the avatar nicely.\n      center.y = (box.max.y - box.min.y) * 0.6 + box.min.y;\n\n      fitBoxInFrustum(this.camera, box, center);\n      fitBoxInFrustum(this.snapshotCamera, box, center, 0.7);\n\n      this.controls.target.copy(center);\n      this.controls.update();\n    };\n  })();\n\n  componentWillUnmount = () => {\n    // Gotta be particularly careful about disposing things here since we will likely create many avatar\n    // previews during a session and Chrome will eventually discard the oldest webgl context if we leak\n    // contexts by holding on to them directly or indirectly.\n\n    this.scene && this.scene.traverse(disposeNode);\n    if (this.previewRenderer) {\n      this.previewRenderer.dispose();\n      this.previewRenderer.context = null;\n    }\n    if (this.snapshotRenderer) {\n      this.snapshotRenderer.dispose();\n      this.snapshotRenderer.context = null;\n    }\n    if (this.controls) {\n      this.controls.dispose();\n      this.controls.domElement = null;\n    }\n\n    Object.values(this.imageBitmaps).forEach(img => disposeImageBitmap(img));\n    window.removeEventListener(\"resize\", this.resize);\n  };\n\n  componentDidUpdate = async oldProps => {\n    if (oldProps.avatarGltfUrl !== this.props.avatarGltfUrl) {\n      if (this.avatar) {\n        this.scene.remove(this.avatar);\n        this.avatar = null;\n      }\n      if (this.props.avatarGltfUrl) {\n        this.setState({ error: null, loading: true });\n        await this.loadPreviewAvatar(this.props.avatarGltfUrl).then(this.setAvatar);\n      }\n    }\n    this.applyMaps(oldProps, this.props);\n  };\n\n  applyMaps(oldProps, newProps) {\n    return Promise.all(\n      ALL_MAPS.map(mapName => {\n        const applyMap = this.applyMapToPreview.bind(this, mapName);\n        if (oldProps[mapName] != newProps[mapName]) {\n          if (newProps[mapName] instanceof File) {\n            return createImageBitmap(newProps[mapName]).then(applyMap);\n          } else if (newProps[mapName]) {\n            return createImageBitmapFromURL(newProps[mapName]).then(applyMap);\n          } else {\n            return this.revertMap(mapName);\n          }\n        }\n      })\n    );\n  }\n\n  loadPreviewAvatar = async avatarGltfUrl => {\n    let gltf;\n    try {\n      gltf = await loadGLTF(avatarGltfUrl, \"model/gltf\");\n    } catch (e) {\n      this.setState({ loading: false, error: true });\n      return;\n    }\n\n    // On the backend we look for a material called Bot_PBS, here we are looking for a mesh called Avatar.\n    // When we \"officially\" support uploading custom GLTFs we need to decide what we are going to key things on\n    this.previewMesh =\n      gltf.scene.getObjectByName(\"AvatarMesh\") ||\n      gltf.scene.getObjectByName(\"Avatar\") ||\n      gltf.scene.getObjectByName(\"Bot_Skinned\") ||\n      gltf.scene;\n\n    const idleAnimation = gltf.animations && gltf.animations.find(({ name }) => name === \"idle_eyes\");\n    if (idleAnimation) {\n      this.mixer = new THREE.AnimationMixer(this.previewMesh);\n      const action = this.mixer.clipAction(idleAnimation);\n      action.enabled = true;\n      action.setLoop(THREE.LoopRepeat, Infinity).play();\n      this.idleAnimationAction = action;\n    }\n\n    const { material } = this.previewMesh;\n    if (material) {\n      // We delete onUpdate here to opt out of the auto texture cleanup after GPU upload.\n      const getImage = p => delete material[p].onUpdate && material[p].image;\n      this.originalMaps = {\n        base_map: TEXTURE_PROPS[\"base_map\"].map(getImage),\n        emissive_map: TEXTURE_PROPS[\"emissive_map\"].map(getImage),\n        normal_map: TEXTURE_PROPS[\"normal_map\"].map(getImage),\n        orm_map: TEXTURE_PROPS[\"orm_map\"].map(getImage)\n      };\n\n      await Promise.all([\n        this.applyMaps({}, this.props), // Apply initial maps\n        createDefaultEnvironmentMap().then(t => {\n          this.previewMesh.material.envMap = t;\n          this.previewMesh.material.needsUpdate = true;\n        })\n      ]);\n    } else {\n      this.originalMaps = {};\n    }\n\n    return gltf.scene;\n  };\n\n  applyMapToPreview = (name, image) => {\n    if (this.imageBitmaps[name]) {\n      disposeImageBitmap(this.imageBitmaps[name]);\n    }\n    this.imageBitmaps[name] = image;\n    TEXTURE_PROPS[name].forEach(prop => {\n      const texture = this.previewMesh.material[prop];\n      texture.image = image;\n      texture.needsUpdate = true;\n    });\n  };\n\n  revertMap = name => {\n    if (this.imageBitmaps[name]) {\n      disposeImageBitmap(this.imageBitmaps[name]);\n    }\n    delete this.imageBitmaps[name];\n    this.originalMaps[name].forEach((bm, i) => {\n      const texture = this.previewMesh.material[TEXTURE_PROPS[name][i]];\n      texture.image = bm;\n      texture.needsUpdate = true;\n    });\n  };\n\n  snapshot = () => {\n    return new Promise(resolve => {\n      if (this.idleAnimationAction) this.idleAnimationAction.stop();\n      this.snapshotRenderer.render(this.scene, this.snapshotCamera);\n      this.snapshotCanvas.toBlob(blob => {\n        if (this.idleAnimationAction) this.idleAnimationAction.play();\n        resolve(blob);\n      });\n    });\n  };\n\n  render() {\n    return (\n      <div className={classNames(styles.preview, this.props.className)}>\n        {this.state.loading &&\n          !this.state.error && (\n            <div className=\"loader\">\n              <div className=\"loader-center\" />\n            </div>\n          )}\n        {this.state.error &&\n          !this.state.loading && (\n            <div className=\"error\">\n              <img\n                src=\"../assets/images/warning_icon.png\"\n                srcSet=\"../assets/images/warning_icon@2x.png 2x\"\n                className=\"error-icon\"\n              />\n              <FormattedMessage id=\"avatar-preview.loading-failed\" />\n            </div>\n          )}\n        <canvas ref={c => (this.canvas = c)} />\n      </div>\n    );\n  }\n}\n\nexport default injectIntl(AvatarPreview, { withRef: true });\n","function loadAsync(loader, url, onProgress) {\n  return new Promise((resolve, reject) => loader.load(url, resolve, onProgress, reject));\n}\n\nexport default class HubsTextureLoader {\n  static crossOrigin = \"anonymous\";\n\n  constructor(manager = THREE.DefaultLoadingManager) {\n    this.manager = manager;\n  }\n\n  load(url, onLoad, onProgress, onError) {\n    const texture = new THREE.Texture();\n\n    this.loadTextureAsync(texture, url, onProgress)\n      .then(onLoad)\n      .catch(onError);\n\n    return texture;\n  }\n\n  async loadTextureAsync(texture, src, onProgress) {\n    let imageLoader;\n\n    if (window.createImageBitmap !== undefined) {\n      imageLoader = new THREE.ImageBitmapLoader(this.manager);\n      texture.flipY = false;\n    } else {\n      imageLoader = new THREE.ImageLoader(this.manager);\n    }\n\n    imageLoader.setCrossOrigin(this.crossOrigin);\n    imageLoader.setPath(this.path);\n\n    const cacheKey = this.manager.resolveURL(src);\n\n    texture.image = await loadAsync(imageLoader, src, onProgress);\n\n    // Image was just added to cache before this function gets called, disable caching by immediatly removing it\n    THREE.Cache.remove(cacheKey);\n\n    texture.needsUpdate = true;\n\n    texture.onUpdate = function() {\n      // Delete texture data once it has been uploaded to the GPU\n      texture.image.close && texture.image.close();\n      delete texture.image;\n    };\n\n    return texture;\n  }\n\n  setCrossOrigin(value) {\n    this.crossOrigin = value;\n    return this;\n  }\n\n  setPath(value) {\n    this.path = value;\n    return this;\n  }\n}\n","import { objectTypeForOriginAndContentType } from \"../object-types\";\nimport { getReticulumFetchUrl } from \"./phoenix-utils\";\nimport mediaHighlightFrag from \"./media-highlight-frag.glsl\";\nimport { mapMaterials } from \"./material-utils\";\nimport HubsTextureLoader from \"../loaders/HubsTextureLoader\";\nimport { validMaterials } from \"../components/hoverable-visuals\";\n\nconst mediaAPIEndpoint = getReticulumFetchUrl(\"/api/v1/media\");\n\n// Map<String, Promise<Object>\nconst resolveUrlCache = new Map();\nexport const resolveUrl = async (url, index) => {\n  const cacheKey = `${url}|${index}`;\n  if (resolveUrlCache.has(cacheKey)) return resolveUrlCache.get(cacheKey);\n\n  const resultPromise = fetch(mediaAPIEndpoint, {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ media: { url, index } })\n  }).then(async response => {\n    if (!response.ok) {\n      const message = `Error resolving url \"${url}\":`;\n      try {\n        const body = await response.text();\n        throw new Error(message + \" \" + body);\n      } catch (e) {\n        throw new Error(message + \" \" + response.statusText);\n      }\n    }\n    return response.json();\n  });\n\n  resolveUrlCache.set(cacheKey, resultPromise);\n  return resultPromise;\n};\n\nexport const upload = (file, desiredContentType) => {\n  const formData = new FormData();\n  formData.append(\"media\", file);\n  formData.append(\"promotion_mode\", \"with_token\");\n\n  if (desiredContentType) {\n    formData.append(\"desired_content_type\", desiredContentType);\n  }\n\n  return fetch(mediaAPIEndpoint, {\n    method: \"POST\",\n    body: formData\n  }).then(r => r.json());\n};\n\n// https://stackoverflow.com/questions/7584794/accessing-jpeg-exif-rotation-data-in-javascript-on-the-client-side/32490603#32490603\nfunction getOrientation(file, callback) {\n  const reader = new FileReader();\n  reader.onload = function(e) {\n    const view = new DataView(e.target.result);\n    if (view.getUint16(0, false) != 0xffd8) {\n      return callback(-2);\n    }\n    const length = view.byteLength;\n    let offset = 2;\n    while (offset < length) {\n      if (view.getUint16(offset + 2, false) <= 8) return callback(-1);\n      const marker = view.getUint16(offset, false);\n      offset += 2;\n      if (marker == 0xffe1) {\n        if (view.getUint32((offset += 2), false) != 0x45786966) {\n          return callback(-1);\n        }\n\n        const little = view.getUint16((offset += 6), false) == 0x4949;\n        offset += view.getUint32(offset + 4, little);\n        const tags = view.getUint16(offset, little);\n        offset += 2;\n        for (let i = 0; i < tags; i++) {\n          if (view.getUint16(offset + i * 12, little) == 0x0112) {\n            return callback(view.getUint16(offset + i * 12 + 8, little));\n          }\n        }\n      } else if ((marker & 0xff00) != 0xff00) {\n        break;\n      } else {\n        offset += view.getUint16(offset, false);\n      }\n    }\n    return callback(-1);\n  };\n  reader.readAsArrayBuffer(file);\n}\n\nlet interactableId = 0;\nexport const addMedia = (\n  src,\n  template,\n  contentOrigin,\n  contentSubtype = null,\n  resolve = false,\n  resize = false,\n  animate = true\n) => {\n  const scene = AFRAME.scenes[0];\n\n  const entity = document.createElement(\"a-entity\");\n  entity.id = \"interactable-media-\" + interactableId++;\n  entity.setAttribute(\"networked\", { template: template });\n  const needsToBeUploaded = src instanceof File;\n  entity.setAttribute(\"media-loader\", {\n    resize,\n    resolve,\n    animate,\n    src: typeof src === \"string\" ? src : \"\",\n    contentSubtype,\n    fileIsOwned: !needsToBeUploaded\n  });\n\n  entity.object3D.matrixNeedsUpdate = true;\n\n  scene.appendChild(entity);\n\n  const fireLoadingTimeout = setTimeout(() => {\n    scene.emit(\"media-loading\", { src: src });\n  }, 100);\n\n  [\"model-loaded\", \"video-loaded\", \"image-loaded\"].forEach(eventName => {\n    entity.addEventListener(\n      eventName,\n      async () => {\n        clearTimeout(fireLoadingTimeout);\n        scene.emit(\"media-loaded\", { src: src });\n      },\n      { once: true }\n    );\n  });\n\n  const orientation = new Promise(function(resolve) {\n    if (needsToBeUploaded) {\n      getOrientation(src, x => {\n        resolve(x);\n      });\n    } else {\n      resolve(1);\n    }\n  });\n  if (needsToBeUploaded) {\n    // Video camera videos are converted to mp4 for compatibility\n    const desiredContentType = contentSubtype === \"video-camera\" ? \"video/mp4\" : null;\n\n    upload(src, desiredContentType)\n      .then(response => {\n        const srcUrl = new URL(response.raw);\n        srcUrl.searchParams.set(\"token\", response.meta.access_token);\n        entity.setAttribute(\"media-loader\", { resolve: false, src: srcUrl.href, fileId: response.file_id });\n        window.APP.store.update({\n          uploadPromotionTokens: [{ fileId: response.file_id, promotionToken: response.meta.promotion_token }]\n        });\n      })\n      .catch(e => {\n        console.error(\"Media upload failed\", e);\n        entity.setAttribute(\"media-loader\", { src: \"error\" });\n      });\n  } else if (src instanceof MediaStream) {\n    entity.setAttribute(\"media-loader\", { src: `hubs://clients/${NAF.clientId}/video` });\n  }\n\n  if (contentOrigin) {\n    entity.addEventListener(\"media_resolved\", ({ detail }) => {\n      const objectType = objectTypeForOriginAndContentType(contentOrigin, detail.contentType, detail.src);\n      scene.emit(\"object_spawned\", { objectType });\n    });\n  }\n\n  return { entity, orientation };\n};\n\nexport function injectCustomShaderChunks(obj) {\n  const vertexRegex = /\\bskinning_vertex\\b/;\n  const fragRegex = /\\bgl_FragColor\\b/;\n\n  const shaderUniforms = [];\n  const batchManagerSystem = AFRAME.scenes[0].systems[\"hubs-systems\"].batchManagerSystem;\n\n  obj.traverse(object => {\n    if (!object.material) return;\n\n    object.material = mapMaterials(object, material => {\n      if (!validMaterials.includes(material.type)) {\n        return material;\n      }\n\n      // HACK, this routine inadvertently leaves the A-Frame shaders wired to the old, dark\n      // material, so maps cannot be updated at runtime. This breaks UI elements who have\n      // hover/toggle state, so for now just skip these while we figure out a more correct\n      // solution.\n      if (\n        object.el.classList.contains(\"ui\") ||\n        object.el.classList.contains(\"hud\") ||\n        object.el.getAttribute(\"text-button\")\n      )\n        return material;\n\n      // Used when the object is batched\n      batchManagerSystem.meshToEl.set(object, obj.el);\n\n      const newMaterial = material.clone();\n      // This will not run if the object is never rendered unbatched, since its unbatched shader will never be compiled\n      newMaterial.onBeforeCompile = shader => {\n        if (!vertexRegex.test(shader.vertexShader)) return;\n\n        shader.uniforms.hubs_IsFrozen = { value: false };\n        shader.uniforms.hubs_EnableSweepingEffect = { value: false };\n        shader.uniforms.hubs_SweepParams = { value: [0, 0] };\n        shader.uniforms.hubs_InteractorOnePos = { value: [0, 0, 0] };\n        shader.uniforms.hubs_InteractorTwoPos = { value: [0, 0, 0] };\n        shader.uniforms.hubs_HighlightInteractorOne = { value: false };\n        shader.uniforms.hubs_HighlightInteractorTwo = { value: false };\n        shader.uniforms.hubs_Time = { value: 0 };\n\n        const vchunk = `\n        if (hubs_HighlightInteractorOne || hubs_HighlightInteractorTwo || hubs_IsFrozen) {\n          vec4 wt = modelMatrix * vec4(transformed, 1);\n\n          // Used in the fragment shader below.\n          hubs_WorldPosition = wt.xyz;\n        }\n      `;\n\n        const vlines = shader.vertexShader.split(\"\\n\");\n        const vindex = vlines.findIndex(line => vertexRegex.test(line));\n        vlines.splice(vindex + 1, 0, vchunk);\n        vlines.unshift(\"varying vec3 hubs_WorldPosition;\");\n        vlines.unshift(\"uniform bool hubs_IsFrozen;\");\n        vlines.unshift(\"uniform bool hubs_HighlightInteractorOne;\");\n        vlines.unshift(\"uniform bool hubs_HighlightInteractorTwo;\");\n        shader.vertexShader = vlines.join(\"\\n\");\n\n        const flines = shader.fragmentShader.split(\"\\n\");\n        const findex = flines.findIndex(line => fragRegex.test(line));\n        flines.splice(findex + 1, 0, mediaHighlightFrag);\n        flines.unshift(\"varying vec3 hubs_WorldPosition;\");\n        flines.unshift(\"uniform bool hubs_IsFrozen;\");\n        flines.unshift(\"uniform bool hubs_EnableSweepingEffect;\");\n        flines.unshift(\"uniform vec2 hubs_SweepParams;\");\n        flines.unshift(\"uniform bool hubs_HighlightInteractorOne;\");\n        flines.unshift(\"uniform vec3 hubs_InteractorOnePos;\");\n        flines.unshift(\"uniform bool hubs_HighlightInteractorTwo;\");\n        flines.unshift(\"uniform vec3 hubs_InteractorTwoPos;\");\n        flines.unshift(\"uniform float hubs_Time;\");\n        shader.fragmentShader = flines.join(\"\\n\");\n\n        shaderUniforms.push(shader.uniforms);\n      };\n      newMaterial.needsUpdate = true;\n      return newMaterial;\n    });\n  });\n\n  return shaderUniforms;\n}\n\nexport function getPromotionTokenForFile(fileId) {\n  return window.APP.store.state.uploadPromotionTokens.find(upload => upload.fileId === fileId);\n}\n\nconst mediaPos = new THREE.Vector3();\n\nexport function addAndArrangeMedia(el, media, contentSubtype, snapCount, mirrorOrientation = false) {\n  const { entity, orientation } = addMedia(media, \"#interactable-media\", undefined, contentSubtype, false);\n\n  const pos = el.object3D.position;\n\n  entity.object3D.position.set(pos.x, pos.y, pos.z);\n  entity.object3D.rotation.copy(el.object3D.rotation);\n\n  if (mirrorOrientation) {\n    entity.object3D.rotateY(Math.PI);\n  }\n\n  // Generate photos in a circle around camera, starting from the bottom.\n  // Prevent z-fighting but place behind viewfinder\n  const idx = (snapCount % 6) + 3;\n\n  mediaPos.set(\n    Math.cos(Math.PI * 2 * (idx / 6.0)) * 0.75,\n    Math.sin(Math.PI * 2 * (idx / 6.0)) * 0.75,\n    -0.05 + idx * 0.001\n  );\n\n  el.object3D.localToWorld(mediaPos);\n  entity.object3D.visible = false;\n\n  const handler = () => {\n    entity.object3D.visible = true;\n    entity.setAttribute(\"animation__photo_pos\", {\n      property: \"position\",\n      dur: 800,\n      from: { x: pos.x, y: pos.y, z: pos.z },\n      to: { x: mediaPos.x, y: mediaPos.y, z: mediaPos.z },\n      easing: \"easeOutElastic\"\n    });\n  };\n\n  let eventType = null;\n\n  if (contentSubtype.startsWith(\"photo\")) {\n    entity.addEventListener(\"image-loaded\", handler, { once: true });\n    eventType = \"photo\";\n  } else if (contentSubtype.startsWith(\"video\")) {\n    entity.addEventListener(\"video-loaded\", handler, { once: true });\n    eventType = \"video\";\n  } else {\n    console.error(\"invalid type \" + contentSubtype);\n    return;\n  }\n\n  entity.object3D.matrixNeedsUpdate = true;\n\n  entity.addEventListener(\n    \"media_resolved\",\n    () => {\n      el.emit(`${eventType}_taken`, entity.components[\"media-loader\"].data.src);\n    },\n    { once: true }\n  );\n\n  return { entity, orientation };\n}\n\nexport const textureLoader = new HubsTextureLoader().setCrossOrigin(\"anonymous\");\n\nexport async function createImageTexture(url) {\n  const texture = new THREE.Texture();\n\n  try {\n    await textureLoader.loadTextureAsync(texture, url);\n  } catch (e) {\n    throw new Error(`'${url}' could not be fetched (Error code: ${e.status}; Response: ${e.statusText})`);\n  }\n\n  texture.encoding = THREE.sRGBEncoding;\n  texture.anisotropy = 4;\n\n  return texture;\n}\n","// removed by extract-text-webpack-plugin\nmodule.exports = {\"preview\":\"avatar-preview__preview__2I8qx\"};","// removed by extract-text-webpack-plugin\nmodule.exports = {\"avatar-landing\":\"avatar__avatar-landing__3bdoO\",\"avatarLanding\":\"avatar__avatar-landing__3bdoO\",\"form-submit\":\"avatar__form-submit__3OEBN\",\"formSubmit\":\"avatar__form-submit__3OEBN\",\"title\":\"avatar__title__PP1dU\",\"attributions\":\"avatar__attributions__1Ej7c\",\"logo\":\"avatar__logo__35vmn\",\"box\":\"avatar__box__vyKNY\",\"selected-message\":\"avatar__selected-message__25S2j\",\"selectedMessage\":\"avatar__selected-message__25S2j\",\"preview\":\"avatar__preview__3T2SV\"};","const qs = new URLSearchParams(location.search);\n\nexport default function qsTruthy(param) {\n  const val = qs.get(param);\n  // if the param exists but is not set (e.g. \"?foo&bar\"), its value is the empty string.\n  return val === \"\" || /1|on|true|yes/i.test(val);\n}\n","import {Helmet} from 'react-helmet'\nimport React from \"react\";\n\nexport const HelmetComponent = ({assets, page}) => {\n\tlet pageTitle = page;\n\tconst titleRoot = assets.Page_Title_Root;\n\tif (titleRoot) pageTitle = `${titleRoot} | ${page}`;\n\treturn <Helmet>\n        <title>{pageTitle}</title>\n        <link rel=\"icon\" sizes=\"16x16 24x24 32x32 48x48 64x64\" href={assets.Favicon} />\n\t    <meta property=\"og:title\" content={assets.Name} />\n\t    <meta property=\"og:description\" content={assets.Social_Description} />\n\t    <meta property=\"og:image\" content={assets.Social_Image} />\n\t    <meta name=\"twitter:site\" content={assets.Twitter_Handle} />\n\t    <meta name=\"twitter:title\" content={assets.Name} />\n\t    <meta name=\"twitter:image\" content={assets.Social_Image} />\n\t    <meta name=\"twitter:description\" content={assets.Social_Description} />\n\t    <meta name=\"application-name\" content={assets.Name} />\n    </Helmet>\n}","import Airtable from 'airtable';\nAirtable.configure({\n    endpointUrl: 'https://api.airtable.com',\n    apiKey: 'keyOHSVeLr3ryLrL5'\n});\nconst base = Airtable.base('appIR0AlHDFG5WR8z');\n\nexport const airtableAssetsInitialState = { DarkLogo: null, Name: null, Icon: null }\n\nlet assets;\n\nconst airtableAssets = base('Assets');\n// export const getAirtableAssets = () => airtableAssets.find('recHqITRS7cBMwn9i');\nexport const getAirtableAssets = async () => {\n    if (assets) return assets;\n    const result = await airtableAssets.select({\n        view: 'Grid view'\n    }).firstPage()\n    assets = result[0].fields;\n    return result[0].fields\n}\n\nexport const airtableMessages = base('Messages').select({\n    view: 'Grid view'\n}).firstPage(async (err, records) => {\n    if (err) { console.error(err); return; }\n    const record = records[0];\n    return record;\n});;","import { airtableMessages } from './airtable'\nimport { Name, Hero_Blurb } from './customization'\nimport translations from '../assets/translations.data.json';\nlet modifiedTranslations = translations;\nconst name = Name;\n// const name = airtableMessages && airtableMessages.get('Name') || \"Axon Park\";\n\n// modifiedTranslations.en[\"home.hero_blurb\"] = airtableMessages && airtableMessages.get('Motto') || 'Learn together, from anywhere.\\nThe future of learning is virtual.\\nEqualizing access to premier quality education.';\nmodifiedTranslations.en[\"home.hero_blurb\"] = Hero_Blurb;\nmodifiedTranslations.en[\"sign-in.rename-room\"] = `You'll need to sign in to rename ${name}.`;\nmodifiedTranslations.en[\"sign-in.close-room\"] = `You'll need to sign in to close ${name}.`;\nmodifiedTranslations.en[\"rename-room.message\"] = `Enter the new name for ${name}.`;\nmodifiedTranslations.en[\"rename-room.rename\"] = `Rename ${name}`;\nmodifiedTranslations.en[\"close-room.message\"] =\n  `Closing this room will remove yourself and others from ${name}, shutting it down permanently.\\n\\nAre you sure? This action cannot be undone.`;\nmodifiedTranslations.en[\"close-room.confirm\"] = `Yes, Close ${name}`;\nmodifiedTranslations.en[\"entry.enter-room\"] = `Enter ${name}`;\nmodifiedTranslations.en[\"entry.leave-room\"] = `Leave ${name}`;\nmodifiedTranslations.en[\"entry.in-lobby-notice\"] = `You are viewing ${name} from the lobby.`;\nmodifiedTranslations.en[\"exit.subtitle.kicked\"] = `You have been kicked from ${name}.`;\nmodifiedTranslations.en[\"exit.subtitle.left\"] = `You have left ${name}.`;\nmodifiedTranslations.en[\"exit.subtitle.disconnected\"] = `You have disconnected from ${name}. Refresh the page to try to reconnect.`;\nmodifiedTranslations.en[\"presence.entered_room\"] = `entered ${name}.`;\nmodifiedTranslations.en[\"presence.entered_lobby\"] = `entered ${name}'s lobby.`;\nmodifiedTranslations.en[\"presence.join_lobby\"] = `joined the ${name} lobby.`;\nmodifiedTranslations.en[\"presence.join_room\"] = `joined ${name}.`;\nmodifiedTranslations.en[\"presence.in_lobby\"] = `${name} Lobby`;\nmodifiedTranslations.en[\"presence.in_room\"] = `In ${name}`;\nmodifiedTranslations.en[\"home.create_a_room\"] = `Initialize ${name}`;\nmodifiedTranslations.en[\"home.room_create_button\"] = `Initialize ${name}`;\nmodifiedTranslations.en[\"home.have_code\"] = `Have an ${name} code?`;\nmodifiedTranslations.en[\"commands.leave\"] = `Disconnect from ${name}.`;\nmodifiedTranslations.en[\"settings.rename-room\"] = `Set ${name} Name...`;\nmodifiedTranslations.en[\"settings.close-room\"] = `Close ${name}...`;\nmodifiedTranslations.en[\"settings.leave-room\"] = `Leave ${name}`;\nmodifiedTranslations.en[\"settings.room-info\"] = `${name} Info`;\nmodifiedTranslations.en[\"settings.create-room\"] = `New ${name}...`;\nmodifiedTranslations.en[\"settings.row-room\"] = `${name}`;\nmodifiedTranslations.en[\"settings.room-settings\"] = `${name} Settings`;\nmodifiedTranslations.en[\"tips.mobile.object_pin\"] = `Pin an object to save it to ${name}.`;\nmodifiedTranslations.en[\"tips.mobile.object_pin\"] = `Pin an object to save it to ${name}.`;\nmodifiedTranslations.en[\"tips.mobile.invite\"] = `Use the Invite button to share ${name}.`;\nmodifiedTranslations.en[\"tips.desktop.object_pin\"] = `Pin an object to save it to ${name}.`;\nmodifiedTranslations.en[\"tips.watching.back\"] = `Enter ${name}`;\nmodifiedTranslations.en[\"leave-room-dialog.create-room.confirm\"] = `Leave ${name}.`;\n\nexport default modifiedTranslations;","export const Name = \"Axon Park\"\nexport const Hero_Blurb = 'Learn together, from anywhere.\\nThe future of learning is virtual.\\nEqualizing access to premier quality education.'","import localeData from \"../everyspace/messages.js\";\n// import localeData from \"../assets/translations.data.json\";\nconst navigatorLang = ((navigator.languages && navigator.languages[0]) || navigator.language || navigator.userLanguage)\n  .toLowerCase()\n  .split(/[_-]+/)[0];\nexport const lang = (localeData[navigatorLang] && navigatorLang) || \"en\";\nexport const messages = localeData[lang] || localeData.en;\n","// A-Frame blows away any npm debug log filters so this allow the user to set the log filter\n// via the query string.\nimport debug from \"debug\";\nimport qsTruthy from \"./qs_truthy\";\n\nconst qs = new URLSearchParams(location.search);\nconst isDebug = qsTruthy(\"debug\");\nconst logFilter = qs.get(\"log_filter\") || (isDebug && \"naf-janus-adapter:*\");\n\nif (logFilter) {\n  debug.enable(logFilter);\n}\n","const tempVector3 = new THREE.Vector3();\nconst tempQuaternion = new THREE.Quaternion();\n\nexport function getLastWorldPosition(src, target) {\n  src.updateMatrices();\n  target.setFromMatrixPosition(src.matrixWorld);\n  return target;\n}\n\nexport function getLastWorldQuaternion(src, target) {\n  src.updateMatrices();\n  src.matrixWorld.decompose(tempVector3, target, tempVector3);\n  return target;\n}\n\nexport function getLastWorldScale(src, target) {\n  src.updateMatrices();\n  src.matrixWorld.decompose(tempVector3, tempQuaternion, target);\n  return target;\n}\n\nexport function disposeMaterial(mtrl) {\n  if (mtrl.map) mtrl.map.dispose();\n  if (mtrl.lightMap) mtrl.lightMap.dispose();\n  if (mtrl.bumpMap) mtrl.bumpMap.dispose();\n  if (mtrl.normalMap) mtrl.normalMap.dispose();\n  if (mtrl.specularMap) mtrl.specularMap.dispose();\n  if (mtrl.envMap) mtrl.envMap.dispose();\n  mtrl.dispose();\n}\n\nexport function disposeNode(node) {\n  if (!(node instanceof THREE.Mesh)) return;\n\n  if (node.geometry) {\n    node.geometry.dispose();\n  }\n\n  if (node.material) {\n    let materialArray;\n    if (node.material instanceof THREE.MeshFaceMaterial || node.material instanceof THREE.MultiMaterial) {\n      materialArray = node.material.materials;\n    } else if (node.material instanceof Array) {\n      materialArray = node.material;\n    }\n    if (materialArray) {\n      materialArray.forEach(disposeMaterial);\n    } else {\n      disposeMaterial(node.material);\n    }\n  }\n}\n\nexport function setMatrixWorld(object3D, m) {\n  object3D.matrixWorld.copy(m);\n  object3D.matrix = object3D.matrix.getInverse(object3D.parent.matrixWorld).multiply(object3D.matrixWorld);\n  object3D.matrix.decompose(object3D.position, object3D.quaternion, object3D.scale);\n}\n","export function forEachMaterial(object3D, fn) {\n  if (!object3D.material) return;\n\n  if (Array.isArray(object3D.material)) {\n    object3D.material.forEach(fn);\n  } else {\n    fn(object3D.material);\n  }\n}\n\nexport function mapMaterials(object3D, fn) {\n  if (!object3D.material) return;\n\n  if (Array.isArray(object3D.material)) {\n    return object3D.material.map(fn);\n  } else {\n    return fn(object3D.material);\n  }\n}\n","import { avatars } from \"../assets/avatars/avatars.js\";\n\nconst names = [\n  \"Baers-Pochard\",\n  \"Baikal-Teal\",\n  \"Barrows-Goldeneye\",\n  \"Blue-Billed\",\n  \"Blue-Duck\",\n  \"Blue-Winged\",\n  \"Brown-Teal\",\n  \"Bufflehead\",\n  \"Canvasback\",\n  \"Cape-Shoveler\",\n  \"Chestnut-Teal\",\n  \"Chiloe-Wigeon\",\n  \"Cinnamon-Teal\",\n  \"Comb-Duck\",\n  \"Common-Eider\",\n  \"Common-Goldeneye\",\n  \"Common-Merganser\",\n  \"Common-Pochard\",\n  \"Common-Scoter\",\n  \"Common-Shelduck\",\n  \"Cotton-Pygmy\",\n  \"Crested-Duck\",\n  \"Crested-Shelduck\",\n  \"Eatons-Pintail\",\n  \"Falcated\",\n  \"Ferruginous\",\n  \"Freckled-Duck\",\n  \"Gadwall\",\n  \"Garganey\",\n  \"Greater-Scaup\",\n  \"Green-Pygmy\",\n  \"Grey-Teal\",\n  \"Hardhead\",\n  \"Harlequin\",\n  \"Hartlaubs\",\n  \"Hooded-Merganser\",\n  \"Hottentot-Teal\",\n  \"Kelp-Goose\",\n  \"King-Eider\",\n  \"Lake-Duck\",\n  \"Laysan-Duck\",\n  \"Lesser-Scaup\",\n  \"Long-Tailed\",\n  \"Maccoa-Duck\",\n  \"Mallard\",\n  \"Mandarin\",\n  \"Marbled-Teal\",\n  \"Mellers-Duck\",\n  \"Merganser\",\n  \"Northern-Pintail\",\n  \"Orinoco-Goose\",\n  \"Paradise-Shelduck\",\n  \"Plumed-Whistler\",\n  \"Puna-Teal\",\n  \"Pygmy-Goose\",\n  \"Radjah-Shelduck\",\n  \"Red-Billed\",\n  \"Red-Crested\",\n  \"Red-Shoveler\",\n  \"Ring-Necked\",\n  \"Ringed-Teal\",\n  \"Rosy-Billed\",\n  \"Ruddy-Shelduck\",\n  \"Salvadoris-Teal\",\n  \"Scaly-Sided\",\n  \"Shelduck\",\n  \"Shoveler\",\n  \"Silver-Teal\",\n  \"Smew\",\n  \"Spectacled-Eider\",\n  \"Spot-Billed\",\n  \"Spotted-Whistler\",\n  \"Steamerduck\",\n  \"Stellers-Eider\",\n  \"Sunda-Teal\",\n  \"Surf-Scoter\",\n  \"Tufted-Duck\",\n  \"Velvet-Scoter\",\n  \"Wandering-Whistler\",\n  \"Whistling-duck\",\n  \"White-Backed\",\n  \"White-Cheeked\",\n  \"White-Winged\",\n  \"Wigeon\",\n  \"Wood-Duck\",\n  \"Yellow-Billed\"\n];\n\nfunction selectRandom(arr) {\n  return arr[Math.floor(Math.random() * arr.length)];\n}\n\nexport function generateRandomName() {\n  return `${selectRandom(names)}-${Math.floor(10000 + Math.random() * 10000)}`;\n}\n\nexport const avatarIds = avatars.map(av => av.id);\n\nexport function generateDefaultProfile() {\n  return {\n    avatarId: selectRandom(avatarIds)\n  };\n}\n","import { Validator } from \"jsonschema\";\nimport merge from \"deepmerge\";\nimport Cookies from \"js-cookie\";\nimport jwtDecode from \"jwt-decode\";\n\nconst LOCAL_STORE_KEY = \"___hubs_store\";\nconst STORE_STATE_CACHE_KEY = Symbol();\nconst OAUTH_FLOW_CREDENTIALS_KEY = \"ret-oauth-flow-account-credentials\";\nconst validator = new Validator();\nimport { EventTarget } from \"event-target-shim\";\nimport { generateDefaultProfile, generateRandomName } from \"../utils/identity.js\";\n\n// Durable (via local-storage) schema-enforced state that is meant to be consumed via forward data flow.\n// (Think flux but with way less incidental complexity, at least for now :))\nexport const SCHEMA = {\n  id: \"/HubsStore\",\n\n  definitions: {\n    profile: {\n      type: \"object\",\n      additionalProperties: false,\n      properties: {\n        displayName: { type: \"string\", pattern: \"^[A-Za-z0-9-]{3,32}$\" },\n        avatarId: { type: \"string\" },\n        personalAvatarId: { type: \"string\" }\n      }\n    },\n\n    credentials: {\n      type: \"object\",\n      additionalProperties: false,\n      properties: {\n        token: { type: [\"null\", \"string\"] },\n        email: { type: [\"null\", \"string\"] }\n      }\n    },\n\n    activity: {\n      type: \"object\",\n      additionalProperties: false,\n      properties: {\n        hasFoundFreeze: { type: \"boolean\" },\n        hasChangedName: { type: \"boolean\" },\n        hasAcceptedProfile: { type: \"boolean\" },\n        lastEnteredAt: { type: \"string\" },\n        hasPinned: { type: \"boolean\" },\n        hasRotated: { type: \"boolean\" },\n        hasRecentered: { type: \"boolean\" },\n        hasScaled: { type: \"boolean\" },\n        hasHoveredInWorldHud: { type: \"boolean\" },\n        hasOpenedShare: { type: \"boolean\" },\n        entryCount: { type: \"number\" }\n      }\n    },\n\n    settings: {\n      type: \"object\",\n      additionalProperties: false,\n      properties: {\n        lastUsedMicDeviceId: { type: \"string\" }\n      }\n    },\n\n    // Legacy\n    confirmedDiscordRooms: {\n      type: \"array\",\n      items: { type: \"string\" }\n    },\n\n    confirmedBroadcastedRooms: {\n      type: \"array\",\n      items: { type: \"string\" }\n    },\n\n    uploadPromotionTokens: {\n      type: \"array\",\n      items: {\n        type: \"object\",\n        additionalProperties: false,\n        properties: {\n          fileId: { type: \"string\" },\n          promotionToken: { type: \"string\" }\n        }\n      }\n    },\n\n    creatorAssignmentTokens: {\n      type: \"array\",\n      items: {\n        type: \"object\",\n        additionalProperties: false,\n        properties: {\n          hubId: { type: \"string\" },\n          creatorAssignmentToken: { type: \"string\" }\n        }\n      }\n    },\n\n    embedTokens: {\n      type: \"array\",\n      items: {\n        type: \"object\",\n        additionalProperties: false,\n        properties: {\n          hubId: { type: \"string\" },\n          embedToken: { type: \"string\" }\n        }\n      }\n    },\n\n    onLoadActions: {\n      type: \"array\",\n      items: {\n        type: \"object\",\n        additionalProperties: false,\n        properties: {\n          action: { type: \"string\" },\n          args: { type: \"object\" }\n        }\n      }\n    }\n  },\n\n  type: \"object\",\n\n  properties: {\n    profile: { $ref: \"#/definitions/profile\" },\n    credentials: { $ref: \"#/definitions/credentials\" },\n    activity: { $ref: \"#/definitions/activity\" },\n    settings: { $ref: \"#/definitions/settings\" },\n    confirmedDiscordRooms: { $ref: \"#/definitions/confirmedDiscordRooms\" }, // Legacy\n    confirmedBroadcastedRooms: { $ref: \"#/definitions/confirmedBroadcastedRooms\" },\n    uploadPromotionTokens: { $ref: \"#/definitions/uploadPromotionTokens\" },\n    creatorAssignmentTokens: { $ref: \"#/definitions/creatorAssignmentTokens\" },\n    embedTokens: { $ref: \"#/definitions/embedTokens\" },\n    onLoadActions: { $ref: \"#/definitions/onLoadActions\" }\n  },\n\n  additionalProperties: false\n};\n\nexport default class Store extends EventTarget {\n  constructor() {\n    super();\n\n    if (localStorage.getItem(LOCAL_STORE_KEY) === null) {\n      localStorage.setItem(LOCAL_STORE_KEY, JSON.stringify({}));\n    }\n\n    // When storage is updated in another window\n    window.addEventListener(\"storage\", e => {\n      if (e.key !== LOCAL_STORE_KEY) return;\n      delete this[STORE_STATE_CACHE_KEY];\n      this.dispatchEvent(new CustomEvent(\"statechanged\"));\n    });\n\n    this.update({\n      activity: {},\n      settings: {},\n      credentials: {},\n      profile: {},\n      confirmedDiscordRooms: [],\n      confirmedBroadcastedRooms: [],\n      uploadPromotionTokens: [],\n      creatorAssignmentTokens: [],\n      embedTokens: [],\n      onLoadActions: []\n    });\n\n    const oauthFlowCredentials = Cookies.getJSON(OAUTH_FLOW_CREDENTIALS_KEY);\n    if (oauthFlowCredentials) {\n      this.update({ credentials: oauthFlowCredentials });\n      this.resetToRandomLegacyAvatar();\n      Cookies.remove(OAUTH_FLOW_CREDENTIALS_KEY);\n    }\n  }\n\n  // Initializes store with any default bits\n  init = () => {\n    this.update({\n      profile: { ...generateDefaultProfile(), ...(this.state.profile || {}) }\n    });\n\n    // Regenerate name to encourage users to change it.\n    if (!this.state.activity.hasChangedName) {\n      this.update({ profile: { displayName: generateRandomName() } });\n    }\n  };\n\n  resetToRandomLegacyAvatar = () => {\n    this.update({\n      profile: { ...(this.state.profile || {}), ...generateDefaultProfile() }\n    });\n  };\n\n  get state() {\n    if (!this.hasOwnProperty(STORE_STATE_CACHE_KEY)) {\n      this[STORE_STATE_CACHE_KEY] = JSON.parse(localStorage.getItem(LOCAL_STORE_KEY));\n    }\n\n    return this[STORE_STATE_CACHE_KEY];\n  }\n\n  get credentialsAccountId() {\n    if (this.state.credentials.token) {\n      return jwtDecode(this.state.credentials.token).sub;\n    } else {\n      return null;\n    }\n  }\n\n  resetConfirmedBroadcastedRooms() {\n    this.clearStoredArray(\"confirmedBroadcastedRooms\");\n  }\n\n  resetTipActivityFlags() {\n    this.update({\n      activity: { hasRotated: false, hasPinned: false, hasRecentered: false, hasScaled: false, entryCount: 0 }\n    });\n  }\n\n  bumpEntryCount() {\n    const currentEntryCount = this.state.activity.entryCount || 0;\n    this.update({ activity: { entryCount: currentEntryCount + 1 } });\n  }\n\n  // Sets a one-time action to perform the next time the page loads\n  enqueueOnLoadAction(action, args) {\n    this.update({ onLoadActions: [{ action, args }] });\n  }\n\n  executeOnLoadActions(sceneEl) {\n    for (let i = 0; i < this.state.onLoadActions.length; i++) {\n      const { action, args } = this.state.onLoadActions[i];\n\n      if (action === \"emit_scene_event\") {\n        sceneEl.emit(args.event, args.detail);\n      }\n    }\n\n    this.clearOnLoadActions();\n  }\n\n  clearOnLoadActions() {\n    this.clearStoredArray(\"onLoadActions\");\n  }\n\n  clearStoredArray(key) {\n    const overwriteMerge = (destinationArray, sourceArray) => sourceArray;\n    const update = {};\n    update[key] = [];\n\n    this.update(update, { arrayMerge: overwriteMerge });\n  }\n\n  update(newState, mergeOpts) {\n    const finalState = merge(this.state, newState, mergeOpts);\n    const { valid } = validator.validate(finalState, SCHEMA);\n\n    if (!valid) {\n      // Intentionally not including details about the state or validation result here, since we don't want to leak\n      // sensitive data in the error message.\n      throw new Error(`Write to store failed schema validation.`);\n    }\n\n    localStorage.setItem(LOCAL_STORE_KEY, JSON.stringify(finalState));\n    delete this[STORE_STATE_CACHE_KEY];\n\n    if (newState.profile !== undefined) {\n      this.dispatchEvent(new CustomEvent(\"profilechanged\"));\n    }\n    this.dispatchEvent(new CustomEvent(\"statechanged\"));\n\n    return finalState;\n  }\n}\n","module.exports = __webpack_public_path__ + \"assets/images/hub-preview-white-ccefba3b70ae589a0ca5ae3230c39299.png\";","// Enumeration of spawned object content origins. URL means the content is\n// fetched from a URL, FILE means it was an uploaded/dropped file, and\n// CLIPBOARD means it was raw data pasted in from the clipboard, SPAWNER means\n// it was copied over from a spawner.\nexport const ObjectContentOrigins = {\n  URL: 1,\n  FILE: 2,\n  CLIPBOARD: 3,\n  SPAWNER: 4\n};\n\n// Enumeration of spawnable object types, used for telemetry, which encapsulates\n// both the origin of the content for the object and also the type of content\n// contained in the object.\nexport const ObjectTypes = {\n  URL_IMAGE: 0,\n  URL_VIDEO: 1,\n  URL_MODEL: 2,\n  URL_PDF: 3,\n  URL_AUDIO: 4,\n  //URL_TEXT: 5,\n  //URL_TELEPORTER: 6,\n  FILE_IMAGE: 8,\n  FILE_VIDEO: 9,\n  FILE_MODEL: 10,\n  FILE_PDF: 11,\n  FILE_AUDIO: 12,\n  //FILE_TEXT: 13,\n  CLIPBOARD_IMAGE: 16,\n  CLIPBOARD_VIDEO: 17,\n  CLIPBOARD_MODEL: 18,\n  CLIPBOARD_PDF: 19,\n  CLIPBOARD_AUDIO: 20,\n  //CLIPBOARD_TEXT: 21,\n  SPAWNER_IMAGE: 24,\n  SPAWNER_VIDEO: 25,\n  SPAWNER_MODEL: 26,\n  SPAWNER_PDF: 27,\n  SPAWNER_AUDIO: 28,\n  //SPAWNER_TEXT: 29,\n  CAMERA: 30,\n  UNKNOWN: 31\n};\n\n// Given an origin and three object type values for URL, FILE, and CLIPBOARD\n// origins respectively, return the appropriate one\nfunction objectTypeForOrigin(contentOrigin, urlType, fileType, clipboardType, spawnerType) {\n  if (contentOrigin === ObjectContentOrigins.URL) {\n    return urlType;\n  } else if (contentOrigin === ObjectContentOrigins.FILE) {\n    return fileType;\n  } else if (contentOrigin === ObjectContentOrigins.CLIPBOARD) {\n    return clipboardType;\n  } else {\n    return spawnerType;\n  }\n}\n\n// Lookup table of mime-type prefixes to the set of object types that we should use\n// for objects spawned matching their underlying Content-Type.\nconst objectTypeMimePrefixLookupMap = {\n  \"image/\": [ObjectTypes.URL_IMAGE, ObjectTypes.FILE_IMAGE, ObjectTypes.CLIPBOARD_IMAGE, ObjectTypes.SPAWNER_IMAGE],\n  \"model/\": [ObjectTypes.URL_MODEL, ObjectTypes.FILE_MODEL, ObjectTypes.CLIPBOARD_MODEL, ObjectTypes.SPAWNER_MODEL],\n  \"application/x-zip-compressed\": [\n    ObjectTypes.URL_MODEL,\n    ObjectTypes.FILE_MODEL,\n    ObjectTypes.CLIPBOARD_MODEL,\n    ObjectTypes.SPAWNER_MODEL\n  ],\n  \"video/\": [ObjectTypes.URL_VIDEO, ObjectTypes.FILE_VIDEO, ObjectTypes.CLIPBOARD_VIDEO, ObjectTypes.SPAWNER_VIDEO],\n  \"application/vnd.apple.mpegurl\": [\n    ObjectTypes.URL_VIDEO,\n    ObjectTypes.FILE_VIDEO,\n    ObjectTypes.CLIPBOARD_VIDEO,\n    ObjectTypes.SPAWNER_VIDEO\n  ],\n  \"application/x-mpegurl\": [\n    ObjectTypes.URL_VIDEO,\n    ObjectTypes.FILE_VIDEO,\n    ObjectTypes.CLIPBOARD_VIDEO,\n    ObjectTypes.SPAWNER_VIDEO\n  ],\n  \"audio/\": [ObjectTypes.URL_AUDIO, ObjectTypes.FILE_AUDIO, ObjectTypes.CLIPBOARD_AUDIO, ObjectTypes.SPAWNER_AUDIO],\n  \"application/pdf\": [ObjectTypes.URL_PDF, ObjectTypes.FILE_PDF, ObjectTypes.CLIPBOARD_PDF, ObjectTypes.SPAWNER_PDF]\n};\n\nconst srcSuffixLookupMap = {\n  \".m3u8\": [ObjectTypes.URL_VIDEO, ObjectTypes.FILE_VIDEO, ObjectTypes.CLIPBOARD_VIDEO, ObjectTypes.SPAWNER_VIDEO]\n};\n\n// Given an content origin and the resolved mime type of a piece of content, return\n// the ObjectType, if any, for that content.\nexport function objectTypeForOriginAndContentType(contentOrigin, contentType, src) {\n  for (const prefix in objectTypeMimePrefixLookupMap) {\n    if (contentType.toLowerCase().startsWith(prefix)) {\n      const types = objectTypeMimePrefixLookupMap[prefix];\n      return objectTypeForOrigin(contentOrigin, ...types);\n    }\n  }\n\n  if (src) {\n    for (const suffix in srcSuffixLookupMap) {\n      if (src.toLowerCase().endsWith(suffix)) {\n        const types = srcSuffixLookupMap[suffix];\n        return objectTypeForOrigin(contentOrigin, ...types);\n      }\n    }\n  }\n\n  return ObjectTypes.UNKNOWN;\n}\n","export const avatars = [\n  {\n    id: \"botdefault\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotDefault_Avatar-9f71f8ff22.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botdefault-thumb-42C4C7D3C01D085EAFDAC8BACE591CE6.png\"\n  },\n  {\n    id: \"botbobo\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotBobo_Avatar-f9740a010b.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botbobo-thumb-261278FD5831E9CD89610D15948F23E4.png\"\n  },\n  {\n    id: \"botdom\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotDom_Avatar-0c48bf15a5.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botdom-thumb-1160EB5E81D24F12CE643C520CE1E99E.png\"\n  },\n  {\n    id: \"botgreg\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotGreg_Avatar-98d39797bb.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botgreg-thumb-F2A37F14F9C342EE44DDE9B24DD9B9FC.png\"\n  },\n  {\n    id: \"botguest\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotGuest_Avatar-78cd857332.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botguest-thumb-F7A471250E2C10C2709325C3B02A8BBB.png\"\n  },\n  {\n    id: \"botjim\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotJim_Avatar-d28005a687.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botjim-thumb-A2D195C1A51A082BCED58BD172481B39.png\"\n  },\n  {\n    id: \"botkev\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotKev_Avatar-a95787bb51.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botkev-thumb-90746A7349E3F964C913EA612EE9A53F.png\"\n  },\n  {\n    id: \"botpinky\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotPinky_Avatar-b0b93f8675.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botpinky-thumb-C2E69D4479077766B988DC3EE4F30BE5.png\"\n  },\n  {\n    id: \"botrobert\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotRobert_Avatar-e9554880f3.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botrobert-thumb-9C33F2C752326E2CF4321EAA7BDB4E47.png\"\n  },\n  {\n    id: \"botwoody\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotWoody_Avatar-0140485a23.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botwoody-thumb-F1F1FA7E21301B5AC1D8872B4ED0CC56.png\"\n  }\n];\n","export const createImageBitmap =\n  window.createImageBitmap ||\n  async function(data) {\n    return new Promise(resolve => {\n      // https://dev.to/nektro/createimagebitmap-polyfill-for-safari-and-edge-228\n      // https://gist.github.com/MonsieurV/fb640c29084c171b4444184858a91bc7\n\n      let srcUrl;\n      if (data instanceof Blob) {\n        srcUrl = URL.createObjectURL(data);\n      } else {\n        const canvas = document.createElement(\"canvas\");\n        const ctx = canvas.getContext(\"2d\");\n        canvas.width = data.width;\n        canvas.height = data.height;\n        ctx.putImageData(data, 0, 0);\n        srcUrl = canvas.toDataURL();\n      }\n      const img = document.createElement(\"img\");\n\n      img.addEventListener(\"load\", () => resolve(img));\n\n      img.src = srcUrl;\n    });\n  };\n\nexport function disposeImageBitmap(imageBitmap) {\n  if (imageBitmap instanceof HTMLImageElement && imageBitmap.src.startsWith(\"blob:\")) {\n    URL.revokeObjectURL(imageBitmap.src);\n  } else {\n    imageBitmap.close && imageBitmap.close();\n  }\n}\n","export default function nextTick() {\n  return new Promise(resolve => {\n    setTimeout(resolve, 0);\n  });\n}\n","export function showHoverEffect(el) {\n  const isFrozen = el.sceneEl.is(\"frozen\");\n  const isPinned = el.components.pinnable && el.components.pinnable.data.pinned;\n  const isSpawner = !!el.components[\"super-spawner\"];\n  const canMove =\n    window.APP.hubChannel.can(\"spawn_and_move_media\") && (!isPinned || window.APP.hubChannel.can(\"pin_objects\"));\n  return (isSpawner || !isPinned || isFrozen) && canMove;\n}\n\nexport function canMove(entity) {\n  const isPinned = entity.components.pinnable && entity.components.pinnable.data.pinned;\n  const networkedTemplate = entity && entity.components.networked && entity.components.networked.data.template;\n  const isCamera = networkedTemplate === \"#interactable-camera\";\n  const isPen = networkedTemplate === \"#interactable-pen\";\n  return (\n    window.APP.hubChannel.can(\"spawn_and_move_media\") &&\n    (!isPinned || window.APP.hubChannel.can(\"pin_objects\")) &&\n    (!isCamera || window.APP.hubChannel.can(\"spawn_camera\")) &&\n    (!isPen || window.APP.hubChannel.can(\"spawn_drawing\"))\n  );\n}\n"],"sourceRoot":""}