!function(e){function t(t){for(var a,o,r=t[0],c=t[1],l=t[2],h=0,u=[];h<r.length;h++)o=r[h],n[o]&&u.push(n[o][0]),n[o]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);for(d&&d(t);u.length;)u.shift()();return s.push.apply(s,l||[]),i()}function i(){for(var e,t=0;t<s.length;t++){for(var i=s[t],a=!0,r=1;r<i.length;r++){var c=i[r];0!==n[c]&&(a=!1)}a&&(s.splice(t--,1),e=o(o.s=i[0]))}return e}var a={},n={6:0},s=[];function o(t){if(a[t])return a[t].exports;var i=a[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=e,o.c=a,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(i,a,function(t){return e[t]}.bind(null,a));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var r=window.webpackJsonp=window.webpackJsonp||[],c=r.push.bind(r);r.push=t,r=r.slice();for(var l=0;l<r.length;l++)t(r[l]);var d=c;s.push([2149,1,0]),i()}({10:function(e,t,i){"use strict";var a=i(128);var n=i(22),s=i(54);function o(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}function r(e){return function(){var t=this,i=arguments;return new Promise(function(a,n){var s=e.apply(t,i);function r(e){o(s,a,n,r,c,"next",e)}function c(e){o(s,a,n,r,c,"throw",e)}r(void 0)})}}i.d(t,"h",function(){return c}),i.d(t,"j",function(){return h}),i.d(t,"i",function(){return p}),i.d(t,"a",function(){return g}),i.d(t,"e",function(){return f}),i.d(t,"d",function(){return b}),i.d(t,"b",function(){return y}),i.d(t,"f",function(){return w}),i.d(t,"g",function(){return S}),i.d(t,"k",function(){return x}),i.d(t,"c",function(){return A});document.createElement("a");function c(e,t=!1){return`https://dev.reticulum.io${e}`}let l=null,d=!1;function h(){return u.apply(this,arguments)}function u(){return(u=r(function*(){d=!0,l=null})).apply(this,arguments)}function p(){return m.apply(this,arguments)}function m(){return(m=r(function*(){l||(!d&&document.querySelector("meta[name='ret:version']")?l={version:document.querySelector("meta[name='ret:version']").getAttribute("value"),pool:document.querySelector("meta[name='ret:pool']").getAttribute("value"),phx_host:document.querySelector("meta[name='ret:phx_host']").getAttribute("value")}:yield fetch(c("/api/v1/meta")).then(function(){var e=r(function*(e){l=yield e.json()});return function(t){return e.apply(this,arguments)}}()));const e=new URLSearchParams(location.search).get("phx_host");return e&&(l.phx_host=e),l})).apply(this,arguments)}function g(){return v.apply(this,arguments)}function v(){return(v=r(function*(e=!1,t=null){const i=new URLSearchParams(location.search),n=function(){var e=r(function*(){const e=i.get("phx_protocol")||("https:"===document.location.protocol?"wss:":"ws:");let t=i.get("phx_host"),a=i.get("phx_port");const n=yield p();return`${e}//${t=t||{NODE_ENV:"production",DEFAULT_SCENE_SID:"JGLt8DP",RETICULUM_SERVER:"dev.reticulum.io",FARSPARK_SERVER:"farspark-dev.reticulum.io",NON_CORS_PROXY_DOMAINS:"hubs.local,dev.reticulum.io",ASSET_BUNDLE_SERVER:"https://asset-bundles-prod.reticulum.io",EXTRA_ENVIRONMENTS:"",POSTGREST_SERVER:"hubs.local:3000"}.RETICULUM_SOCKET_SERVER||n.phx_host}${(a=a||new URL(`${e}//dev.reticulum.io`).port)?`:${a}`:""}`});return function(){return e.apply(this,arguments)}}(),s=yield n();console.log(`Phoenix Socket URL: ${s}`);const o={};e&&(o.logger=(e,t,i)=>{console.log(`${e}: ${t}`,i)}),t&&(o.params=t);const c=new a.b(`${s}/socket`,o);return c.connect(),c.onError(r(function*(){h();const e=new URL(c.endPoint).pathname,t=`${yield n()}${e}`;console.log(`Socket error, changed endpoint to ${t}`),c.endPoint=t})),c})).apply(this,arguments)}function f(e){const t=new URL(e);return c(t.pathname.replace(".png",".html")+t.search,!0)}function b(e,t="GET",i){const{token:a}=window.APP.store.state.credentials,n=c(e),s={headers:{"content-type":"application/json"},method:t};return a&&(s.headers.authorization=`bearer ${a}`),i&&(s.body=JSON.stringify(i)),fetch(n,s).then(function(){var e=r(function*(e){const t=yield e.text();try{return JSON.parse(t)}catch(e){return t}});return function(t){return e.apply(this,arguments)}}())}function y(e,t,i,a){return _.apply(this,arguments)}function _(){return(_=r(function*(e,t,i,a){const o=c("/api/v1/hubs");let r={Name:"Test",SceneUrl:null};const l=yield n.a.find("recHqITRS7cBMwn9i");l&&(r=l.fields);const d={hub:{name:r.Name}};d.hub.default_environment_gltf_bundle_url=r.SceneUrl;const h={"content-type":"application/json"},u=new s.b;u.state&&u.state.credentials.token&&(h.authorization=`bearer ${u.state.credentials.token}`);let p=yield fetch(o,{body:JSON.stringify(d),headers:h,method:"POST"}).then(e=>e.json());"invalid_token"===p.error&&(u.update({credentials:{token:null,email:null}}),delete h.authorization,p=yield fetch(o,{body:JSON.stringify(d),headers:h,method:"POST"}).then(e=>e.json()));const m=p;let g=m.url;const v=m.creator_assignment_token;if(v){u.update({creatorAssignmentTokens:[{hubId:m.hub_id,creatorAssignmentToken:v}]});const e=m.embed_token;e&&u.update({embedTokens:[{hubId:m.hub_id,embedToken:e}]})}"dev.reticulum.io"!==document.location.host&&(g=`/hub.html?hub_id=${m.hub_id}`),a?document.location.replace(g):document.location=g})).apply(this,arguments)}function E(e,t){const i=(Object.entries(e||{}).find(([e])=>e===t)||[])[1];return i&&i.metas&&i.metas[0]||{}}function w(e,t){return(E(e,t)||{}).context||{}}function S(e,t){return(E(e,t)||{}).profile||{}}function x(e,t,i){const a=t.channel(e.topic,i||e.params);for(let t=0,i=e.bindings.length;t<i;t++){const i=e.bindings[t];a.on(i.event,i.callback)}for(let t=0,i=e.pushBuffer.length;t<i;t++){const i=e.pushBuffer[t];a.push(i.event,i.payload,i.timeout)}const n=e.joinPush,s=a.join();for(let e=0,t=n.recHooks.length;e<t;e++){const t=n.recHooks[e];s.receive(t.status,t.callback)}return new Promise(t=>{s.receive("ok",()=>{e.bindings=[],t(a)})})}function A(e){const t=[];for(const i of Object.values(e))for(const e of i.metas)e.profile&&e.profile.discordBridges&&Array.prototype.push.apply(t,e.profile.discordBridges.map(e=>e.channel.name));return t}},1049:function(e,t,i){"use strict";i(838),i(839),i(840),i(512),i(841);const a=new THREE.Box3,n=new THREE.Box3,s=new THREE.Matrix4,o=new THREE.Box3,r=1,c=-500,l=500,d=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];AFRAME.registerComponent("directional-light",{schema:{color:{type:"color"},intensity:{default:1},castShadow:{default:!0},shadowMapResolution:{default:[512,512]},shadowBias:{default:0},shadowRadius:{default:1}},init(){const e=this.el;this.light=new THREE.DirectionalLight,this.light.position.set(0,0,0),this.light.target.position.set(0,0,1),this.light.add(this.light.target),this.el.setObject3D("directional-light",this.light),this.el.sceneEl.systems.light.registerLight(e),this.rendererSystem=this.el.sceneEl.systems.renderer},update(e){const t=this.light;if(this.data.color!==e.color){const e=new THREE.Color(this.data.color);this.rendererSystem.applyColorCorrection(e),t.color.copy(e)}this.data.intensity!==e.intensity&&(t.intensity=this.data.intensity),this.data.castShadow!==e.castShadow&&(t.castShadow=this.data.castShadow),this.data.shadowBias!==e.shadowBias&&(t.shadow.bias=this.data.shadowBias),this.data.shadowRadius!==e.shadowRadius&&(t.shadow.radius=this.data.shadowRadius);const[i,a]=this.data.shadowMapResolution,[n,s]=e.shadowMapResolution?e.shadowMapResolution:[512,512];i===n&&a===s||(t.shadow.mapSize.set(i,a),t.shadow.map&&(t.shadow.map.dispose(),t.shadow.map=null)),this.light.shadow.camera.matrixNeedsUpdate=!0},tick(){window.APP&&"low"===window.APP.quality||function(e,t){n.makeEmpty(),a.makeEmpty(),t.traverse(e=>{const t=e.geometry;t&&e.castShadow&&(t.boundingBox||t.computeBoundingBox(),o.copy(t.boundingBox),o.applyMatrix4(e.matrixWorld),a.union(o))});const i=a.min,h=a.max;d[0].set(i.x,i.y,i.z),d[1].set(i.x,i.y,h.z),d[2].set(i.x,h.y,i.z),d[3].set(i.x,h.y,h.z),d[4].set(h.x,i.y,i.z),d[5].set(h.x,i.y,h.z),d[6].set(h.x,h.y,i.z),d[7].set(h.x,h.y,h.z),s.getInverse(e.shadow.camera.matrixWorld);for(let e=0;e<d.length;e++)d[e].applyMatrix4(s),n.expandByPoint(d[e]);const u=e.shadow.camera;u.left=n.min.x-r,u.right=n.max.x+r,u.bottom=n.min.y-r,u.top=n.max.y+r,u.near=n.min.z+c,u.far=n.max.z+l,u.updateProjectionMatrix()}(this.light,this.el.sceneEl.object3D)},remove:function(){this.el.removeObject3D("directional-light")}});i(842),i(164),i(844),i(845),i(846);const h={reflection:3};AFRAME.registerComponent("layers",{schema:{reflection:{type:"boolean",default:!1},inWorldHud:{type:"boolean",default:!1},exclusive:{type:"boolean",default:!1}},init(){this.update=this.update.bind(this),this.el.addEventListener("model-loaded",this.update)},update(e){const t=this.el.object3D;this.data.exclusive&&t.traverse(e=>e.layers.mask=0);for(const[i,a]of Object.entries(h)){const n=e[i],s=this.data[i];n!==s&&(s?t.traverse(e=>e.layers.enable(a)):t.traverse(e=>e.layers.disable(a)))}},remove(){this.el.removeEventListener("model-loaded",this.update)}});var u=i(273);AFRAME.registerComponent("loop-animation",{schema:{paused:{type:"boolean",default:!1},clip:{type:"string"}},init(){this.mixerEl=Object(u.a)(this.el,"animation-mixer"),this.mixerEl?this.updateClip():console.warn("loop-animation component could not find an animation-mixer in its ancestors.")},update(e){e.clip===this.data.clip&&e.paused===this.data.paused||!this.mixerEl||(e.clip!==this.data.clip&&this.updateClip(),this.currentAction&&(this.currentAction.paused=this.data.paused))},updateClip(){const{mixer:e,animations:t}=this.mixerEl.components["animation-mixer"],i=this.data.clip;if(0===t.length)return;let a;if(!(a=i?t.find(({name:e})=>e===i):t[0]))return;const n=e.clipAction(a,this.el.object3D);n.enabled=!0,n.setLoop(THREE.LoopRepeat,1/0).play(),this.currentAction=n},destroy(){this.currentAction&&(this.currentAction.enabled=!1,this.currentAction.stop())}});var p=i(286),m=i(35),g=i(16),v=i(375),f=i(27),b=(i(460),i(517)),y=i.n(b),_=i(23),E=i(300);function w(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}function S(e){return function(){var t=this,i=arguments;return new Promise(function(a,n){var s=e.apply(t,i);function o(e){w(s,a,n,o,r,"next",e)}function r(e){w(s,a,n,o,r,"throw",e)}o(void 0)})}}const x=i(224).SHAPE;let A;(new THREE.GLTFLoader).load(y.a,e=>{A=e});const k=new THREE.Box3,C=Object(f.a)("forceBatching"),T=Object(f.a)("enableBatching");AFRAME.registerComponent("media-loader",{schema:{fileId:{type:"string"},fileIsOwned:{type:"boolean"},src:{type:"string"},resize:{default:!1},resolve:{default:!1},contentType:{default:null},contentSubtype:{default:null},animate:{default:!0},mediaOptions:{default:{},parse:e=>"object"==typeof e?e:JSON.parse(e),stringify:JSON.stringify}},init(){this.onError=this.onError.bind(this),this.showLoader=this.showLoader.bind(this),this.clearLoadingTimeout=this.clearLoadingTimeout.bind(this),this.onMediaLoaded=this.onMediaLoaded.bind(this),NAF.utils.getNetworkedEntity(this.el).then(e=>{this.networkedEl=e})},updateScale:function(){const e=new THREE.Vector3;return function(t){const i=this.el.getObject3D("mesh"),a=Object(p.a)(this.el,i),n=t?Object(p.b)(.5,a):1;i.scale.multiplyScalar(n);const{min:s,max:o}=a;e.addVectors(s,o).multiplyScalar(.5*n),i.position.sub(e),i.matrixNeedsUpdate=!0}}(),removeShape(e){this.el.getAttribute("ammo-shape__"+e)&&this.el.removeAttribute("ammo-shape__"+e)},tick(e,t){this.loaderMixer&&this.loaderMixer.update(t/1e3)},remove(){this.loadingSoundNode&&(this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.stopSoundNode(this.loadingSoundNode),this.loadingSoundNode=null)},onError(){this.el.removeAttribute("gltf-model-plus"),this.el.removeAttribute("media-pager"),this.el.removeAttribute("media-video"),this.el.setAttribute("media-image",{src:"error"}),this.clearLoadingTimeout()},showLoader(){if(this.el.object3DMap.mesh)return void this.clearLoadingTimeout();const e=!!A,t=e?A.scene.clone():new THREE.Mesh(new THREE.BoxGeometry,new THREE.MeshBasicMaterial);this.el.setObject3D("mesh",t),this.updateScale(!0),e&&(this.loaderMixer=new THREE.AnimationMixer(t),this.loadingClip=this.loaderMixer.clipAction(A.animations[0]),this.loadingScaleClip=this.loaderMixer.clipAction(new THREE.AnimationClip(null,1e3,[new THREE.VectorKeyframeTrack(".scale",[0,.2],[0,0,0,t.scale.x,t.scale.y,t.scale.z])])),setTimeout(()=>{this.loaderMixer&&this.el.setAttribute("ammo-shape__loader",{type:x.BOX})},200),this.loadingClip.play(),this.loadingScaleClip.play()),!this.el.sceneEl.is("entered")||this.networkedEl&&!NAF.utils.isMine(this.networkedEl)||(this.loadingSoundNode=this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playSoundLooped(_.h)),delete this.showLoaderTimeout},clearLoadingTimeout(){clearTimeout(this.showLoaderTimeout),this.loadingSoundNode&&(this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.stopSoundNode(this.loadingSoundNode),this.loadingSoundNode=null),this.loaderMixer&&(this.loadingClip.stop(),this.loadingScaleClip.stop(),delete this.loaderMixer,delete this.loadingScaleClip,delete this.loadingClip),delete this.showLoaderTimeout,this.removeShape("loader")},updateHoverableVisuals(){const e=this.el.components["hoverable-visuals"];e&&(this.injectedCustomShaderChunks||(this.injectedCustomShaderChunks=!0,e.uniforms=Object(m.e)(this.el.object3D)),k.setFromObject(this.el.object3DMap.mesh),k.getBoundingSphere(e.boundingSphere))},onMediaLoaded(e=null){const t=this.el;this.clearLoadingTimeout(),this.el.sceneEl.is("entered")&&this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(_.g);const i=()=>{e&&t.setAttribute("ammo-shape",{type:e,minHalfExtent:.04}),this.updateHoverableVisuals();const i=t.components["media-pager"];i&&i.repositionToolbar()};if(this.data.animate){const e=this.el.getObject3D("mesh"),t={x:.001,y:.001,z:.001};t.x=e.scale.x<t.x?.001*e.scale.x:t.x,t.y=e.scale.y<t.y?.001*e.scale.x:t.y,t.z=e.scale.z<t.z?.001*e.scale.x:t.z,this.addMeshScaleAnimation(e,t,i)}else i()},addMeshScaleAnimation(e,t,i){const a=function(){const t={};return function(i){const a=i.animatables[0].target;a.x=Math.max(Number.MIN_VALUE,a.x),a.y=Math.max(Number.MIN_VALUE,a.y),a.z=Math.max(Number.MIN_VALUE,a.z),a.x===t.x&&a.y===t.y&&a.z===t.z||(t.x=a.x,t.y=a.y,t.z=a.z,e.scale.set(a.x,a.y,a.z),e.matrixNeedsUpdate=!0)}}(),n={duration:400,easing:"easeOutElastic",elasticity:400,loop:0,round:!1,x:e.scale.x,y:e.scale.y,z:e.scale.z,targets:[t],update:e=>a(e),complete:e=>{a(e),i()}};return e.scale.copy(t),e.matrixNeedsUpdate=!0,Object(E.default)(n)},update(e){var t=this;return S(function*(){try{const{src:i,contentSubtype:a}=t.data;if(i===e.src||t.showLoaderTimeout||(t.showLoaderTimeout=setTimeout(t.showLoader,100)),!i)return;let n,s=i,o=i,r=t.data.contentType;if(t.data.resolve){const e=yield Object(m.f)(i);(s=e.origin).startsWith("//")&&(s=location.protocol+s),r=e.meta&&e.meta.expected_content_type||r,n=e.meta&&e.meta.thumbnail&&Object(g.g)(e.meta.thumbnail)}if(o=Object(g.g)(s,null),r=r||Object(g.b)(s)||(yield(e=>fetch(e,{method:"HEAD"}).then(e=>e.headers.get("content-type")))(o)),i!==e.src&&t.el.emit("media_resolved",{src:i,raw:o,contentType:r}),r.startsWith("video/")||r.startsWith("audio/")||AFRAME.utils.material.isHLS(s,r)){const e=new URL(i),a=parseInt(e.searchParams.get("t")),n=parseInt(new URLSearchParams(e.hash.substring(1)).get("t"))||a||0;t.el.removeAttribute("gltf-model-plus"),t.el.removeAttribute("media-image"),t.el.setAttribute("floaty-object",{reduceAngularFloat:!0,releaseGravity:-1}),t.el.addEventListener("video-loaded",e=>{t.onMediaLoaded("flat"===e.detail.projection?x.BOX:null)},{once:!0}),t.el.setAttribute("media-video",Object.assign({},t.data.mediaOptions,{src:o,time:n,contentType:r})),t.el.components["position-at-box-shape-border__freeze"]&&t.el.setAttribute("position-at-box-shape-border__freeze",{dirs:["forward","back"]})}else if(r.startsWith("image/"))t.el.removeAttribute("gltf-model-plus"),t.el.removeAttribute("media-video"),t.el.removeAttribute("media-pager"),t.el.addEventListener("image-loaded",e=>{t.onMediaLoaded("flat"===e.detail.projection?x.BOX:null),"photo-camera"===a&&t.el.setAttribute("hover-menu__photo",{template:"#photo-hover-menu",dirs:["forward","back"]})},{once:!0}),t.el.setAttribute("floaty-object",{reduceAngularFloat:!0,releaseGravity:-1}),t.el.setAttribute("media-image",Object.assign({},t.data.mediaOptions,{src:o,contentType:r,batch:T})),t.el.components["position-at-box-shape-border__freeze"]&&t.el.setAttribute("position-at-box-shape-border__freeze",{dirs:["forward","back"]});else if(r.startsWith("application/pdf"))t.el.removeAttribute("gltf-model-plus"),t.el.removeAttribute("media-video"),t.el.setAttribute("media-pager",Object.assign({},t.data.mediaOptions,{src:s})),t.el.setAttribute("floaty-object",{reduceAngularFloat:!0,releaseGravity:-1}),t.el.addEventListener("image-loaded",t.clearLoadingTimeout,{once:!0}),t.el.addEventListener("preview-loaded",()=>t.onMediaLoaded(x.BOX),{once:!0}),t.el.components["position-at-box-shape-border__freeze"]&&t.el.setAttribute("position-at-box-shape-border__freeze",{dirs:["forward","back"]});else if(r.includes("application/octet-stream")||r.includes("x-zip-compressed")||r.startsWith("model/gltf"))t.el.removeAttribute("media-image"),t.el.removeAttribute("media-video"),t.el.removeAttribute("media-pager"),t.el.addEventListener("model-loaded",()=>{t.updateScale(t.data.resize),t.onMediaLoaded(x.HULL),Object(v.a)(t.el)},{once:!0}),t.el.addEventListener("model-error",t.onError,{once:!0}),t.el.setAttribute("gltf-model-plus",Object.assign({},t.data.mediaOptions,{src:o,contentType:r,inflate:!0,batch:C,modelToWorldScale:t.data.resize?1e-4:1}));else{if(!r.startsWith("text/html"))throw new Error(`Unsupported content type: ${r}`);t.el.removeAttribute("gltf-model-plus"),t.el.removeAttribute("media-video"),t.el.removeAttribute("media-pager"),t.el.addEventListener("image-loaded",()=>{const e=t.el.sceneEl.systems.permissions.can("update_hub");Object(g.c)(i)?t.el.setAttribute("hover-menu__hubs-item",{template:"#avatar-link-hover-menu",dirs:["forward","back"]}):Object(g.e)(i)||Object(g.f)(i)&&e?t.el.setAttribute("hover-menu__hubs-item",{template:"#hubs-destination-hover-menu",dirs:["forward","back"]}):t.el.setAttribute("hover-menu__link",{template:"#link-hover-menu",dirs:["forward","back"]}),t.onMediaLoaded(x.BOX)},{once:!0}),t.el.setAttribute("floaty-object",{reduceAngularFloat:!0,releaseGravity:-1}),t.el.setAttribute("media-image",Object.assign({},t.data.mediaOptions,{src:n,contentType:Object(g.b)(n)||"image/png",batch:T})),t.el.components["position-at-box-shape-border__freeze"]&&t.el.setAttribute("position-at-box-shape-border__freeze",{dirs:["forward","back"]})}}catch(e){console.error("Error adding media",e),t.onError()}})()}}),AFRAME.registerComponent("media-pager",{schema:{src:{type:"string"},index:{default:0}},init(){var e=this;this.toolbar=null,this.imageSrc=null,this.onNext=this.onNext.bind(this),this.onPrev=this.onPrev.bind(this),NAF.utils.getNetworkedEntity(this.el).then(e=>{this.networkedEl=e}),this.el.addEventListener("image-loaded",function(){var t=S(function*(t){e.imageSrc=t.detail.src,yield e._ensureUI(),e.update()});return function(e){return t.apply(this,arguments)}}())},_ensureUI(){var e=this;return S(function*(){if(e.hasSetupUI||!e.imageSrc)return;e.hasSetupUI=!0,e.maxIndex=yield(e=>fetch(e).then(e=>parseInt(e.headers.get("x-max-content-index"))))(e.imageSrc);const t=document.getElementById("paging-toolbar");e.el.querySelector(".interactable-ui").appendChild(document.importNode(t.content,!0)),e.toolbar=e.el.querySelector(".paging-toolbar"),setTimeout(()=>{e.nextButton=e.el.querySelector(".next-button [text-button]"),e.prevButton=e.el.querySelector(".prev-button [text-button]"),e.pageLabel=e.el.querySelector(".page-label"),e.nextButton.object3D.addEventListener("interact",e.onNext),e.prevButton.object3D.addEventListener("interact",e.onPrev),e.update(),e.el.emit("preview-loaded")},0)})()},update(){var e=this;return S(function*(){if(!e.data.src)return;const t=Object(g.g)(e.data.src,e.data.index);e.el.setAttribute("media-image",{src:t,contentType:Object(g.b)(t)||"image/png"}),yield e._ensureUI(),e.pageLabel&&(e.pageLabel.setAttribute("text","value",`${e.data.index+1}/${e.maxIndex+1}`),e.repositionToolbar())})()},remove(){this.toolbar&&this.toolbar.parentNode.removeChild(this.toolbar)},onNext(){(NAF.utils.isMine(this.networkedEl)||NAF.utils.takeOwnership(this.networkedEl))&&(this.el.setAttribute("media-pager","index",Math.min(this.data.index+1,this.maxIndex)),this.el.emit("pager-page-changed"))},onPrev(){(NAF.utils.isMine(this.networkedEl)||NAF.utils.takeOwnership(this.networkedEl))&&(this.el.setAttribute("media-pager","index",Math.max(this.data.index-1,0)),this.el.emit("pager-page-changed"))},repositionToolbar(){this.el.getAttribute("ammo-shape")&&(this.toolbar.object3D.position.y=-.7,this.toolbar.object3D.matrixNeedsUpdate=!0)}});i(847);AFRAME.registerComponent("quack",{schema:{quackPercentage:{default:1},specialQuackPercentage:{default:.01}},init:function(){this._handleGrabStart=this._handleGrabStart.bind(this)},play:function(){this.el.object3D.addEventListener("interact",this._handleGrabStart)},pause:function(){this.el.object3D.removeEventListener("interact",this._handleGrabStart)},_handleGrabStart:function(){const e=Math.random();e<this.data.specialQuackPercentage?this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(_.q):e<this.data.quackPercentage&&this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(_.n)}});var R=i(40),M=i(211);function D(e,t,i){return(1-i)*e+i*t}const P=new THREE.Quaternion;AFRAME.registerComponent("scene-preview-camera",{schema:{duration:{default:90,type:"number"},positionOnly:{default:!1,type:"boolean"}},init:function(){this.startPoint=this.el.object3D.position.clone(),this.startRotation=this.el.object3D.quaternion.clone(),this.targetPoint=this.el.object3D.position.clone(),this.targetPoint.y=Math.max(this.targetPoint.y-1.5,1),this.targetPoint.add(new THREE.Vector3(2,0,-2));const e=new THREE.Euler(-.15,0,.15);this.targetRotation=new THREE.Quaternion,this.targetRotation.setFromEuler(e),this.targetRotation.premultiply(this.startRotation),this.startTime=performance.now(),this.backwards=!1,this.ranOnePass=!1},tick2:function(){const e=function(){const e=Object(M.b)();return e?e.el.querySelector(".camera").object3D:null}();if(e)Object(R.d)(this.el.object3D,e.matrixWorld),this.el.object3D.translateZ(-.1),this.el.object3D.matrixNeedsUpdate=!0;else{let e=(performance.now()-this.startTime)/(1e3*this.data.duration);e=Math.min(1,Math.max(0,e)),this.ranOnePass?e=e<.5?2*e*e:(4-2*e)*e-1:e*=2-e;const t=this.backwards?this.targetPoint:this.startPoint,i=this.backwards?this.startPoint:this.targetPoint,a=this.backwards?this.targetRotation:this.startRotation,n=this.backwards?this.startRotation:this.targetRotation;THREE.Quaternion.slerp(a,n,P,e),this.el.object3D.position.set(D(t.x,i.x,e),D(t.y,i.y,e),D(t.z,i.z,e)),this.data.positionOnly||this.el.object3D.rotation.setFromQuaternion(P),this.el.object3D.matrixNeedsUpdate=!0,e>=.9999&&(this.ranOnePass=!0,this.backwards=!this.backwards,this.startTime=performance.now())}}});i(1126),i(1127);const O=Object(f.a)("bot");THREE.Sky=function(){const e=THREE.Sky.SkyShader,t=new THREE.ShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:THREE.UniformsUtils.clone(e.uniforms),side:THREE.BackSide});THREE.Mesh.call(this,new THREE.BoxBufferGeometry(1,1,1),t)},THREE.Sky.prototype=Object.create(THREE.Mesh.prototype),THREE.Sky.prototype.constructor=THREE.Sky,THREE.Sky.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new THREE.Vector3}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")},AFRAME.registerComponent("skybox",{schema:{turbidity:{type:"number",default:10},rayleigh:{type:"number",default:2},luminance:{type:"number",default:1},mieCoefficient:{type:"number",default:.005},mieDirectionalG:{type:"number",default:.8},inclination:{type:"number",default:0},azimuth:{type:"number",default:.15},distance:{type:"number",default:8e3}},init(){this.sky=new THREE.Sky,this.el.setObject3D("mesh",this.sky),this.skyScene=new THREE.Scene,this.cubeCamera=new THREE.CubeCamera(1,1e5,512),this.skyScene.add(this.cubeCamera),this.updateEnvironmentMap=this.updateEnvironmentMap.bind(this),requestAnimationFrame(()=>setTimeout(this.updateEnvironmentMap))},update(e){const t=this.sky.material.uniforms;if(this.data.turbidity!==e.turbidity&&(t.turbidity.value=this.data.turbidity),this.data.rayleigh!==e.rayleigh&&(t.rayleigh.value=this.data.rayleigh),this.data.luminance!==e.luminance&&(t.luminance.value=this.data.luminance),this.data.mieCoefficient!==e.mieCoefficient&&(t.mieCoefficient.value=this.data.mieCoefficient),this.data.mieDirectionalG!==e.mieDirectionalG&&(t.mieDirectionalG.value=this.data.mieDirectionalG),this.data.inclination!==e.inclination||this.data.azimuth!==e.azimuth||this.data.distance!==e.distance){const e=Math.PI*(this.data.inclination-.5),i=2*Math.PI*(this.data.azimuth-.5),a=this.data.distance,n=a*Math.cos(i),s=a*Math.sin(i)*Math.sin(e),o=a*Math.sin(i)*Math.cos(e);t.sunPosition.value.set(n,s,o).normalize(),1===this.el.object3D.scale.x&&this.sky.scale.set(a,a,a),this.el.object3D.matrixNeedsUpdate=!0}this.updateEnvironmentMap()},updateEnvironmentMap(){const e=this.el.sceneEl.components["environment-map"];if(e&&!O){const t=this.el.sceneEl.renderer;this.skyScene.add(this.sky),this.cubeCamera.update(t,this.skyScene),this.el.setObject3D("mesh",this.sky);const i=t.vr.enabled;t.vr.enabled=!1;const a=new THREE.PMREMGenerator(this.cubeCamera.renderTarget.texture);a.update(t);const n=new THREE.PMREMCubeUVPacker(a.cubeLods);n.update(t),t.vr.enabled=i,e.updateEnvironmentMap(n.CubeUVRenderTarget.texture),a.dispose(),n.dispose()}},remove(){this.el.removeObject3D("mesh")}}),AFRAME.registerComponent("spawn-controller",{schema:{target:{type:"selector"},camera:{type:"selector",default:"#player-camera"},playerHeight:{default:1.6},loadedEvent:{type:"string"}},init(){this.moveToSpawnPoint=this.moveToSpawnPoint.bind(this),this.data.target.addEventListener(this.data.loadedEvent,this.moveToSpawnPoint)},moveToSpawnPoint(){const e=document.querySelectorAll("[spawn-point]");if(0===e.length)return;const t=this.data.camera,i=e[Math.round((e.length-1)*Math.random())];Object(R.b)(i.object3D,this.el.object3D.position),this.el.object3D.rotation.copy(i.object3D.rotation),this.el.sceneEl.is("vr-mode")?this.el.object3D.rotation.y-=this.data.camera.object3D.rotation.y:(t.object3D.position.set(0,this.data.playerHeight,0),t.object3D.rotation.set(0,0,0),t.object3D.matrixNeedsUpdate=!0),this.el.object3D.rotation.y+=Math.PI,this.el.object3D.matrixNeedsUpdate=!0,t.components["pitch-yaw-rotator"]&&t.components["pitch-yaw-rotator"].set(t.object3D.rotation.x,t.object3D.rotation.y)}}),AFRAME.registerComponent("spawn-point",{init(){this.el.object3D.visible=!1}});i(848),i(849);var N=i(169),H=i(62),I=i(2);function j(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}const L=i(195).COLLISION_LAYERS;AFRAME.registerComponent("super-spawner",{schema:{src:{default:""},resolve:{default:!1},resize:{default:!1},template:{default:""},useCustomSpawnPosition:{default:!1},spawnPosition:{type:"vec3"},useCustomSpawnRotation:{default:!1},spawnRotation:{type:"vec4"},useCustomSpawnScale:{default:!1},spawnScale:{type:"vec3"},spawnCooldown:{default:1},centerSpawnedObject:{default:!1},spawnEvent:{type:"string"},animateFromCursor:{type:"boolean"}},init(){this.cooldownTimeout=null,this.handPosition=new THREE.Vector3,this.onSpawnEvent=this.onSpawnEvent.bind(this),this.sceneEl=document.querySelector("a-scene"),this.tempSpawnHandPosition=new THREE.Vector3},play(){this.data.spawnEvent&&this.el.sceneEl.addEventListener(this.data.spawnEvent,this.onSpawnEvent)},pause(){this.data.spawnEvent&&this.el.sceneEl.removeEventListener(this.data.spawnEvent,this.onSpawnEvent),this.cooldownTimeout&&(clearTimeout(this.cooldownTimeout),this.cooldownTimeout=null,this.el.setAttribute("visible",!0),this.el.classList.add("interactable"))},onSpawnEvent(){var e,t=this;return(e=function*(){if(t.cooldownTimeout||!t.el.sceneEl.is("entered"))return;const e=Object(m.b)(t.data.src,t.data.template,H.a.SPAWNER,null,t.data.resolve,!1).entity,i=document.querySelector("#cursor");i.object3D.getWorldPosition(e.object3D.position),i.object3D.getWorldQuaternion(e.object3D.quaternion),e.object3D.matrixNeedsUpdate=!0,t.data.useCustomSpawnScale&&e.object3D.scale.copy(t.data.spawnScale);const a=AFRAME.scenes[0].systems.userinput,n=AFRAME.scenes[0].systems.interaction,s=t.data.animateFromCursor&&a.get(I.a.actions.rightHand.matrix);s||(n.state.rightRemote.held=e,n.state.rightRemote.spawning=!0),t.activateCooldown(),yield Object(N.b)("body-loaded",e),i.object3D.getWorldPosition(e.object3D.position),i.object3D.getWorldQuaternion(e.object3D.quaternion),e.object3D.matrixNeedsUpdate=!0,s?(document.querySelector("#player-right-controller").object3D.getWorldPosition(t.handPosition),e.setAttribute("animation__spawn-at-cursor",{property:"position",delay:500,dur:1500,from:{x:e.object3D.position.x,y:e.object3D.position.y,z:e.object3D.position.z},to:{x:t.handPosition.x,y:t.handPosition.y,z:t.handPosition.z},easing:"easeInOutBack"})):n.state.rightRemote.spawning=!1,e.components["ammo-body"].syncToPhysics()},function(){var t=this,i=arguments;return new Promise(function(a,n){var s=e.apply(t,i);function o(e){j(s,a,n,o,r,"next",e)}function r(e){j(s,a,n,o,r,"throw",e)}o(void 0)})})()},activateCooldown(){if(this.data.spawnCooldown>0){const[e,t,i]=[this.el.object3D.scale.x,this.el.object3D.scale.y,this.el.object3D.scale.z];this.el.setAttribute("visible",!1),this.el.object3D.scale.set(.001,.001,.001),this.el.object3D.matrixNeedsUpdate=!0,this.el.classList.remove("interactable"),this.el.setAttribute("ammo-body",{collisionFilterMask:L.NONE}),this.cooldownTimeout=setTimeout(()=>{this.el.setAttribute("visible",!0),this.el.classList.add("interactable"),this.el.setAttribute("ammo-body",{collisionFilterMask:L.DEFAULT_SPAWNER}),this.el.removeAttribute("animation__spawner-cooldown"),this.el.setAttribute("animation__spawner-cooldown",{property:"scale",delay:50,dur:350,from:{x:.001,y:.001,z:.001},to:{x:e,y:t,z:i},easing:"easeOutElastic"}),this.cooldownTimeout=null},1e3*this.data.spawnCooldown)}}});i(1128);var F=i(532),B=i.n(F);function V(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}function U(e,t){THREE.Mesh.call(this,e);const i=void 0!==(t=t||{}).time?t.time:0,a=void 0!==t.waterNormals?t.waterNormals:null,n=void 0!==t.sunDirection?t.sunDirection:new THREE.Vector3(.70707,.70707,0),s=new THREE.Color(void 0!==t.sunColor?t.sunColor:16777215),o=new THREE.Color(void 0!==t.waterColor?t.waterColor:8355711),r=void 0!==t.eye?t.eye:new THREE.Vector3(0,0,0),c=void 0!==t.distortionScale?t.distortionScale:20,l=void 0!==t.side?t.side:THREE.FrontSide,d=void 0!==t.fog&&t.fog,h={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.lights,{normalSampler:{value:null},time:{value:0},size:{value:1},distortionScale:{value:20},sunColor:{value:new THREE.Color(8355711)},sunDirection:{value:new THREE.Vector3(.70707,.70707,0)},eye:{value:new THREE.Vector3},waterColor:{value:new THREE.Color(5592405)}}]),vertexShader:"\n      uniform float time;\n      varying vec4 worldPosition;\n\n      void main() {\n      \tworldPosition = modelMatrix * vec4( position, 1.0 );\n      \tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );\n      \tgl_Position = projectionMatrix * mvPosition;\n\n      }\n    ",fragmentShader:`\n      uniform float time;\n      uniform float size;\n      uniform float distortionScale;\n      uniform sampler2D normalSampler;\n      uniform vec3 sunColor;\n      uniform vec3 sunDirection;\n      uniform vec3 eye;\n      uniform vec3 waterColor;\n\n      varying vec4 worldPosition;\n\n      vec4 getNoise( vec2 uv ) {\n      \tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);\n      \tvec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );\n      \tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );\n      \tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );\n      \tvec4 noise = texture2D( normalSampler, uv0 ) +\n      \t\ttexture2D( normalSampler, uv1 ) +\n      \t\ttexture2D( normalSampler, uv2 ) +\n      \t\ttexture2D( normalSampler, uv3 );\n      \treturn noise * 0.5 - 1.0;\n      }\n\n      void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {\n      \tvec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );\n      \tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );\n      \tspecularColor += pow( direction, shiny ) * sunColor * spec;\n      \tdiffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;\n      }\n\n      ${THREE.ShaderChunk.common}\n      ${THREE.ShaderChunk.packing}\n      ${THREE.ShaderChunk.bsdfs}\n      ${THREE.ShaderChunk.lights_pars_begin}\n\n      void main() {\n      \tvec4 noise = getNoise( worldPosition.xz * size );\n      \tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );\n\n      \tvec3 diffuseLight = vec3(0.0);\n      \tvec3 specularLight = vec3(0.0);\n\n      \tvec3 worldToEye = eye-worldPosition.xyz;\n      \tvec3 eyeDirection = normalize( worldToEye );\n      \tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );\n\n      \tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );\n      \tfloat rf0 = 0.3;\n      \tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );\n      \tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;\n      \tvec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ), ( 0.5 + specularLight ), reflectance);\n      \tvec3 outgoingLight = albedo;\n      \tgl_FragColor = vec4( outgoingLight, 1 );\n      }\n    `},u=new THREE.ShaderMaterial({fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:THREE.UniformsUtils.clone(h.uniforms),transparent:!1,lights:!0,side:l,fog:d});u.uniforms.time.value=i,u.uniforms.normalSampler.value=a,u.uniforms.sunColor.value=s,u.uniforms.waterColor.value=o,u.uniforms.sunDirection.value=n,u.uniforms.distortionScale.value=c,u.uniforms.eye.value=r,this.material=u}function z(){var e;return e=function*(e){const t=yield new Promise((t,i)=>(new THREE.TextureLoader).load(e,t,void 0,i));return t.wrapS=t.wrapT=THREE.RepeatWrapping,t.needsUpdate=!0,t},(z=function(){var t=this,i=arguments;return new Promise(function(a,n){var s=e.apply(t,i);function o(e){V(s,a,n,o,r,"next",e)}function r(e){V(s,a,n,o,r,"throw",e)}o(void 0)})}).apply(this,arguments)}U.prototype=Object.create(THREE.Mesh.prototype),U.prototype.constructor=THREE.Water,AFRAME.registerComponent("water",{schema:{waterColor:{type:"color",default:"#001e0f"},distortionScale:{type:"number",default:3.7},sunColor:{type:"color",default:"#ffffff"},inclination:{type:"number",default:0},azimuth:{type:"number",default:0},distance:{type:"number",default:1},speed:{type:"number",default:.1},forceMobile:{type:"boolean",default:!1}},init(){const e=this.el.getObject3D("mesh"),t=e.geometry;e.visible=!1,function(e){return z.apply(this,arguments)}(B.a).then(e=>{const i={textureWidth:512,textureHeight:512,waterNormals:e,sunDirection:this.data.sunDirection,sunColor:new THREE.Color(this.data.sunColor),waterColor:new THREE.Color(this.data.waterColor),distortionScale:this.data.distortionScale,fog:!1};AFRAME.utils.device.isMobile()||AFRAME.utils.device.isMobileVR()||this.data.forceMobile?this.water=new U(t,i):(this.water=new THREE.Water(t,i),this.water.mirrorCamera.layers.set(h.reflection)),this.el.setObject3D("water",this.water)})},update(e){if(this.data.forceMobile!==e.forceMobile)return this.el.removeObject3D("water"),void this.init();if(!this.water)return;const t=this.water.material.uniforms;if(this.data.waterColor!==e.waterColor&&t.waterColor.value.setStyle(this.data.waterColor),this.data.distortionScale!==e.distortionScale&&(t.distortionScale.value=this.data.distortionScale),this.data.sunColor!==e.sunColor&&t.sunColor.value.setStyle(this.data.sunColor),this.data.inclination!==e.inclination||this.data.azimuth!==e.azimuth||this.data.distance!==e.distance){const e=Math.PI*(this.data.inclination-.5),i=2*Math.PI*(this.data.azimuth-.5),a=this.data.distance,n=a*Math.cos(i),s=a*Math.sin(i)*Math.sin(e),o=a*Math.sin(i)*Math.cos(e);t.sunDirection.value.set(n,s,o)}},tick(e){this.water&&(this.water.material.uniforms.time.value=e/1e3*this.data.speed)},remove(){this.el.removeObject3D("water"),this.el.getObject3D("mesh").visible=!0}});i(201),i(850),i(851)},1050:function(e,t,i){"use strict";i(164);function a(e,t,i){const a=i[e];if(!a)throw new Error(`Component "${e}" is not public.`);const n=a.publicProperties[t];if(!n)throw new Error(`Component "${e}"'s property "${t}" is not public.`);return{mappedComponent:a.mappedComponent,mappedProperty:n.mappedProperty,getMappedValue:n.getMappedValue}}var n=i(16);const s=i(224),o=s.TYPE,r=s.SHAPE,c=s.FIT,l=i(195).COLLISION_LAYERS;function d(e,t,i){0===i.range&&(i.decay=0),e.setAttribute(t,i)}function h(e,t,i,a){let s=!0;if(a.networked){const o="video"===t,r=(s=i.controls||Object(n.d)(i.src)||Object(n.d)(i.href))||o?"#static-controlled-media":"#static-media";e.setAttribute("networked",{template:r,owner:"scene",persistent:!0,networkId:a.networked.id})}const o={};"video"!==t&&"image"!==t||(o.projection=i.projection),"video"===t&&(o.videoPaused=!i.autoPlay,o.volume=i.volume,o.loop=i.loop,o.audioType=i.audioType,o.hidePlaybackControls=!s,"pannernode"===i.audioType&&(o.distanceModel=i.distanceModel,o.rolloffFactor=i.rolloffFactor,o.refDistance=i.refDistance,o.maxDistance=i.maxDistance,o.coneInnerAngle=i.coneInnerAngle,o.coneOuterAngle=i.coneOuterAngle,o.coneOuterGain=i.coneOuterGain),e.setAttribute("video-pause-state",{paused:o.videoPaused}));const r="link"===t?i.href:i.src;e.setAttribute("media-loader",{src:r,resize:!0,resolve:!0,fileIsOwned:!0,animate:!1,mediaOptions:o})}AFRAME.GLTFModelPlus.registerComponent("duck","duck"),AFRAME.GLTFModelPlus.registerComponent("quack","quack"),AFRAME.GLTFModelPlus.registerComponent("sound","sound"),AFRAME.GLTFModelPlus.registerComponent("css-class","css-class"),AFRAME.GLTFModelPlus.registerComponent("interactable","css-class",(e,t)=>{e.setAttribute(t,"interactable")}),AFRAME.GLTFModelPlus.registerComponent("super-spawner","super-spawner",(e,t,i)=>{e.setAttribute("is-remote-hover-target",""),e.setAttribute("tags",{isHandCollisionTarget:!0}),e.setAttribute("hoverable-visuals",{cursorController:"#cursor-controller"}),e.setAttribute(t,i)}),AFRAME.GLTFModelPlus.registerComponent("gltf-model-plus","gltf-model-plus"),AFRAME.GLTFModelPlus.registerComponent("media-loader","media-loader"),AFRAME.GLTFModelPlus.registerComponent("body","ammo-body",e=>{e.setAttribute("ammo-body",{mass:0,type:o.STATIC,collisionFilterGroup:l.INTERACTABLES,collisionFilterMask:l.DEFAULT_SPAWNER})}),AFRAME.GLTFModelPlus.registerComponent("ammo-shape","ammo-shape"),AFRAME.GLTFModelPlus.registerComponent("hide-when-quality","hide-when-quality"),AFRAME.GLTFModelPlus.registerComponent("light","light",(e,t,i)=>{0===i.distance&&(i.decay=0),e.setAttribute(t,i),i.castShadow&&setTimeout(()=>{e.components.light.light.shadow.camera.matrixNeedsUpdate=!0},0)}),AFRAME.GLTFModelPlus.registerComponent("ambient-light","ambient-light"),AFRAME.GLTFModelPlus.registerComponent("directional-light","directional-light"),AFRAME.GLTFModelPlus.registerComponent("hemisphere-light","hemisphere-light"),AFRAME.GLTFModelPlus.registerComponent("point-light","point-light",d),AFRAME.GLTFModelPlus.registerComponent("spot-light","spot-light",d),AFRAME.GLTFModelPlus.registerComponent("skybox","skybox"),AFRAME.GLTFModelPlus.registerComponent("layers","layers"),AFRAME.GLTFModelPlus.registerComponent("shadow","shadow"),AFRAME.GLTFModelPlus.registerComponent("water","water"),AFRAME.GLTFModelPlus.registerComponent("scale-audio-feedback","scale-audio-feedback"),AFRAME.GLTFModelPlus.registerComponent("animation-mixer","animation-mixer"),AFRAME.GLTFModelPlus.registerComponent("loop-animation","loop-animation"),AFRAME.GLTFModelPlus.registerComponent("box-collider","ammo-shape",(()=>{const e=new THREE.Euler;return(t,i,a)=>{const{scale:n,rotation:s}=a;e.set(s.x,s.y,s.z);const o=(new THREE.Quaternion).setFromEuler(e);t.setAttribute(i,{type:r.BOX,fit:c.MANUAL,offset:a.position,halfExtents:{x:n.x/2,y:n.y/2,z:n.z/2},orientation:o})}})()),AFRAME.GLTFModelPlus.registerComponent("visible","visible",(e,t,i)=>{"object"==typeof i?e.setAttribute(t,i.visible):e.setAttribute(t,i)}),AFRAME.GLTFModelPlus.registerComponent("spawn-point","spawn-point"),AFRAME.GLTFModelPlus.registerComponent("sticky-zone","sticky-zone"),AFRAME.GLTFModelPlus.registerComponent("nav-mesh","nav-mesh",(e,t,i)=>{const a=AFRAME.scenes[0].systems.nav,n=i.zone||"character";let s=!1;e.object3D.traverse(e=>{e.isMesh&&!s&&(s=!0,a.loadMesh(e,n))}),e.setAttribute("nav-mesh")}),AFRAME.GLTFModelPlus.registerComponent("pinnable","pinnable"),AFRAME.GLTFModelPlus.registerComponent("media","media",(e,t,i)=>{i.id&&e.setAttribute("networked",{template:"#interactable-media",owner:"scene",persistent:!0,networkId:i.id}),e.setAttribute("media-loader",{src:i.src,resize:!0,resolve:!0,fileIsOwned:!0,animate:!1,contentSubtype:i.contentSubtype}),i.pageIndex&&e.setAttribute("media-pager",{index:i.pageIndex}),void 0!==i.paused&&e.setAttribute("media-video",{videoPaused:i.paused}),i.time&&e.setAttribute("media-video",{time:i.time})}),AFRAME.GLTFModelPlus.registerComponent("image","image",h),AFRAME.GLTFModelPlus.registerComponent("video","video",h,(e,t,i)=>"paused"===t?{name:"video-pause-state",property:t,value:i}:null),AFRAME.GLTFModelPlus.registerComponent("link","link",h),AFRAME.GLTFModelPlus.registerComponent("hoverable","is-remote-hover-target",e=>{e.setAttribute("is-remote-hover-target",""),e.setAttribute("tags",{isHandCollisionTarget:!0})}),AFRAME.GLTFModelPlus.registerComponent("spawner","spawner",(e,t,i)=>{e.setAttribute("media-loader",{src:i.src,resolve:!0,fileIsOwned:!0,animate:!1}),e.setAttribute("css-class","interactable"),e.setAttribute("super-spawner",{src:i.src,resolve:!0,template:"#interactable-media"}),e.setAttribute("hoverable-visuals",{cursorController:"#cursor-controller"}),e.setAttribute("ammo-body",{mass:0,type:o.STATIC,collisionFilterGroup:l.INTERACTABLES,collisionFilterMask:l.DEFAULT_SPAWNER}),e.setAttribute("is-remote-hover-target",""),e.setAttribute("tags",{isHandCollisionTarget:!0})});const u={video:{mappedComponent:"video-pause-state",publicProperties:{paused:{mappedProperty:"paused",getMappedValue:e=>!!e}}},"loop-animation":{mappedComponent:"loop-animation",publicProperties:{paused:{mappedProperty:"paused",getMappedValue:e=>!!e}}}};AFRAME.GLTFModelPlus.registerComponent("trigger-volume","trigger-volume",(e,t,i,n,s)=>{const{size:o,target:r,enterComponent:c,enterProperty:l,enterValue:d,leaveComponent:h,leaveProperty:p,leaveValue:m}=i;let g,v,f;try{if(g=a(c,l,u),v=a(h,p,u),!(f=s[r]))throw new Error(`Couldn't find target entity with index: ${r}.`)}catch(e){return void console.warn(`Error inflating gltf component "trigger-volume": ${e.message}`)}e.setAttribute("trigger-volume",{colliders:"#player-camera",size:o,target:f,enterComponent:g.mappedComponent,enterProperty:g.mappedProperty,enterValue:g.getMappedValue(d),leaveComponent:v.mappedComponent,leaveProperty:v.mappedProperty,leaveValue:v.getMappedValue(m)})}),AFRAME.GLTFModelPlus.registerComponent("heightfield","heightfield",(e,t,i)=>{e.setAttribute("ammo-shape__heightfield",{type:r.HEIGHTFIELD,margin:.01,fit:c.MANUAL,heightfieldDistance:i.distance,offset:i.offset,heightfieldData:i.data})}),AFRAME.GLTFModelPlus.registerComponent("trimesh","trimesh",e=>{e.setAttribute("ammo-shape__trimesh",{type:r.MESH,margin:.01,fit:c.ALL,includeInvisible:!0})})},1073:function(e,t,i){e.exports=i.p+"assets/images/logo-8f1dfd234d060073524bc29912a24f75.svg"},1074:function(e,t,i){e.exports=i.p+"assets/images/giphy_logo-1dcbee43e18919c0bd0c999be8602628.png"},11:function(e,t,i){"use strict";function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function n(e,t,i,n,s,o,r){let c={};const l=(e.location.state&&e.location.state.__historyLength||0)+(t?0:1);(i||o||r)&&(delete(c=e.location.state?function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),n.forEach(function(t){a(e,t,i[t])})}return e}({},e.location.state):{}).__duplicate,i&&(c[i]=n,c.key=i,c.value=n,c.detail=s));const d=void 0!==o?o:"/"===e.location.pathname?"":e.location.pathname,h=void 0!==r?r:e.location.search,u=e.location.state&&e.location.state.__duplicate,p=t||u?e.replace:e.push;c.__historyLength=l,p({pathname:d,search:h,state:c})}function s(e,t,i,a){n(e,!1,t,i,a)}function o(e,t,i,a){n(e,!0,t,i,a)}function r(e,t,i){n(e,!1,null,null,null,t,i)}function c(e){n(e,!1)}function l(e,t){if(!e.location.state||void 0===e.location.state.__historyLength)return;const i=e.location.state.__historyLength;return 0!==i?new Promise(a=>{const n=e.listen(()=>{n(),e.push({pathname:e.location.pathname,search:e.location.search,state:{__historyLength:0,__duplicate:!0}}),t&&e.go(-2),a()});e.go(-i)}):void 0}function d(e){l(e,!0)}function h(e){return`/${e.pathname.split("/").slice(2).join("/")}`}function u(e,t){return`/${e.pathname.split("/")[1]}${t}`}i.d(t,"e",function(){return s}),i.d(t,"f",function(){return o}),i.d(t,"d",function(){return r}),i.d(t,"a",function(){return c}),i.d(t,"c",function(){return l}),i.d(t,"b",function(){return d}),i.d(t,"g",function(){return h}),i.d(t,"h",function(){return u})},120:function(e,t,i){"use strict";i.d(t,"c",function(){return r}),i.d(t,"a",function(){return c}),i.d(t,"b",function(){return l});var a=i(83),n=i.n(a);let s=!1;function o(){return(AFRAME.utils.device.isMobile()||AFRAME.utils.device.isMobileVR())&&!AFRAME.utils.device.isIOS()&&n.a.enabled}function r(){return!n.a.isFullscreen&&o()}function c(){o()&&(n.a.request(),s=!0)}function l(){s&&!n.a.isFullscreen&&n.a.request()}},1230:function(e,t){e.exports="data:image/gif;base64,R0lGODlhEAAQAIQaAAAAAAEBAQABBQEBAgEBBQMDAwAykwBk+wFk+/85Af47AwCIHgCJHgGJHgCKHgOJIPc63vc64Pc64YeHhwDySLu7wru8wru8w7y8wwD6/v///////////////////////yH+EUNyZWF0ZWQgd2l0aCBHSU1QACH5BAEKAB8ALAAAAAAQABAAAAVl4AeMZDl9KAqkLDqd6YrN9HzC4jdbTUPDMBnGQWEAKphBYKTSYR6LRQE5y+VmlUAAc+lWrMIa4nBYxXQJcabMkkUUtLGhJZNA4BiC4HyVSCJpKRhgOktmgoRVLDSELY5mTHQlKyEAOw=="},1232:function(e,t,i){e.exports=i.p+"assets/camera_tool-a25d0894a6b635779bd4ed41f2de0411.glb"},1234:function(e,t,i){e.exports=i.p+"assets/images/mic_granted-5d41c8098b2c1a084f07dd3a2473983f.png"},1235:function(e,t,i){e.exports=i.p+"assets/images/mic_granted@2x-f84d9eb002832eeeb768529e6cb1e93e.png"},1236:function(e,t,i){e.exports=i.p+"assets/images/mic_small-b81b3397cc985eb8d3d67a4f007158cc.png"},1237:function(e,t,i){e.exports=i.p+"assets/images/mic_small@2x-d04ff548fa26495f69249f0c34f44b72.png"},1238:function(e,t,i){e.exports=i.p+"assets/images/dropdown_arrow-601450f494125f8caccec2271aebd4cb.png"},1239:function(e,t,i){e.exports=i.p+"assets/images/dropdown_arrow@2x-1023ab0bd743b3525d99986de89f0c3b.png"},1240:function(e,t,i){e.exports=i.p+"assets/images/add-owner-c3f352da151b4a5be71defd565720235.png"},1241:function(e,t,i){e.exports=i.p+"assets/images/remove-owner-02b96ad3a84badda798fde00ac4c2243.png"},1242:function(e,t,i){e.exports=i.p+"assets/images/mobile_screen_entry-b29fcd32c8f70bb828c1abceb62f93e2.svg"},1243:function(e,t,i){e.exports=i.p+"assets/images/desktop_screen_entry-e5ff9b5e64caa694e9b4183e532fcb17.svg"},1244:function(e,t,i){e.exports=i.p+"assets/images/generic_vr_entry-c648c26ce1388450df7edbd92ec00f5e.svg"},1245:function(e,t,i){e.exports=i.p+"assets/images/gearvr_entry-dcea59d35d7fae4c8b9c4985c1743851.svg"},1246:function(e,t,i){e.exports=i.p+"assets/images/daydream_entry-6e2716960046992dbd6b0e87bf8c2c3a.svg"},125:function(e,t,i){e.exports=i.p+"assets/sfx/tick-b0fcbf1d9b6f92a24bec12f9bae1e42a.mp3"},1251:function(e,t,i){e.exports=i.p+"assets/images/link_dialog_header-b15568ca2056d8be7a58c359e6a9ca51.svg"},1258:function(e,t,i){e.exports=i.p+"assets/images/presence_phone-fd7ea0e8be441172a758704055604e5f.png"},1259:function(e,t,i){e.exports=i.p+"assets/images/presence_desktop-be24a9f21df60cd831ad66b67282d6f2.png"},1260:function(e,t,i){e.exports=i.p+"assets/images/presence_discord-e05ead6e6ebc08df9291738d0aa6986d.png"},1261:function(e,t,i){e.exports=i.p+"assets/images/presence_camera-aaa719190a30677416c33e3dda33d7ef.png"},1262:function(e,t,i){e.exports=i.p+"assets/images/presence_vr-563f3bd1c0f37473a3303f4a6049288c.png"},1264:function(e,t,i){e.exports=i.p+"assets/images/level_background-9744d0690bba7838e4a75949d9645c09.png"},1265:function(e,t,i){e.exports=i.p+"assets/images/level_background@2x-bf55b6a808963d89ff7ce04c516c232c.png"},1266:function(e,t,i){e.exports=i.p+"assets/images/level_fill-35626a008836cbdc34ec624e16f5b723.png"},1267:function(e,t,i){e.exports=i.p+"assets/images/level_fill@2x-b3e3675f8281c84660fb5b47eb66126e.png"},1268:function(e,t,i){e.exports=i.p+"assets/images/mic_level-d197b930a4350dc80adb2446babb05e1.png"},1269:function(e,t,i){e.exports=i.p+"assets/images/mic_level@2x-9d49309c2f0e55e5c54193237658768b.png"},1271:function(e,t,i){e.exports=i.p+"assets/images/level_action_background-5aeb2dca8113545a2bc3e56dc702001b.png"},1272:function(e,t,i){e.exports=i.p+"assets/images/level_action_background@2x-3a7ab65c95a1b4037d701c8fa16c3cd6.png"},1273:function(e,t,i){e.exports=i.p+"assets/images/level_action_fill-4e639ed717b8a9a7da4426665ec2dcf4.png"},1274:function(e,t,i){e.exports=i.p+"assets/images/level_action_fill@2x-eb547f6337c0ea74b35da9812ee3e04b.png"},1275:function(e,t,i){e.exports=i.p+"assets/images/speaker_level-9567a1a6f33d4d0e59e57903b08369c9.png"},1276:function(e,t,i){e.exports=i.p+"assets/images/speaker_level@2x-b5e6a12f613576cf5c1a1b96e8c9d8d0.png"},1277:function(e,t,i){e.exports=i.p+"assets/sfx/tone-624e72d19fe0cea1b85ca174cb6be256.webm"},1278:function(e,t,i){e.exports=i.p+"assets/sfx/tone-3fa0defb5172b2533fedcc1929605799.mp3"},1279:function(e,t,i){e.exports=i.p+"assets/sfx/tone-78ae5a60f0e336f384919eee9f5a2e18.ogg"},1280:function(e,t,i){e.exports=i.p+"assets/sfx/tone-4604a4c98f36f3e0c6980295bc5c7ffe.wav"},1281:function(e,t,i){e.exports=i.p+"assets/images/change_avatar-a426739806600c28e20a614cbade29f2.svg"},1286:function(e,t){e.exports="#version 300 es\nprecision highp float;\nprecision highp int;\n\n// Keep these separate so three only sets them once\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\nlayout(std140) uniform InstanceData {\n  mat4 transforms[MAX_INSTANCES];\n  vec4 colors[MAX_INSTANCES];\n  vec4 uvTransforms[MAX_INSTANCES];\n  vec4 mapSettings[MAX_INSTANCES];\n\n  vec4 hubs_SweepParams[MAX_INSTANCES];\n\n  vec3 hubs_InteractorOnePos;\n  bool hubs_IsFrozen;\n\n  vec3 hubs_InteractorTwoPos;\n  float hubs_Time;\n\n} instanceData;\n\nout vec3 hubs_WorldPosition;\n\nin vec3 position;\nin vec2 uv;\n\n#ifdef PSEUDO_INSTANCING\nin float instance;\nflat out uint vInstance;\n#endif\n\n#ifdef VERTEX_COLORS\nin vec3 color;\n#endif\n\nout vec2 vUv;\nout vec4 vColor;\n\nflat out vec4 vUVTransform;\nflat out vec4 vMapSettings;\n\nvoid main() {\n  #ifdef PSEUDO_INSTANCING\n  uint instanceIndex = uint(instance);\n  #elif\n  uint instanceIndex = gl_InstanceID;\n  #endif\n\n  vColor = instanceData.colors[instanceIndex];\n\n  #ifdef VERTEX_COLORS\n  vColor *= vec4(color, 1.0);\n  #endif\n\n  vUv = uv;\n  vUVTransform = instanceData.uvTransforms[instanceIndex];\n  vMapSettings = instanceData.mapSettings[instanceIndex];\n\n  gl_Position = projectionMatrix * viewMatrix * instanceData.transforms[instanceIndex] * vec4(position, 1.0);\n\n  hubs_WorldPosition = (instanceData.transforms[instanceIndex] * vec4(position, 1.0)).xyz;\n  vInstance = instanceIndex;\n}\n"},1287:function(e,t){e.exports="#version 300 es\nprecision highp float;\nprecision highp int;\nprecision highp sampler2DArray;\n\n\nlayout(std140) uniform InstanceData {\n  mat4 transforms[MAX_INSTANCES];\n  vec4 colors[MAX_INSTANCES];\n  vec4 uvTransforms[MAX_INSTANCES];\n  vec4 mapSettings[MAX_INSTANCES];\n\n  vec4 hubs_SweepParams[MAX_INSTANCES];\n\n  vec3 hubs_InteractorOnePos;\n  bool hubs_IsFrozen;\n\n  vec3 hubs_InteractorTwoPos;\n  float hubs_Time;\n\n} instanceData;\nin vec3 hubs_WorldPosition;\n#ifdef PSEUDO_INSTANCING\nflat in uint vInstance;\n#endif\n\n\nuniform sampler2DArray map;\n\nin vec2 vUv;\nin vec4 vColor;\nflat in vec4 vUVTransform;\nflat in vec4 vMapSettings;\n\nout vec4 outColor;\n\nfloat applyWrapping(float value, int mode) {\n  if (mode == 0) {\n    // CLAMP_TO_EDGE - default\n    return clamp(value, 0.0, 1.0);\n  } else if (mode == 1) {\n    // REPEAT\n    return fract(value);\n  } else {\n    // MIRRORED_REPEAT\n    float n = mod(value, 2.0);\n    return mix(n, 2.0 - n, step(1.0, n));\n  }\n}\n\nvoid main() {\n  vec2 uv = vUv;\n\n  int wrapS = int(vMapSettings.y);\n  int wrapT = int(vMapSettings.z);\n  uv.s = applyWrapping(uv.s, wrapS);\n  uv.t = applyWrapping(uv.t, wrapT);\n\n  vec2 uvMin = vUVTransform.xy;\n  vec2 uvScale = vUVTransform.zw;\n  uv = uvMin + uv * uvScale;\n\n  int mapIdx = int(vMapSettings.x);\n  outColor = texture(map, vec3(uv, mapIdx)) * vColor;\n  if(outColor.a == 0.0) {\n      discard;\n  }\n\n  bool hubs_HighlightInteractorOne = instanceData.hubs_SweepParams[vInstance].z > 0.0;\n  bool hubs_HighlightInteractorTwo = instanceData.hubs_SweepParams[vInstance].w > 0.0;\n  bool hubs_IsFrozen = instanceData.hubs_IsFrozen;\n\n  if (hubs_HighlightInteractorOne || hubs_HighlightInteractorTwo || hubs_IsFrozen) {\n\n      bool hubs_EnableSweepingEffect = true;\n      vec2 hubs_SweepParams = instanceData.hubs_SweepParams[vInstance].xy;\n      float hubs_Time = instanceData.hubs_Time;\n\n      float ratio = 0.0;\n\n      if (hubs_EnableSweepingEffect) {\n          float size = hubs_SweepParams.t - hubs_SweepParams.s;\n          float line = mod(hubs_Time / 500.0 * size, size * 3.0) + hubs_SweepParams.s - size / 3.0;\n\n          if (hubs_WorldPosition.y < line) {\n              // Highlight with a sweeping gradient.\n              ratio = max(0.0, 1.0 - (line - hubs_WorldPosition.y) / (size * 1.5));\n          }\n      }\n\n      // Highlight with a gradient falling off with distance.\n      float pulse = 9.0 + 3.0 * (sin(hubs_Time / 1000.0) + 1.0);\n\n      if (hubs_HighlightInteractorOne) {\n          float dist1 = distance(hubs_WorldPosition, instanceData.hubs_InteractorOnePos);\n          ratio += -min(1.0, pow(dist1 * pulse, 3.0)) + 1.0;\n      }\n\n      if (hubs_HighlightInteractorTwo) {\n          float dist2 = distance(hubs_WorldPosition, instanceData.hubs_InteractorTwoPos);\n          ratio += -min(1.0, pow(dist2 * pulse, 3.0)) + 1.0;\n      }\n\n      ratio = min(1.0, ratio);\n\n      // Gamma corrected highlight color\n      vec3 highlightColor = vec3(0.184, 0.499, 0.933);\n\n      outColor = vec4((outColor.rgb * (1.0 - ratio)) + (highlightColor * ratio), outColor.a);\n  }\n\n}\n"},1288:function(e){e.exports={meta:{image:"sprite-system-spritesheet.png",size:{w:1024,h:1024},scale:"1"},frames:{"freeze_on.png":{frame:{x:156,y:8,w:132,h:132},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:132,h:132},sourceSize:{w:132,h:132}},"create_object-hover.png":{frame:{x:8,y:8,w:132,h:132},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:132,h:132},sourceSize:{w:132,h:132}},"freeze_on-hover.png":{frame:{x:8,y:156,w:132,h:132},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:132,h:132},sourceSize:{w:132,h:132}},"freeze_off.png":{frame:{x:156,y:156,w:132,h:132},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:132,h:132},sourceSize:{w:132,h:132}},"freeze_off-hover.png":{frame:{x:304,y:8,w:132,h:132},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:132,h:132},sourceSize:{w:132,h:132}},"create_object.png":{frame:{x:304,y:156,w:132,h:132},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:132,h:132},sourceSize:{w:132,h:132}},"spawn-disabled.png":{frame:{x:8,y:304,w:128,h:128},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:128,h:128},sourceSize:{w:128,h:128}},"mod-badge.png":{frame:{x:152,y:304,w:128,h:128},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:128,h:128},sourceSize:{w:128,h:128}},"recording-badge.png":{frame:{x:296,y:304,w:128,h:128},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:128,h:128},sourceSize:{w:128,h:128}},"spawn.png":{frame:{x:452,y:8,w:128,h:128},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:128,h:128},sourceSize:{w:128,h:128}},"spawn-hover.png":{frame:{x:452,y:152,w:128,h:128},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:128,h:128},sourceSize:{w:128,h:128}},"Background.png":{frame:{x:452,y:296,w:128,h:48},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:128,h:48},sourceSize:{w:128,h:48}},"Oval Copy.png":{frame:{x:8,y:448,w:124,h:124},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:124,h:124},sourceSize:{w:124,h:124}},"share_camera_off.png":{frame:{x:452,y:360,w:68,h:68},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:68,h:68},sourceSize:{w:68,h:68}},"mute_off.png":{frame:{x:148,y:448,w:68,h:68},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:68,h:68},sourceSize:{w:68,h:68}},"mute_on-hover.png":{frame:{x:232,y:448,w:68,h:68},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:68,h:68},sourceSize:{w:68,h:68}},"mute_on.png":{frame:{x:316,y:448,w:68,h:68},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:68,h:68},sourceSize:{w:68,h:68}},"pen_off-disabled.png":{frame:{x:400,y:448,w:68,h:68},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:68,h:68},sourceSize:{w:68,h:68}},"pen_off-hover.png":{frame:{x:484,y:448,w:68,h:68},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:68,h:68},sourceSize:{w:68,h:68}},"camera_off-disabled.png":{frame:{x:596,y:8,w:68,h:68},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:68,h:68},sourceSize:{w:68,h:68}},"pen_on-hover.png":{frame:{x:596,y:92,w:68,h:68},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:68,h:68},sourceSize:{w:68,h:68}},"pen_on.png":{frame:{x:596,y:176,w:68,h:68},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:68,h:68},sourceSize:{w:68,h:68}},"camera_on.png":{frame:{x:596,y:260,w:68,h:68},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:68,h:68},sourceSize:{w:68,h:68}},"camera_on-hover.png":{frame:{x:596,y:344,w:68,h:68},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:68,h:68},sourceSize:{w:68,h:68}},"share_camera_off-hover.png":{frame:{x:596,y:428,w:68,h:68},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:68,h:68},sourceSize:{w:68,h:68}},"mute_off-hover.png":{frame:{x:8,y:588,w:68,h:68},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:68,h:68},sourceSize:{w:68,h:68}},"share_camera_on-hover.png":{frame:{x:92,y:588,w:68,h:68},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:68,h:68},sourceSize:{w:68,h:68}},"share_camera_on.png":{frame:{x:176,y:588,w:68,h:68},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:68,h:68},sourceSize:{w:68,h:68}},"share_screen_off.png":{frame:{x:260,y:588,w:68,h:68},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:68,h:68},sourceSize:{w:68,h:68}},"share_screen_on-hover.png":{frame:{x:344,y:588,w:68,h:68},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:68,h:68},sourceSize:{w:68,h:68}},"share_screen_on.png":{frame:{x:428,y:588,w:68,h:68},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:68,h:68},sourceSize:{w:68,h:68}},"share_window_off-hover.png":{frame:{x:512,y:588,w:68,h:68},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:68,h:68},sourceSize:{w:68,h:68}},"share_window_off.png":{frame:{x:596,y:588,w:68,h:68},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:68,h:68},sourceSize:{w:68,h:68}},"share_window_on-hover.png":{frame:{x:680,y:8,w:68,h:68},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:68,h:68},sourceSize:{w:68,h:68}},"share_window_on.png":{frame:{x:680,y:92,w:68,h:68},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:68,h:68},sourceSize:{w:68,h:68}},"camera_off.png":{frame:{x:680,y:176,w:68,h:68},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:68,h:68},sourceSize:{w:68,h:68}},"camera_off-hover.png":{frame:{x:680,y:260,w:68,h:68},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:68,h:68},sourceSize:{w:68,h:68}},"pen_off.png":{frame:{x:680,y:344,w:68,h:68},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:68,h:68},sourceSize:{w:68,h:68}},"volume_up.png":{frame:{x:484,y:532,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},"recenter-action.png":{frame:{x:680,y:508,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"record-action-alpha.png":{frame:{x:680,y:588,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"record-action.png":{frame:{x:8,y:672,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"fly_off-hover.png":{frame:{x:88,y:672,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"remove-action.png":{frame:{x:168,y:672,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"rotate-action.png":{frame:{x:248,y:672,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"rotate-cursor.png":{frame:{x:328,y:672,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"scale-action.png":{frame:{x:408,y:672,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"unmute-action.png":{frame:{x:488,y:672,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"stop-action.png":{frame:{x:568,y:672,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"spawn_message_dark.png":{frame:{x:648,y:672,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"spawn_message_dark-hover.png":{frame:{x:764,y:8,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"fly_off.png":{frame:{x:764,y:88,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"fly_on-hover.png":{frame:{x:764,y:168,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"fly_on.png":{frame:{x:764,y:248,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"next.png":{frame:{x:764,y:328,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"pause-hover.png":{frame:{x:764,y:408,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"pause.png":{frame:{x:764,y:488,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"close-action.png":{frame:{x:764,y:568,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"close-white.png":{frame:{x:764,y:648,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"camera-action.png":{frame:{x:8,y:752,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"prev.png":{frame:{x:88,y:752,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"drop-action.png":{frame:{x:168,y:752,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"spawn_message.png":{frame:{x:248,y:752,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"pin-action.png":{frame:{x:328,y:752,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"snap_camera.png":{frame:{x:408,y:752,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"play-hover.png":{frame:{x:488,y:752,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"play.png":{frame:{x:568,y:752,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}},"snap.png":{frame:{x:596,y:512,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},"snap-hover.png":{frame:{x:536,y:360,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},"seek_fwd.png":{frame:{x:148,y:532,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},"seek_fwd-hover.png":{frame:{x:196,y:532,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},"seek_back.png":{frame:{x:244,y:532,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},"seek_back-hover.png":{frame:{x:292,y:532,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},"volume_down-hover.png":{frame:{x:340,y:532,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},"volume_down.png":{frame:{x:388,y:532,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},"volume_up-hover.png":{frame:{x:436,y:532,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},"mute-action.png":{frame:{x:680,y:428,w:64,h:64},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:64,h:64},sourceSize:{w:64,h:64}}}}},1289:function(e,t,i){e.exports=i.p+"assets/images/spritesheets/sprite-system-spritesheet-547a69f61b13d234bc0b01285bb23da0.png"},129:function(e,t,i){"use strict";i.d(t,"a",function(){return c}),i.d(t,"e",function(){return d}),i.d(t,"b",function(){return u}),i.d(t,"c",function(){return g}),i.d(t,"d",function(){return v});var a=i(10),n=i(16),s=i(72);function o(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}function r(e){return function(){var t=this,i=arguments;return new Promise(function(a,n){var s=e.apply(t,i);function r(e){o(s,a,n,r,c,"next",e)}function c(e){o(s,a,n,r,c,"throw",e)}r(void 0)})}}const c={LEGACY:"legacy",SKINNABLE:"skinnable",URL:"url"},l=s.a.map(e=>e.id);function d(e){return e&&-1===l.indexOf(e)?e.startsWith("http")?c.URL:c.SKINNABLE:c.LEGACY}function h(){return(h=r(function*(e){const t=yield Object(a.d)(`/api/v1/avatars/${e}`);return t&&t.avatars&&t.avatars[0]})).apply(this,arguments)}function u(e){return p.apply(this,arguments)}function p(){return(p=r(function*(e){switch(d(e)){case c.LEGACY:return{avatar_id:e,gltf_url:s.a.find(t=>t.id===e).model};case c.SKINNABLE:return function(e){return h.apply(this,arguments)}(e);case c.URL:return{avatar_id:e,gltf_url:Object(n.g)(e)}}})).apply(this,arguments)}function m(){return(m=r(function*(e){return u(e).then(e=>e&&e.gltf_url)})).apply(this,arguments)}function g(e){switch(d(e)){case c.LEGACY:return`#${e}`;case c.SKINNABLE:return function(e){return m.apply(this,arguments)}(e);case c.URL:return Object(n.g)(e);default:return e}}function v(e){return f.apply(this,arguments)}function f(){return(f=r(function*(e){switch(d(e)){case c.LEGACY:return s.a.find(t=>t.id===e).thumbnail;case c.SKINNABLE:return u(e).then(e=>e.files.thumbnail);default:return"https://asset-bundles-prod.reticulum.io/bots/avatar_unavailable.png"}})).apply(this,arguments)}},1290:function(e,t){e.exports="attribute vec4 mvCol0;\nattribute vec4 mvCol1;\nattribute vec4 mvCol2;\nattribute vec4 mvCol3;\nattribute vec3 a_vertices;\nattribute vec2 a_uvs;\nvarying vec2 v_uvs;\nattribute float a_hubs_EnableSweepingEffect;\nvarying float v_hubs_EnableSweepingEffect;\nattribute vec2 a_hubs_SweepParams;\nvarying vec2 v_hubs_SweepParams;\nvarying vec3 hubs_WorldPosition;\n\nvoid main() {\n  mat4 mv = mat4(mvCol0, mvCol1, mvCol2, mvCol3);\n  gl_Position = projectionMatrix * modelViewMatrix * mv * vec4(a_vertices, 1.0);\n  v_uvs = a_uvs;\n  v_hubs_EnableSweepingEffect = a_hubs_EnableSweepingEffect;\n  v_hubs_SweepParams = a_hubs_SweepParams;\n\n  vec4 wt = vec4(a_vertices, 1.0);\n  hubs_WorldPosition = (mv * wt).xyz;\n}\n"},1291:function(e,t){e.exports="precision mediump float;\n\nuniform sampler2D u_spritesheet;\n\nvarying vec2 v_uvs;\n\nvarying float v_hubs_EnableSweepingEffect;\nvarying vec2 v_hubs_SweepParams;\nvarying vec3 hubs_WorldPosition;\nuniform bool hubs_HighlightInteractorOne;\nuniform vec3 hubs_InteractorOnePos;\nuniform bool hubs_HighlightInteractorTwo;\nuniform vec3 hubs_InteractorTwoPos;\nuniform float hubs_Time;\n\n#define GAMMA_FACTOR 2.2\n\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\n\nvec4 linearToOutputTexel( vec4 value ) {\n  return LinearToGamma( value, float( GAMMA_FACTOR ) );\n}\n\nvoid main() {\n    vec4 texColor = texture2D(u_spritesheet, v_uvs);\n\n    float ratio = 0.0;\n    if (v_hubs_EnableSweepingEffect > 0.9 ) {\n        float size = v_hubs_SweepParams.t - v_hubs_SweepParams.s * 1.0;\n        float line = mod(hubs_Time / 500.0 * size, size * 3.0) + v_hubs_SweepParams.s - size / 3.0;\n        if (hubs_WorldPosition.y < line) {\n            ratio = max(0.0, 1.0 - (line - hubs_WorldPosition.y) / (size * 1.5));\n        }\n\n    }\n    ratio = min(1.0, ratio);\n\n    vec4 highlightColor = linearToOutputTexel(vec4(0.184, 0.499, 0.933, 1.0));\n    gl_FragColor = vec4((texColor.rgb * (1.0 - ratio)) + (highlightColor.rgb * ratio), texColor.a);\n}\n"},141:function(e,t,i){"use strict";function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.d(t,"a",function(){return o});const n="\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n  #include <uv_vertex>\n  #include <uv2_vertex>\n  #include <color_vertex>\n  #include <skinbase_vertex>\n\n  #include <begin_vertex>\n  #include <morphtarget_vertex>\n  #include <skinning_vertex>\n  #include <project_vertex>\n  #include <logdepthbuf_vertex>\n\n  #include <worldpos_vertex>\n  #include <clipping_planes_vertex>\n  #include <fog_vertex>\n}\n",s="\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <aomap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n  #include <clipping_planes_fragment>\n\n  vec4 diffuseColor = vec4(diffuse, opacity);\n  ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n  vec3 totalEmissiveRadiance = emissive;\n\n  #include <logdepthbuf_fragment>\n  #include <map_fragment>\n  #include <color_fragment>\n  #include <alphatest_fragment>\n  #include <emissivemap_fragment>\n\n  reflectedLight.indirectDiffuse += vec3(1.0);\n\n  #include <aomap_fragment>\n\n  reflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n  vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n  gl_FragColor = vec4(outgoingLight, diffuseColor.a);\n\n  #include <premultiplied_alpha_fragment>\n  #include <tonemapping_fragment>\n  #include <encodings_fragment>\n  #include <fog_fragment>\n}\n";class o extends THREE.ShaderMaterial{constructor(...e){super(...e),a(this,"type","MobileStandardMaterial"),a(this,"isMobileStandardMaterial",!0)}static fromStandardMaterial(e){const t={vertexShader:n,fragmentShader:s,uniforms:{uvTransform:{value:new THREE.Matrix3},diffuse:{value:e.color},opacity:{value:e.opacity},map:{value:e.map},aoMapIntensity:{value:e.aoMapIntensity},aoMap:{value:e.aoMap},emissive:{value:e.emissive},emissiveMap:{value:e.emissiveMap}},fog:!0,lights:!1,opacity:e.opacity,transparent:e.transparent,alphaTest:e.alphaTest,skinning:e.skinning,morphTargets:e.morphTargets,vertexColors:e.vertexColors},i=new o(t);return i.color=e.color,i.map=e.map,i.aoMap=e.aoMap,i.aoMapIntensity=e.aoMapIntensity,i.emissive=e.emissive,i.emissiveMap=e.emissiveMap,i}clone(){return o.fromStandardMaterial(this)}}},142:function(e,t,i){"use strict";i.d(t,"a",function(){return l}),i.d(t,"b",function(){return m});var a=i(82),n=i(10),s=i(11);function o(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}function r(e){return function(){var t=this,i=arguments;return new Promise(function(a,n){var s=e.apply(t,i);function r(e){o(s,a,n,r,c,"next",e)}function c(e){o(s,a,n,r,c,"throw",e)}r(void 0)})}}function c(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const l=["poly","sketchfab","videos","scenes","gifs","images","twitch"],d={entries:[],meta:{}},h={scenes:"scene_listings",images:"bing_images",videos:"bing_videos",youtube:"youtube_videos",gifs:"tenor",sketchfab:"sketchfab",poly:"poly",twitch:"twitch",favorites:"favorites"},u={gifs:"trending",sketchfab:"featured",scenes:"featured",favorites:"my-favorites"},p=["q","filter","cursor"];class m extends a.a{constructor(){var e;super(),e=this,c(this,"_update",function(){var t=r(function*(t){e.result=null,e.dispatchEvent(new CustomEvent("statechanged"));const i=e.getUrlMediaSource(t);if(!i)return;e.previousSource&&e.previousSource===i||(e.dispatchEvent(new CustomEvent("sourcechanged")),e.previousSource=i);const a=new URLSearchParams(t.search);e.requestIndex++;const s=e.requestIndex,o=new URLSearchParams,r=new URLSearchParams(t.search),c=r.get("filter")&&r.get("filter").startsWith("my-");for(const e of p)a.get(e)&&o.set(e,a.get(e));let l;if(o.get("locale",navigator.languages[0]),"avatars"===i||"scenes"===i){const e="avatars"===i?"avatar":"scene";l=c?`${e}s`:`${e}_listings`}else l=h[i];o.set("source",l);let u=!0;"avatars"!==l&&"scenes"!==l&&"favorites"!==l||c&&(window.APP.store.credentialsAccountId?o.set("user",window.APP.store.credentialsAccountId):u=!1);const m=`/api/v1/media/search?${o.toString()}`,g=Object(n.h)(m);if(e.lastSavedUrl===g)return;e.isFetching=!0,e.dispatchEvent(new CustomEvent("statechanged"));const v=u?yield Object(n.d)(m):d;e.requestIndex==s&&(e.result=v,e.nextCursor=e.result&&e.result.meta&&e.result.meta.next_cursor,e.lastFetchedUrl=g,e.isFetching=!1,e.dispatchEvent(new CustomEvent("statechanged")))});return function(e){return t.apply(this,arguments)}}()),c(this,"_legacyAvatarToSearchEntry",e=>({id:e.id,type:"avatar_listing",url:e.url,images:{preview:{url:e.thumbnail,width:720,height:1280}},gltfs:{avatar:e.model}})),c(this,"pageNavigate",e=>{if(-1===e)this.history.goBack();else{const e=this.history.location,t=new URLSearchParams(e.search);t.set("cursor",this.nextCursor),Object(s.d)(this.history,e.pathname,t.toString())}}),c(this,"filterQueryNavigate",(e,t)=>{const i=this.history.location,a=new URLSearchParams(i.search);t?a.set("q",t):a.delete("q"),e?a.set("filter",e):a.delete("filter"),e?a.set("cursor",e):a.delete("cursor"),Object(s.d)(this.history,i.pathname,a.toString())}),c(this,"getSearchClearedSearchParams",(e,t,i)=>{const a=new URLSearchParams(e.search);return a.delete("q"),a.delete("filter"),a.delete("cursor"),i||a.delete("media_nav"),t||a.delete("media_source"),a}),c(this,"_stashLastSearchParams",e=>{const t=new URLSearchParams(e.search);this._stashedParams={},this._stashedSource=null;const i=this.getUrlMediaSource(e);if("favorites"!==i){this._stashedSource=i;for(const e of p){const i=t.get(e);i&&(this._stashedParams[e]=i)}}}),c(this,"clearStashedQuery",()=>{this._stashedParams&&delete this._stashedParams.q}),c(this,"sourceNavigate",e=>{this._sourceNavigate(e,!1,!0)}),c(this,"sourceNavigateToDefaultSource",()=>{this._sourceNavigate(this._stashedSource?this._stashedSource:l[0],!1,!0)}),c(this,"sourceNavigateWithNoNav",e=>{this._sourceNavigate(e,!0,!1)}),c(this,"_sourceNavigate",function(){var t=r(function*(t,i,a){const n=new URLSearchParams(e.history.location.search).get("q"),o=e.getSearchClearedSearchParams(e.history.location);if(n)o.set("q",n);else if(a&&e._stashedParams)for(const i of p){const a=e._stashedParams[i],n="q"===i||e._stashedSource===t;a&&n&&o.set(i,a)}else if("avatars"===t){const t=yield e._hasAccountWithAvatars();o.set("filter",t?"my-avatars":"featured")}else u[t]&&o.set("filter",u[t]);e._stashedParams=null,e._stashedSource=null,i&&o.set("media_nav","false"),"dev.reticulum.io"!==document.location.host?(o.set("media_source",t),Object(s.d)(e.history,e.history.location.pathname,o.toString())):Object(s.d)(e.history,Object(s.h)(e.history.location,`/media/${t}`),o.toString())});return function(e,i,a){return t.apply(this,arguments)}}()),c(this,"_hasAccountWithAvatars",r(function*(){const{credentialsAccountId:e}=window.APP.store;if(!e)return!1;const t=new URLSearchParams;t.set("source","avatars"),t.set("user",e);const i=yield Object(n.d)(`/api/v1/media/search?${t.toString()}`);return!(!i||!i.entries)&&i.entries.length>0})),c(this,"getUrlMediaSource",e=>{const{search:t}=e,i=new URLSearchParams(t),a=Object(s.g)(e);return a.startsWith("/media")||i.get("media_source")?i.get("media_source")||a.substring(7):null}),c(this,"pushExitMediaBrowserHistory",(e,t=!0)=>{e||(e=this.history),t&&this._stashLastSearchParams(e.location);const{pathname:i}=e.location,a=Object(s.g)(e.location).startsWith("/media");Object(s.d)(e,a?Object(s.h)(e.location,"/"):i,this.getSearchClearedSearchParams(e.location).toString()),this.dispatchEvent(new CustomEvent("media-exit"))}),this.requestIndex=0}setHistory(e){this.history=e,this._update(this.history.location),this.history.listen(e=>{this._update(e)})}}},151:function(e,t,i){"use strict";var a,n,s,o=i(0),r=i.n(o),c=i(1),l=i.n(c),d=i(11);function h(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}class u extends r.a.Component{handleClick(e,t){var i,a=this;return(i=function*(){if(a.props.onClick&&a.props.onClick(e),!(e.defaultPrevented||0!==e.button||a.props.target&&"_self"!==a.props.target||function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e))){e.preventDefault(),(a.props.replace?d.f:d.e)(t,a.props.stateKey,a.props.stateValue,a.props.stateDetail)}},function(){var e=this,t=arguments;return new Promise(function(a,n){var s=i.apply(e,t);function o(e){h(s,a,n,o,r,"next",e)}function r(e){h(s,a,n,o,r,"throw",e)}o(void 0)})})()}render(){const{innerRef:e,target:t,className:i,children:a}=this.props;return r.a.createElement("a",{target:t,className:i,onClick:e=>this.handleClick(e,this.props.history),href:"#",ref:e},a)}}a=u,n="propTypes",s={history:l.a.object,innerRef:l.a.object,replace:l.a.bool,stateKey:l.a.string,stateValue:l.a.string,stateDetail:l.a.object,target:l.a.string,onClick:l.a.func,children:l.a.node,className:l.a.string},n in a?Object.defineProperty(a,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):a[n]=s,t.a=u},16:function(e,t,i){"use strict";i.d(t,"h",function(){return o}),i.d(t,"g",function(){return r}),i.d(t,"a",function(){return c}),i.d(t,"b",function(){return d}),i.d(t,"f",function(){return m}),i.d(t,"e",function(){return g}),i.d(t,"d",function(){return v}),i.d(t,"c",function(){return f});const a="hubs.local,dev.reticulum.io".split(",");({NODE_ENV:"production",DEFAULT_SCENE_SID:"JGLt8DP",RETICULUM_SERVER:"dev.reticulum.io",FARSPARK_SERVER:"farspark-dev.reticulum.io",NON_CORS_PROXY_DOMAINS:"hubs.local,dev.reticulum.io",ASSET_BUNDLE_SERVER:"https://asset-bundles-prod.reticulum.io",EXTRA_ENVIRONMENTS:"",POSTGREST_SERVER:"hubs.local:3000"}).CORS_PROXY_SERVER&&a.push({NODE_ENV:"production",DEFAULT_SCENE_SID:"JGLt8DP",RETICULUM_SERVER:"dev.reticulum.io",FARSPARK_SERVER:"farspark-dev.reticulum.io",NON_CORS_PROXY_DOMAINS:"hubs.local,dev.reticulum.io",ASSET_BUNDLE_SERVER:"https://asset-bundles-prod.reticulum.io",EXTRA_ENVIRONMENTS:"",POSTGREST_SERVER:"hubs.local:3000"}.CORS_PROXY_SERVER);const n={gltf:"model/gltf",glb:"model/gltf-binary",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",pdf:"application/pdf",mp4:"video/mp4",mp3:"audio/mpeg"};const s=e=>(function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(e,t)=>String.fromCharCode("0x"+t)))})(e).replace(/=+$/g,"").replace(/\+/g,"-").replace(/\//g,"_"),o=(e,t,i)=>{const a=`https://farspark-dev.reticulum.io/thumbnail/${s(e)}?w=${t}&h=${i}`;try{const t=new URL(e).hostname;if(new URL("https://dev.reticulum.io").hostname===t)return e}catch(e){return a}return a},r=(e,t=null)=>{if(!e.startsWith("http:")&&!e.startsWith("https:"))return e;const i=null!==t;if(!i)try{const t=new URL(e);if(a.find(e=>t.hostname.endsWith(e)))return e}catch(e){}if(i||!{NODE_ENV:"production",DEFAULT_SCENE_SID:"JGLt8DP",RETICULUM_SERVER:"dev.reticulum.io",FARSPARK_SERVER:"farspark-dev.reticulum.io",NON_CORS_PROXY_DOMAINS:"hubs.local,dev.reticulum.io",ASSET_BUNDLE_SERVER:"https://asset-bundles-prod.reticulum.io",EXTRA_ENVIRONMENTS:"",POSTGREST_SERVER:"hubs.local:3000"}.CORS_PROXY_SERVER){return`https://farspark-dev.reticulum.io/0/${i?"extract":"raw"}/0/0/0/${t||0}/${s(e)}`}return`https://${{NODE_ENV:"production",DEFAULT_SCENE_SID:"JGLt8DP",RETICULUM_SERVER:"dev.reticulum.io",FARSPARK_SERVER:"farspark-dev.reticulum.io",NON_CORS_PROXY_DOMAINS:"hubs.local,dev.reticulum.io",ASSET_BUNDLE_SERVER:"https://asset-bundles-prod.reticulum.io",EXTRA_ENVIRONMENTS:"",POSTGREST_SERVER:"hubs.local:3000"}.CORS_PROXY_SERVER}/${e}`},c=e=>t=>{if("string"!=typeof t||""===t)return"";if(/^(https?:)?\/\//i.test(t))return t;if(/^data:.*,.*$/i.test(t))return t;if(/^blob:.*$/i.test(t))return t;if({NODE_ENV:"production",DEFAULT_SCENE_SID:"JGLt8DP",RETICULUM_SERVER:"dev.reticulum.io",FARSPARK_SERVER:"farspark-dev.reticulum.io",NON_CORS_PROXY_DOMAINS:"hubs.local,dev.reticulum.io",ASSET_BUNDLE_SERVER:"https://asset-bundles-prod.reticulum.io",EXTRA_ENVIRONMENTS:"",POSTGREST_SERVER:"hubs.local:3000"}.CORS_PROXY_SERVER){const i=`https://${{NODE_ENV:"production",DEFAULT_SCENE_SID:"JGLt8DP",RETICULUM_SERVER:"dev.reticulum.io",FARSPARK_SERVER:"farspark-dev.reticulum.io",NON_CORS_PROXY_DOMAINS:"hubs.local,dev.reticulum.io",ASSET_BUNDLE_SERVER:"https://asset-bundles-prod.reticulum.io",EXTRA_ENVIRONMENTS:"",POSTGREST_SERVER:"hubs.local:3000"}.CORS_PROXY_SERVER}/`;if(e.startsWith(i)){const a=decodeURIComponent(e.substring(i.length)).split("/"),n=new URL(t).pathname;return i+(a.slice(0,a.length-1).join("/")+"/"+n)}}return t},l=/data:([a-zA-Z0-9]+\/[a-zA-Z0-9-.+]+).*,.*/,d=e=>{if(e.startsWith("hubs://")&&e.endsWith("/video"))return"video/vnd.hubs-webrtc";if(e.startsWith("data:")){const t=l.match(e);t.length>0&&t[1]}const t=new URL(e,window.location).pathname.split(".").pop();return n[t]},h=/https?:\/\/(hubs.local(:\d+)?|(smoke-)?hubs.mozilla.com)\/scenes\/(\w+)\/?\S*/,u=/https?:\/\/(hubs.local(:\d+)?|(smoke-)?hubs.mozilla.com)\/avatars\/(\w+)\/?\S*/,p=/https?:\/\/(hubs.local(:\d+)?|(smoke-)?hubs.mozilla.com)\/(\w+)\/?\S*/,m=h.test.bind(h),g=e=>!m(e)&&p.test(e),v=e=>m(e)||g(e),f=u.test.bind(u)},164:function(e,t,i){"use strict";i.d(t,"a",function(){return x});var a=i(94),n=i(41),s=i(301),o=i.n(s),r=i(141),c=i(35),l=i(16),d=i(167),h=i(189),u=i(40);function p(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}function m(e){return function(){var t=this,i=arguments;return new Promise(function(a,n){var s=e.apply(t,i);function o(e){p(s,a,n,o,r,"next",e)}function r(e){p(s,a,n,o,r,"throw",e)}o(void 0)})}}THREE.Mesh.prototype.raycast=h.b;const g=new class{constructor(){var e,t,i;e=this,t="cache",i=new Map,t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}set(e,t){return this.cache.set(e,{gltf:t,count:0}),this.retain(e)}has(e){return this.cache.has(e)}get(e){return this.cache.get(e)}retain(e){const t=this.cache.get(e);return t.count++,t}release(e){const t=this.cache.get(e);t?(t.count--,t.count<=0&&(t.gltf.scene.traverse(u.a),this.cache.delete(e))):console.error(`Releasing uncached gltf ${e}`)}},v=new Map,f=Object(d.a)(new o.a);function b(e,t,i){if(!AFRAME.components[t])throw new Error(`Inflator failed. "${t}" component does not exist.`);if(AFRAME.components[t].multiple&&Array.isArray(i))for(let a=0;a<i.length;a++)e.setAttribute(t+"__"+a,i[a]);else e.setAttribute(t,i)}function y(e){const t=new Map,i=e.clone();return function e(t,i,a){a(t,i);for(let n=0;n<t.children.length;n++)e(t.children[n],i.children[n],a)}(e,i,function(e,i){t.set(e,i),e.isMesh&&e.geometry.boundsTree&&(i.geometry.boundsTree=e.geometry.boundsTree)}),e.traverse(function(e){if(!e.isSkinnedMesh)return;const i=e.skeleton.bones,a=t.get(e);a.skeleton=e.skeleton.clone(),a.skeleton.bones=i.map(function(e){if(!t.has(e))throw new Error("Required bones are not descendants of the given object.");return t.get(e)}),a.bind(a.skeleton,e.bindMatrix)}),i}function _(e){return{animations:e.animations,scene:y(e.scene)}}function E(e){const t=e.userData.gltfExtensions&&(e.userData.gltfExtensions.MOZ_hubs_components||e.userData.gltfExtensions.HUBS_components),i=e.userData.components;return t||i}AFRAME.GLTFModelPlus={components:{},registerComponent(e,t,i){i=i||b,AFRAME.GLTFModelPlus.components[e]={inflator:i,componentName:t}}};const w=function(e,t,i,a,n=1){"Chest"===t.name?t.name="Spine":"Root Scene"===t.name?t.name="AvatarRoot":"Bot_Skinned"===t.name&&(t.name="AvatarMesh");const s=[],o=t.children.slice(0);for(const t of o){const a=w(e,t,i);a&&s.push(a)}const r=E(t);if(!(!!r||t.name in i)&&!s.length&&!a)return null;const c=document.createElement("a-entity");c.append.apply(c,s);const l=(t.name||t.uuid).replace(/[^\w-]/g,"");c.classList.add(l),"YXZ"!==t.rotation.order&&t.rotation.setFromQuaternion(t.quaternion,"YXZ"),c.object3D.position.copy(t.position),c.object3D.rotation.copy(t.rotation),c.object3D.scale.copy(t.scale).multiplyScalar(n),c.object3D.matrixNeedsUpdate=!0,t.matrixAutoUpdate=!1,t.matrix.identity(),t.matrix.decompose(t.position,t.rotation,t.scale),c.setObject3D(t.type.toLowerCase(),t),r&&"nav-mesh"in r&&c.setObject3D("mesh",t),c.object3D.name=t.name,t.animations&&(t.parent.animations=t.animations);const d=t.userData.gltfIndex;return void 0!==d&&(e[d]=c),c};function S(e,t,i){const a=e.querySelectorAll("."+t);for(const e of a){const t=i.cloneNode(!0);for(const i of t.attributes){const{name:t,value:a}=i;e.setAttribute(t,a)}for(;t.children.length>0;)e.appendChild(t.children[0])}}function x(e,t,i,a,n){return A.apply(this,arguments)}function A(){return(A=m(function*(e,t,i,a,s){let o,d=e;(t.includes("model/gltf+zip")||t.includes("application/x-zip-compressed"))&&(o=yield f(d),d=o["scene.gtlf"]);const h=new THREE.LoadingManager;h.setURLModifier(Object(l.a)(d));const u=new THREE.GLTFLoader(h),p=yield new Promise((e,t)=>u.createParser(d,e,a,t));p.textureLoader=c.g,s&&(p.json=s(p.json));let m=0;p.json.extensions&&p.json.extensions.MOZ_hubs_components&&p.json.extensions.MOZ_hubs_components.hasOwnProperty("version")&&(m=p.json.extensions.MOZ_hubs_components.version),function(e,t){if(e<2){const e=t.nodes.find(e=>{let t=null;return e.extensions&&e.extensions.MOZ_hubs_components?t=e.extensions.MOZ_hubs_components:e.extensions&&e.extensions.HUBS_components&&(t=e.extensions.HUBS_components),t&&t.heightfield&&t["nav-mesh"]});e&&(e.extensions.MOZ_hubs_components?delete e.extensions.MOZ_hubs_components.heightfield:e.extensions.HUBS_components&&delete e.extensions.HUBS_components.heightfield)}}(m,p.json);const g=p.json.materials;if(g)for(let e=0;e<g.length;e++){const t=g[e];if(t.extensions&&t.extensions.MOZ_alt_materials&&void 0!==t.extensions.MOZ_alt_materials[i]){const a=t.extensions.MOZ_alt_materials[i];g[e]=g[a]}}const v=p.json.nodes;if(v)for(let e=0;e<v.length;e++){const t=v[e];t.extras||(t.extras={}),t.extras.gltfIndex=e}const b=yield new Promise(p.parse.bind(p));return b.scene.traverse(e=>{e.matrixAutoUpdate=THREE.Object3D.DefaultMatrixAutoUpdate,e.material=Object(n.b)(e,e=>e.isMeshStandardMaterial&&"KHR_materials_unlit"===i?r.a.fromStandardMaterial(e):e)}),o&&Object.keys(o).forEach(URL.revokeObjectURL),b})).apply(this,arguments)}AFRAME.registerComponent("gltf-model-plus",{schema:{src:{type:"string"},contentType:{type:"string"},useCache:{default:!0},inflate:{default:!1},batch:{default:!1},modelToWorldScale:{type:"number",default:1}},init(){this.preferredTechnique=window.APP&&"low"===window.APP.quality?"KHR_materials_unlit":"pbrMetallicRoughness",this.jsonPreprocessor=null,this.loadTemplates()},update(){this.applySrc(this.data.src,this.data.contentType)},remove(){this.data.batch&&this.model&&this.el.sceneEl.systems["hubs-systems"].batchManagerSystem.removeObject(this.el.object3DMap.mesh),this.data.src&&g.release(this.data.src)},loadTemplates(){this.templates={},this.el.querySelectorAll(":scope > template").forEach(e=>{const t=document.importNode(e.firstElementChild||e.content.firstElementChild,!0);this.templates[e.getAttribute("data-name")]=t})},loadModel(e,t,i,a){var n=this;return m(function*(){if(a){if(g.has(e))return g.retain(e),_(g.get(e).gltf);if(v.has(e)){const t=yield v.get(e);return g.retain(e),_(t)}{const a=x(e,t,i,null,n.jsonPreprocessor);v.set(e,a);const s=yield a;return v.delete(e),g.set(e,s),_(s)}}return x(e,t,i,null,n.jsonPreprocessor)})()},applySrc(e,t){var i=this;return m(function*(){try{if(e&&"#"===e.charAt(0)){const t=document.getElementById(e.substring(1));e=t.getAttribute("src")}if(e===i.lastSrc)return;if(i.lastSrc&&g.release(i.lastSrc),i.lastSrc=e,!e)return void(i.inflatedEl&&(console.warn("gltf-model-plus set to an empty source, unloading inflated model."),i.disposeLastInflatedEl()));i.el.emit("model-loading");const n=yield i.loadModel(e,t,i.preferredTechnique,i.data.useCache);if(e!=i.lastSrc)return;i.disposeLastInflatedEl(),i.model=n.scene||n.scenes[0],i.model.animations=n.animations,i.data.batch&&i.el.sceneEl.systems["hubs-systems"].batchManagerSystem.addObject(i.model),n.animations.length>0?(i.el.setAttribute("animation-mixer",{}),i.el.components["animation-mixer"].initMixer(n.animations)):i.model.traverse(e=>{const t=e.isMesh&&e.geometry.isBufferGeometry,i=t&&e.geometry.boundsTree;if(t&&!i&&e.geometry.attributes.position){const t=e.geometry,i=t.index?t.index.count/3:t.attributes.position.count/3;i>1e3&&i<1e6&&(t.boundsTree=new h.a(e.geometry,{strategy:0,maxDepth:30}))}});const s={};let o=i.model;if(i.data.inflate&&(i.inflatedEl=w(s,i.model,i.templates,!0,i.data.modelToWorldScale))){if(i.el.appendChild(i.inflatedEl),o=i.inflatedEl.object3D,yield Object(a.a)(),e!=i.lastSrc)return;!function(e,t){e.object3D.traverse(e=>{const i=E(e),a=e.el;if(i&&a)for(const e in i)if(i.hasOwnProperty(e)&&AFRAME.GLTFModelPlus.components.hasOwnProperty(e)){const{componentName:n,inflator:s}=AFRAME.GLTFModelPlus.components[e];s(a,n,i[e],i,t)}})}(i.inflatedEl,s);for(const e in i.templates)S(i.el,e,i.templates[e])}const r=[];o.traverse(e=>{const t=e.el;t&&r.push(()=>e.el=t)});const c=i.el.sceneEl.components["environment-map"];c&&c.applyEnvironmentMap(o),i.el.setObject3D("mesh",o),r.forEach(e=>e()),i.el.emit("model-loaded",{format:"gltf",model:i.model})}catch(t){g.release(e),console.error("Failed to load glTF model",t,i),i.el.emit("model-error",{format:"gltf",src:e})}})()},disposeLastInflatedEl(){this.inflatedEl&&(this.inflatedEl.parentNode.removeChild(this.inflatedEl),this.inflatedEl.object3D.traverse(e=>{e.material&&e.material.dispose&&e.material.dispose(),e.geometry&&(e.geometry.dispose&&e.geometry.dispose(),e.geometry.boundsTree=null)}),delete this.inflatedEl,this.el.removeAttribute("animation-mixer"))}})},167:function(e,t,i){"use strict";function a(e){let t=0;const i={};return e.onmessage=t=>{const{id:a,result:n,err:s}=t.data,o=i[a];null==o?console.error(`Unknown message with ID ${a} received from ${e}.`):(delete i[a],null!=s?o.reject(new Error(s)):o.resolve(n))},function(a,n){const s=t++,o=new Promise((e,t)=>{i[s]={resolve:e,reject:t}});return e.postMessage({id:s,payload:a},n),o}}i.d(t,"a",function(){return a})},169:function(e,t,i){"use strict";i.d(t,"a",function(){return a}),i.d(t,"b",function(){return n});const a=function(){return"complete"===document.readyState||"loaded"===document.readyState||"interactive"===document.readyState?Promise.resolve(null):new Promise(e=>{window.addEventListener("DOMContentLoaded",e)})},n=function(e,t){return new Promise(i=>{t.addEventListener(e,i,{once:!0})})}},1700:function(e,t){document.addEventListener("DOMContentLoaded",()=>{const e=THREE.AudioContext.getContext();function t(){e.resume(),setTimeout(function(){"running"===e.state&&(document.body.removeEventListener("touchend",t,!1),document.body.removeEventListener("mouseup",t,!1))},0)}document.body.addEventListener("touchend",t,!1),document.body.addEventListener("mouseup",t,!1)})},1701:function(e,t){THREE.PositionalAudio.prototype.updateMatrixWorld=function(){const e=new THREE.Vector3,t=new THREE.Quaternion,i=new THREE.Vector3,a=new THREE.Vector3;return function(n){THREE.Object3D.prototype.updateMatrixWorld.call(this,n);let s=!1;this._lastPosition||(s=!0,this._lastPosition=new THREE.Vector3,this._lastOrientation=new THREE.Vector3,this._lastListenerPosition=new THREE.Vector3);const o=this.panner,r=o.context.listener;this.matrixWorld.decompose(e,t,i),a.set(0,0,1).applyQuaternion(t),(s||Math.abs(e.x-this._lastPosition.x)>Number.EPSILON||Math.abs(e.y-this._lastPosition.y)>Number.EPSILON||Math.abs(e.z-this._lastPosition.z)>Number.EPSILON||Math.abs(a.x-this._lastOrientation.x)>Number.EPSILON||Math.abs(a.y-this._lastOrientation.y)>Number.EPSILON||Math.abs(a.z-this._lastOrientation.z)>Number.EPSILON||r.positionX&&Math.abs(r.positionX.value-this._lastListenerPosition.x)>Number.EPSILON||r.positionY&&Math.abs(r.positionY.value-this._lastListenerPosition.y)>Number.EPSILON||r.positionZ&&Math.abs(r.positionZ.value-this._lastListenerPosition.z)>Number.EPSILON)&&(o.setPosition(e.x,e.y,e.z),o.setOrientation(a.x,a.y,a.z),this._lastPosition.x=e.x,this._lastPosition.y=e.y,this._lastPosition.z=e.z,this._lastOrientation.x=a.x,this._lastOrientation.y=a.y,this._lastOrientation.z=a.z,r.positionX&&r.positionY&&r.positionZ&&(this._lastListenerPosition.x=r.positionX.value,this._lastListenerPosition.y=r.positionY.value,this._lastListenerPosition.z=r.positionZ.value))}}()},1702:function(e,t){AFRAME.registerComponent("bone-mute-state-indicator",{schema:{unmutedBoneName:{default:"Watch_Joint_MicON"},mutedBoneName:{default:"Watch_Joint_Muted"},onPos:{default:.81},offPos:{default:.5}},init(){this.onStateToggled=this.onStateToggled.bind(this),this.el.addEventListener("model-loaded",()=>{this.unmutedBone=this.el.object3D.getObjectByName(this.data.unmutedBoneName),this.mutedBone=this.el.object3D.getObjectByName(this.data.mutedBoneName),this.modelLoaded=!0,this.updateMuteState()})},play(){this.el.sceneEl.addEventListener("stateadded",this.onStateToggled),this.el.sceneEl.addEventListener("stateremoved",this.onStateToggled)},pause(){this.el.sceneEl.removeEventListener("stateadded",this.onStateToggled),this.el.sceneEl.removeEventListener("stateremoved",this.onStateToggled)},onStateToggled(e){"muted"!==!e.detail.state&&this.updateMuteState()},updateMuteState(){if(!this.modelLoaded)return;const e=this.el.sceneEl.is("muted");this.mutedBone.position.y=e?this.data.onPos:this.data.offPos,this.unmutedBone.position.y=e?this.data.offPos:this.data.onPos,this.mutedBone.matrixNeedsUpdate=!0,this.unmutedBone.matrixNeedsUpdate=!0}})},1703:function(e,t){AFRAME.registerComponent("bone-visibility",{tick(){const{visible:e}=this.el.object3D;this.lastVisible!==e&&(e?this.el.object3D.scale.set(1,1,1):this.el.object3D.scale.set(1e-8,1e-8,1e-8),this.lastVisible=e,this.el.object3D.updateMatrices(!0,!0),this.el.object3D.updateMatrixWorld(!0,!0))}})},1704:function(e,t){AFRAME.registerComponent("offset-relative-to",{schema:{target:{type:"selector"},offset:{type:"vec3"},on:{type:"string"},orientation:{default:1},selfDestruct:{default:!1}},init(){this.updateOffset=this.updateOffset.bind(this),this.data.on?this.el.sceneEl.addEventListener(this.data.on,this.updateOffset):this.updateOffset()},updateOffset:function(){const e=new THREE.Vector3(0,1,0),t=new THREE.Vector3(0,0,-1),i=Math.PI/2,a=new THREE.Vector3;return function(){const n=this.el.object3D,s=this.data.target.object3D;switch(a.copy(this.data.offset),s.localToWorld(a),n.parent&&n.parent.worldToLocal(a),n.position.copy(a),s.getWorldQuaternion(n.quaternion),this.data.orientation){case 8:n.rotateOnAxis(t,3*i);break;case 7:n.rotateOnAxis(t,3*i),n.rotateOnAxis(e,2*i);break;case 6:n.rotateOnAxis(t,i);break;case 5:n.rotateOnAxis(t,i),n.rotateOnAxis(e,2*i);break;case 4:n.rotateOnAxis(t,2*i),n.rotateOnAxis(e,2*i);break;case 3:n.rotateOnAxis(t,2*i);break;case 2:n.rotateOnAxis(e,2*i)}n.matrixNeedsUpdate=!0,this.data.selfDestruct&&(this.data.on&&this.el.sceneEl.removeEventListener(this.data.on,this.updateOffset),this.el.removeAttribute("offset-relative-to"))}}()})},1705:function(e,t){const i=2*Math.PI;AFRAME.registerComponent("hud-controller",{schema:{head:{type:"selector"},offset:{default:.7},lookCutoff:{default:20},animRange:{default:30},yawCutoff:{default:50}},init(){this.onChildHovered=this.onChildHovered.bind(this),this.removeHoverEvents=this.removeHoverEvents.bind(this),this.isYLocked=!1,this.lockedHeadPositionY=0,this.lookDir=new THREE.Vector3,this.lookEuler=new THREE.Euler,this.store=window.APP.store,this.hoverableChildren=this.el.querySelectorAll("[is-remote-hover-target]")},tick(){const e=this.el.object3D,t=this.data.head.object3D,{offset:a,lookCutoff:n,animRange:s,yawCutoff:o}=this.data,r=t.rotation.x*THREE.Math.RAD2DEG,c=function(e,t){const a=Math.abs(t-e)%i;return a>Math.PI?i-a:a}(t.rotation.y,e.rotation.y)*THREE.Math.RAD2DEG,l=!this.store.state.activity.hasHoveredInWorldHud;let d=1-THREE.Math.clamp(n-r,0,s)/s;l&&(d=1),1===d?(this.lockedHeadPositionY=t.position.y,this.hudLocked=!0):this.hudLocked&&r<n-s/2&&(this.hudLocked=!1),this.hudLocked&&(d=1);const h=c>=o||r<n-s/2;h&&(this.lookDir.set(0,0,-1),this.lookDir.applyQuaternion(t.quaternion),this.lookDir.add(t.position),e.position.x=this.lookDir.x,e.position.z=this.lookDir.z,e.rotation.copy(t.rotation),e.rotation.x=0,e.rotation.z=0),e.visible=!h||l,e.position.y=(this.isYLocked?this.lockedHeadPositionY:t.position.y)+a+(1-d)*a,e.rotation.x=(1-d)*THREE.Math.DEG2RAD*90,e.matrixNeedsUpdate=!0},play(){for(let e=0;e<this.hoverableChildren.length;e++)this.hoverableChildren[e].object3D.addEventListener("hovered",this.onChildHovered)},pause(){this.removeHoverEvents()},removeHoverEvents(){for(let e=0;e<this.hoverableChildren.length;e++)this.hoverableChildren[e].object3D.removeEventListener("hovered",this.onChildHovered)},onChildHovered(){this.store.state.activity.hasHoveredInWorldHud||(this.store.update({activity:{hasHoveredInWorldHud:!0}}),this.removeHoverEvents())}})},1706:function(e,t){AFRAME.registerComponent("icon-button",{schema:{image:{type:"string"},hoverImage:{type:"string"},activeImage:{type:"string"},activeHoverImage:{type:"string"},active:{type:"boolean"},disabled:{type:"boolean"},tooltip:{type:"selector"},tooltipText:{type:"string"},activeTooltipText:{type:"string"}},init(){this.el.object3D.matrixNeedsUpdate=!0,this.onHover=()=>{this.hovering=!0,this.updateButtonState()},this.onHoverOut=()=>{this.hovering=!1,this.updateButtonState()}},play(){this.updateButtonState(),this.el.object3D.addEventListener("hovered",this.onHover),this.el.object3D.addEventListener("unhovered",this.onHoverOut)},pause(){this.el.object3D.removeEventListener("hovered",this.onHover),this.el.object3D.removeEventListener("unhovered",this.onHoverOut)},update(){this.updateButtonState()},updateButtonState(){const e=this.hovering,t=this.data.active,i=this.data.disabled;let a;if(a=i?"disabledImage":t?e?"activeHoverImage":"activeImage":e?"hoverImage":"image",this.el.components.sprite?this.data[a]?this.el.setAttribute("sprite","name",this.data[a]):console.warn(`No ${a} image on me.`,this):console.error("No sprite."),this.data.tooltip&&e){const e=(this.data.active?this.data.activeTooltipText:this.data.tooltipText)+(i?" Disabled":"");this.data.tooltip.object3D.visible=this.hovering,this.data.tooltip.querySelector("[text]").setAttribute("text","value",e)}}})},1707:function(e,t){AFRAME.registerComponent("text-button",{schema:{textHoverColor:{type:"string"},textColor:{type:"string"},backgroundHoverColor:{type:"string"},backgroundColor:{type:"string"}},init(){this.el.object3D.matrixNeedsUpdate=!0,this.onHover=()=>{this.hovering=!0,this.updateButtonState()},this.onHoverOut=()=>{this.hovering=!1,this.updateButtonState()},this.textEl=this.el.querySelector("[text]")},play(){this.updateButtonState(),this.el.object3D.addEventListener("hovered",this.onHover),this.el.object3D.addEventListener("unhovered",this.onHoverOut)},pause(){this.el.object3D.removeEventListener("hovered",this.onHover),this.el.object3D.removeEventListener("unhovered",this.onHoverOut)},update(){this.updateButtonState()},updateButtonState(){const e=this.hovering;this.el.setAttribute("slice9","color",e?this.data.backgroundHoverColor:this.data.backgroundColor),this.textEl&&this.textEl.setAttribute("text","color",e?this.data.textHoverColor:this.data.textColor)}});const i=function(){};AFRAME.registerComponent("text-raycast-hack",{dependencies:["text"],init(){this.el.getObject3D("text").raycast=i}})},1708:function(e,t){AFRAME.registerComponent("block-button",{init(){this.onClick=()=>{this.block(this.owner)},NAF.utils.getNetworkedEntity(this.el).then(e=>{this.owner=e.components.networked.data.owner})},play(){this.el.object3D.addEventListener("interact",this.onClick)},pause(){this.el.object3D.removeEventListener("interact",this.onClick)},block(e){window.APP.hubChannel.hide(e)}})},1709:function(e,t){function i(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}AFRAME.registerComponent("mute-button",{init(){this.onClick=()=>{this.mute(this.owner)},NAF.utils.getNetworkedEntity(this.el).then(e=>{this.owner=e.components.networked.data.owner})},play(){this.el.object3D.addEventListener("interact",this.onClick)},pause(){this.el.object3D.removeEventListener("interact",this.onClick)},mute(e){var t,a=this;return(t=function*(){a.el.sceneEl.emit("action_mute_client",{clientId:e})},function(){var e=this,a=arguments;return new Promise(function(n,s){var o=t.apply(e,a);function r(e){i(o,n,s,r,c,"next",e)}function c(e){i(o,n,s,r,c,"throw",e)}r(void 0)})})()}})},1710:function(e,t){function i(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}AFRAME.registerComponent("kick-button",{init(){this.onClick=()=>{this.kick(this.owner)},NAF.utils.getNetworkedEntity(this.el).then(e=>{this.owner=e.components.networked.data.owner})},play(){this.el.object3D.addEventListener("interact",this.onClick)},pause(){this.el.object3D.removeEventListener("interact",this.onClick)},kick(e){var t,a=this;return(t=function*(){a.el.sceneEl.emit("action_kick_client",{clientId:e})},function(){var e=this,a=arguments;return new Promise(function(n,s){var o=t.apply(e,a);function r(e){i(o,n,s,r,c,"next",e)}function c(e){i(o,n,s,r,c,"throw",e)}r(void 0)})})()}})},1711:function(e,t){AFRAME.registerComponent("close-vr-notice-button",{init(){this.onClick=()=>{this.el.sceneEl.emit("action_vr_notice_closed")}},play(){this.el.object3D.addEventListener("interact",this.onClick)},pause(){this.el.object3D.removeEventListener("interact",this.onClick)}})},1712:function(e,t){AFRAME.registerComponent("leave-room-button",{init(){this.onClick=()=>{this.el.sceneEl.emit("leave_room_requested")}},play(){this.el.object3D.addEventListener("interact",this.onClick)},pause(){this.el.object3D.removeEventListener("interact",this.onClick)}})},1713:function(e,t){AFRAME.registerComponent("visible-if-permitted",{schema:{type:"string"},init(){this.updateVisibility=this.updateVisibility.bind(this),this.updateVisibility(),window.APP.hubChannel.addEventListener("permissions_updated",this.updateVisibility)},updateVisibility(){this.el.object3D.visible=this.el.sceneEl.systems.permissions.canOrWillIfCreator(this.data)},remove(){window.APP.hubChannel.removeEventListener("permissions_updated",this.updateVisibility)}})},1714:function(e,t){AFRAME.registerComponent("visibility-on-content-type",{schema:{contentType:{type:"string"},contentSubtype:{type:"string"},visible:{type:"boolean",default:!0}},init(){this.updateVisibility=this.updateVisibility.bind(this),NAF.utils.getNetworkedEntity(this.el).then(e=>{this.networkedEl=e,e.addEventListener("media_resolved",({detail:{contentType:e}})=>this.updateVisibility(e)),this.updateVisibility()})},updateVisibility(e){const t=this.networkedEl.components["media-loader"],i=this.networkedEl.components["media-image"],a=this.networkedEl.components["media-video"],n=e||a&&a.data.contentType||i&&i.data.contentType,s=!this.data.contentType||n&&n.toLowerCase().split(";")[0]===this.data.contentType,o=!this.data.contentSubtype||t.data.contentSubtype&&t.data.contentSubtype===this.data.contentSubtype,r=!(!s||!o);this.el.object3D.visible=this.data.visible?r:!r}})},1715:function(e,t){AFRAME.registerComponent("hide-when-pinned-and-forbidden",{schema:{whenPinned:{type:"boolean"}},init(){this._updateUI=this._updateUI.bind(this),this._updateUIOnStateChange=this._updateUIOnStateChange.bind(this),this.el.sceneEl.addEventListener("stateadded",this._updateUIOnStateChange),this.el.sceneEl.addEventListener("stateremoved",this._updateUIOnStateChange),NAF.utils.getNetworkedEntity(this.el).then(e=>{this.targetEl=e,this._updateUI(),this.targetEl.addEventListener("pinned",this._updateUI),this.targetEl.addEventListener("unpinned",this._updateUI)})},remove(){this.el.sceneEl.removeEventListener("stateadded",this._updateUIOnStateChange),this.el.sceneEl.removeEventListener("stateremoved",this._updateUIOnStateChange),this.targetEl&&(this.targetEl.removeEventListener("pinned",this._updateUI),this.targetEl.removeEventListener("unpinned",this._updateUI))},_updateUIOnStateChange(e){"frozen"===e.detail&&this._updateUI()},_updateUI(){if(!this.targetEl)return;const e=this.targetEl.components.pinnable&&this.targetEl.components.pinnable.data.pinned;if(this.data.whenPinned)this.el.object3D.visible=!e;else{const t=e&&!window.APP.hubChannel.canOrWillIfCreator("pin_objects");this.el.object3D.visible=!t}}})},1716:function(e,t){AFRAME.registerComponent("networked-avatar",{schema:{left_hand_pose:{default:0},right_hand_pose:{default:0}}})},1717:function(e,t){AFRAME.registerComponent("pinnable",{schema:{pinned:{default:!1}},init(){this._fireEventsAndAnimate=this._fireEventsAndAnimate.bind(this),this.el.addEventListener("pager-page-changed",this._fireEventsAndAnimate),this.el.addEventListener("owned-video-state-changed",this._fireEventsAndAnimate)},update(e){this._fireEventsAndAnimate(e)},_fireEventsAndAnimate(e,t){if(this.el.components.networked&&this.el.components.networked.data&&!NAF.utils.isMine(this.el))return;const i=!!e.pinned!==this.data.pinned;if(this.data.pinned){(i||t)&&this.el.emit("pinned",{el:this.el}),this.el.removeAttribute("animation__pin-start"),this.el.removeAttribute("animation__pin-end");const e=this.el.object3D.scale;this.el.setAttribute("animation__pin-start",{property:"scale",dur:200,from:{x:e.x,y:e.y,z:e.z},to:{x:1.1*e.x,y:1.1*e.y,z:1.1*e.z},easing:"easeOutElastic"}),this.el.setAttribute("animation__pin-end",{property:"scale",delay:200,dur:200,from:{x:1.1*e.x,y:1.1*e.y,z:1.1*e.z},to:{x:e.x,y:e.y,z:e.z},easing:"easeOutElastic"}),this.el.components["ammo-body"]&&this.el.setAttribute("ammo-body",{type:"static"})}else(i||t)&&this.el.emit("unpinned",{el:this.el})},isHeld(e){const{leftHand:t,rightHand:i,rightRemote:a}=e.sceneEl.systems.interaction.state;return t.held===e||i.held===e||a.held===e},tick(){const e=this.isHeld(this.el);!e&&this.wasHeld&&this._fireEventsAndAnimate(this.data,!0),this.wasHeld=e}})},1718:function(e,t,i){const a=i(195).COLLISION_LAYERS;AFRAME.registerComponent("drop-object-button",{init(){this.onClick=()=>{(NAF.utils.isMine(this.targetEl)||NAF.utils.takeOwnership(this.targetEl))&&(this.targetEl.setAttribute("floaty-object",{modifyGravityOnRelease:!1}),this.targetEl.setAttribute("ammo-body",{type:"dynamic",gravity:{x:0,y:-9.8,z:0},angularDamping:.01,linearDamping:.01,linearSleepingThreshold:1.6,angularSleepingThreshold:2.5,collisionFilterMask:a.DEFAULT_INTERACTABLE}),this.targetEl.components["ammo-body"].body.activate(),this.el.parentNode.removeChild(this.el))},NAF.utils.getNetworkedEntity(this.el).then(e=>{this.targetEl=e})},play(){this.el.object3D.addEventListener("interact",this.onClick)},pause(){this.el.object3D.removeEventListener("interact",this.onClick)}})},1719:function(e,t){AFRAME.registerComponent("remove-networked-object-button",{init(){this.onClick=()=>{(NAF.utils.isMine(this.targetEl)||NAF.utils.takeOwnership(this.targetEl))&&(this.targetEl.setAttribute("animation__remove",{property:"scale",dur:200,to:{x:.01,y:.01,z:.01},easing:"easeInQuad"}),this.el.parentNode.removeAttribute("visibility-while-frozen"),this.el.parentNode.setAttribute("visible",!1),this.targetEl.addEventListener("animationcomplete",()=>{NAF.utils.takeOwnership(this.targetEl),this.targetEl.parentNode.removeChild(this.targetEl)}))},NAF.utils.getNetworkedEntity(this.el).then(e=>{this.targetEl=e})},play(){this.el.object3D.addEventListener("interact",this.onClick)},pause(){this.el.object3D.removeEventListener("interact",this.onClick)}})},1720:function(e,t){AFRAME.registerComponent("camera-focus-button",{schema:{track:{default:!1},selector:{default:null}},init(){this.cameraSystem=this.el.sceneEl.systems["camera-tools"],NAF.utils.getNetworkedEntity(this.el).then(e=>{this.data.selector?this.targetEl=e.querySelector(this.data.selector):this.targetEl=e}),this.onClick=()=>{const e=this.cameraSystem.getMyCamera();e&&e.components["camera-tool"].focus(this.targetEl,this.data.track)}},tick(){const e=this.el.object3D.visible,t=!(!this.cameraSystem||!this.cameraSystem.getMyCamera());e!==t&&this.el.setAttribute("visible",t)},play(){this.el.object3D.addEventListener("interact",this.onClick)},pause(){this.el.object3D.removeEventListener("interact",this.onClick)}})},1721:function(e,t){AFRAME.registerComponent("visible-to-owner",{init(){this.onStateChange=e=>{this.el.setAttribute("visible",e.detail.newOwner===NAF.clientId)},NAF.utils.getNetworkedEntity(this.el).then(e=>{e.addEventListener("ownership-changed",this.onStateChange),this.el.setAttribute("visible",NAF.utils.isMine(e))})}})},1722:function(e,t){AFRAME.registerComponent("emit-state-change",{multiple:!0,schema:{state:{type:"string"},transform:{type:"string",oneof:["rising","falling"]},event:{type:"string"}},init(){this.stateadded=this.stateadded.bind(this),this.stateremoved=this.stateremoved.bind(this)},stateadded(e){e.detail===this.data.state&&this.el.emit(this.data.event)},stateremoved(e){e.detail===this.data.state&&this.el.emit(this.data.event)},update(){this.el.removeEventListener("stateadded",this.stateadded),this.el.removeEventListener("stateremoved",this.stateremoved),"rising"===this.data.transform&&this.el.addEventListener("stateadded",this.stateadded),"falling"===this.data.transform&&this.el.addEventListener("stateremoved",this.stateremoved)}})},1723:function(e,t){AFRAME.registerComponent("action-to-event",{multiple:!0,schema:{path:{type:"string"},event:{type:"string"},withPermission:{type:"string"}},init(){this.needsPermission=!!this.data.withPermission,this.updatePermissions=()=>{this.needsPermission&&(this.hasPermission=window.APP.hubChannel.canOrWillIfCreator(this.data.withPermission))}},play(){this.el.sceneEl.systems.permissions.onPermissionsUpdated(this.updatePermissions)},pause(){window.APP.hubChannel.removeEventListener("permissions_updated",this.updatePermissions)},tick(){if(this.needsPermission&&!this.hasPermission)return;AFRAME.scenes[0].systems.userinput.get(this.data.path)&&this.el.emit(this.data.event)}})},1724:function(e,t){AFRAME.registerComponent("action-to-remove",{multiple:!0,schema:{path:{type:"string"},requireOwnership:{type:"boolean",default:!0}},init(){NAF.utils.getNetworkedEntity(this.el).then(e=>{this.networkedEl=e})},tick(){AFRAME.scenes[0].systems.userinput.get(this.data.path)&&(this.data.requireOwnership&&this.networkedEl&&!NAF.utils.isMine(this.networkedEl)||this.el.parentNode.removeChild(this.el))}})},1725:function(e,t){AFRAME.registerComponent("emit-scene-event-on-remove",{schema:{event:{default:null}},remove(){this.data.event&&this.el.sceneEl.emit(this.data.event,{el:this.el})}})},1726:function(e,t){AFRAME.registerComponent("follow-in-fov",{schema:{target:{type:"selector"},offset:{type:"vec3"},speed:{type:"number",default:.003},angle:{type:"number",default:45}},init(){this.targetPos=new THREE.Vector3,this.offset=new THREE.Vector3,this.offset.copy(this.data.offset),this.snappedRot=new THREE.Euler,this.snappedQ=new THREE.Quaternion,this.snappedXForm=new THREE.Matrix4,this.snappedXFormWorld=new THREE.Matrix4,this.tempVector=new THREE.Vector3},tick(e,t){if(!this.el.object3D.visible)return;const i=this.el.object3D,a=this.data.target.object3D;if(this._applyMaskedTargetRotation(-this.data.angle*THREE.Math.DEG2RAD,a.rotation.y,0,this.snappedXFormWorld),this.targetPos.copy(this.offset),this.targetPos.applyMatrix4(this.snappedXFormWorld),i.parent&&i.parent.worldToLocal(this.targetPos),this.started){const e=this.data.speed*t;i.position.set(i.position.x+(this.targetPos.x-i.position.x)*e,i.position.y+(this.targetPos.y-i.position.y)*e,i.position.z+(this.targetPos.z-i.position.z)*e)}else i.position.copy(this.targetPos),this.started=!0;this.snappedXFormWorld.decompose(this.tempVector,i.quaternion,this.tempVector),i.matrixNeedsUpdate=!0},_applyMaskedTargetRotation(e,t,i,a){const n=this.data.target.object3D;this.snappedRot.set(e,t,i,n.rotation.order),this.snappedQ.setFromEuler(this.snappedRot),this.snappedXForm.compose(n.position,this.snappedQ,n.scale),a.multiplyMatrices(n.parent.matrixWorld,this.snappedXForm)}})},1727:function(e,t){AFRAME.registerComponent("matrix-auto-update",{schema:{target:{type:"string"}},init:function(){this._updateMatrixAutoUpdate=this._updateMatrixAutoUpdate.bind(this),this._updateMatrixAutoUpdate()},play:function(){this.el.sceneEl.addEventListener("object3dset",this._updateMatrixAutoUpdate)},pause:function(){this.el.sceneEl.removeEventListener("object3dset",this._updateMatrixAutoUpdate)},_updateMatrixAutoUpdate:function(){this.data.target?this.el.getObject3D(this.data.target).matrixAutoUpdate=!0:this.el.object3D.matrixAutoUpdate=!0}})},1728:function(e,t){AFRAME.registerComponent("tweet-media-button",{init(){NAF.utils.getNetworkedEntity(this.el).then(e=>{this.targetEl=e}),this.onClick=()=>{const e=window.APP.hubChannel&&window.APP.hubChannel.discordBridges().length>0?"Taken in hubs.mozilla.com ":`Taken in hubs.mozilla.com - join me now at hub.link/${window.APP.hubChannel.hubId}! `,{src:t,contentSubtype:i}=this.targetEl.components["media-loader"].data;this.el.sceneEl.emit("action_media_tweet",{url:t,contentSubtype:i,text:e,el:this.targetEl})}},play(){this.el.object3D.addEventListener("interact",this.onClick)},pause(){this.el.object3D.removeEventListener("interact",this.onClick)}})},1729:function(e,t){function i(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}AFRAME.registerComponent("hover-menu",{multiple:!0,schema:{template:{type:"selector"},dirs:{type:"array"},dim:{default:!0},withPermission:{type:"string"}},init(){var e,t=this;return(e=function*(){t.onFrozenStateChange=t.onFrozenStateChange.bind(t),t.hovering=!1,yield t.getHoverMenu(),t.applyHoverState()},function(){var t=this,a=arguments;return new Promise(function(n,s){var o=e.apply(t,a);function r(e){i(o,n,s,r,c,"next",e)}function c(e){i(o,n,s,r,c,"throw",e)}r(void 0)})})()},getHoverMenu(){return this.menuPromise?this.menuPromise:this.menuPromise=new Promise(e=>{const t=this.el.appendChild(document.importNode(this.data.template.content,!0).children[0]);setTimeout(()=>{this.menu=t,this.el.setAttribute("position-at-box-shape-border",{target:".hover-container",dirs:this.data.dirs,animate:!1,scale:!1}),e(this.menu)})})},onFrozenStateChange(e){"frozen"!==!e.detail&&this.applyHoverState()},applyHoverState(){if(!this.menu)return;const e=!this.data.withPermission||window.APP.hubChannel.canOrWillIfCreator(this.data.withPermission);this.menu.object3D.visible=e&&!this.el.sceneEl.is("frozen")&&this.hovering,this.data.dim&&this.el.object3DMap.mesh&&this.el.object3DMap.mesh.material&&this.el.object3DMap.mesh.material.color.setScalar(this.menu.object3D.visible?.5:1)},play(){this.el.sceneEl.addEventListener("stateadded",this.onFrozenStateChange),this.el.sceneEl.addEventListener("stateremoved",this.onFrozenStateChange)},pause(){this.el.sceneEl.removeEventListener("stateadded",this.onFrozenStateChange),this.el.sceneEl.removeEventListener("stateremoved",this.onFrozenStateChange)}})},1730:function(e,t){AFRAME.registerComponent("disable-frustum-culling",{init(){this.el.object3D.traverse(e=>e.frustumCulled=!1)}})},1731:function(e,t){AFRAME.registerComponent("set-active-camera",{init(){const e=this.el.sceneEl.systems.camera,t=e.activeCameraEl;t!==this.el&&(e.setActiveCamera(this.el),t.parentNode.removeChild(t),this.el.sceneEl.canvas.classList.remove("a-grab-cursor"))}})},1732:function(e,t){AFRAME.registerComponent("track-pose",{schema:{path:{type:"string"}},tick(){const e=AFRAME.scenes[0].systems.userinput.get(this.data.path);if(e){const t=this.el.object3D;t.matrix.copy(e),t.matrix.decompose(t.position,t.quaternion,t.scale),t.matrixIsModified=!0}}})},1733:function(e,t){AFRAME.registerComponent("replay",{init:function(){this.playhead=0,this.poseIndex=0},tick:function(e,t){let i=!1;for(;!i&&this.playhead>=this.poses[this.poseIndex].timestamp;)this.el.setAttribute("position",this.poses[this.poseIndex].position),this.el.setAttribute("rotation",this.poses[this.poseIndex].rotation),this.el.object3D.matrixNeedsUpdate=!0,this.poseIndex+=1,i=this.poseIndex===this.poses.length;this.playhead+=t,i&&(this.playhead=0,this.poseIndex=0)}})},1734:function(e,t){AFRAME.registerComponent("visibility-by-path",{schema:{path:{type:"string"}},tick(){const e=!!AFRAME.scenes[0].systems.userinput.get(this.data.path);this.el.object3D.visible!==e&&this.el.setAttribute("visible",e)}})},1735:function(e,t){AFRAME.registerComponent("tags",{schema:{isHandCollisionTarget:{default:!1},isHoldable:{default:!1},offersHandConstraint:{default:!1},offersRemoteConstraint:{default:!1},singleActionButton:{default:!1},holdableButton:{default:!1},isPen:{default:!1},isHoverMenuChild:{default:!1}},update(){this.didUpdateOnce&&console.warn("Do not edit tags with .setAttribute"),this.didUpdateOnce=!0}})},1747:function(e,t){const i=AFRAME.utils.device.isMobileVR();AFRAME.registerComponent("billboard",{init:function(){this.target=new THREE.Vector3,this._updateBillboard=this._updateBillboard.bind(this),this._updateIsInView=this._updateIsInView.bind(this),i&&this.el.sceneEl.systems["frame-scheduler"].schedule(this._updateIsInView,"billboards")},remove(){i&&this.el.sceneEl.systems["frame-scheduler"].unschedule(this._updateIsInView,"billboards")},tick(){!this.isInView&&i||this._updateBillboard()},_updateIsInView:function(){const e=new THREE.Frustum,t=new THREE.Matrix4,i=new THREE.Box3,a=new THREE.Box3,n=e=>{e.geometry&&(e.updateMatrices(),e.geometry.computeBoundingBox(),a.copy(e.geometry.boundingBox).applyMatrix4(e.matrixWorld),i.expandByPoint(a.min),i.expandByPoint(a.max))};return function(){this.el.object3D.visible?(this.playerCamera||(this.playerCamera=document.querySelector("#player-camera").getObject3D("camera")),this.playerCamera&&(this.isInView=((a,s)=>(t.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),e.setFromMatrix(t),i.makeEmpty(),a.traverse(n),e.intersectsBox(i)))(this.el.object3D,this.playerCamera))):this.isInView=!1}}(),_updateBillboard:function(){if(!this.el.object3D.visible)return;const e=this.el.sceneEl.camera,t=this.el.object3D;e&&(this.target.setFromMatrixPosition(e.matrixWorld),t.lookAt(this.target),t.matrixNeedsUpdate=!0)}})},1748:function(e,t){AFRAME.registerComponent("periodic-full-syncs",{init(){this.lastSync=0},tick(){const e=performance.now();e-this.lastSync>=5e3&&this.el.components&&this.el.components.networked&&(this.lastSync=e,this.el.components.networked.syncAll(null,!0))}})},187:function(e,t,i){"use strict";i.d(t,"a",function(){return r});var a=i(41),n=i(98);const s=[],o=[],r=["MeshStandardMaterial","MeshBasicMaterial","MobileStandardMaterial"];AFRAME.registerComponent("hoverable-visuals",{schema:{enableSweepingEffect:{type:"boolean",default:!0}},init(){this.uniforms=null,this.boundingSphere=new THREE.Sphere,this.sweepParams=[0,0]},remove(){this.uniforms=null,this.boundingBox=null;const e=AFRAME.scenes[0].systems["hubs-systems"].batchManagerSystem;this.el.object3D.traverse(t=>{t.material&&Object(a.a)(t,i=>{!r.includes(i.type)||t.el.classList.contains("ui")||t.el.classList.contains("hud")||t.el.getAttribute("text-button")||e.meshToEl.delete(t)})})},tick(e){if(!this.uniforms||!this.uniforms.length)return;const t=this.el.sceneEl.is("frozen"),i=Object(n.b)(this.el);let a,r;const c=AFRAME.scenes[0].systems.interaction;if(c.state.leftHand.hovered!==this.el&&c.state.leftHand.held!==this.el||(a=c.options.leftHand.entity.object3D),c.state.rightRemote.hovered!==this.el&&c.state.rightRemote.held!==this.el||(r=c.options.rightRemote.entity.object3D),c.state.rightHand.hovered!==this.el&&c.state.rightHand.held!==this.el||(r=c.options.rightHand.entity.object3D),a&&a.matrixWorld.toArray(s),r&&r.matrixWorld.toArray(o),a||r||t){const e=this.el.object3D.matrixWorld.elements[13],t=this.el.object3D.scale.y*this.boundingSphere.radius;this.sweepParams[0]=e-t,this.sweepParams[1]=e+t}for(let n=0,c=this.uniforms.length;n<c;n++){const c=this.uniforms[n];c.hubs_EnableSweepingEffect.value=this.data.enableSweepingEffect&&i,c.hubs_IsFrozen.value=t,c.hubs_SweepParams.value=this.sweepParams,c.hubs_HighlightInteractorOne.value=!!a&&i,c.hubs_InteractorOnePos.value[0]=s[12],c.hubs_InteractorOnePos.value[1]=s[13],c.hubs_InteractorOnePos.value[2]=s[14],c.hubs_HighlightInteractorTwo.value=!!r&&i,c.hubs_InteractorTwoPos.value[0]=o[12],c.hubs_InteractorTwoPos.value[1]=o[13],c.hubs_InteractorTwoPos.value[2]=o[14],(a||r||t)&&(c.hubs_Time.value=e)}}})},1919:function(e,t){AFRAME.registerSystem("frame-scheduler",{init(){this.registry=new Map,this.queues=[],this.frameIndex=0},schedule(e,t){this.registry.has(t)||(this.queues.push(t),this.registry.set(t,[])),this.registry.get(t).push(e)},unschedule(e){for(let t=0;t<this.queues.length;t++){const i=this.queues[t],a=this.registry.get(i),n=a.indexOf(e);n>=0&&a.splice(n,1)}},tick:function(){for(let e=0;e<this.queues.length;e++){const t=this.queues[e],i=this.registry.get(t);0!==i.length&&i[this.frameIndex%i.length]()}this.frameIndex++}})},1920:function(e,t){AFRAME.registerComponent("vr-mode-toggle-visibility",{schema:{invert:{type:"boolean",default:!1}},init(){this.updateComponentState=this.updateComponentState.bind(this)},play(){this.updateComponentState(),this.el.sceneEl.addEventListener("enter-vr",this.updateComponentState),this.el.sceneEl.addEventListener("exit-vr",this.updateComponentState)},pause(){this.el.sceneEl.removeEventListener("enter-vr",this.updateComponentState),this.el.sceneEl.removeEventListener("exit-vr",this.updateComponentState)},updateComponentState(){const e=this.el.sceneEl.is("vr-mode");this.el.setAttribute("visible",e!==this.data.invert)}}),AFRAME.registerComponent("vr-mode-toggle-playing",{multiple:!0,schema:{invert:{type:"boolean",default:!1}},init(){this.updateComponentState=this.updateComponentState.bind(this)},play(){this.updateComponentState(),this.el.sceneEl.addEventListener("enter-vr",this.updateComponentState),this.el.sceneEl.addEventListener("exit-vr",this.updateComponentState)},pause(){this.el.sceneEl.removeEventListener("enter-vr",this.updateComponentState),this.el.sceneEl.removeEventListener("exit-vr",this.updateComponentState)},updateComponentState(){const e=this.id,t=this.el.sceneEl.is("vr-mode");this.el.components[e][t!==this.data.invert?"play":"pause"]()}}),AFRAME.registerComponent("vr-mode-toggle-class",{multiple:!0,schema:{invert:{type:"boolean",default:!1},class:{type:"string",default:!1}},init(){this.updateComponentState=this.updateComponentState.bind(this)},play(){this.updateComponentState(),this.el.sceneEl.addEventListener("enter-vr",this.updateComponentState),this.el.sceneEl.addEventListener("exit-vr",this.updateComponentState)},pause(){this.el.sceneEl.removeEventListener("enter-vr",this.updateComponentState),this.el.sceneEl.removeEventListener("exit-vr",this.updateComponentState)},updateComponentState(){this.el.sceneEl.is("vr-mode")?this.el.classList.add(this.data.class):this.el.classList.remove(this.data.class)}})},1921:function(e,t){AFRAME.registerSystem("permissions",{onPermissionsUpdated(e){window.APP.hubChannel?window.APP.hubChannel.addEventListener("permissions_updated",e):window.addEventListener("hub_channel_ready",()=>window.APP.hubChannel.addEventListener("permissions_updated",e),{once:!0})},can:e=>!!window.APP.hubChannel.can(e),canOrWillIfCreator:e=>!!window.APP.hubChannel.canOrWillIfCreator(e),fetchPermissions:()=>window.APP.hubChannel.fetchPermissions()})},1922:function(e,t){AFRAME.registerSystem("exit-on-blur",{init(){this.onBlur=this.onBlur.bind(this),this.onFocus=this.onFocus.bind(this),this.onTimeout=this.onTimeout.bind(this),this.onEnterVR=this.onEnterVR.bind(this),this.isOculusBrowser=navigator.userAgent.match(/Oculus/),this.enteredVR=!1,window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus),this.el.addEventListener("enter-vr",this.onEnterVR),this.lastTimeoutCheck=0,this.exitTimeout=null},tick(e){this.isOculusBrowser&&this.enteredVR&&(0===this.lastTimeoutCheck||e-this.lastTimeoutCheck>=1e3)&&(this.lastTimeoutCheck=e,clearTimeout(this.exitTimeout),this.exitTimeout=setTimeout(this.onTimeout,15e3))},onEnterVR(){this.enteredVR=!0},onBlur(){this.el.isMobile&&(clearTimeout(this.exitTimeout),this.exitTimeout=setTimeout(this.onTimeout,3e4))},onFocus(){this.el.isMobile&&clearTimeout(this.exitTimeout)},onTimeout(){this.el.dispatchEvent(new CustomEvent("exit"))},remove(){clearTimeout(this.exitTimeout),window.removeEventListener("blur",this.onBlur)}})},1923:function(e,t){AFRAME.registerSystem("camera-tools",{init(){this.cameraEls=[],this.cameraUpdateCount=0,this.ticks=0},register(e){this.cameraEls.push(e),e.addEventListener("ownership-changed",this._onOwnershipChange),delete this.myCamera},deregister(e){this.cameraEls=this.cameraEls.filter(t=>t!==e),e.removeEventListener("ownership-changed",this._onOwnershipChange),delete this.myCamera},avatarUpdated(){this.cameraEls.forEach(e=>(e.components["camera-tool"].onAvatarUpdated(),!0))},getMyCamera(){return void 0!==this.myCamera?this.myCamera:(this.myCamera=this.cameraEls.find(NAF.utils.isMine)||null,this.myCamera)},_onOwnershipChange(){this.myCamera=null},tick(){if(this.ticks++,this.ticks%10==0){if(0==this.cameraEls.length)return;this.cameraUpdateCount++,this.cameraEls[this.cameraUpdateCount%this.cameraEls.length].components["camera-tool"].updateViewfinder()}}})},195:function(e,t){e.exports={COLLISION_LAYERS:{ALL:-1,NONE:0,INTERACTABLES:1,ENVIRONMENT:2,AVATAR:4,HANDS:8,DEFAULT_INTERACTABLE:15,UNOWNED_INTERACTABLE:9,DEFAULT_SPAWNER:9}}},1969:function(e,t){AFRAME.registerComponent("owned-object-limiter",{schema:{counter:{type:"selector"}},init(){this.counter=this.data.counter.components["networked-counter"]},tick(){this._syncCounterRegistration();const e=this.el.sceneEl.systems.interaction.isHeld(this.el);!e&&this.wasHeld&&this.counter.timestamps.has(this.el)&&this.counter.timestamps.set(this.el,performance.now()),this.wasHeld=e},remove(){this.counter.deregister(this.el)},_syncCounterRegistration(){if(!this.el.components.networked)return;const e=this.el.components.pinnable&&this.el.components.pinnable.data.pinned;NAF.utils.isMine(this.el)&&!e?this.counter.register(this.el):this.counter.deregister(this.el)}})},1970:function(e,t,i){const a=i(195).COLLISION_LAYERS;AFRAME.registerComponent("set-unowned-body-kinematic",{init(){this.setBodyKinematic=this.setBodyKinematic.bind(this)},play(){this.el.addEventListener("ownership-lost",this.setBodyKinematic),this.didThisOnce||(this.didThisOnce=!0,NAF.utils.isMine(this.el)||this.setBodyKinematic())},pause(){this.el.removeEventListener("ownership-lost",this.setBodyKinematic)},setBodyKinematic(){this.el.setAttribute("ammo-body",{type:"kinematic",collisionFilterMask:a.UNOWNED_INTERACTABLE}),this.el.components["floaty-object"]&&(this.el.components["floaty-object"].locked=!0)}})},1971:function(e,t){AFRAME.registerComponent("networked-counter",{schema:{max:{default:3}},init(){this.timestamps=new Map,this.el.object3D.visible=!1},remove(){this.timestamps.clear()},count(){return this.timestamps.size},register(e){this.data.max<=0||this.timestamps.has(e)||(this.timestamps.set(e,performance.now()),this.timestamps.size>this.data.max&&this._destroyOldest())},deregister(e){this.timestamps.has(e)&&this.timestamps.delete(e)},_destroyOldest(){const e=this.el.sceneEl.systems.interaction;let t=null,i=Number.MAX_VALUE;this.timestamps.forEach((a,n)=>{a<i&&!e.isHeld(n)&&NAF.utils.isMine(n)&&(t=n,i=a)}),this._destroy(t)},_destroy(e){e.pause(),this.deregister(e),e.parentNode.removeChild(e)}})},1972:function(e,t){AFRAME.registerComponent("set-yxz-order",{init:function(){this.el.object3D.rotation.order="YXZ"}})},1973:function(e,t){AFRAME.registerComponent("nav-mesh-helper",{init:function(){this.el.addEventListener("model-loaded",()=>{const e=document.querySelectorAll("[teleporter]");for(let t=0;t<e.length;t++)e[t].components.teleporter.queryCollisionEntities()})}})},1974:function(e,t){AFRAME.registerComponent("drawing-manager",{init(){this._onComponentInitialized=this._onComponentInitialized.bind(this),this.el.object3D.visible=!1,this.drawingToPen=new Map},remove(){this.drawingEl&&this.drawingEl.removeEventListener("componentinitialized",this._onComponentInitialized)},_onComponentInitialized(e){"networked-drawing"==e.detail.name&&(this.drawing=this.drawingEl.components["networked-drawing"])},createDrawing(){this.drawingEl||(this.drawingEl=document.createElement("a-entity"),this.drawingEl.setAttribute("networked","template: #interactable-drawing"),this.el.sceneEl.appendChild(this.drawingEl),this.drawingEl.addEventListener("componentinitialized",this._onComponentInitialized))},getDrawing(e){return!this.drawing||this.drawingToPen.has(this.drawing)&&this.drawingToPen.get(this.drawing)!==e?null:(this.drawingToPen.set(this.drawing,e),this.drawing)},returnDrawing(e){this.drawingToPen.has(this.drawing)&&this.drawingToPen.get(this.drawing)===e&&this.drawingToPen.delete(this.drawing)}})},2:function(e,t,i){"use strict";function a(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},a=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),a.forEach(function(t){n(e,t,i[t])})}return e}function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.d(t,"a",function(){return s});const s={noop:"/noop",actions:{}};s.actions.log="/actions/log",s.actions.toggleScreenShare="/actions/toggleScreenShare",s.actions.snapRotateLeft="/actions/snapRotateLeft",s.actions.snapRotateRight="/actions/snapRotateRight",s.actions.angularVelocity="/actions/angularVelocity",s.actions.logDebugFrame="/actions/logDebugFrame",s.actions.logInteractionState="/actions/logInteractionState",s.actions.cameraDelta="/actions/cameraDelta",s.actions.lobbyCameraDelta="/actions/lobbyCameraDelta",s.actions.characterAcceleration="/actions/characterAcceleration",s.actions.boost="/actions/boost",s.actions.startGazeTeleport="/actions/startTeleport",s.actions.stopGazeTeleport="/actions/stopTeleport",s.actions.spawnPen="/actions/spawnPen",s.actions.ensureFrozen="/actions/ensureFrozen",s.actions.toggleFreeze="/actions/toggleFreeze",s.actions.thaw="/actions/thaw",s.actions.muteMic="/actions/muteMic",s.actions.toggleFlying="/actions/toggleFlying",s.actions.focusChat="/actions/focusChat",s.actions.focusChatCommand="/actions/focusChatCommand",s.actions.toggleCamera="/actions/toggleCamera",s.actions.takeSnapshot="/actions/takeSnapshot",s.actions.mediaExit="/actions/mediaExit",s.actions.mediaSearch1="/actions/mediaSearch1",s.actions.mediaSearch2="/actions/mediaSearch2",s.actions.mediaSearch3="/actions/mediaSearch3",s.actions.mediaSearch4="/actions/mediaSearch4",s.actions.mediaSearch5="/actions/mediaSearch5",s.actions.mediaSearch6="/actions/mediaSearch6",s.actions.mediaSearch7="/actions/mediaSearch7",s.actions.mediaSearch8="/actions/mediaSearch8",s.actions.transformModifier="/actions/transformModifier",s.actions.rayObjectRotation="/actions/rayObjectRotation",s.actions.cursor={},s.actions.cursor.pose="/actions/cursorPose",s.actions.cursor.hideLine="/actions/cursorHideLine",s.actions.cursor.grab="/actions/cursorGrab",s.actions.cursor.drop="/actions/cursorDrop",s.actions.cursor.modDelta="/actions/cursorModDelta",s.actions.cursor.startDrawing="/actions/cursorStartDrawing",s.actions.cursor.stopDrawing="/actions/cursorStopDrawing",s.actions.cursor.undoDrawing="/actions/cursorUndoDrawing",s.actions.cursor.penNextColor="/actions/cursorPenNextColor",s.actions.cursor.penPrevColor="/actions/cursorPenPrevColor",s.actions.cursor.scalePenTip="/actions/cursorScalePenTip",s.actions.cursor.scaleGrabbedGrabbable="/actions/cursorScaleGrabbedGrabbable",s.actions.cursor.mediaVolumeMod="/actions/cursor/mediaVolumeMod",s.actions.cursor.takeSnapshot="/actions/cursorTakeSnapshot",s.actions.pen={},s.actions.pen.remove="/actions/pen/remove",s.actions.rightHand={},s.actions.rightHand.matrix="/actions/rightHand/matrix",s.actions.rightHand.pose="/actions/rightHandPose",s.actions.rightHand.grab="/actions/rightHandGrab",s.actions.rightHand.drop="/actions/rightHandDrop",s.actions.rightHand.modDelta="/actions/rightHandModDelta",s.actions.rightHand.startDrawing="/actions/rightHandStartDrawing",s.actions.rightHand.stopDrawing="/actions/rightHandStopDrawing",s.actions.rightHand.undoDrawing="/actions/rightHandUndoDrawing",s.actions.rightHand.switchDrawMode="/actions/rightHandSwitchDrawMode",s.actions.rightHand.penNextColor="/actions/rightHandPenNextColor",s.actions.rightHand.penPrevColor="/actions/rightHandPenPrevColor",s.actions.rightHand.scalePenTip="/actions/rightHandScalePenTip",s.actions.rightHand.startTeleport="/actions/rightHand/startTeleport",s.actions.rightHand.stopTeleport="/actions/rightHand/stopTeleport",s.actions.rightHand.takeSnapshot="/actions/rightHandTakeSnapshot",s.actions.rightHand.thumb="/actions/rightHand/thumbDown",s.actions.rightHand.index="/actions/rightHand/indexDown",s.actions.rightHand.middleRingPinky="/actions/rightHand/middleRingPinkyDown",s.actions.leftHand={},s.actions.leftHand.matrix="/actions/leftHand/matrix",s.actions.leftHand.pose="/actions/leftHandPose",s.actions.leftHand.grab="/actions/leftHandGrab",s.actions.leftHand.drop="/actions/leftHandDrop",s.actions.leftHand.modDelta="/actions/leftHandModDelta",s.actions.leftHand.startDrawing="/actions/leftHandStartDrawing",s.actions.leftHand.stopDrawing="/actions/leftHandStopDrawing",s.actions.leftHand.undoDrawing="/actions/leftHandUndoDrawing",s.actions.leftHand.switchDrawMode="/actions/leftHandSwitchDrawMode",s.actions.leftHand.penNextColor="/actions/leftHandPenNextColor",s.actions.leftHand.penPrevColor="/actions/leftHandPenPrevColor",s.actions.leftHand.scalePenTip="/actions/leftHandScalePenTip",s.actions.leftHand.startTeleport="/actions/leftHand/startTeleport",s.actions.leftHand.stopTeleport="/actions/leftHand/stopTeleport",s.actions.leftHand.takeSnapshot="/actions/leftHandTakeSnapshot",s.actions.leftHand.thumb="/actions/leftHand/thumbDown",s.actions.leftHand.index="/actions/leftHand/indexDown",s.actions.leftHand.middleRingPinky="/actions/leftHand/middleRingPinkyDown",s.actions.camera={},s.actions.camera.exitMirror="/actions/cameraExitMirror",s.haptics={},s.haptics.actuators={},s.haptics.actuators.left="/haptics/actuators/left",s.haptics.actuators.right="/haptics/actuators/right",s.device={},s.device.mouse={},s.device.mouse.coords="/device/mouse/coords",s.device.mouse.movementXY="/device/mouse/movementXY",s.device.mouse.buttonLeft="/device/mouse/buttonLeft",s.device.mouse.buttonRight="/device/mouse/buttonRight",s.device.mouse.wheel="/device/mouse/wheel",s.device.smartMouse={},s.device.smartMouse.cursorPose="/device/smartMouse/cursorPose",s.device.smartMouse.cameraDelta="/device/smartMouse/cameraDelta",s.device.touchscreen={},s.device.touchscreen.cursorPose="/device/touchscreen/cursorPose",s.device.touchscreen.touchCameraDelta="/device/touchscreen/touchCameraDelta",s.device.touchscreen.gyroCameraDelta="/device/touchscreen/gyroCameraDelta",s.device.touchscreen.cameraDelta="/device/touchscreen/cameraDelta",s.device.touchscreen.pinch={},s.device.touchscreen.pinch.delta="/device/touchscreen/pinch/delta",s.device.touchscreen.pinch.initialDistance="/device/touchscreen/pinch/initialDistance",s.device.touchscreen.pinch.currentDistance="/device/touchscreen/pinch/currentDistance",s.device.touchscreen.isTouching="/device/touchscreen/isTouching",s.device.touchscreen.isTouchingGrabbable="/device/touchscreen/isTouchingGrabbable",s.device.touchscreen.tap1="/device/touchscreen/tap1",s.device.touchscreen.tap2="/device/touchscreen/tap2",s.device.touchscreen.tap3="/device/touchscreen/tap3",s.device.touchscreen.tap4="/device/touchscreen/tap4",s.device.touchscreen.tap5="/device/touchscreen/tap5",s.device.gyro={},s.device.gyro.averageDeltaX="/device/gyro/averageDeltaX",s.device.gyro.averageDeltaY="/device/gyro/averageDeltaY",s.device.hud={},s.device.hud.penButton="/device/hud/penButton",s.device.keyboard={map:new Map,key:function(e){let t=this.map.get(e);return t||(t=`/device/keyboard/${e.toLowerCase()}`,this.map.set(e,t),t)}},s.device.gamepad=e=>({button:t=>({pressed:`/device/gamepad/${e}/button/${t}/pressed`,touched:`/device/gamepad/${e}/button/${t}/touched`,value:`/device/gamepad/${e}/button/${t}/value`}),axis:t=>`/device/gamepad/${e}/axis/${t}`});const o="/device/xbox/";s.device.xbox={v:e=>`/vars/xbox/${e}`,button:e=>({pressed:`${o}button/${e}/pressed`,touched:`${o}button/${e}/touched`,value:`${o}button/${e}/value`}),axis:e=>`${o}axis/${e}`,axesSum:`${o}axis/sum`},s.device.oculusgo={button:e=>({pressed:`/device/oculusgo/button/${e}/pressed`,touched:`/device/oculusgo/button/${e}/touched`,value:`/device/oculusgo/button/${e}/value`}),axis:e=>`/device/oculusgo/axis/${e}`,trigger:{pressed:"/device/oculusgo/button/trigger/pressed",touched:"/device/oculusgo/button/trigger/touched",value:"/device/oculusgo/button/trigger/value"},touchpad:{pressed:"/device/oculusgo/button/touchpad/pressed",touched:"/device/oculusgo/button/touchpad/touched",value:"/device/oculusgo/button/touchpad/value",axisX:"/device/oculusgo/axis/touchpadX",axisY:"/device/oculusgo/axis/touchpadY"},pose:"/device/oculusgo/pose",matrix:"/device/oculusgo/matrix",v:e=>`/vars/oculusgo/${e}`};const r="/device/gearVRController/";s.device.gearVRController={button:e=>({pressed:`${r}button/${e}/pressed`,touched:`${r}button/${e}/touched`,value:`${r}button/${e}/value`}),axis:e=>`${r}axis/${e}`,pose:`${r}pose`,matrix:`${r}matrix`,v:e=>`/vars/gearVRController/${e}`};const c="/device/daydream/";s.device.daydream={button:e=>({pressed:`${c}button/${e}/pressed`,touched:`${c}button/${e}/touched`,value:`${c}button/${e}/value`}),axis:e=>`${c}axis/${e}`,pose:`${c}pose`,matrix:`${c}matrix`};const l="/device/rightOculusTouch/";s.device.rightOculusTouch={button:e=>({pressed:`${l}button/${e}/pressed`,touched:`${l}button/${e}/touched`,value:`${l}button/${e}/value`}),axis:e=>`${l}axis/${e}`,axesSum:`${l}axis/sum`,pose:`${l}pose`,matrix:`${l}matrix`};const d="/device/leftOculusTouch/";function h(e,t,i){return{pressed:`${e}${t}/button/${i}/pressed`,touched:`${e}${t}/button/${i}/touched`,value:`${e}${t}/button/${i}/value`}}function u(e,t,i){return{axisX:`${e}${t}/axis/${i}X`,axisY:`${e}${t}/axis/${i}Y`}}function p(e){const t="/device/wmr/";return{touchpad:a({},h(t,e,"touchpad"),u(t,e,"touchpad")),trigger:h(t,e,"trigger"),grip:h(t,e,"grip"),menu:h(t,e,"menu"),joystick:u(t,e,"joystick"),pose:`${t}${e}/pose`,matrix:`${t}${e}/matrix`}}s.device.leftOculusTouch={button:e=>({pressed:`${d}button/${e}/pressed`,touched:`${d}button/${e}/touched`,value:`${d}button/${e}/value`}),axis:e=>`${d}axis/${e}`,axesSum:`${d}axis/sum`,pose:`${d}pose`,matrix:`${d}matrix`},s.device.vive={},s.device.vive.left={button:e=>({pressed:`/device/vive/left/button/${e}/pressed`,touched:`/device/vive/left/button/${e}/touched`,value:`/device/vive/left/button/${e}/value`}),axis:e=>`/device/vive/left/axis/${e}`,axesSum:"/device/vive/left/axis/sum",pose:"/device/vive/left/pose",matrix:"/device/vive/left/matrix"},s.device.vive.right={button:e=>({pressed:`/device/vive/right/button/${e}/pressed`,touched:`/device/vive/right/button/${e}/touched`,value:`/device/vive/right/button/${e}/value`}),axis:e=>`/device/vive/right/axis/${e}`,axesSum:"/device/vive/right/axis/sum",pose:"/device/vive/right/pose",matrix:"/device/vive/right/matrix"},s.device.wmr={},s.device.wmr.v=e=>`/vars/wmr/${e}`,s.device.wmr.k=e=>`/vars/wmr/keyboard/${e}`,s.device.wmr.left=p("left"),s.device.wmr.right=p("right")},200:function(e,t){},201:function(e,t,i){"use strict";i.d(t,"a",function(){return f});var a=i(41),n=i(203),s=i.n(n),o=i(204),r=i.n(o),c=i(205),l=i.n(c),d=i(206),h=i.n(d),u=i(207),p=i.n(u),m=i(208),g=i.n(m);function v(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}function f(){return b.apply(this,arguments)}function b(){var e;return e=function*(){const e=[s.a,r.a,l.a,h.a,p.a,g.a],t=yield new Promise((t,i)=>(new THREE.CubeTextureLoader).load(e,t,void 0,i));return t.format=THREE.RGBFormat,t},(b=function(){var t=this,i=arguments;return new Promise(function(a,n){var s=e.apply(t,i);function o(e){v(s,a,n,o,r,"next",e)}function r(e){v(s,a,n,o,r,"throw",e)}o(void 0)})}).apply(this,arguments)}AFRAME.registerComponent("environment-map",{init(){this.environmentMap=null,this.updateEnvironmentMap=this.updateEnvironmentMap.bind(this)},updateEnvironmentMap(e){this.environmentMap=e,this.applyEnvironmentMap(this.el.object3D)},applyEnvironmentMap(e){e.traverse(e=>{Object(a.a)(e,e=>{e.isMeshStandardMaterial&&(e.envMap=this.environmentMap,e.needsUpdate=!0)})})}})},202:function(e,t){e.exports="if (hubs_HighlightInteractorOne || hubs_HighlightInteractorTwo || hubs_IsFrozen) {\n  float ratio = 0.0;\n\n  if (hubs_EnableSweepingEffect) {\n    float size = hubs_SweepParams.t - hubs_SweepParams.s;\n    float line = mod(hubs_Time / 500.0 * size, size * 3.0) + hubs_SweepParams.s - size / 3.0;\n\n    if (hubs_WorldPosition.y < line) {\n      // Highlight with a sweeping gradient.\n      ratio = max(0.0, 1.0 - (line - hubs_WorldPosition.y) / (size * 1.5));\n    }\n  }\n\n  // Highlight with a gradient falling off with distance.\n  float pulse = 9.0 + 3.0 * (sin(hubs_Time / 1000.0) + 1.0);\n\n  if (hubs_HighlightInteractorOne) {\n    float dist1 = distance(hubs_WorldPosition, hubs_InteractorOnePos);\n    ratio += -min(1.0, pow(dist1 * pulse, 3.0)) + 1.0;\n  } \n\n  if (hubs_HighlightInteractorTwo) {\n    float dist2 = distance(hubs_WorldPosition, hubs_InteractorTwoPos);\n    ratio += -min(1.0, pow(dist2 * pulse, 3.0)) + 1.0;\n  }\n\n  ratio = min(1.0, ratio);\n\n  // Gamma corrected highlight color\n  vec3 highlightColor = vec3(0.184, 0.499, 0.933);\n\n  gl_FragColor.rgb = (gl_FragColor.rgb * (1.0 - ratio)) + (highlightColor * ratio);\n}\n"},203:function(e,t,i){e.exports=i.p+"assets/images/cubemap/posx-d235fb97df77b607be04b84125f40e7c.jpg"},204:function(e,t,i){e.exports=i.p+"assets/images/cubemap/negx-35034574e114423babdea92b6a2eb97a.jpg"},205:function(e,t,i){e.exports=i.p+"assets/images/cubemap/posy-d0c4e1e7979d75923d4d8b49c191bc6e.jpg"},206:function(e,t,i){e.exports=i.p+"assets/images/cubemap/negy-35808d21d1d17ac1b84d3184e365093b.jpg"},207:function(e,t,i){e.exports=i.p+"assets/images/cubemap/posz-de29aa8396196e4b040cd5305e351dbe.jpg"},208:function(e,t,i){e.exports=i.p+"assets/images/cubemap/negz-d73d18a8b7994524dc39a6ea3fcf43fc.jpg"},209:function(e,t,i){"use strict";i.d(t,"a",function(){return n});var a=i(140);function n(){if("iOS"!==Object(a.detectOS)(navigator.userAgent))return;let e=0;document.addEventListener("touchmove",e=>{1!==e.scale&&e.preventDefault()}),document.addEventListener("touchend",t=>{const i=(new Date).getTime(),a=i-e<=300;e=i,a&&t.preventDefault()})}},21:function(e,t,i){"use strict";i.d(t,"a",function(){return p});var a=i(0),n=i.n(a),s=i(1),o=i.n(s),r=i(3),c=i.n(r),l=i(9),d=i(68),h=i(15);function u(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class p extends a.Component{constructor(e){super(e),u(this,"onContainerClicked",e=>{this.props.closable&&e.currentTarget===e.target&&this.props.onClose()}),this.onKeyDown=this.onKeyDown.bind(this),this.onContainerClicked=this.onContainerClicked.bind(this)}componentDidMount(){window.addEventListener("keydown",this.onKeyDown)}componentWillUnmount(){window.removeEventListener("keydown",this.onKeyDown)}onKeyDown(e){this.props.closable&&"Escape"===e.key&&this.props.onClose()}render(){return n.a.createElement("div",{className:c()("dialog-overlay",this.props.className)},n.a.createElement("div",{className:"dialog",onClick:this.onContainerClicked},n.a.createElement("div",{className:`dialog__box ${this.props.wide?"dialog__wide":""} `},n.a.createElement("div",{className:c()("dialog__box__contents",this.props.allowOverflow?"dialog__box__contents-overflow":null,this.props.additionalClass)},this.props.closable&&this.props.onClose&&n.a.createElement(l.b,null,n.a.createElement("button",{className:"dialog__box__contents__close",onClick:()=>this.props.onClose()},n.a.createElement("i",null,n.a.createElement(h.a,{icon:d.faTimes})))),this.props.title&&n.a.createElement("div",{className:"dialog__box__contents__title"},this.props.title),n.a.createElement("div",{className:"dialog__box__contents__body"},this.props.children),n.a.createElement("div",{className:"dialog__box__contents__button-container"})))))}}u(p,"propTypes",{title:o.a.node,children:o.a.node.isRequired,onClose:o.a.func,closable:o.a.bool,wide:o.a.bool,className:o.a.string,allowOverflow:o.a.bool,additionalClass:o.a.string}),u(p,"defaultProps",{closable:!0})},210:function(e,t,i){"use strict";i.d(t,"a",function(){return s});var a=i(54),n=i(142);class s{constructor(){this.scene=null,this.quality="low",this.store=new a.b,this.mediaSearchStore=new n.b}setQuality(e){return this.quality!==e&&(this.quality=e,this.scene&&this.scene.dispatchEvent(new CustomEvent("quality-changed",{detail:e})),!0)}}},211:function(e,t,i){"use strict";function a(e,t){window.APP.componentRegistry=window.APP.componentRegistry||{},window.APP.componentRegistry[t]=window.APP.componentRegistry[t]||[],window.APP.componentRegistry[t].push(e)}function n(e,t){window.APP.componentRegistry&&window.APP.componentRegistry[t]&&window.APP.componentRegistry[t].splice(window.APP.componentRegistry[t].indexOf(e),1)}function s(){if(!(window.APP&&window.APP.componentRegistry&&window.APP.hubChannel&&window.APP.hubChannel.presence))return null;const e=window.APP.componentRegistry["player-info"]||[],t=window.APP.hubChannel.presence.state;for(let i=0;i<e.length;i++){const a=e[i],n=t[a.playerSessionId];if(n&&n.metas[0]&&n.metas[0].streaming)return a}return null}i.d(t,"c",function(){return a}),i.d(t,"a",function(){return n}),i.d(t,"b",function(){return s})},2149:function(e,t,i){"use strict";i.r(t);i(1374),i(829),i(2376),i(459),i(341);var a=i(516);i(460),i(1665),i(1682),i(1686),i(1687),i(1699),i(1700),i(1701),i(837);var n=i(140),s=i(10),o=i(94),r=i(375),c=i(86),l=i.n(c),d=(i(1049),i(23));const h=function(e,t,i){if(e&&e.length)for(const a of e)t.length&&t.forEach(e=>{a.addEventListener(e,i)})},u=function(e,t,i){if(e&&e.length)for(const a of e)t.length&&t.forEach(e=>{a.removeEventListener(e,i)})};AFRAME.registerComponent("mute-mic",{schema:{eventSrc:{type:"selectorAll"},toggleEvents:{type:"array"},muteEvents:{type:"array"},unmuteEvents:{type:"array"}},init:function(){this.onToggle=this.onToggle.bind(this),this.onMute=this.onMute.bind(this),this.onUnmute=this.onUnmute.bind(this)},play:function(){const{eventSrc:e,toggleEvents:t,muteEvents:i,unmuteEvents:a}=this.data;h(e,t,this.onToggle),h(e,i,this.onMute),h(e,a,this.onUnmute)},pause:function(){const{eventSrc:e,toggleEvents:t,muteEvents:i,unmuteEvents:a}=this.data;u(e,t,this.onToggle),u(e,i,this.onMute),u(e,a,this.onUnmute)},onToggle:function(){NAF.connection.adapter&&this.el.sceneEl.is("entered")&&(this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(d.u),this.el.is("muted")?(NAF.connection.adapter.enableMicrophone(!0),this.el.removeState("muted")):(NAF.connection.adapter.enableMicrophone(!1),this.el.addState("muted")))},onMute:function(){NAF.connection.adapter&&(this.el.is("muted")||(NAF.connection.adapter.enableMicrophone(!1),this.el.addState("muted")))},onUnmute:function(){this.el.is("muted")&&(NAF.connection.adapter.enableMicrophone(!0),this.el.removeState("muted"))}});AFRAME.registerComponent("toggle-flying",{schema:{eventSrc:{type:"selectorAll"},toggleEvents:{type:"array"}},init:function(){this.onToggle=this.onToggle.bind(this)},play:function(){const{eventSrc:e,toggleEvents:t}=this.data;!function(e,t,i){if(e&&e.length)for(const a of e)t.length&&t.forEach(e=>{a.addEventListener(e,i)})}(e,t,this.onToggle)},pause:function(){const{eventSrc:e,toggleEvents:t}=this.data;!function(e,t,i){if(e&&e.length)for(const a of e)t.length&&t.forEach(e=>{a.removeEventListener(e,i)})}(e,t,this.onToggle)},onToggle:function(){this.el.sceneEl.is("entered")&&(this.el.is("flying")?this.el.removeState("flying"):this.el.addState("flying"))}});i(1702),i(1703);AFRAME.registerComponent("in-world-hud",{init(){this.mic=this.el.querySelector(".mic"),this.spawn=this.el.querySelector(".spawn"),this.pen=this.el.querySelector(".penhud"),this.cameraBtn=this.el.querySelector(".camera-btn"),this.inviteBtn=this.el.querySelector(".invite-btn"),this.background=this.el.querySelector(".bg"),this.flyBtn=this.el.querySelector(".fly-btn"),this.updateButtonStates=()=>{this.mic.setAttribute("icon-button","active",this.el.sceneEl.is("muted")),this.pen.setAttribute("icon-button","active",this.el.sceneEl.is("pen")),this.cameraBtn.setAttribute("icon-button","active",this.el.sceneEl.is("camera")),this.flyBtn.setAttribute("icon-button","active",this.el.sceneEl.is("flying")),window.APP.hubChannel&&(this.spawn.setAttribute("icon-button","disabled",!window.APP.hubChannel.can("spawn_and_move_media")),this.pen.setAttribute("icon-button","disabled",!window.APP.hubChannel.can("spawn_drawing")),this.cameraBtn.setAttribute("icon-button","disabled",!window.APP.hubChannel.can("spawn_camera")))},this.updateButtonStates(),this.onStateChange=e=>{"muted"!==e.detail&&"frozen"!==e.detail&&"pen"!==e.detail&&"camera"!==e.detail&&"flying"!==e.detail||this.updateButtonStates()},this.onMicClick=()=>{this.el.emit("action_mute")},this.onSpawnClick=()=>{window.APP.hubChannel.can("spawn_and_move_media")&&this.el.emit("action_spawn")},this.onPenClick=()=>{window.APP.hubChannel.can("spawn_drawing")&&(this.el.emit("spawn_pen"),this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(d.p))},this.onCameraClick=()=>{window.APP.hubChannel.can("spawn_camera")&&this.el.emit("action_toggle_camera")},this.onFlyClick=()=>{this.el.emit("action_fly");const e=document.querySelector("#player-rig"),t=e.getAttribute("character-controller","fly").fly;e.setAttribute("character-controller","fly",!t)},this.onInviteClick=()=>{this.el.emit("action_invite")}},play(){this.el.sceneEl.addEventListener("stateadded",this.onStateChange),this.el.sceneEl.addEventListener("stateremoved",this.onStateChange),this.el.sceneEl.systems.permissions.onPermissionsUpdated(this.updateButtonStates),this.mic.object3D.addEventListener("interact",this.onMicClick),this.spawn.object3D.addEventListener("interact",this.onSpawnClick),this.pen.object3D.addEventListener("interact",this.onPenClick),this.cameraBtn.object3D.addEventListener("interact",this.onCameraClick),this.flyBtn.object3D.addEventListener("interact",this.onFlyClick),this.inviteBtn.object3D.addEventListener("interact",this.onInviteClick)},pause(){this.el.sceneEl.removeEventListener("stateadded",this.onStateChange),this.el.sceneEl.removeEventListener("stateremoved",this.onStateChange),window.APP.hubChannel.removeEventListener("permissions_updated",this.updateButtonStates),this.mic.object3D.removeEventListener("interact",this.onMicClick),this.spawn.object3D.removeEventListener("interact",this.onSpawnClick),this.pen.object3D.removeEventListener("interact",this.onPenClick),this.cameraBtn.object3D.removeEventListener("interact",this.onCameraClick),this.flyBtn.object3D.removeEventListener("interact",this.onFlyClick),this.inviteBtn.object3D.removeEventListener("interact",this.onInviteClick)}});var p=i(1072),m=i.n(p),g=i(2382),v=i.n(g);AFRAME.registerComponent("virtual-gamepad-controls",{schema:{},init(){this.onEnterVr=this.onEnterVr.bind(this),this.onExitVr=this.onExitVr.bind(this),this.onFirstInteraction=this.onFirstInteraction.bind(this),this.onMoveJoystickChanged=this.onMoveJoystickChanged.bind(this),this.onMoveJoystickEnd=this.onMoveJoystickEnd.bind(this),this.onLookJoystickChanged=this.onLookJoystickChanged.bind(this),this.onLookJoystickEnd=this.onLookJoystickEnd.bind(this),this.mockJoystickContainer=document.createElement("div"),this.mockJoystickContainer.classList.add(v.a.mockJoystickContainer);const e=document.createElement("div");e.classList.add(v.a.mockJoystick);const t=document.createElement("div");t.classList.add(v.a.mockJoystick,v.a.inner),e.appendChild(t),this.mockJoystickContainer.appendChild(e);const i=document.createElement("div");i.classList.add(v.a.mockJoystick);const a=document.createElement("div");a.classList.add(v.a.mockJoystick,v.a.inner),i.appendChild(a),this.mockJoystickContainer.appendChild(i),document.body.appendChild(this.mockJoystickContainer);const n=document.createElement("div");n.classList.add(v.a.touchZone,v.a.left),document.body.appendChild(n),this.leftTouchZone=n,this.leftStick=m.a.create({zone:this.leftTouchZone,color:"white",fadeTime:0}),this.leftStick.on("start",this.onFirstInteraction),this.leftStick.on("move",this.onMoveJoystickChanged),this.leftStick.on("end",this.onMoveJoystickEnd);const s=document.createElement("div");s.classList.add(v.a.touchZone,v.a.right),document.body.appendChild(s),this.rightTouchZone=s,this.rightStick=m.a.create({zone:this.rightTouchZone,color:"white",fadeTime:0}),this.rightStick.on("start",this.onFirstInteraction),this.rightStick.on("move",this.onLookJoystickChanged),this.rightStick.on("end",this.onLookJoystickEnd),this.inVr=!1,this.moving=!1,this.rotating=!1,this.moveEvent={axis:[0,0]},this.rotateYEvent={value:0},this.rotateXEvent={value:0},this.el.sceneEl.addEventListener("enter-vr",this.onEnterVr),this.el.sceneEl.addEventListener("exit-vr",this.onExitVr)},onFirstInteraction(){this.leftStick.off("start",this.onFirstInteraction),this.rightStick.off("start",this.onFirstInteraction),document.body.removeChild(this.mockJoystickContainer)},onMoveJoystickChanged(e,t){const i=t.angle.radian,a=t.force<1?t.force:1,n=Math.cos(i)*a*1.85,s=Math.sin(i)*a*1.85;this.moving=!0,this.moveEvent.axis[0]=n,this.moveEvent.axis[1]=s},onMoveJoystickEnd(){this.moving=!1,this.moveEvent.axis[0]=0,this.moveEvent.axis[1]=0,this.el.sceneEl.emit("move",this.moveEvent)},onLookJoystickChanged(e,t){const i=t.angle.radian,a=t.force<1?t.force:1;this.rotating=!0,this.rotateYEvent.value=Math.cos(i)*a*.5,this.rotateXEvent.value=Math.sin(i)*a*.5},onLookJoystickEnd(){this.rotating=!1,this.rotateYEvent.value=0,this.rotateXEvent.value=0,this.el.sceneEl.emit("rotateY",this.rotateYEvent),this.el.sceneEl.emit("rotateX",this.rotateXEvent)},tick(){this.inVr||(this.moving&&this.el.sceneEl.emit("move",this.moveEvent),this.rotating&&(this.el.sceneEl.emit("rotateY",this.rotateYEvent),this.el.sceneEl.emit("rotateX",this.rotateXEvent)))},onEnterVr(){this.inVr=!0,this.leftTouchZone.style.display="none",this.rightTouchZone.style.display="none"},onExitVr(){this.inVr=!1,this.leftTouchZone.style.display="block",this.rightTouchZone.style.display="block"},remove(){this.el.sceneEl.removeEventListener("entervr",this.onEnterVr),this.el.sceneEl.removeEventListener("exitvr",this.onExitVr),document.body.removeChild(this.mockJoystickContainer),document.body.removeChild(this.leftTouchZone),document.body.removeChild(this.rightTouchZone)}});var f=i(129);const{Vector3:b,Quaternion:y,Matrix4:_,Euler:E}=THREE;AFRAME.registerComponent("ik-root",{schema:{camera:{type:"string",default:".camera"},leftController:{type:"string",default:".left-controller"},rightController:{type:"string",default:".right-controller"}},update(e){this.data.camera!==e.camera&&(this.camera=this.el.querySelector(this.data.camera)),this.data.leftController!==e.leftController&&(this.leftController=this.el.querySelector(this.data.leftController)),this.data.rightController!==e.rightController&&(this.rightController=this.el.querySelector(this.data.rightController))}});const w={left:(new _).makeRotationFromEuler(new E(-Math.PI/2,Math.PI/2,0)),right:(new _).makeRotationFromEuler(new E(Math.PI/2,Math.PI/2,0))},S={left:(new _).makeRotationFromEuler(new E(-Math.PI/2,Math.PI/2,0)),right:(new _).makeRotationFromEuler(new E(-Math.PI/2,-Math.PI/2,0))};AFRAME.registerComponent("ik-controller",{schema:{leftEye:{type:"string",default:"LeftEye"},rightEye:{type:"string",default:"RightEye"},head:{type:"string",default:"Head"},neck:{type:"string",default:"Neck"},leftHand:{type:"string",default:"LeftHand"},rightHand:{type:"string",default:"RightHand"},chest:{type:"string",default:"Spine"},hips:{type:"string",default:"Hips"},rotationSpeed:{default:5},alwaysUpdate:{type:"boolean",default:!1}},init(){this._runScheduledWork=this._runScheduledWork.bind(this),this._updateIsInView=this._updateIsInView.bind(this),this.flipY=(new _).makeRotationY(Math.PI),this.cameraForward=new _,this.headTransform=new _,this.hipsPosition=new b,this.invHipsToHeadVector=new b,this.middleEyeMatrix=new _,this.middleEyePosition=new b,this.invMiddleEyeToHead=new _,this.cameraYRotation=new E,this.cameraYQuaternion=new y,this.invHipsQuaternion=new y,this.headQuaternion=new y,this.rootToChest=new _,this.invRootToChest=new _,this.ikRoot=function(e){for(;e&&(!e.components||!e.components["ik-root"]);)e=e.parentNode;return e&&e.components["ik-root"]}(this.el),this.isInView=!0,this.hasConvergedHips=!1,this.lastCameraTransform=new THREE.Matrix4,this.playerCamera=document.querySelector("#player-camera").getObject3D("camera"),this.el.sceneEl.systems["frame-scheduler"].schedule(this._runScheduledWork,"ik")},remove(){this.el.sceneEl.systems["frame-scheduler"].unschedule(this._runScheduledWork,"ik")},update(e){this.data.leftEye!==e.leftEye&&(this.leftEye=this.el.object3D.getObjectByName(this.data.leftEye)),this.data.rightEye!==e.rightEye&&(this.rightEye=this.el.object3D.getObjectByName(this.data.rightEye)),this.data.head!==e.head&&(this.head=this.el.object3D.getObjectByName(this.data.head)),this.data.neck!==e.neck&&(this.neck=this.el.object3D.getObjectByName(this.data.neck)),this.data.leftHand!==e.leftHand&&(this.leftHand=this.el.object3D.getObjectByName(this.data.leftHand)),this.data.rightHand!==e.rightHand&&(this.rightHand=this.el.object3D.getObjectByName(this.data.rightHand)),this.data.chest!==e.chest&&(this.chest=this.el.object3D.getObjectByName(this.data.chest)),this.data.hips!==e.hips&&(this.hips=this.el.object3D.getObjectByName(this.data.hips)),this.middleEyePosition.addVectors(this.leftEye.position,this.rightEye.position),this.middleEyePosition.divideScalar(2),this.middleEyeMatrix.makeTranslation(this.middleEyePosition.x,this.middleEyePosition.y,this.middleEyePosition.z),this.invMiddleEyeToHead=this.middleEyeMatrix.getInverse(this.middleEyeMatrix),this.invHipsToHeadVector.addVectors(this.chest.position,this.neck.position).add(this.head.position).negate()},tick(e,t){if(!this.ikRoot)return;const i=this.ikRoot.el.object3D,{camera:a,leftController:n,rightController:s}=this.ikRoot;a.object3D.updateMatrix();const o=!this.lastCameraTransform.equals(a.object3D.matrix);if(this.data.alwaysUpdate||this.forceIkUpdate||this.isInView&&(o||!this.hasConvergedHips)){o&&this.lastCameraTransform.copy(a.object3D.matrix);const{hips:e,head:n,neck:s,chest:d,cameraForward:h,headTransform:u,invMiddleEyeToHead:p,invHipsToHeadVector:m,flipY:g,cameraYRotation:v,cameraYQuaternion:f,invHipsQuaternion:b,rootToChest:_,invRootToChest:E}=this;h.multiplyMatrices(a.object3D.matrix,g),u.multiplyMatrices(h,p),e.position.setFromMatrixPosition(u).add(m),v.setFromRotationMatrix(h,"YXZ"),v.x=0,v.z=0,f.setFromEuler(v),y.slerp(e.quaternion,f,e.quaternion,this.data.rotationSpeed*t/1e3),this.hasConvergedHips=(r=1e-4,c=f,l=e.quaternion,Math.abs(c.x-l.x)<r&&Math.abs(c.y-l.y)<r&&Math.abs(c.z-l.z)<r&&Math.abs(c.w-l.w)<r||Math.abs(-c.x-l.x)<r&&Math.abs(-c.y-l.y)<r&&Math.abs(-c.z-l.z)<r&&Math.abs(-c.w-l.w)<r),b.copy(e.quaternion).inverse(),n.quaternion.setFromRotationMatrix(u).premultiply(b),e.updateMatrix(),_.multiplyMatrices(e.matrix,d.matrix),E.getInverse(_),i.matrixNeedsUpdate=!0,s.matrixNeedsUpdate=!0,n.matrixNeedsUpdate=!0,d.matrixNeedsUpdate=!0}var r,c,l;const{leftHand:d,rightHand:h}=this,u=this.ikRoot.el.components["player-info"].data.avatarType===f.a.LEGACY?w:S;d&&this.updateHand(u.left,d,n.object3D,!0,this.isInView),h&&this.updateHand(u.right,h,s.object3D,!1,this.isInView),this.forceIkUpdate=!1},updateHand(e,t,i,a,n){const s=t.matrix,o=t.el.components["personal-space-invader"],r=o&&o.invading;t.visible=!r&&i.visible,i.visible&&(n||this.forceIkUpdate||this.data.alwaysUpdate)&&(s.multiplyMatrices(this.invRootToChest,i.matrix),s.multiply(e),t.position.setFromMatrixPosition(s),t.rotation.setFromRotationMatrix(s),t.matrixNeedsUpdate=!0)},_runScheduledWork(){this.forceIkUpdate=!0,this._updateIsInView()},_updateIsInView:function(){const e=new THREE.Frustum,t=new THREE.Matrix4,i=new THREE.Vector3;return function(){this.ikRoot.camera.object3D.getWorldPosition(i),this.isInView=((i,a)=>(t.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),e.setFromMatrix(t),e.containsPoint(a)))(this.playerCamera,i)}}()});var x=i(2);const A="open",k="point",C="fist",T="thumbUp",R="thumbDown",M="indexDown",D="pinch",P="mrpDown";AFRAME.registerComponent("hand-controls2",{schema:{default:"left"},init(){this.pose=A},poseForFingers:(e,t,i)=>e||t||i?e&&t&&i?C:!e&&t&&i?T:e||t||!i?e||!t||i?!e||t||i?e&&t&&!i?D:e&&!t&&i?k:(console.warn(`Did not find matching pose for thumb ${e}, index ${t}, middleRingPinky ${i}`),A):R:M:P:A,tick(){const e=this.data,t=AFRAME.scenes[0].systems.userinput,i="left"===e?x.a.actions.leftHand:x.a.actions.rightHand,a=t.get(i.thumb),n=t.get(i.index),s=t.get(i.middleRingPinky),o=this.poseForFingers(a,n,s);o!==this.pose&&(this.el.emit("hand-pose",{previous:this.pose,current:o}),this.pose=o)}});AFRAME.registerComponent("character-controller",{schema:{groundAcc:{default:5.5},easing:{default:10},pivot:{type:"selector"},snapRotationDegrees:{default:45*THREE.Math.DEG2RAD},rotationSpeed:{default:-3},fly:{default:!1}},init:function(){this.navGroup=null,this.navNode=null,this.velocity=new THREE.Vector3(0,0,0),this.accelerationInput=new THREE.Vector3(0,0,0),this.pendingSnapRotationMatrix=new THREE.Matrix4,this.angularVelocity=0,this._withinWarningLimit=!0,this._warningCount=0,this.setAccelerationInput=this.setAccelerationInput.bind(this),this.snapRotateLeft=this.snapRotateLeft.bind(this),this.snapRotateRight=this.snapRotateRight.bind(this),this.setAngularVelocity=this.setAngularVelocity.bind(this),this.el.sceneEl.addEventListener("nav-mesh-loaded",()=>{this.navGroup=null,this.navNode=null})},update:function(){this.leftRotationMatrix=(new THREE.Matrix4).makeRotationY(this.data.snapRotationDegrees),this.rightRotationMatrix=(new THREE.Matrix4).makeRotationY(-this.data.snapRotationDegrees)},play:function(){const e=this.el.sceneEl;e.addEventListener("move",this.setAccelerationInput),e.addEventListener("rotateY",this.setAngularVelocity)},pause:function(){const e=this.el.sceneEl;e.removeEventListener("move",this.setAccelerationInput),e.removeEventListener("rotateY",this.setAngularVelocity),this.reset()},reset(){this.accelerationInput.set(0,0,0),this.velocity.set(0,0,0),this.angularVelocity=0,this.pendingSnapRotationMatrix.identity()},setAccelerationInput:function(e){const t=e.detail.axis;this.accelerationInput.set(t[0],0,t[1])},setAngularVelocity:function(e){this.angularVelocity=e.detail.value},snapRotateLeft:function(){this.pendingSnapRotationMatrix.copy(this.leftRotationMatrix),this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(d.o)},snapRotateRight:function(){this.pendingSnapRotationMatrix.copy(this.rightRotationMatrix),this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(d.o)},teleportTo:function(){const e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Vector3,n=new THREE.Vector3;return function(s){const o=this.el.object3D;o.getWorldPosition(e),this.data.pivot.object3D.getWorldPosition(t),a.copy(s),a.y+=this.data.pivot.object3D.position.y,i.copy(a).sub(t),n.copy(e).add(i);const r=this.el.sceneEl.systems.nav.pathfinder;this.navGroup=r.getGroup("character",n,!0,!0),this.navNode=null,this._setNavNode(n),r.clampStep(e,n,this.navNode,"character",this.navGroup,o.position),o.matrixNeedsUpdate=!0}}(),tick:function(){const e=new THREE.Matrix4,t=new THREE.Matrix4,i=new THREE.Matrix4,a=new THREE.Vector3,n=new THREE.Vector3(0,1,0),s=new THREE.Matrix4,o=new THREE.Matrix4,r=new THREE.Matrix4,c=new THREE.Matrix4,l=new THREE.Matrix4,d=new THREE.Vector3,h=new THREE.Vector3;return function(u,p){if(!this.el.sceneEl.is("entered"))return;const m=p/1e3,g=this.el.object3D,v=this.data.pivot.object3D,f=this.data.groundAcc*m,b=AFRAME.scenes[0].systems.userinput,y=b.get(x.a.actions.angularVelocity);null!=y&&(this.angularVelocity=y);const _=this.data.rotationSpeed*this.angularVelocity*m;v.updateMatrices(),g.updateMatrices(),h.copy(g.scale),d.copy(g.position),b.get(x.a.actions.snapRotateLeft)&&this.snapRotateLeft(),b.get(x.a.actions.snapRotateRight)&&this.snapRotateRight();const E=b.get(x.a.actions.characterAcceleration);E&&this.accelerationInput.set(this.accelerationInput.x+E[0],this.accelerationInput.y+0,this.accelerationInput.z+E[1]),a.copy(v.position),a.applyMatrix4(g.matrix),t.setPosition(a),i.makeTranslation(-a.x,-a.y,-a.z),o.makeRotationAxis(n,g.rotation.y),r.makeRotationAxis(n,-g.rotation.y),c.makeRotationAxis(n,v.rotation.y),l.makeRotationAxis(n,-v.rotation.y),this.updateVelocity(m,v),this.accelerationInput.set(0,0,0);const w=b.get(x.a.actions.boost)?2:1;e.makeTranslation(this.velocity.x*f*w,this.velocity.y*f*w,this.velocity.z*f*w),s.makeRotationAxis(n,_),g.matrix.premultiply(i),g.matrix.premultiply(r),g.matrix.premultiply(l),g.matrix.premultiply(e),g.matrix.premultiply(s),g.matrix.premultiply(this.pendingSnapRotationMatrix),g.matrix.premultiply(c),g.matrix.premultiply(o),g.matrix.premultiply(t),g.matrix.decompose(g.position,g.quaternion,g.scale),g.scale.copy(h),this.pendingSnapRotationMatrix.identity(),this.velocity.lengthSq()>1e-5&&!this.data.fly&&this.setPositionOnNavMesh(d,g.position,g),g.matrixNeedsUpdate=!0}}(),_warnWithWarningLimit:function(e){this._withinWarningLimit&&(this._warningCount++,this._warningCount>10&&(this._withinWarningLimit=!1,e="Warning count exceeded. Will not log further warnings"),console.warn("character-controller",e))},_setNavNode:function(e){if(null!==this.navNode)return;const{pathfinder:t}=this.el.sceneEl.systems.nav;this.navNode=t.getClosestNode(e,"character",this.navGroup,!0)||t.getClosestNode(e,"character",this.navGroup)},setPositionOnNavMesh:function(e,t,i){const{pathfinder:a}=this.el.sceneEl.systems.nav;"character"in a.zones&&(null===this.navGroup&&(this.navGroup=a.getGroup("character",t,!0,!0)),this._setNavNode(t),this.navNode=a.clampStep(e,t,this.navNode,"character",this.navGroup,i.position),i.matrixNeedsUpdate=!0)},updateVelocity:function(e,t){const i=this.data,a=this.velocity;if(e>.2)return a.x=0,a.y=0,void(a.z=0);0!==a.x&&(a.x-=a.x*i.easing*e),0!==a.y&&(a.y-=a.y*i.easing*e),0!==a.z&&(a.z-=a.z*i.easing*e);const n=i.groundAcc*e*this.accelerationInput.x,s=i.groundAcc*e*-this.accelerationInput.z;a.x+=n,this.data.fly?(a.y+=s*-Math.sin(t.rotation.x),a.z+=s*Math.cos(t.rotation.x)):a.z+=s;this.accelerationInput.x=.7*this.accelerationInput.x,this.accelerationInput.z=.7*this.accelerationInput.z,Math.abs(a.x)<.01&&(a.x=0),Math.abs(a.y)<.01&&(a.y=0),Math.abs(a.z)<.01&&(a.z=0)}});i(187);var O=i(98);AFRAME.registerComponent("hover-visuals",{schema:{hand:{type:"string"}},init(){this.handleLeftVisuals=this.handleLeftVisuals.bind(this),this.handleRightVisuals=this.handleRightVisuals.bind(this),this.hadLeftVisualLastFrame=!1,this.hadRightVisualLastFrame=!1,this.uniforms=null},remove(){this.uniforms=null},tick(){this.uniforms&&this.uniforms.length&&("left"===this.data.hand?this.handleLeftVisuals():this.handleRightVisuals())},handleLeftVisuals:function(){const e=AFRAME.scenes[0].systems.interaction,t=e.state.leftHand.held||e.state.leftHand.hovered,i=!t||!Object(O.b)(t);if(i&&!this.hadLeftVisualLastFrame)return;this.hadLeftVisualLastFrame=!i;const a=this.el.object3D.matrixWorld.elements;for(let e=0,t=this.uniforms.length;e<t;e++){const t=this.uniforms[e];t.hubs_HighlightInteractorOne.value=!i,t.hubs_InteractorOnePos.value[0]=a[12],t.hubs_InteractorOnePos.value[1]=a[13],t.hubs_InteractorOnePos.value[2]=a[14]}},handleRightVisuals:function(){const e=AFRAME.scenes[0].systems.interaction,t=e.state.rightHand.held||e.state.rightHand.hovered,i=!t||!Object(O.b)(t);if(i&&!this.hadRightVisualLastFrame)return;this.hadRightVisualLastFrame=!i;const a=this.el.object3D.matrixWorld.elements;for(let e=0,t=this.uniforms.length;e<t;e++){const t=this.uniforms[e];t.hubs_HighlightInteractorTwo.value=!i,t.hubs_InteractorTwoPos.value[0]=a[12],t.hubs_InteractorTwoPos.value[1]=a[13],t.hubs_InteractorTwoPos.value[2]=a[14]}}});i(1704);var N=i(35),H=i(211);function I(e){const{nodes:t}=e;if(!t.some(e=>"Head"===e.name)){const i=e.scenes[e.scene].nodes[0];t.push({name:"LeftEye",extensions:{MOZ_hubs_components:{}}}),t.push({name:"RightEye",extensions:{MOZ_hubs_components:{}}}),t.push({name:"Head",children:[i,t.length-1,t.length-2],extensions:{MOZ_hubs_components:{"scale-audio-feedback":""}}}),t.push({name:"Neck",children:[t.length-1]}),t.push({name:"Spine",children:[t.length-1]}),t.push({name:"Hips",children:[t.length-1]}),t.push({name:"AvatarRoot",children:[t.length-1]}),e.scenes[e.scene].nodes[0]=t.length-1}return e}AFRAME.registerComponent("player-info",{schema:{avatarSrc:{type:"string"},avatarType:{type:"string",default:f.a.LEGACY}},init(){this.displayName=null,this.communityIdentifier=null,this.isOwner=!1,this.isRecording=!1,this.applyProperties=this.applyProperties.bind(this),this.updateDisplayName=this.updateDisplayName.bind(this),this.applyDisplayName=this.applyDisplayName.bind(this),this.handleModelError=this.handleModelError.bind(this),this.isLocalPlayerInfo="player-rig"===this.el.id,this.playerSessionId=null,this.isLocalPlayerInfo||NAF.utils.getNetworkedEntity(this.el).then(e=>{this.playerSessionId=NAF.utils.getCreator(e);const t=window.APP.hubChannel.presence.state[this.playerSessionId];t&&this.updateDisplayNameFromPresenceMeta(t.metas[0])}),Object(H.c)(this,"player-info")},remove(){Object(H.a)(this,"player-info")},play(){this.el.addEventListener("model-loaded",this.applyProperties),this.el.sceneEl.addEventListener("presence_updated",this.updateDisplayName),this.isLocalPlayerInfo&&this.el.querySelector(".model").addEventListener("model-error",this.handleModelError)},pause(){this.el.removeEventListener("model-loaded",this.applyProperties),this.el.sceneEl.removeEventListener("presence_updated",this.updateDisplayName),this.isLocalPlayerInfo&&this.el.querySelector(".model").removeEventListener("model-error",this.handleModelError)},update(){this.applyProperties()},updateDisplayName(e){!this.playerSessionId&&this.isLocalPlayerInfo&&(this.playerSessionId=NAF.clientId),this.playerSessionId&&this.playerSessionId===e.detail.sessionId&&this.updateDisplayNameFromPresenceMeta(e.detail)},updateDisplayNameFromPresenceMeta(e){this.displayName=e.profile.displayName,this.communityIdentifier=e.profile.communityIdentifier,this.isRecording=!(!e.streaming&&!e.recording),this.isOwner=!(!e.roles||!e.roles.owner),this.applyDisplayName()},applyDisplayName(){const e=this.el.querySelector(".nametag");this.displayName&&e&&e.setAttribute("text",{value:this.displayName});const t=this.el.querySelector(".communityIdentifier");t&&this.communityIdentifier&&t.setAttribute("text",{value:this.communityIdentifier});const i=this.el.querySelector(".recordingBadge");i&&(i.object3D.visible=this.isRecording);const a=this.el.querySelector(".modBadge");a&&(a.object3D.visible=!this.isRecording&&this.isOwner)},applyProperties(){this.applyDisplayName();const e=this.el.querySelector(".model");this.data.avatarSrc&&e&&(e.components["gltf-model-plus"].jsonPreprocessor=I,e.setAttribute("gltf-model-plus","src",this.data.avatarSrc),this.el.sceneEl.systems["camera-tools"].avatarUpdated());const t=Object(N.e)(this.el.object3D);this.el.querySelectorAll("[hover-visuals]").forEach(e=>{e.components["hover-visuals"].uniforms=t})},handleModelError(){window.APP.store.resetToRandomLegacyAvatar()}});i(852);var j=i(273);const L={open:"allOpen",thumbDown:"thumbDown",indexDown:"indexDown",mrpDown:"mrpDown",thumbUp:"thumbsUp",point:"point",fist:"allGrip",pinch:"pinch"},F=["allOpen","thumbDown","indexDown","mrpDown","thumbsUp","point","allGrip","pinch"];AFRAME.registerComponent("hand-pose",{multiple:!0,init(){this.pose=0,this.animatePose=this.animatePose.bind(this);const e=Object(j.a)(this.el,"animation-mixer"),t="left"==this.id?"_L":"_R";if(this.mixer=e&&e.components["animation-mixer"].mixer,!this.mixer||!this.mixer.clipAction(L.open+t))return console.warn("Avatar does not an 'allOpen' animation, disabling hand animations"),void this.el.removeAttribute("hand-pose");this.from=this.to=this.mixer.clipAction(L.open+t),this.from.play(),this.networkField=`${this.id}_hand_pose`;const i=e=>{if(!e)return void window.setTimeout(()=>{i(this.el)},1e3);const t=e.components&&e.components["networked-avatar"];return t||i(e.parentEl)};this.networkedAvatar=i(this.el)},tick(){this.networkedAvatar&&this.networkedAvatar.data&&this.networkedAvatar.data[this.networkField]!==this.pose&&(this.animatePose(F[this.pose],F[this.networkedAvatar.data[this.networkField]]),this.pose=this.networkedAvatar.data[this.networkField])},animatePose(e,t){this.from.stop(),this.to.stop();const i="left"==this.id?"_L":"_R";this.from=this.mixer.clipAction(e+i),this.to=this.mixer.clipAction(t+i),this.from.fadeOut(.065),this.to.fadeIn(.065),this.to.play(),this.from.play(),this.mixer.update(.001)}}),AFRAME.registerComponent("hand-pose-controller",{multiple:!0,schema:{eventSrc:{type:"selector"},networkedAvatar:{type:"selector"}},init:function(){this.setHandPose=this.setHandPose.bind(this)},play:function(){this.data.eventSrc.addEventListener("hand-pose",this.setHandPose)},pause:function(){this.data.eventSrc.removeEventListener("hand-pose",this.setHandPose)},setHandPose:function(e){this.data.networkedAvatar.setAttribute("networked-avatar",`${this.id}_hand_pose`,F.indexOf(L[e.detail.current]))}});i(1705);AFRAME.registerComponent("freeze-controller",{schema:{toggleEvent:{type:"string"}},init:function(){this.onToggle=this.onToggle.bind(this)},play:function(){this.el.addEventListener(this.data.toggleEvent,this.onToggle)},pause:function(){this.el.removeEventListener(this.data.toggleEvent,this.onToggle)},tick:function(){const e=this.el.sceneEl;if(!e.is("entered"))return;const t=e.systems.userinput,i=t.get(x.a.actions.ensureFrozen),a=t.get(x.a.actions.thaw),n=t.get(x.a.actions.toggleFreeze);(this.el.is("frozen")&&a||!this.el.is("frozen")&&i||n)&&this.onToggle()},onToggle:function(){window.APP.store.update({activity:{hasFoundFreeze:!0}}),NAF.connection.adapter&&(NAF.connection.adapter.toggleFreeze(),NAF.connection.adapter.frozen?(this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(d.e),this.el.addState("frozen")):(this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(d.t),this.el.removeState("frozen")))}});i(1706),i(1707),i(1708),i(1709),i(1710),i(1711),i(1712),i(1713),i(1714),i(1715);var B=i(40);const V=AFRAME.utils.device.isMobile();AFRAME.registerComponent("visibility-while-frozen",{schema:{withinDistance:{type:"number"},visible:{type:"boolean",default:!0},requireHoverOnNonMobile:{type:"boolean",default:!0},withPermission:{type:"string"}},init(){this.updateVisibility=this.updateVisibility.bind(this),this.camWorldPos=new THREE.Vector3,this.objWorldPos=new THREE.Vector3,this.cam=this.el.sceneEl.camera.el.object3D;let e=this.el;for(;e!==document;){if(null!==e.getAttribute("is-remote-hover-target")){this.hoverable=e;break}e=e.parentNode}!this.hoverable&&this.data.requireHoverOnNonMobile&&console.error("Didn't find a remote hover target."),this.onStateChange=e=>{"frozen"!==!e.detail&&this.updateVisibility()},this.updateVisibility()},tick(){const e=this.el.sceneEl.is("frozen"),t=this.el.object3D.visible,i=e===!this.data.visible;!t&&i||this.updateVisibility()},updateVisibility(){const e=this.el.sceneEl.is("frozen");let t=!0;const i=this.el.object3D.visible;this.data.withinDistance&&(i||this.el.object3D.updateMatrices(!0,!0),Object(B.b)(this.cam,this.camWorldPos),this.objWorldPos.copy(this.el.object3D.position),this.el.object3D.localToWorld(this.objWorldPos),t=this.camWorldPos.distanceToSquared(this.objWorldPos)<this.data.withinDistance*this.data.withinDistance);const a=AFRAME.scenes[0].systems["transform-selected-object"].transforming;let n=(!this.data.withPermission||window.APP.hubChannel.canOrWillIfCreator(this.data.withPermission))&&(e&&this.data.visible||!e&&!this.data.visible)&&t&&!a;this.data.requireHoverOnNonMobile&&!V&&(n=n&&(this.hoverable&&AFRAME.scenes[0].systems.interaction.state.rightRemote.hovered===this.hoverable||i)),i!==n&&this.el.setAttribute("visible",n)},play(){this.el.sceneEl.addEventListener("stateadded",this.onStateChange),this.el.sceneEl.addEventListener("stateremoved",this.onStateChange),this.hoverable&&(this.hoverable.object3D.addEventListener("hovered",this.updateVisibility),this.hoverable.object3D.addEventListener("unhovered",this.updateVisibility))},pause(){this.el.sceneEl.removeEventListener("stateadded",this.onStateChange),this.el.sceneEl.removeEventListener("stateremoved",this.onStateChange),this.hoverable&&(this.hoverable.object3D.addEventListener("hovered",this.updateVisibility),this.hoverable.object3D.addEventListener("unhovered",this.updateVisibility))}}),AFRAME.registerComponent("ui-class-while-frozen",{init(){this.onStateChange=e=>{"frozen"!==!e.detail&&this.el.classList.toggle("ui",this.el.sceneEl.is("frozen"))},this.el.classList.toggle("ui",this.el.sceneEl.is("frozen"))},play(){this.el.sceneEl.addEventListener("stateadded",this.onStateChange),this.el.sceneEl.addEventListener("stateremoved",this.onStateChange)},pause(){this.el.sceneEl.removeEventListener("stateadded",this.onStateChange),this.el.sceneEl.removeEventListener("stateremoved",this.onStateChange)}});i(2384);var U=i(27);AFRAME.registerComponent("stats-plus",{schema:{default:!1},init(){this.onExpand=this.onExpand.bind(this),this.onCollapse=this.onCollapse.bind(this),this.onEnterVr=this.onEnterVr.bind(this),this.onExitVr=this.onExitVr.bind(this);const e=this.el.sceneEl;this.stats=function(e){const t=new window.threeStats(e.renderer),i=new window.aframeStats(e),a=e.isMobile?[]:[t,i];return new window.rStats({css:[],values:{fps:{caption:"fps",below:30},batchdraws:{caption:"Draws"},batchinstances:{caption:"Instances"},batchatlassize:{caption:"Atlas Size"}},groups:[{caption:"Framerate",values:["fps","raf","physics"]},{caption:"Batching",values:["batchdraws","batchinstances","batchatlassize"]}],plugins:a})}(e),this.statsEl=document.querySelector(".rs-base");const t=document.createElement("div");t.classList.add("rs-header");const i=document.createElement("h1");i.innerHTML="Stats",t.appendChild(i);const a=document.createElement("div");a.classList.add("rs-collapse-btn"),a.innerHTML="X",a.addEventListener("click",this.onCollapse),t.appendChild(a),this.statsEl.insertBefore(t,this.statsEl.firstChild),this.fpsEl=document.createElement("div"),this.fpsEl.addEventListener("click",this.onExpand),this.fpsEl.classList.add("rs-fps-counter"),document.body.appendChild(this.fpsEl),this.lastFpsUpdate=performance.now(),this.lastFps=0,this.frameCount=0,this.inVR=e.is("vr-mode"),e.isMobile&&(this.statsEl.classList.add("rs-mobile"),this.fpsEl.classList.add("rs-mobile")),e.addEventListener("enter-vr",this.onEnterVr),e.addEventListener("exit-vr",this.onExitVr),this.vrStatsEnabled=Object(U.a)("vrstats"),this.vrStatsEnabled&&this.initVRStats(),this.lastUpdate=0},initVRStats(){this.vrPanel=document.createElement("a-entity"),this.vrPanel.setAttribute("text",{width:.5,whiteSpace:"pre",value:"_",baseline:"bottom"}),this.vrPanel.addEventListener("loaded",()=>this.vrPanel.object3D.traverse(e=>{e.material&&(e.material.depthTest=!1)}),{once:!0}),this.el.append(this.vrPanel);const e=document.createElement("a-plane");e.setAttribute("color","#333333"),e.setAttribute("material","shader","flat"),e.setAttribute("material","depthTest",!1),e.setAttribute("width",.1),e.setAttribute("height",.12),e.setAttribute("position","-0.2 0.055 0"),this.el.append(e)},toggleVRStats(){this.vrStatsEnabled?(this.el.object3D.visible=!1,this.vrStatsEnabled=!1):(this.vrPanel||this.initVRStats(),this.el.object3D.visible=!0,this.vrStatsEnabled=!0)},play(){this.el.sceneEl.systems.physics.addComponent(this)},pause(){this.el.sceneEl.systems.physics.removeComponent(this)},beforeStep(){this.stats("physics").start()},afterStep(){this.stats("physics").end()},update(e){e!==this.data&&(this.data?(this.statsEl.classList.remove("a-hidden"),this.fpsEl.classList.add("a-hidden")):(this.statsEl.classList.add("a-hidden"),this.fpsEl.classList.remove("a-hidden")))},tick(e){const t=this.stats;if(this.data||this.vrStatsEnabled){t("rAF").tick(),t("FPS").frame();const e=this.el.sceneEl.systems["hubs-systems"].batchManagerSystem;if(e.batchingEnabled){const i=e.batchManager;t("batchdraws").set(i.batches.length),t("batchinstances").set(i.instanceCount),t("batchatlassize").set(i.atlas.arrayDepth)}t().update()}else if(!this.inVR){const e=performance.now();if(this.frameCount++,e>=this.lastFpsUpdate+1e3){const t=Math.round(this.frameCount/((e-this.lastFpsUpdate)/1e3));t!==this.lastFps&&(this.fpsEl.innerHTML=Math.round(t)+" FPS",this.lastFps=t),this.lastFpsUpdate=e,this.frameCount=0}}this.vrStatsEnabled&&e-this.lastUpdate>100&&(this.vrPanel.setAttribute("text","value",[`f ${t("fps").value().toFixed(0)}`,`r ${t("raf").value().toFixed(0)}`,`p ${t("physics").value().toFixed(0)}`,`c ${this.el.sceneEl.renderer.info.render.calls}`,`t ${(this.el.sceneEl.renderer.info.render.triangles/1e3).toFixed(0)}k`].join("\n")),this.lastUpdate=e)},onEnterVr(){this.inVR=!0,this.el.sceneEl.isMobile&&(this.statsEl.classList.add("a-hidden"),this.fpsEl.classList.add("a-hidden"))},onExitVr(){this.inVR=!1,this.el.sceneEl.isMobile&&(this.data?this.statsEl.classList.remove("a-hidden"):this.fpsEl.classList.remove("a-hidden"))},onExpand(){this.el.setAttribute(this.name,!0)},onCollapse(){this.el.setAttribute(this.name,!1)},remove(){this.el.sceneEl.removeEventListener("enter-vr",this.hide),this.el.sceneEl.removeEventListener("exit-vr",this.show),this.statsEl&&(this.statsEl.parentNode.removeChild(this.statsEl),this.fpsEl.parentNode.removeChild(this.fpsEl))}});i(1716);var z=i(1229),W=i.n(z),q=i(1230),G=i.n(q),Y=i(383),$=i.n(Y),X=i(16),Q=i(1231),K=i(167);function J(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}function Z(e){return function(){var t=this,i=arguments;return new Promise(function(a,n){var s=e.apply(t,i);function o(e){J(s,a,n,o,r,"next",e)}function r(e){J(s,a,n,o,r,"throw",e)}o(void 0)})}}const ee={once:!0},te={type:"image/png"},ie=Object(K.a)(new W.a),ae=[];for(let e=0;e<=20;e++){let t="|";for(let i=0;i<=20;i++)t+=e>=i?"|":" ";t+="|",ae[e]=t}class ne extends THREE.Texture{constructor(e,t,i){super(document.createElement("canvas")),this.image.width=e[0].width,this.image.height=e[0].height,this._ctx=this.image.getContext("2d"),this.generateMipmaps=!1,this.isVideoTexture=!0,this.minFilter=THREE.NearestFilter,this.frames=e,this.delays=t,this.disposals=i,this.frame=0,this.frameStartTime=Date.now()}update(){if(!this.frames||!this.delays||!this.disposals)return;const e=Date.now();e-this.frameStartTime>this.delays[this.frame]&&(2===this.disposals[this.frame]&&this._ctx.clearRect(0,0,this.image.width,this.image.width),this.frame=(this.frame+1)%this.frames.length,this.frameStartTime=e,this._ctx.drawImage(this.frames[this.frame],0,0,this.image.width,this.image.height),this.needsUpdate=!0)}}function se(){return(se=Z(function*(e){return new Promise((t,i)=>{fetch(e,{mode:"cors"}).then(e=>e.arrayBuffer()).then(e=>ie(e,[e])).then(i=>{const{frames:a,delayTimes:n,disposals:s}=i;let o=0;for(let i=0;i<a.length;i++){const r=new Image;r.onload=r=>{if(o++,a[i]=r.target,o===a.length){const i=new ne(a,n,s);i.image.src=e,i.encoding=THREE.sRGBEncoding,i.minFilter=THREE.LinearFilter,t(i)}},r.src=a[i]}}).catch(i)})})).apply(this,arguments)}const oe=AFRAME.utils.device.isIOS();function re(){return(re=Z(function*(){const e=document.createElement("video");return e.setAttribute("playsinline",""),e.setAttribute("webkit-playsinline",""),e.autoplay=!0,e.muted=oe,e.preload="auto",e.crossOrigin="anonymous",e})).apply(this,arguments)}function ce(e,t){return new Promise(function(){var i=Z(function*(i,a){const n=yield function(){return re.apply(this,arguments)}(),s=new THREE.VideoTexture(n);if(s.minFilter=THREE.LinearFilter,s.encoding=THREE.sRGBEncoding,e.startsWith("hubs://")){const t=e.substring(7).split("/")[1],i=yield NAF.connection.adapter.getMediaStream(t,"video");n.srcObject=new MediaStream(i.getVideoTracks())}else if(AFRAME.utils.material.isHLS(e,t))if($.a.isSupported()){const t=`https://${{NODE_ENV:"production",DEFAULT_SCENE_SID:"JGLt8DP",RETICULUM_SERVER:"dev.reticulum.io",FARSPARK_SERVER:"farspark-dev.reticulum.io",NON_CORS_PROXY_DOMAINS:"hubs.local,dev.reticulum.io",ASSET_BUNDLE_SERVER:"https://asset-bundles-prod.reticulum.io",EXTRA_ENVIRONMENTS:"",POSTGREST_SERVER:"hubs.local:3000"}.CORS_PROXY_SERVER}/`,i=e.startsWith(t)?e.substring(t.length):e,o=new $.a({xhrSetup:(e,a)=>{a.startsWith(t)&&(a=a.substring(t.length)),a.startsWith("http")||(a=Object(Q.buildAbsoluteURL)(i,a.startsWith("/")?a:`/${a}`)),e.open("GET",Object(X.g)(a))}});s.hls=o,o.loadSource(e),o.attachMedia(n),o.on($.a.Events.ERROR,function(e,t){if(t.fatal)switch(t.type){case $.a.ErrorTypes.NETWORK_ERROR:o.startLoad();break;case $.a.ErrorTypes.MEDIA_ERROR:o.recoverMediaError();break;default:return void a(e)}})}else n.canPlayType(t)?(n.src=e,n.onerror=a):a("HLS unsupported");else n.src=e,n.onerror=a;let o=!1;const r=()=>{o||(o=!0,i(s))};if(n.addEventListener("canplay",r,{once:!0}),oe){const e=()=>{(s.image.videoHeight||s.image.height)&&(s.image.videoWidth||s.image.width)?r():setTimeout(e,500)};e()}});return function(e,t){return i.apply(this,arguments)}}())}function le(e,t){const i=Math.min(1,1/t),a=Math.min(1,t);e.object3DMap.mesh.scale.set(i,a,1),e.object3DMap.mesh.matrixNeedsUpdate=!0}function de(e){if(e.image instanceof HTMLVideoElement){const t=e.image;t.pause(),t.src="",t.load()}e.hls&&e.hls.destroy(),e.dispose()}const he=new class{constructor(){var e,t,i;e=this,t="cache",i=new Map,t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}set(e,t){const i=t.image;return this.cache.set(e,{texture:t,ratio:(i.videoHeight||i.height)/(i.videoWidth||i.width),count:0}),this.retain(e)}has(e){return this.cache.has(e)}get(e){return this.cache.get(e)}retain(e){const t=this.cache.get(e);return t.count++,t}release(e){const t=this.cache.get(e);t?(t.count--,t.count<=0&&(de(t.texture),this.cache.delete(e))):console.error(`Releasing uncached texture src ${e}`)}},ue=new Map,pe=new Image;pe.src=G.a;const me=new THREE.Texture(pe);me.magFilter=THREE.NearestFilter,pe.onload=()=>{me.needsUpdate=!0};const ge={texture:me,ratio:1};function ve(e){let t=Math.floor(e),i=Math.floor(t/3600);t-=3600*i;let a=Math.floor(t/60);return t-=60*a,i<10&&(i=`0${i}`),a<10&&(a=`0${a}`),t<10&&(t=`0${t}`),"00"===i?`${a}:${t}`:`${i}:${a}:${t}`}AFRAME.registerComponent("media-video",{schema:{src:{type:"string"},contentType:{type:"string"},volume:{type:"number",default:.5},loop:{type:"boolean",default:!0},audioType:{type:"string",default:"pannernode"},hidePlaybackControls:{type:"boolean",default:!1},distanceModel:{type:"string",default:"inverse"},rolloffFactor:{type:"number",default:1},refDistance:{type:"number",default:1},maxDistance:{type:"number",default:1e4},coneInnerAngle:{type:"number",default:360},coneOuterAngle:{type:"number",default:0},coneOuterGain:{type:"number",default:0},videoPaused:{type:"boolean"},projection:{type:"string",default:"flat"},time:{type:"number"},tickRate:{default:1e3},syncTolerance:{default:2}},init(){this.onPauseStateChange=this.onPauseStateChange.bind(this),this.tryUpdateVideoPlaybackState=this.tryUpdateVideoPlaybackState.bind(this),this.updateSrc=this.updateSrc.bind(this),this.seekForward=this.seekForward.bind(this),this.seekBack=this.seekBack.bind(this),this.volumeUp=this.volumeUp.bind(this),this.volumeDown=this.volumeDown.bind(this),this.snap=this.snap.bind(this),this.changeVolumeBy=this.changeVolumeBy.bind(this),this.togglePlaying=this.togglePlaying.bind(this),this.lastUpdate=0,this.videoMutedAt=0,this.localSnapCount=0,this.isSnapping=!1,this.onSnapImageLoaded=()=>this.isSnapping=!1,this.el.setAttribute("hover-menu__video",{template:"#video-hover-menu",dirs:["forward","back"]}),this.el.components["hover-menu__video"].getHoverMenu().then(e=>{this.el.parentNode&&(this.hoverMenu=e,this.playbackControls=this.el.querySelector(".video-playback"),this.playPauseButton=this.el.querySelector(".video-playpause-button"),this.volumeUpButton=this.el.querySelector(".video-volume-up-button"),this.volumeDownButton=this.el.querySelector(".video-volume-down-button"),this.seekForwardButton=this.el.querySelector(".video-seek-forward-button"),this.seekBackButton=this.el.querySelector(".video-seek-back-button"),this.snapButton=this.el.querySelector(".video-snap-button"),this.timeLabel=this.el.querySelector(".video-time-label"),this.volumeLabel=this.el.querySelector(".video-volume-label"),this.playPauseButton.object3D.addEventListener("interact",this.togglePlaying),this.seekForwardButton.object3D.addEventListener("interact",this.seekForward),this.seekBackButton.object3D.addEventListener("interact",this.seekBack),this.volumeUpButton.object3D.addEventListener("interact",this.volumeUp),this.volumeDownButton.object3D.addEventListener("interact",this.volumeDown),this.snapButton.object3D.addEventListener("interact",this.snap),this.updateVolumeLabel(),this.updateHoverMenuBasedOnLiveState(),this.updatePlaybackState())}),NAF.utils.getNetworkedEntity(this.el).then(e=>{this.networkedEl=e,this.updatePlaybackState(),oe||"scene"!==NAF.utils.getNetworkOwner(this.networkedEl)||setTimeout(()=>{"scene"===NAF.utils.getNetworkOwner(this.networkedEl)&&NAF.utils.takeOwnership(this.networkedEl)},2e3+Math.floor(2e3*Math.random()))});const e=this.el.sceneEl;e.audioListener=e.audioListener||new THREE.AudioListener,e.camera&&e.camera.add(e.audioListener),e.addEventListener("camera-set-active",function(t){t.detail.cameraEl.getObject3D("camera").add(e.audioListener)})},seekForward(){(!this.videoIsLive&&NAF.utils.isMine(this.networkedEl)||NAF.utils.takeOwnership(this.networkedEl))&&(this.video.currentTime+=30,this.el.setAttribute("media-video","time",this.video.currentTime))},seekBack(){(!this.videoIsLive&&NAF.utils.isMine(this.networkedEl)||NAF.utils.takeOwnership(this.networkedEl))&&(this.video.currentTime-=10,this.el.setAttribute("media-video","time",this.video.currentTime))},changeVolumeBy(e){this.el.setAttribute("media-video","volume",THREE.Math.clamp(this.data.volume+e,0,1)),this.updateVolumeLabel()},volumeUp(){this.changeVolumeBy(.1)},volumeDown(){this.changeVolumeBy(-.1)},snap(){var e=this;return Z(function*(){if(e.isSnapping)return;e.isSnapping=!0,e.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(d.b);const t=document.createElement("canvas");t.width=e.video.videoWidth,t.height=e.video.videoHeight,t.getContext("2d").drawImage(e.video,0,0,t.width,t.height);const i=yield new Promise(e=>t.toBlob(e)),a=new File([i],"snap.png",te);e.localSnapCount++;const{entity:n}=Object(N.a)(e.el,a,"photo-snapshot",e.localSnapCount);n.addEventListener("image-loaded",e.onSnapImageLoaded,ee)})()},togglePlaying(){oe&&this.video.paused&&NAF.utils.isMine(this.networkedEl)?this.video.play():this.networkedEl&&(NAF.utils.isMine(this.networkedEl)||NAF.utils.takeOwnership(this.networkedEl))&&this.tryUpdateVideoPlaybackState(!this.data.videoPaused)},onPauseStateChange(){oe&&this.video.paused&&NAF.utils.isMine(this.networkedEl)||(this.el.setAttribute("media-video","videoPaused",this.video.paused),this.networkedEl&&NAF.utils.isMine(this.networkedEl)&&this.el.emit("owned-video-state-changed"))},updatePlaybackState(e){if(this.hoverMenu){this.playbackControls.object3D.visible=!this.data.hidePlaybackControls&&!!this.video,this.timeLabel.object3D.visible=!this.data.hidePlaybackControls;const e=this.el.components.pinnable&&this.el.components.pinnable.data.pinned;this.playPauseButton.object3D.visible=!!this.video&&(!e||window.APP.hubChannel.can("pin_objects")),this.snapButton.object3D.visible=!!this.video&&window.APP.hubChannel.can("spawn_and_move_media"),this.seekForwardButton.object3D.visible=!!this.video&&!this.videoIsLive,this.seekBackButton.object3D.visible=!!this.video&&!this.videoIsLive}(e||this.networkedEl&&!NAF.utils.isMine(this.networkedEl)&&this.video)&&(Math.abs(this.data.time-this.video.currentTime)>this.data.syncTolerance?this.tryUpdateVideoPlaybackState(this.data.videoPaused,this.data.time):this.tryUpdateVideoPlaybackState(this.data.videoPaused)),this.audio&&(this.audio.gain.gain.value=this.data.volume)},tryUpdateVideoPlaybackState(e,t){this._playbackStateChangeTimeout&&(clearTimeout(this._playbackStateChangeTimeout),delete this._playbackStateChangeTimeout),this.videoIsLive||void 0===t||(this.video.currentTime=t),this.hoverMenu&&this.playPauseButton.setAttribute("icon-button","active",e),e?this.video.pause():this.video.play().catch(()=>{this._playbackStateChangeTimeout=setTimeout(()=>this.tryUpdateVideoPlaybackState(e,t),1e3)})},update(e){var t=this;return Z(function*(){const i=t.data.src;if(t.updatePlaybackState(),i&&i!==e.src)return t.updateSrc(e)})()},updateSrc(e){var t=this;return Z(function*(){const{src:i}=t.data;let a;t.cleanUp(),t.mesh&&t.mesh.material&&(t.mesh.material.map=null,t.mesh.material.needsUpdate=!0);try{if(a=yield ce(i,t.data.contentType),t.data.src!==i)return void de(a);if(i.startsWith("hubs://")||(a.audioSource=t.el.sceneEl.audioListener.context.createMediaElementSource(a.image),"pannernode"===t.data.audioType?(t.audio=new THREE.PositionalAudio(t.el.sceneEl.audioListener),t.audio.setDistanceModel(t.data.distanceModel),t.audio.setRolloffFactor(t.data.rolloffFactor),t.audio.setRefDistance(t.data.refDistance),t.audio.setMaxDistance(t.data.maxDistance),t.audio.panner.coneInnerAngle=t.data.coneInnerAngle,t.audio.panner.coneOuterAngle=t.data.coneOuterAngle,t.audio.panner.coneOuterGain=t.data.coneOuterGain):t.audio=new THREE.Audio(t.el.sceneEl.audioListener),t.audio.setNodeSource(a.audioSource),t.el.setObject3D("sound",t.audio)),t.video=a.image,t.video.loop=t.data.loop,t.video.addEventListener("pause",t.onPauseStateChange),t.video.addEventListener("play",t.onPauseStateChange),a.hls){const e=()=>{t.videoIsLive=a.hls.levels[a.hls.currentLevel].details.live,t.updateHoverMenuBasedOnLiveState()};a.hls.on($.a.Events.LEVEL_SWITCHED,e),a.hls.currentLevel>=0&&e()}else t.videoIsLive=t.video.duration===1/0,t.updateHoverMenuBasedOnLiveState();if(oe){const e=document.getElementById("video-unmute");t.el.appendChild(document.importNode(e.content,!0)),t.el.setAttribute("position-at-box-shape-border__unmute-ui",{target:".unmute-ui",dirs:["forward","back"]})}}catch(e){console.error("Error loading video",t.data.src,e),a=me}const n=t.data.projection;if(!t.mesh||n!==e.projection){const e=new THREE.MeshBasicMaterial;let i;"360-equirectangular"===n?(i=new THREE.SphereBufferGeometry(1,64,32)).scale(-1,1,1):(i=new THREE.PlaneBufferGeometry,e.side=THREE.DoubleSide),t.mesh=new THREE.Mesh(i,e),t.el.setObject3D("mesh",t.mesh)}t.mesh.material.map=a,t.mesh.material.needsUpdate=!0,"flat"===n&&le(t.el,a.image.videoHeight/a.image.videoWidth),t.updatePlaybackState(!0),t.video.muted&&(t.videoMutedAt=performance.now()),t.el.emit("video-loaded",{projection:n})})()},updateHoverMenuBasedOnLiveState(){this.hoverMenu&&(this.seekForwardButton.object3D.visible=!this.videoIsLive,this.seekBackButton.object3D.visible=!this.videoIsLive,this.videoIsLive&&this.timeLabel.setAttribute("text","value","LIVE"))},updateVolumeLabel(){this.volumeLabel.setAttribute("text","value",0===this.data.volume?"MUTE":ae[Math.floor(this.data.volume/.05)])},tick(){if(!this.video)return;const e=this.el.sceneEl.systems.userinput,t=this.el.sceneEl.systems.interaction,i=e.get(x.a.actions.cursor.mediaVolumeMod);t.state.rightRemote.hovered===this.el&&i&&this.changeVolumeBy(i);const a=t.isHeld(this.el);if(this.wasHeld&&!a&&(this.localSnapCount=0),this.wasHeld=a,this.hoverMenu&&this.hoverMenu.object3D.visible&&!this.videoIsLive&&this.timeLabel.setAttribute("text","value",`${ve(this.video.currentTime)} / ${ve(this.video.duration)}`),!this.data.videoPaused&&!this.videoIsLive&&this.networkedEl&&NAF.utils.isMine(this.networkedEl)){const e=performance.now();e-this.lastUpdate>this.data.tickRate&&(this.el.setAttribute("media-video","time",this.video.currentTime),this.lastUpdate=e)}},cleanUp(){this.mesh&&this.mesh.material&&de(this.mesh.material.map)},remove(){this.cleanUp(),this.audio&&(this.el.removeObject3D("sound"),this.audio.disconnect(),delete this.audio),this.video&&(this.video.removeEventListener("pause",this.onPauseStateChange),this.video.removeEventListener("play",this.onPauseStateChange)),this.hoverMenu&&(this.playPauseButton.object3D.removeEventListener("interact",this.togglePlaying),this.volumeUpButton.object3D.removeEventListener("interact",this.volumeUp),this.volumeDownButton.object3D.removeEventListener("interact",this.volumeDown),this.seekForwardButton.object3D.removeEventListener("interact",this.seekForward),this.seekBackButton.object3D.removeEventListener("interact",this.seekBack))}}),AFRAME.registerComponent("media-image",{schema:{src:{type:"string"},projection:{type:"string",default:"flat"},contentType:{type:"string"},batch:{default:!1}},remove(){this.data.batch&&this.mesh&&this.el.sceneEl.systems["hubs-systems"].batchManagerSystem.removeObject(this.mesh),this._hasRetainedTexture&&(he.release(this.data.src),this.currentSrcIsRetained=!1)},update(e){var t=this;return Z(function*(){let i,a=1;try{const{src:n,contentType:s}=t.data;if(!n)return;let o;if(t.el.emit("image-loading"),t.mesh&&t.mesh.map&&n!==e.src&&(t.mesh.material.map=null,t.mesh.material.needsUpdate=!0,t.mesh.map!==me&&(he.release(e.src),t.currentSrcIsRetained=!1)),he.has(n))o=he.retain(n);else{if("error"===n)o=ge;else if(ue.has(n))yield ue.get(n),o=he.retain(n);else{let e;if(s.includes("image/gif"))e=function(e){return se.apply(this,arguments)}(n);else{if(!s.startsWith("image/"))throw new Error(`Unknown image content type: ${s}`);e=Object(N.c)(n)}ue.set(n,e),i=yield e,ue.delete(n),o=he.set(n,i)}if(t.data.src!==n||!t.el.parentNode)return void he.release(n)}i=o.texture,a=o.ratio,t.currentSrcIsRetained=!0}catch(e){console.error("Error loading image",t.data.src,e),i=me,t.currentSrcIsRetained=!1}const n=t.data.projection;if(!t.mesh||n!==e.projection){const e=new THREE.MeshBasicMaterial;let a;"360-equirectangular"===n?(a=new THREE.SphereBufferGeometry(1,64,32)).scale(-1,1,1):(a=new THREE.PlaneBufferGeometry(1,1,1,1,i.flipY),e.side=THREE.DoubleSide),t.mesh=new THREE.Mesh(a,e),t.el.setObject3D("mesh",t.mesh)}t.mesh.material.transparent=!t.data.batch||i==me||t.data.contentType.includes("image/gif"),t.mesh.material.map=i,t.mesh.material.needsUpdate=!0,"flat"===n&&le(t.el,a),i!==me&&t.data.batch&&t.el.sceneEl.systems["hubs-systems"].batchManagerSystem.addObject(t.mesh),t.el.emit("image-loaded",{src:t.data.src,projection:n})})()}}),AFRAME.registerComponent("avatar-volume-controls",{schema:{volume:{type:"number",default:1}},init(){this.volumeUp=this.volumeUp.bind(this),this.volumeDown=this.volumeDown.bind(this),this.changeVolumeBy=this.changeVolumeBy.bind(this),this.volumeUpButton=this.el.querySelector(".avatar-volume-up-button"),this.volumeDownButton=this.el.querySelector(".avatar-volume-down-button"),this.volumeLabel=this.el.querySelector(".avatar-volume-label"),this.volumeUpButton.object3D.addEventListener("interact",this.volumeUp),this.volumeDownButton.object3D.addEventListener("interact",this.volumeDown),this.updateVolumeLabel()},changeVolumeBy(e){this.el.setAttribute("avatar-volume-controls","volume",THREE.Math.clamp(this.data.volume+e,0,1)),this.updateVolumeLabel()},volumeUp(){this.changeVolumeBy(.1)},volumeDown(){this.changeVolumeBy(-.1)},update(){this.audio&&(this.audio.gain.gain.value=this.data.volume)},updateVolumeLabel(){this.volumeLabel.setAttribute("text","value",0===this.data.volume?"Muted":ae[Math.floor(this.data.volume/.05)])},tick(){if(this.audio)return;const e=this.el.parentNode.parentNode.querySelector("[networked-audio-source]");e&&(this.audio=e.components["networked-audio-source"].sound,this.update())}}),AFRAME.registerComponent("pinch-to-move",{schema:{speed:{default:.25}},init(){this.axis=[0,0]},tick(){const e=AFRAME.scenes[0].systems.userinput.get(x.a.device.touchscreen.pinchDelta);e&&(this.axis[1]=e*this.data.speed,this.el.emit("move",{axis:this.axis}))}});const fe=THREE.Math.degToRad,be=THREE.Math.radToDeg;AFRAME.registerComponent("pitch-yaw-rotator",{schema:{minPitch:{default:-90},maxPitch:{default:90}},init(){this.pitch=0,this.yaw=0,this.onRotateX=this.onRotateX.bind(this),this.el.sceneEl.addEventListener("rotateX",this.onRotateX),this.el.sceneEl.addEventListener("enter-vr",()=>this.pause()),this.el.sceneEl.addEventListener("exit-vr",()=>this.play()),this.pendingXRotation=0},onRotateX(e){this.pendingXRotation+=e.detail.value},look(e,t){const{minPitch:i,maxPitch:a}=this.data;this.pitch+=e,this.pitch=THREE.Math.clamp(this.pitch,i,a),this.yaw+=t},set(e,t){const{minPitch:i,maxPitch:a}=this.data;this.pitch=THREE.Math.clamp(be(e),i,a),this.yaw=be(t)},tick(){const e=AFRAME.scenes[0],t=e.systems.userinput.get(e.is("entered")?x.a.actions.cameraDelta:x.a.actions.lobbyCameraDelta);let i=this.pendingXRotation,a=0;t&&(a+=t[0],i+=t[1]),0===i&&0===a||(this.look(i,a),this.el.object3D.rotation.set(fe(this.pitch),fe(this.yaw),0),this.el.object3D.rotation.order="YXZ"),this.pendingXRotation=0}});var ye=i(286);const _e=Math.PI,Ee=_e/2,we=3*Ee,Se=new THREE.Vector3(1,0,0),xe=new THREE.Vector3(0,0,1),Ae=new THREE.Vector3(-1,0,0),ke=new THREE.Vector3(0,0,-1),Ce=new THREE.Vector3(0,0,0),Te={left:{dir:Ae,rotation:we,halfExtent:"x"},right:{dir:Se,rotation:Ee,halfExtent:"x"},forward:{dir:xe,rotation:0,halfExtent:"z"},back:{dir:ke,rotation:_e,halfExtent:"z"}};AFRAME.registerComponent("position-at-box-shape-border",{multiple:!0,schema:{target:{type:"string"},dirs:{default:["left","right","forward","back"]},animate:{default:!0},scale:{default:!0}},init(){this.cam=this.el.sceneEl.camera.el.object3D,this._updateBox=this._updateBox.bind(this),this._setupTarget=this._setupTarget.bind(this),this.halfExtents=new THREE.Vector3,this.el.sceneEl.systems["frame-scheduler"].schedule(this._updateBox,"media-components")},remove(){this.el.sceneEl.systems["frame-scheduler"].unschedule(this._updateBox,"media-components")},update(){this.dirs=this.data.dirs.map(e=>Te[e])},_setupTarget(){this.targetEl=this.el.querySelector(this.data.target),this.targetEl?(this.target=this.targetEl.object3D,this.targetEl.addEventListener("animationcomplete",()=>{this.targetEl.removeAttribute("animation__show")}),this.target.scale.setScalar(.01),this.target.matrixNeedsUpdate=!0):console.warn(`Race condition on position-at-box-shape-border on selector ${this.data.target}`)},tick(){if(!this.target)return void this._setupTarget();if(!this.el.getObject3D("mesh"))return;const e=this.targetEl.object3D.visible,t=e&&!this.wasVisible,i=this.el.object3D.scale.x!==this.previousScaleX||this.el.object3D.scale.y!==this.previousScaleY||this.el.object3D.scale.z!==this.previousScaleZ,a=this.targetEl.getAttribute("animation__show");(t||i&&a)&&this._updateBox(this.data.animate,!0),this.wasVisible=e,this.previousScaleX=this.el.object3D.scale.x,this.previousScaleY=this.el.object3D.scale.y,this.previousScaleZ=this.el.object3D.scale.z},_updateBox:function(){const e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Vector3,n=new THREE.Vector3,s=new THREE.Vector3,o=new THREE.Vector3,r=new THREE.Vector3(.001,.001,.001);return function(c,l){if(l||this.mesh!==this.el.getObject3D("mesh")){this.mesh=this.el.getObject3D("mesh");const e=Object(ye.a)(this.el,this.mesh);this.halfExtents=e.min.clone().negate().add(e.max).multiplyScalar(.65),this.halfExtents.max(r)}if(!this.target)return;Object(B.b)(this.cam,e);let d=1/0,h=this.dirs[0].dir,u=this.dirs[0].halfExtent,p=this.halfExtents[u],m=this.dirs[0].rotation,g=-1.1;this.el.object3D.updateMatrices();for(let t=0;t<this.dirs.length;t++){const s=this.dirs[t].dir,r=this.dirs[t].halfExtent,c=this.halfExtents[r];i.copy(s).multiplyScalar(c),n.copy(Ce),this.el.object3D.localToWorld(i),this.el.object3D.localToWorld(n),a.subVectors(e,i),a.normalize(),o.subVectors(i,n),o.normalize();const l=o.dot(a),v=i.distanceToSquared(e);l>g&&(d=v,h=s,p=c,m=this.dirs[t].rotation,u=r,g=l)}this.target.position.copy(t.copy(h).multiplyScalar(p)),this.target.rotation.set(0,m,0),s.setFromMatrixScale(this.target.parent.matrixWorld);const v=Math.sqrt(d),f=Math.max(this.halfExtents.x,this.halfExtents.z)*v,b=Math.min(2,Math.max(.5,f*s.x)),y=this.data.scale?b/s.x:1;c?(this.targetEl.removeAttribute("animation__show"),this.targetEl.setAttribute("animation__show",{property:"scale",dur:300,from:{x:.8*y,y:.8*y,z:.8*y},to:{x:y,y:y,z:y},easing:"easeOutElastic"})):this.targetEl.getAttribute("animation__show")||this.target.scale.setScalar(y),this.target.matrixNeedsUpdate=!0}}()});i(1717);AFRAME.registerComponent("pin-networked-object-button",{schema:{tipSelector:{type:"string"},labelSelector:{type:"string"}},init(){this._updateUI=this._updateUI.bind(this),this._updateUIOnStateChange=this._updateUIOnStateChange.bind(this),this.el.sceneEl.addEventListener("stateadded",this._updateUIOnStateChange),this.el.sceneEl.addEventListener("stateremoved",this._updateUIOnStateChange),this.tipEl=this.el.parentNode.querySelector(this.data.tipSelector),this.labelEl=this.el.parentNode.querySelector(this.data.labelSelector),NAF.utils.getNetworkedEntity(this.el).then(e=>{this.targetEl=e,this._updateUI(),this.targetEl.addEventListener("pinned",this._updateUI),this.targetEl.addEventListener("unpinned",this._updateUI)}),this.onHovered=()=>{this.hovering=!0,this._updateUI()},this.onUnhovered=()=>{this.hovering=!1,this._updateUI()},this.onClick=()=>{if(!NAF.utils.isMine(this.targetEl)&&!NAF.utils.takeOwnership(this.targetEl))return;const e=this.targetEl.components.pinnable&&this.targetEl.components.pinnable.data.pinned;this.targetEl.setAttribute("pinnable","pinned",!e),e||this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(d.m)}},play(){this.el.object3D.addEventListener("interact",this.onClick),this.el.object3D.addEventListener("hovered",this.onHovered),this.el.object3D.addEventListener("unhovered",this.onUnhovered)},pause(){this.el.object3D.removeEventListener("interact",this.onClick),this.el.object3D.removeEventListener("hovered",this.onHovered),this.el.object3D.removeEventListener("unhovered",this.onUnhovered)},remove(){this.el.sceneEl.removeEventListener("stateadded",this._updateUIOnStateChange),this.el.sceneEl.removeEventListener("stateremoved",this._updateUIOnStateChange),this.targetEl&&(this.targetEl.removeEventListener("pinned",this._updateUI),this.targetEl.removeEventListener("unpinned",this._updateUI))},_discordBridges:()=>window.APP.hubChannel.discordBridges(),_updateUIOnStateChange(e){"frozen"===e.detail&&this._updateUI()},_updateUI(){const{fileIsOwned:e,fileId:t}=this.targetEl.components["media-loader"].data,i=window.APP.hubChannel.can("pin_objects")&&!!(e||t&&Object(N.d)(t));this.el.object3D.visible=i,this.labelEl.object3D.visible=i;const a=this.targetEl.getAttribute("pinnable")&&this.targetEl.getAttribute("pinnable").pinned,n=this._discordBridges();this.tipEl.object3D.visible=!!(i&&!a&&this.hovering&&n.length>0),i&&(this.labelEl.setAttribute("text","value",a?"un-pin":"pin"),this.el.setAttribute("text-button","backgroundColor",a?"#fff":"#ff3550"),this.el.setAttribute("text-button","backgroundHoverColor",a?"#bbb":"#fc3545"))}});i(1718),i(1719),i(1720);AFRAME.registerComponent("unmute-video-button",{init(){this.onClick=()=>{const e=Object(j.a)(this.el,"media-video").components["media-video"];e&&e.video&&e.videoMutedAt&&(performance.now()-e.videoMutedAt<3e3||e.video.muted&&(e.video.muted=!1,this.el.setAttribute("visible",!1)))}},play(){document.addEventListener("touchstart",this.onClick)},pause(){document.removeEventListener("touchstart",this.onClick)}}),AFRAME.registerComponent("destroy-at-extreme-distances",{schema:{xMin:{default:-1e3},xMax:{default:1e3},yMin:{default:-1e3},yMax:{default:1e3},zMin:{default:-1e3},zMax:{default:1e3}},init(){this._checkForDestroy=this._checkForDestroy.bind(this),this.el.sceneEl.systems["frame-scheduler"].schedule(this._checkForDestroy,"media-components")},remove(){this.el.sceneEl.systems["frame-scheduler"].unschedule(this._checkForDestroy,"media-components")},_checkForDestroy:function(){const e=new THREE.Vector3;return function(){const{xMin:t,xMax:i,yMin:a,yMax:n,zMin:s,zMax:o}=this.data;Object(B.b)(this.el.object3D,e),(e.x<t||e.x>i||e.y<a||e.y>n||e.z<s||e.z>o)&&(this.el.components.networked&&!NAF.utils.isMine(this.el)||this.el.parentNode.removeChild(this.el))}}()});i(1721);var Re=i(87),Me=i(62),De=i(512),Pe=i(1232),Oe=i.n(Pe);function Ne(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}function He(e){return function(){var t=this,i=arguments;return new Promise(function(a,n){var s=e.apply(t,i);function o(e){Ne(s,a,n,o,r,"next",e)}function r(e){Ne(s,a,n,o,r,"throw",e)}o(void 0)})}}const Ie=new Promise(e=>(new THREE.GLTFLoader).load(Oe.a,e)),je={"player-right-controller":{takeSnapshot:x.a.actions.rightHand.takeSnapshot},"player-left-controller":{takeSnapshot:x.a.actions.leftHand.takeSnapshot},cursor:{takeSnapshot:x.a.actions.cursor.takeSnapshot}},Le=AFRAME.utils.device.isMobileVR(),Fe=["h264","vp9","vp8"].find(e=>window.MediaRecorder&&MediaRecorder.isTypeSupported(`video/webm; codecs=${e}`)),Be=Fe?`video/webm; codecs=${Fe}`:null,Ve=!!document.createElement("canvas").getContext("webgl2"),Ue=!!Be&&Ve,ze=Ue?[0,3,7,15,30,60,1/0]:[0],We=Ue?3:0,qe=document.createElement("canvas");function Ge(){return(Ge=He(function*(e,t,i){qe.width=t,qe.height=i;const a=qe.getContext("2d"),n=a.createImageData(t,i);n.data.set(e);const s=yield Object(Re.a)(n);a.scale(1,-1),a.drawImage(s,0,-i);const o=yield new Promise(e=>qe.toBlob(e));return new File([o],"snap.png",{type:"image/png"})})).apply(this,arguments)}AFRAME.registerComponent("camera-tool",{schema:{captureDuration:{default:We},captureAudio:{default:!1},isSnapping:{default:!1},isRecording:{default:!1},label:{default:""}},init(){this.lastUpdate=performance.now(),this.localSnapCount=0,this.showCameraViewfinder=!Le,this.renderTarget=new THREE.WebGLRenderTarget(1280,720,{format:THREE.RGBAFormat,minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,encoding:THREE.sRGBEncoding,depth:!1,stencil:!1}),this.camera=new THREE.PerspectiveCamera(50,1280/720,.1,3e4),this.camera.rotation.set(0,Math.PI,0),this.camera.position.set(0,0,.05),this.camera.matrixNeedsUpdate=!0,this.el.setObject3D("camera",this.camera);const e=new THREE.MeshBasicMaterial({map:this.renderTarget.texture});e.map.isVideoTexture=!0,e.map.update=()=>{this.showCameraViewfinder&&(this.viewfinderInViewThisFrame=!0)},this.el.sceneEl.addEventListener("stateadded",()=>this.updateUI()),this.el.sceneEl.addEventListener("stateremoved",()=>this.updateUI()),Ie.then(t=>{const i=t.scene.clone();i.scale.set(2,2,2),i.matrixNeedsUpdate=!0,this.el.setObject3D("mesh",i);const a=new THREE.PlaneBufferGeometry(.28,.28/this.camera.aspect),n=this.el.sceneEl.components["environment-map"];n&&n.applyEnvironmentMap(this.el.object3D),this.screen=new THREE.Mesh(a,e),this.screen.rotation.set(0,Math.PI,0),this.screen.position.set(0,0,-.042),this.screen.matrixNeedsUpdate=!0,this.el.setObject3D("screen",this.screen),this.selfieScreen=new THREE.Mesh(a,e),this.selfieScreen.position.set(0,.4,0),this.selfieScreen.scale.set(-2,2,2),this.selfieScreen.matrixNeedsUpdate=!0,this.el.setObject3D("selfieScreen",this.selfieScreen),this.label=this.el.querySelector(".label"),this.labelActionBackground=this.el.querySelector(".label-action-background"),this.labelBackground=this.el.querySelector(".label-background"),this.durationLabel=this.el.querySelector(".duration"),this.snapIcon=this.el.querySelector(".snap-icon"),this.recordIcon=this.el.querySelector(".record-icon"),this.recordAlphaIcon=this.el.querySelector(".record-alpha-icon"),this.label.object3D.visible=!1,this.durationLabel.object3D.visible=!1,this.snapMenu=this.el.querySelector(".camera-snap-menu"),this.playerCamera=document.querySelector("#player-camera").getObject3D("camera"),this.snapButton=this.el.querySelector(".snap-button"),this.cancelButton=this.el.querySelector(".cancel-button"),this.nextDurationButton=this.el.querySelector(".next-duration"),this.prevDurationButton=this.el.querySelector(".prev-duration"),this.snapButton.object3D.addEventListener("interact",()=>this.snapClicked()),this.cancelButton.object3D.addEventListener("interact",()=>this.cancelSnapping()),this.nextDurationButton.object3D.addEventListener("interact",()=>this.changeDuration(1)),this.prevDurationButton.object3D.addEventListener("interact",()=>this.changeDuration(-1)),this.stopButton=this.el.querySelector(".stop-button"),this.stopButton.object3D.addEventListener("interact",()=>this.stopRecording()),this.captureAudioButton=this.el.querySelector(".capture-audio"),this.captureAudioIcon=this.el.querySelector(".capture-audio-icon"),this.captureAudioButton.object3D.addEventListener("interact",()=>this.el.setAttribute("camera-tool","captureAudio",!this.data.captureAudio)),this.updateUI(),this.updateRenderTargetNextTick=!0,this.cameraSystem=this.el.sceneEl.systems["camera-tools"],this.cameraSystem.register(this.el)})},remove(){this.cameraSystem.deregister(this.el),this.el.sceneEl.emit("camera_removed"),this.stopRecording()},updateViewfinder(){this.updateRenderTargetNextTick=!0},changeDuration(e){const t=ze.findIndex(e=>this.data.captureDuration==e),i=0===t&&-1===e?ze.length-1:(t+e)%ze.length;this.el.setAttribute("camera-tool","captureDuration",ze[i])},focus(e,t){this.trackTarget=t?e:null,this.lookAt(e)},lookAt:function(){const e=new THREE.Vector3;return function(t){e.setFromMatrixPosition(t.object3D.matrixWorld),this.el.object3D.lookAt(e),this.el.object3D.matrixNeedsUpdate=!0}}(),onAvatarUpdated(){delete this.playerHead},snapClicked(){var e=this;this.data.isSnapping||(NAF.utils.isMine(this.el)||NAF.utils.takeOwnership(this.el))&&(this.el.setAttribute("camera-tool","isSnapping",!0),this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(d.a),this.snapCountdown=3,this.el.setAttribute("camera-tool","label",`${this.snapCountdown}`),this.countdownInterval=setInterval(He(function*(){if(!NAF.utils.isMine(e.el)&&!NAF.utils.takeOwnership(e.el))return clearInterval(e.countdownInterval),void(e.countdownInterval=null);e.snapCountdown--,0===e.snapCountdown?(clearInterval(e.countdownInterval),e.countdownInterval=null,0===e.data.captureDuration?(e.el.setAttribute("camera-tool",{label:"",isSnapping:!1}),e.takeSnapshotNextTick=!0):e.beginRecording(e.data.captureDuration)):(e.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(d.a),e.el.setAttribute("camera-tool","label",`${e.snapCountdown}`))}),1e3))},cancelSnapping(){clearInterval(this.countdownInterval),this.stopRecording(!0),this.updateUI()},update(){this.updateUI()},updateUI(){if(!this.label)return;const e=this.data.label,t=this.el.sceneEl.is("frozen"),i=0!==this.data.captureDuration&&this.data.captureDuration!==1/0,a=0===this.data.captureDuration,n=!i&&this.data.isRecording&&this.videoRecorder;this.label.object3D.visible=!!e&&!n;const s=this.label.object3D.visible&&this.data.isRecording&&!n;e&&this.label.setAttribute("text",{value:e,color:s?"#fafafa":"#ff3464"}),this.labelActionBackground.object3D.visible=s,this.labelBackground.object3D.visible=this.label.object3D.visible&&!s,this.stopButton.object3D.visible=n,i&&this.durationLabel.setAttribute("text","value",`${this.data.captureDuration}`),this.durationLabel.object3D.visible=i&&!this.data.isSnapping&&!t,this.recordIcon.object3D.visible=!i&&!a&&!t,this.recordAlphaIcon.object3D.visible=i&&!a&&!t,this.snapIcon.object3D.visible=a&&!t,this.snapButton.object3D.visible=!this.data.isSnapping&&!t,this.cancelButton.object3D.visible=this.data.isSnapping&&!t,this.prevDurationButton.object3D.visible=this.nextDurationButton.object3D.visible=!this.data.isSnapping&&Ue&&!t,this.captureAudioIcon.setAttribute("icon-button","active",this.data.captureAudio)},beginRecording(e){var t=this;return He(function*(){t.videoContext||(t.videoCanvas=document.createElement("canvas"),t.videoCanvas.width=640,t.videoCanvas.height=360,t.videoContext=t.videoCanvas.getContext("2d"),t.videoImageData=t.videoContext.createImageData(640,360),t.videoPixels=new Uint8Array(921600),t.videoImageData.data.set(t.videoPixels)),t.el.sceneEl.setAttribute("local-audio-analyser",{analyze:!0});const i=new MediaStream,a=t.videoCanvas.captureStream(25).getVideoTracks()[0];if(t.data.captureAudio){const e=yield NAF.connection.adapter.getMediaStream(NAF.clientId,"audio");if(e&&e.getAudioTracks().length>0){const a=THREE.AudioContext.getContext(),n=a.createMediaStreamDestination(),s=t.el.sceneEl.audioListener;s&&s.getInput().connect(n),a.createMediaStreamSource(e).connect(n);const o=n.stream.getAudioTracks()[0];i.addTrack(o)}}i.addTrack(a),t.videoRecorder=new MediaRecorder(i,{mimeType:Be});const n=[],s=performance.now();t.videoRecorder.ondataavailable=e=>n.push(e.data),t.updateRenderTargetNextTick=!0,t.videoRecorder.start(),t.el.setAttribute("camera-tool",{isRecording:!0,label:" "}),t.el.sceneEl.emit("action_camera_recording_started"),e!==1/0&&(t.videoCountdown=t.data.captureDuration,t.el.setAttribute("camera-tool","label",`${t.videoCountdown}`),t.videoCountdownInterval=setInterval(()=>{t.videoCountdown--,0===t.videoCountdown?(t.stopRecording(),t.videoCountdownInterval=null):t.el.setAttribute("camera-tool","label",`${t.videoCountdown}`)},1e3)),t.videoRecorder._free=()=>n.length=0,t.videoRecorder.onstop=He(function*(){if(t.el.sceneEl.emit("action_camera_recording_ended"),0===n.length)return;const e=n[0].type,i=performance.now()-s,a=new Blob(n,{type:e});n.length=0;const{entity:o,orientation:r}=Object(N.a)(t.el,new File([a],"capture",{type:e.split(";")[0]}),"video-camera",t.localSnapCount,!!t.playerIsBehindCamera);o.addEventListener("video-loaded",()=>{(t.data.captureAudio||i<=31e3)&&setTimeout(()=>{(NAF.utils.isMine(o)||NAF.utils.takeOwnership(o))&&o.components["media-video"].tryUpdateVideoPlaybackState(!0)},t.data.captureAudio?0:3*i+100)},{once:!0}),t.localSnapCount++,r.then(()=>t.el.sceneEl.emit("object_spawned",{objectType:Me.b.CAMERA}))})})()},stopRecording(e){this.videoRecorder&&(e&&(this.videoRecorder.onstop=()=>{},this.videoRecorder._free()),this.videoRecorder.stop(),this.videoRecorder=null,e||this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(d.b)),clearInterval(this.videoCountdownInterval),this.videoCountdownInterval=null,this.el.setAttribute("camera-tool","label",""),this.el.setAttribute("camera-tool",{isRecording:!1,isSnapping:!1}),this.el.sceneEl.setAttribute("local-audio-analyser",{analyze:!1})},tick(){const e=AFRAME.scenes[0].systems.interaction,t=AFRAME.scenes[0].systems.userinput,i=e.state.leftHand.held===this.el,a=e.state.rightHand.held===this.el,n=e.state.rightRemote.held===this.el,s=i&&t.get(e.options.leftHand.grabPath)||a&&t.get(e.options.rightHand.grabPath)||n&&t.get(e.options.rightRemote.grabPath),o=i||a||n;this.updateSnapMenuOrientation(),s&&(this.localSnapCount=0),this.showCameraViewfinder=o||!Le||this.data.isSnapping||this.videoRecorder,this.screen&&this.selfieScreen&&(this.screen.visible=this.selfieScreen.visible=!!this.showCameraViewfinder),(o||this.data.isSnapping||this.videoRecorder)&&performance.now()-this.lastUpdate>=1e3/(this.videoRecorder?25:6)&&(this.updateRenderTargetNextTick=!0);const r=this.isHoldingSnapshotTrigger();window.APP.hubChannel.can("spawn_camera")&&(!r||this.data.isSnapping||this.snapTriggerTimeout?r||this.data.isSnapping||!this.snapTriggerTimeout||(clearTimeout(this.snapTriggerTimeout),this.snapTriggerTimeout=null,this.takeSnapshotNextTick=!0):this.snapTriggerTimeout=setTimeout(()=>{if(this.isHoldingSnapshotTrigger()){this.el.setAttribute("camera-tool","isSnapping",!0),this.beginRecording(1/0);const e=setInterval(()=>{this.isHoldingSnapshotTrigger()||(this.stopRecording(),clearInterval(e))},500)}this.snapTriggerTimeout=null},500))},tock:function(){const e=new THREE.Vector3;return function(){const t=this.el.sceneEl,i=this.renderer||t.renderer,a=performance.now();if(this.trackTarget&&(this.trackTarget.parentNode?this.lookAt(this.trackTarget):this.trackTarget=null),!this.playerHead){const e=document.getElementById("player-head");this.playerHead=e&&e.object3D}if(!this.playerHud){const e=document.getElementById("player-hud");this.playerHud=e&&e.object3D}if(this.takeSnapshotNextTick||this.updateRenderTargetNextTick&&(this.viewfinderInViewThisFrame||this.videoRecorder)){if(this.playerHead){e.copy(this.playerHead.scale);let t=1;const i=this.el.sceneEl.systems["local-audio-analyser"];i&&i.data.analyze&&this.playerHead.el.components["scale-audio-feedback"]&&(t=Object(De.a)(this.el.object3D,this.playerHead,1,2,i.volume)),this.playerHead.scale.set(t,t,t),this.playerHead.updateMatrices(!0,!0),this.playerHead.updateMatrixWorld(!0,!0)}let n=!1;this.playerHud&&(n=this.playerHud.visible,this.playerHud.visible=!1,this.el.sceneEl.systems["post-physics"]&&(this.el.sceneEl.systems["post-physics"].spriteSystem.mesh.visible=!1));const s=i.vr.enabled,o=t.object3D.onAfterRender;delete t.object3D.onAfterRender,i.vr.enabled=!1,Ue&&this.videoRecorder&&!this.videoRenderTarget&&(this.videoRenderTarget=new THREE.WebGLRenderTarget(640,360,{format:THREE.RGBAFormat,minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,encoding:THREE.sRGBEncoding,depth:!1,stencil:!1}),i.setRenderTarget(this.videoRenderTarget)),i.setRenderTarget(this.renderTarget),i.render(t.object3D,this.camera),i.setRenderTarget(null),i.vr.enabled=s,t.object3D.onAfterRender=o,this.playerHead&&(this.playerHead.scale.copy(e),this.playerHead.updateMatrices(!0,!0),this.playerHead.updateMatrixWorld(!0,!0)),this.playerHud&&(this.playerHud.visible=n,this.el.sceneEl.systems["post-physics"]&&(this.el.sceneEl.systems["post-physics"].spriteSystem.mesh.visible=!0)),this.lastUpdate=a,this.videoRecorder&&(!function(e,t,i,a,n,s,o,r,c,l,d){const h=e.context,u=e.properties.get(t).__webglFramebuffer,p=e.properties.get(o).__webglFramebuffer;u&&p&&(h.bindFramebuffer(h.READ_FRAMEBUFFER,u),h.bindFramebuffer(h.DRAW_FRAMEBUFFER,p),h.checkFramebufferStatus(h.READ_FRAMEBUFFER)===h.FRAMEBUFFER_COMPLETE&&h.blitFramebuffer(i,a,n,s,r,c,l,d,h.COLOR_BUFFER_BIT,h.LINEAR))}(i,this.renderTarget,0,0,1280,720,this.videoRenderTarget,0,360,640,0),i.readRenderTargetPixels(this.videoRenderTarget,0,0,640,360,this.videoPixels),this.videoImageData.data.set(this.videoPixels),this.videoContext.putImageData(this.videoImageData,0,0)),this.updateRenderTargetNextTick=!1,this.viewfinderInViewThisFrame=!1}this.takeSnapshotNextTick&&(this.snapPixels||(this.snapPixels=new Uint8Array(3686400)),i.readRenderTargetPixels(this.renderTarget,0,0,1280,720,this.snapPixels),function(e,t,i){return Ge.apply(this,arguments)}(this.snapPixels,1280,720).then(e=>{const{orientation:t}=Object(N.a)(this.el,e,"photo-camera",this.localSnapCount,!!this.playerIsBehindCamera);t.then(()=>{this.el.sceneEl.emit("object_spawned",{objectType:Me.b.CAMERA})})}),t.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(d.b),this.takeSnapshotNextTick=!1,this.localSnapCount++)}}(),isHoldingSnapshotTrigger:function(){const e=AFRAME.scenes[0].systems.interaction,t=AFRAME.scenes[0].systems.userinput,i=e.state.leftHand.held===this.el,a=e.state.rightHand.held===this.el,n=e.state.rightRemote.held===this.el;let s;if(a?s="player-right-controller":i?s="player-left-controller":n&&(s="cursor"),s){const e=je[s];if(t.get(e.takeSnapshot))return!0}return!!t.get(x.a.actions.takeSnapshot)},updateSnapMenuOrientation:function(){const e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Vector3,n=new THREE.Vector3;return function(){this.el.object3D.getWorldPosition(t),this.playerCamera.getWorldPosition(e),i.subVectors(e,t),a.set(0,0,1),this.el.object3D.localToWorld(a),n.subVectors(a,t),n.normalize(),i.normalize();const s=n.dot(i)<0;this.playerIsBehindCamera!==s&&(this.playerIsBehindCamera=s,this.snapMenu.object3D.rotation.set(0,this.playerIsBehindCamera?Math.PI:0,0),this.snapMenu.object3D.matrixNeedsUpdate=!0)}}()});i(1722),i(1723),i(1724),i(1725),i(1726),i(1727);AFRAME.registerComponent("clone-media-button",{init(){this.updateSrc=()=>{const e=this.src=this.targetEl.components["media-loader"].data.src,t=e&&"video/vnd.hubs-webrtc"!==Object(X.b)(e);this.el.object3D.visible=!!t},NAF.utils.getNetworkedEntity(this.el).then(e=>{this.targetEl=e,this.targetEl.addEventListener("media_resolved",this.updateSrc,{once:!0}),this.updateSrc()}),this.onClick=()=>{const e=this.src,{contentSubtype:t,resize:i}=this.targetEl.components["media-loader"].data,{entity:a}=Object(N.b)(e,"#interactable-media",Me.a.URL,t,!0,i);a.object3D.matrixNeedsUpdate=!0,a.setAttribute("offset-relative-to",{target:"#player-camera",offset:{x:0,y:0,z:-1.5}})}},play(){this.el.object3D.addEventListener("interact",this.onClick)},pause(){this.el.object3D.removeEventListener("interact",this.onClick)}}),AFRAME.registerComponent("open-media-button",{init(){this.label=this.el.querySelector("[text]"),this.updateSrc=()=>{const e=this.src=this.targetEl.components["media-loader"].data.src,t=e&&"video/vnd.hubs-webrtc"!==Object(X.b)(e),i=this.el.sceneEl.systems.permissions.canOrWillIfCreator("update_hub");if(this.el.object3D.visible=!!t,t){let t="open link";Object(X.c)(e)?t="use avatar":Object(X.f)(e)&&i?t="use scene":Object(X.e)(e)&&(t="visit room"),this.label.setAttribute("text","value",t)}},this.onClick=()=>{const e=this.el.sceneEl.systems.permissions.canOrWillIfCreator("update_hub");if(Object(X.c)(this.src)){const e=new URL(this.src).pathname.split("/").pop();window.APP.store.update({profile:{avatarId:e}})}else Object(X.f)(this.src)&&e?this.el.sceneEl.emit("scene_media_selected",this.src):Object(X.e)(this.src)?location.href=this.src:window.open(this.src)},NAF.utils.getNetworkedEntity(this.el).then(e=>{this.targetEl=e,this.targetEl.addEventListener("media_resolved",this.updateSrc,{once:!0}),this.updateSrc()})},play(){this.el.object3D.addEventListener("interact",this.onClick)},pause(){this.el.object3D.removeEventListener("interact",this.onClick)}});i(1728);const Ye={type:"kinematic",collisionFilterMask:i(195).COLLISION_LAYERS.HANDS},$e={AXIS:"axis",PUPPET:"puppet",CURSOR:"cursor",ALIGN:"align",SCALE:"scale"},Xe=Math.PI/10,Qe=new THREE.Quaternion,Ke=new THREE.Vector3,Je=new THREE.Quaternion,Ze=new THREE.Vector3,et=new THREE.Vector3,tt=new THREE.Quaternion,it=new THREE.Quaternion;AFRAME.registerComponent("transform-button",{schema:{mode:{type:"string",oneof:Object.values($e),default:$e.CURSOR},axis:{type:"vec3",default:null}},init(){NAF.utils.getNetworkedEntity(this.el).then(e=>{this.targetEl=e});const e=document.querySelector("#player-right-controller");this.onGrabStart=t=>{this.targetEl&&(NAF.utils.isMine(this.targetEl)||NAF.utils.takeOwnership(this.targetEl))&&(this.targetEl.body&&this.targetEl.setAttribute("ammo-body",Ye),this.transformSystem=this.transformSystem||AFRAME.scenes[0].systems["transform-selected-object"],this.transformSystem.startTransform(this.targetEl.object3D,"cursor"===t.object3D.el.id?e.object3D:t.object3D,this.data))},this.onGrabEnd=()=>{this.transformSystem=this.transformSystem||AFRAME.scenes[0].systems["transform-selected-object"],this.transformSystem.stopTransform()}},play(){this.el.object3D.addEventListener("interact",this.onGrabStart),this.el.object3D.addEventListener("holdable-button-down",this.onGrabStart),this.el.object3D.addEventListener("holdable-button-up",this.onGrabEnd)},pause(){this.el.object3D.removeEventListener("interact",this.onGrabStart),this.el.object3D.removeEventListener("holdable-button-down",this.onGrabStart),this.el.object3D.removeEventListener("holdable-button-up",this.onGrabEnd)}}),AFRAME.registerSystem("transform-selected-object",{init(){this.target=null,this.mode=null,this.transforming=!1,this.axis=new THREE.Vector3,this.store=window.APP.store,this.dxStore=0,this.dxApplied=0,this.dyAll=0,this.dyStore=0,this.dyApplied=0,this.puppet={initialControllerOrientation:new THREE.Quaternion,initialControllerOrientation_inverse:new THREE.Quaternion,initialObjectOrientation:new THREE.Quaternion,currentControllerOrientation:new THREE.Quaternion,controllerOrientationDelta:new THREE.Quaternion},this.planarInfo={plane:new THREE.Mesh(new THREE.PlaneBufferGeometry(1e5,1e5,2,2),new THREE.MeshBasicMaterial({visible:!1,wireframe:!0,side:THREE.DoubleSide,transparent:!0,opacity:.3})),normal:new THREE.Vector3,intersections:[],previousPointOnPlane:new THREE.Vector3,currentPointOnPlane:new THREE.Vector3,deltaOnPlane:new THREE.Vector3,finalProjectedVec:new THREE.Vector3},this.el.object3D.add(this.planarInfo.plane)},stopTransform(){this.transforming=!1},startPlaneCasting(){const{plane:e,intersections:t,previousPointOnPlane:i}=this.planarInfo;this.el.camera.getWorldQuaternion(Qe),e.quaternion.copy(Qe),this.target.getWorldPosition(e.position),e.matrixNeedsUpdate=!0,e.updateMatrixWorld(!0),t.length=0,this.raycaster=this.raycaster||document.querySelector("#cursor-controller").components["cursor-controller"].raycaster;const a=this.raycaster.far;this.raycaster.far=1e3,e.raycast(this.raycaster,t),this.raycaster.far=a,this.transforming=!!t[0],this.transforming&&(i.copy(t[0].point),this.target.getWorldQuaternion(Je),Ze.set(0,0,-1).applyQuaternion(Qe),et.set(0,0,-1).applyQuaternion(Je),this.sign=Ze.dot(et)>0?1:-1,Ze.set(0,1,0),et.set(0,1,0).applyQuaternion(Je),this.sign2=Ze.dot(et)>0?1:-1,this.dyAll=0,this.dyStore=0,this.dyApplied=0,this.dxAll=0,this.dxStore=0,this.dxApplied=0)},startTransform(e,t,i){if(this.target=e,this.hand=t,this.mode=i.mode,this.transforming=!0,this.mode!==$e.ALIGN){if(this.mode===$e.SCALE?this.store.update({activity:{hasScaled:!0}}):this.store.update({activity:{hasRotated:!0}}),this.mode===$e.PUPPET)return this.target.getWorldQuaternion(this.puppet.initialObjectOrientation),this.hand.getWorldQuaternion(this.puppet.initialControllerOrientation),void this.puppet.initialControllerOrientation_inverse.copy(this.puppet.initialControllerOrientation).inverse();this.mode===$e.AXIS&&this.axis.copy(i.axis),this.startPlaneCasting()}else this.store.update({activity:{hasRecentered:!0}})},puppetingTick(){const{currentControllerOrientation:e,controllerOrientationDelta:t,initialControllerOrientation_inverse:i,initialObjectOrientation:a}=this.puppet;this.hand.getWorldQuaternion(e),t.copy(i).premultiply(e),this.target.quaternion.copy(a).premultiply(t),this.target.matrixNeedsUpdate=!0},cursorAxisOrScaleTick(){const{plane:e,normal:t,intersections:i,previousPointOnPlane:a,currentPointOnPlane:n,deltaOnPlane:s,finalProjectedVec:o}=this.planarInfo;this.target.getWorldPosition(e.position),this.el.camera.getWorldQuaternion(e.quaternion),e.matrixNeedsUpdate=!0;const r=Ze.sub(e.position).length();i.length=0;const c=this.raycaster.far;this.raycaster.far=1e3,e.raycast(this.raycaster,i),this.raycaster.far=c;const l=i[0];if(!l)return;t.set(0,0,-1).applyQuaternion(e.quaternion),n.copy(l.point),s.copy(n).sub(a);if(o.copy(s).projectOnPlane(t).applyQuaternion(tt.copy(e.quaternion).inverse()).multiplyScalar(10/r),this.mode===$e.CURSOR||this.mode===$e.SCALE){const e=AFRAME.scenes[0].systems.userinput.get(x.a.actions.transformModifier);if(this.dyAll=this.dyStore+o.y,this.dyApplied=e?this.dyAll:Math.round(this.dyAll/Xe)*Xe,this.dyStore=this.dyAll-this.dyApplied,this.dxAll=this.dxStore+o.x,this.dxApplied=e?this.dxAll:Math.round(this.dxAll/Xe)*Xe,this.dxStore=this.dxAll-this.dxApplied,this.mode===$e.CURSOR)this.target.getWorldQuaternion(Je),Ze.set(1,0,0).applyQuaternion(e?Qe:Je),tt.setFromAxisAngle(Ze,e?-this.dyApplied:this.sign2*this.sign*-this.dyApplied),e?Ze.set(0,1,0).applyQuaternion(Qe):Ze.set(0,1,0),it.setFromAxisAngle(Ze,this.dxApplied),this.target.quaternion.premultiply(tt).premultiply(it);else{const e=100*THREE.Math.clamp(o.y+o.x,-5e-4,5e-4),t=this.target.scale.x*(1+e);t>.1&&t<100&&this.target.scale.multiplyScalar(1+e)}this.target.matrixNeedsUpdate=!0}else this.mode===$e.AXIS&&(this.dxAll=this.dxStore+o.x,this.dxApplied=Math.round(this.dxAll/Xe)*Xe,this.dxStore=this.dxAll-this.dxApplied,this.target.quaternion.multiply(tt.setFromAxisAngle(this.axis,-this.sign*this.dxApplied)),this.target.matrixNeedsUpdate=!0);a.copy(n)},tick(){if(this.transforming)return this.mode===$e.ALIGN?(this.el.camera.getWorldPosition(Ke),this.target.lookAt(Ke),void(this.transforming=!1)):void(this.mode!==$e.PUPPET?this.cursorAxisOrScaleTick():this.puppetingTick())}}),AFRAME.registerComponent("transform-button-selector",{tick(){AFRAME.scenes[0].systems.userinput.get(x.a.actions.rightHand.pose)?this.el.components["transform-button"].data.mode!==$e.PUPPET&&this.el.setAttribute("transform-button","mode",$e.PUPPET):this.el.components["transform-button"].data.mode!==$e.CURSOR&&this.el.setAttribute("transform-button","mode",$e.CURSOR)}});const at=new THREE.Vector3(0,0,1),nt=2*Math.PI;AFRAME.registerComponent("visible-if-transforming",{init(){},tick(e){const t=AFRAME.scenes[0].systems["transform-selected-object"].transforming;this.el.getAttribute("visible")!==t&&this.el.setAttribute("visible",AFRAME.scenes[0].systems["transform-selected-object"].transforming),t&&(this.el.object3D.quaternion.setFromAxisAngle(at,nt*Math.sin(e/1e3)),this.el.object3D.matrixNeedsUpdate=!0)}});i(1729),i(1730);const st=function(e,t){this.geometry=new THREE.BufferGeometry,this.vertices=new Float32Array(3*e*2),this.uvs=new Float32Array(2*e*2),this.width=t,this.geometry.addAttribute("position",new THREE.BufferAttribute(this.vertices,3).setDynamic(!0)),this.material=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0}),this.mesh=new THREE.Mesh(this.geometry,this.material),this.mesh.drawMode=THREE.TriangleStripDrawMode,this.mesh.frustumCulled=!1,this.mesh.vertices=this.vertices,this.direction=new THREE.Vector3,this.numPoints=e};function ot(e,t,i,a){return a.x=e.x+t.x*i,a.y=e.y+t.y*i-4.9*i*i,a.z=e.z+t.z*i,a}st.prototype={setDirection:function(e){const t=new THREE.Vector3(0,1,0);this.direction.copy(e).cross(t).normalize().multiplyScalar(this.width/2)},setWidth:function(e){this.width=e},setPoint:function(){const e=new THREE.Vector3,t=new THREE.Vector3;return function(i,a){e.copy(a).add(this.direction),t.copy(a).sub(this.direction);let n=6*i;this.vertices[n++]=e.x,this.vertices[n++]=e.y,this.vertices[n++]=e.z,this.vertices[n++]=t.x,this.vertices[n++]=t.y,this.vertices[n++]=t.z,this.geometry.attributes.position.needsUpdate=!0}}()};const rt=function(){const e=new THREE.Vector3;return function(t,i,a,n,s,o,r){e.copy(i).sub(t);const c=e.length();n.far=c,n.set(t,e.normalize());const l=n.intersectObjects(a,!0);return!!(l.length>0&&function(e,t,i){const a=t.angleTo(e);return THREE.Math.RAD2DEG*a<=i}(l[0].face.normal,s,o))&&(r.copy(l[0].point),!0)}}();const ct=new THREE.Vector3(0,0,-1),lt=new THREE.Vector3(0,1,0),dt=new THREE.Quaternion,ht=new THREE.Vector3;AFRAME.registerComponent("teleporter",{schema:{start:{type:"string"},confirm:{type:"string"},speed:{default:12},collisionEntities:{default:""},hitCylinderColor:{type:"color",default:"#99ff99"},hitCylinderRadius:{default:.25,min:0},outerRadius:{default:.6,min:0},hitCylinderHeight:{default:.3,min:0}},init(){this.isTeleporting=!1,this.rayCurve=new st(20,.025),this.rayCurve.mesh.visible=!1,this.teleportEntity=document.createElement("a-entity"),this.teleportEntity.setObject3D("mesh",this.rayCurve.mesh),this.el.sceneEl.appendChild(this.teleportEntity),this.p0=new THREE.Vector3,this.v0=new THREE.Vector3,this.parabola=Array.from(new Array(this.rayCurve.numPoints),()=>new THREE.Vector3),this.hit=!1,this.hitPoint=new THREE.Vector3,this.meshes=[],this.raycaster=new THREE.Raycaster,this.rigWorldPosition=new THREE.Vector3,this.newRigWorldPosition=new THREE.Vector3,this.teleportOriginWorldPosition=new THREE.Vector3,this.teleportEventDetail={oldPosition:this.rigWorldPosition,newPosition:this.newRigWorldPosition,hitPoint:this.hitPoint},this.prevHitHeight=0,this.direction=new THREE.Vector3,this.hitEntity=this.createHitEntity(),this.hitEntity.object3D.visible=!1,this.el.sceneEl.appendChild(this.hitEntity),this.queryCollisionEntities()},queryCollisionEntities:function(){this.collisionEntities=[].slice.call(this.el.sceneEl.querySelectorAll(this.data.collisionEntities)),this.meshes=this.collisionEntities.map(function(e){return e.getObject3D("mesh")}).filter(function(e){return e})},remove(){this.stopPlayingTeleportSound()},stopPlayingTeleportSound(){if(this.teleportingSound){this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.stopSoundNode(this.teleportingSound.source),this.teleportingSound=null}},tick(e,t){if(!this.el.sceneEl.is("entered"))return;const i=this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem,a=AFRAME.scenes[0].systems.userinput,{start:n,confirm:s,speed:o}=this.data,r=this.el.object3D;if(!this.isTeleporting&&a.get(n)&&(this.isTeleporting=!0,this.timeTeleporting=0,this.hit=!1,this.rayCurve.mesh.visible=!0,this.rayCurve.mesh.updateMatrixWorld(),this.rayCurve.mesh.material.opacity=.1,this.rayCurve.mesh.material.color.set(16711680),this.rayCurve.mesh.material.needsUpdate=!0,this.teleportingSound=i.playSoundLoopedWithGain(d.s),this.teleportingSound&&(this.teleportingSound.gain.gain.value=.005)),!this.isTeleporting)return;if(this.teleportingSound&&(this.teleportingSound.gain.gain.value=Math.min(.025,this.teleportingSound.gain.gain.value+2e-5*t)),a.get(s)){if(this.hitEntity.setAttribute("visible",!1),this.isTeleporting=!1,this.rayCurve.mesh.visible=!1,this.teleportingSound&&this.stopPlayingTeleportSound(),!this.hit||this.timeTeleporting<400)return;return this.characterController=this.characterController||document.querySelector("#player-rig").components["character-controller"],this.characterController.teleportTo(this.hitPoint),void i.playSoundOneShot(d.r)}this.timeTeleporting+=t,r.updateMatrixWorld(),r.matrixWorld.decompose(this.p0,dt,ht),this.direction.copy(ct).applyQuaternion(dt).normalize(),this.rayCurve.setDirection(this.direction),this.v0.copy(this.direction).multiplyScalar(o);let c=this.rayCurve.numPoints-1;this.hit=!1,this.parabola[0].copy(this.p0);const l=1/(this.rayCurve.numPoints-1);for(let e=1;e<this.rayCurve.numPoints;e++){const t=e*l;if(ot(this.p0,this.v0,t,ht),this.parabola[e].copy(ht),rt(this.parabola[e-1],this.parabola[e],this.meshes,this.raycaster,lt,45,this.hitPoint)){this.hit=!0,c=e;break}}const h=this.timeTeleporting>400?1:this.timeTeleporting/400,u=h*(c/(this.rayCurve.numPoints-1))/(this.rayCurve.numPoints-1);for(let e=0;e<this.rayCurve.numPoints;e++){const t=e*u;ot(this.p0,this.v0,t,ht),this.rayCurve.setPoint(e,ht)}const p=this.hit?65280:16711680,m=this.hit&&this.timeTeleporting>=400?.3:.1;if(this.rayCurve.material.color.set(p),this.rayCurve.material.opacity=m,this.hitEntity.setAttribute("visible",this.hit),this.hit){this.hitEntity.setAttribute("position",this.hitPoint),this.hitEntity.object3D.traverse(e=>{e.matrixNeedsUpdate=!0});const e=.3*function(e){return e<.5?.5*((e=2*e-1)*e*e+1):.5*(e=2*e-1)*e*e+.5}(h),t=this.data.outerRadius-this.data.hitCylinderRadius,i=(this.data.outerRadius-function(e){return e*e}(h)*t)/this.data.outerRadius;this.outerTorus.object3D.scale.set(i,i,1),this.torus.setAttribute("material","opacity",e),this.cylinder.setAttribute("material","opacity",e)}},createHitEntity(){const e=this.data,t=document.createElement("a-entity");return t.className="hitEntity",this.torus=document.createElement("a-entity"),this.torus.setAttribute("geometry",{primitive:"torus",radius:e.hitCylinderRadius,radiusTubular:.01,segmentsRadial:16,segmentsTubular:18}),this.torus.setAttribute("rotation",{x:90,y:0,z:0}),this.torus.setAttribute("material",{shader:"flat",color:e.hitCylinderColor,side:"double",depthTest:!1}),t.appendChild(this.torus),this.cylinder=document.createElement("a-entity"),this.cylinder.setAttribute("position",{x:0,y:e.hitCylinderHeight/2,z:0}),void 0!==window.createImageBitmap&&this.cylinder.setAttribute("rotation",{x:0,y:0,z:180}),this.cylinder.setAttribute("geometry",{primitive:"cylinder",segmentsHeight:1,radius:e.hitCylinderRadius,height:e.hitCylinderHeight,openEnded:!0}),this.cylinder.setAttribute("material",{shader:"flat",color:e.hitCylinderColor,side:"double",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAQCAYAAADXnxW3AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAADJJREFUeNpEx7ENgDAAAzArK0JA6f8X9oewlcWStU1wBGdwB08wgjeYm79jc2nbYH0DAC/+CORJxO5fAAAAAElFTkSuQmCC",transparent:!0,depthTest:!1}),t.appendChild(this.cylinder),this.outerTorus=document.createElement("a-entity"),this.outerTorus.setAttribute("geometry",{primitive:"torus",radius:e.outerRadius,radiusTubular:.01,segmentsRadial:16,segmentsTubular:18}),this.outerTorus.setAttribute("rotation",{x:90,y:0,z:0}),this.outerTorus.setAttribute("material",{shader:"flat",color:e.hitCylinderColor,side:"double",opacity:.3,depthTest:!1}),this.outerTorus.setAttribute("id","outerTorus"),t.appendChild(this.outerTorus),t}});i(1731),i(1732),i(1733),i(1734),i(1735);var ut=i(1233),pt=i.n(ut);const mt=16;function gt(e,t,i){return e||(.5+t)*i}const vt={roboto:{json:(ft="https://cdn.aframe.io/fonts/Roboto-msdf.json",fetch(ft).then(e=>e.json()).then(e=>{if(ft.indexOf("/Roboto-msdf.json")>=0)for(const t of e.chars)t.yoffset+=30;return e.widthFactor=function(e){let t=0,i=0,a=0;for(const n of e.chars)t+=n.xadvance,n.id>=48&&n.id<=57&&(a++,i+=n.xadvance);return a?i/a:t/e.chars.length}(e),e})),texture:function(e){return new Promise((t,i)=>{(new THREE.ImageLoader).load(e,e=>{const i=new THREE.Texture;i.image=e,i.needsUpdate=!0,i.anisotropy=mt,t(i)},void 0,t=>{console.error("Error loading font image",e,t),i(null)})})}("https://cdn.aframe.io/fonts/Roboto-msdf.png")}};var ft;AFRAME.registerComponent("text",{multiple:!0,schema:{align:{type:"string",default:"left",oneOf:["left","right","center"]},alphaTest:{default:.5},anchor:{default:"center",oneOf:["left","right","center","align"]},baseline:{default:"center",oneOf:["top","center","bottom"]},color:{type:"color",default:"#FFF"},font:{type:"string",default:"roboto"},height:{type:"number"},letterSpacing:{type:"number",default:0},lineHeight:{type:"number"},negate:{type:"boolean",default:!0},opacity:{type:"number",default:1},side:{default:"front",oneOf:["front","back","double"]},tabSize:{default:4},transparent:{default:!0},value:{type:"string"},whiteSpace:{default:"normal",oneOf:["normal","pre","nowrap"]},width:{type:"number"},wrapCount:{type:"number",default:40},wrapPixels:{type:"number"},xOffset:{type:"number",default:0},zOffset:{type:"number",default:.001}},init:function(){const e=this.getShaderData(this.data);this.shaderObject=new AFRAME.shaders.msdf.Shader,this.shaderObject.el=this.el,this.shaderObject.init(e),this.shaderObject.update(e),this.shaderObject.material.transparent=e.transparent,this.shaderObject.material.side=e.side,this.geometry=pt()(),this.mesh=new THREE.Mesh(this.geometry,this.shaderObject.material),this.el.setObject3D(this.attrName,this.mesh)},update:function(e){const t=this.data,i=this.getShaderData(this.data);this.shaderObject.update(i),this.shaderObject.material.transparent=i.transparent,this.shaderObject.material.side=i.side,e.font!==t.font&&this.updateFont().catch(e=>console.error(e)),null!=this.currentFont&&(this.updateGeometry(this.geometry,this.currentFont),this.updateLayout(this.currentFont))},remove:function(){this.geometry.dispose(),this.geometry=null,this.el.removeObject3D(this.attrName),this.shaderObject.material.dispose(),this.shaderObject.material=null,delete this.shaderObject},getShaderData:function(){const e={};return function(t){return e.alphaTest=t.alphaTest,e.color=t.color,e.opacity=t.opacity,e.side=function(e){switch(e){case"back":return THREE.FrontSide;case"double":return THREE.DoubleSide;default:return THREE.BackSide}}(t.side),e.transparent=t.transparent,e.negate=t.negate,e}}(),updateFont:function(){const e=this.data,t=this.geometry;return this.mesh.visible=!1,Promise.all([vt[e.font].json,vt[e.font].texture]).then(([e,i])=>{if(1!==e.pages.length)throw new Error("Currently only single-page bitmap fonts are supported.");this.currentFont=e,this.updateGeometry(t,e),this.shaderObject.update({map:i}),this.updateLayout(e),this.mesh.visible=!0})},updateLayout:function(e){const t=this.el,i=this.data,a=this.geometry,n=this.mesh;if(!a.layout)return;const s=t.getAttribute("geometry"),o=i.width||s&&s.width||1,r=o/gt(i.wrapPixels,i.wrapCount,e.widthFactor),c=a.layout,l=r*(c.height+c.descender);s&&"plane"===s.primitive&&(s.width||t.setAttribute("geometry","width",o),s.height||t.setAttribute("geometry","height",l));const d="align"===i.anchor?i.align:i.anchor;let h,u;if("left"===d)h=0;else if("right"===d)h=-1*c.width;else{if("center"!==d)throw new TypeError("Invalid text.anchor property value",d);h=-1*c.width/2}const p=i.baseline;if("bottom"===p)u=0;else if("top"===p)u=-1*c.height+c.ascender;else{if("center"!==p)throw new TypeError("Invalid text.baseline property value",p);u=-1*c.height/2}n.position.x=h*r+i.xOffset,n.position.y=u*r,n.position.z=i.zOffset,n.scale.set(r,-1*r,r)},updateGeometry:function(){const e={},t={},i=/\\n/g,a=/\\t/g;return function(n,s){const o=this.data;t.font=s,t.lineHeight=o.lineHeight&&isFinite(o.lineHeight)?o.lineHeight:s.common.lineHeight,t.text=o.value.toString().replace(i,"\n").replace(a,"\t"),t.width=gt(o.wrapPixels,o.wrapCount,s.widthFactor),n.update(Object.assign(e,o,t))}}()});i(1747),i(1748);const bt={global:"global",inputFocused:"inputFocused",cursorHoveringOnPen:"cursorHoveringOnPen",cursorHoveringOnCamera:"cursorHoveringOnCamera",cursorHoveringOnInteractable:"cursorHoveringOnInteractable",cursorHoveringOnUI:"cursorHoveringOnUI",cursorHoveringOnVideo:"cursorHoveringOnVideo",cursorHoveringOnNothing:"cursorHoveringOnNothing",cursorHoldingPen:"cursorHoldingPen",cursorHoldingCamera:"cursorHoldingCamera",cursorHoldingInteractable:"cursorHoldingInteractable",cursorHoldingUI:"cursorHoldingUI",cursorHoldingNothing:"cursorHoldingNothing",rightHandTeleporting:"rightHandTeleporting",rightHandHoveringOnPen:"rightHandHoveringOnPen",rightHandHoveringOnCamera:"rightHandHoveringOnCamera",rightHandHoveringOnInteractable:"rightHandHoveringOnInteractable",rightHandHoveringOnNothing:"rightHandHoveringOnNothing",rightHandHoldingPen:"rightHandHoldingPen",rightHandHoldingCamera:"rightHandHoldingCamera",rightHandHoldingInteractable:"rightHandHoldingInteractable",leftHandTeleporting:"leftHandTeleporting",leftHandHoveringOnPen:"leftHandHoveringOnPen",leftHandHoveringOnCamera:"leftHandHoveringOnCamera",leftHandHoveringOnInteractable:"leftHandHoveringOnInteractable",leftHandHoldingPen:"leftHandHoldingPen",leftHandHoldingCamera:"leftHandHoldingCamera",leftHandHoldingInteractable:"leftHandHoldingInteractable",leftHandHoveringOnNothing:"leftHandHoveringOnNothing"};var yt=i(32),_t=i.n(yt),Et=i(0),wt=i.n(Et),St=i(2163),xt=i(2164),At=i(64),kt=i(11),Ct=i(1073),Tt=i.n(Ct),Rt=i(1234),Mt=i.n(Rt),Dt=i(1235),Pt=i.n(Dt),Ot=i(594),Nt=i.n(Ot),Ht=i(595),It=i.n(Ht),jt=i(1236),Lt=i.n(jt),Ft=i(1237),Bt=i.n(Ft),Vt=i(1238),Ut=i.n(Vt),zt=i(1239),Wt=i.n(zt),qt=i(228),Gt=i.n(qt),Yt=i(229),$t=i.n(Yt),Xt=i(1),Qt=i.n(Xt),Kt=i(3),Jt=i.n(Kt),Zt=i(401),ei=i.n(Zt),ti=i(22),ii=i(4),ai=i(150),ni=i.n(ai),si=i(83),oi=i.n(si);function ri(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}const{detect:ci}=i(140),li=ci(),di={yes:"yes",no:"no",maybe:"maybe"};const hi=[/cardboard/i];function ui(){return pi.apply(this,arguments)}function pi(){var e;return e=function*(){const e=navigator.userAgent,t="chrome"===li.name&&/SamsungBrowser/.test(e),i=AFRAME.utils.device.isMobile(),a=AFRAME.utils.device.isMobileVR(),n=window.hasNativeWebVRImplementation,s=!(!n||"chrome"!==li.name||t),o=AFRAME.utils.device.isIOS(),r="firefox"===li.name,c=void 0===navigator.mediaDevices,l=o?c?di.maybe:di.yes:di.no,d=!(!i||o||"chrome"!==li.name||t);let h=[];try{("chrome"!==li.name||i)&&(h=n||d?yield navigator.getVRDisplays():[])}catch(e){console.warn("navigator.getVRDisplays() failed",e)}const u=/Oculus/.test(e),p=a?di.no:o&&c?di.maybe:di.yes;let m=i||!n&&r?di.no:di.maybe,g=di.no,v=di.no;(function(e){return/\WAndroid\W/.test(e)})(e)&&(v=u?di.yes:di.maybe);let f=function(e){return/\WAndroid\W/.test(e)}(e)&&!a?di.maybe:di.no;if(g=d&&h.find(e=>e.capabilities.canPresent&&/cardboard/i.test(e.displayName))?di.yes:di.no,n){m=h.find(e=>e.capabilities.canPresent&&!hi.find(t=>t.test(e.displayName)))?di.yes:di.no,h.find(e=>/daydream/i.test(e.displayName))?(f=di.yes,m=di.no):s&&(f=di.no)}return{screen:p,generic:m,gearvr:v,daydream:f,cardboard:g,safari:l}},(pi=function(){var t=this,i=arguments;return new Promise(function(a,n){var s=e.apply(t,i);function o(e){ri(s,a,n,o,r,"next",e)}function r(e){ri(s,a,n,o,r,"throw",e)}o(void 0)})}).apply(this,arguments)}const mi=AFRAME.utils.device.isMobileVR();function gi(){return navigator.share&&!mi}function vi(e){if(gi())return navigator.share(e);{const{title:t,url:i}=e,a=550,n=420,s=(screen.width-a)/2,o=`scrollbars=no,menubar=no,toolbar=no,status=no,width=${a},height=${n},top=${(screen.height-n)/2},left=${s}`,r=`https://twitter.com/intent/tweet?url=${encodeURIComponent(i)}&text=${encodeURIComponent(t)}`;return window.open(r,"_blank",o),Promise.resolve()}}var fi,bi,yi,_i=i(2386),Ei=i.n(_i),wi=i(2388),Si=i.n(wi),xi=i(2390),Ai=i.n(xi),ki=i(9),Ci=i(151),Ti=i(274);function Ri(){return(Ri=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}function Mi(e,t){if(null==e)return{};var i,a,n=function(e,t){if(null==e)return{};var i,a,n={},s=Object.keys(e);for(a=0;a<s.length;a++)i=s[a],t.indexOf(i)>=0||(n[i]=e[i]);return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)i=s[a],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}class Di extends wt.a.Component{render(){const e=this.props,{history:t,stateKey:i,stateValue:a}=e,n=Mi(e,["history","stateKey","stateValue"]);return!t.location.state&&!a||t.location.state&&(t.location.state[i]===a||!t.location.state[i]&&!a)?wt.a.createElement(Ti.a,Ri({path:"/"},n)):null}}fi=Di,bi="propTypes",yi={stateKey:Qt.a.string,stateValue:Qt.a.string,history:Qt.a.object},bi in fi?Object.defineProperty(fi,bi,{value:yi,enumerable:!0,configurable:!0,writable:!0}):fi[bi]=yi;var Pi=Di,Oi=i(1240),Ni=i.n(Oi),Hi=i(1241),Ii=i.n(Hi),ji=i(21),Li=i(2392),Fi=i.n(Li);function Bi(){return(Bi=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}class Vi extends Et.Component{render(){return wt.a.createElement(ji.a,Bi({title:"Promote User"},this.props),wt.a.createElement("div",{className:Fi.a.message},wt.a.createElement(ii.a,{id:"promote.message"})),wt.a.createElement("button",{className:Fi.a.confirmButton,onClick:()=>{this.props.onConfirm(),this.props.onClose()}},wt.a.createElement(ii.a,{id:"promote.confirm-prefix"}),wt.a.createElement("span",null,this.props.displayName)),wt.a.createElement("button",{className:Fi.a.cancelButton,onClick:()=>this.props.onClose()},wt.a.createElement(ii.a,{id:"promote.cancel"})))}}!function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(Vi,"propTypes",{displayName:Qt.a.string,onConfirm:Qt.a.func,onClose:Qt.a.func});var Ui=i(2394),zi=i.n(Ui);function Wi(){return(Wi=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}function qi(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}function Gi(e){return function(){var t=this,i=arguments;return new Promise(function(a,n){var s=e.apply(t,i);function o(e){qi(s,a,n,o,r,"next",e)}function r(e){qi(s,a,n,o,r,"throw",e)}o(void 0)})}}function Yi(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class $i extends Et.Component{constructor(...e){super(...e),Yi(this,"state",{avatarThumbnailUrl:null})}kick(){const{clientId:e,performConditionalSignIn:t,hubChannel:i,onClose:a}=this.props;t(()=>i.can("kick_users"),Gi(function*(){return yield i.kick(e)}),"kick-user"),a()}hide(){const{clientId:e,onClose:t,hubChannel:i}=this.props;i.hide(e),t()}mute(){const{clientId:e,performConditionalSignIn:t,hubChannel:i,onClose:a}=this.props;t(()=>i.can("mute_users"),Gi(function*(){return yield i.mute(e)}),"mute-user"),a()}addOwner(){var e=this;const{clientId:t,performConditionalSignIn:i,hubChannel:a,onClose:n}=this.props,{profile:s}=this.getPresenceEntry();i(()=>a.can("update_roles"),Gi(function*(){n(),e.props.showNonHistoriedDialog(Vi,{displayName:s.displayName,onConfirm:()=>a.addOwner(t)})}),"add-owner")}removeOwner(){const{clientId:e,performConditionalSignIn:t,hubChannel:i,onClose:a}=this.props;t(()=>i.can("update_roles"),Gi(function*(){return yield i.removeOwner(e)}),"remove-owner"),a()}unhide(){const{clientId:e,hubChannel:t,onClose:i}=this.props;t.unhide(e),i()}getPresenceEntry(){if(!this.props.presences)return null;const e=Object.entries(this.props.presences).find(([e])=>e===this.props.clientId);if(!e)return{profile:{},roles:{}};const t=e[1].metas;return t[t.length-1]}componentDidMount(){const{profile:e}=this.getPresenceEntry();e.avatarId&&Object(f.d)(e.avatarId).then(e=>this.setState({avatarThumbnailUrl:e}))}render(){const{profile:e,roles:t}=this.getPresenceEntry(),{displayName:i,communityIdentifier:a}=e,{hubChannel:n,clientId:s,onClose:o}=this.props,r=wt.a.createElement("div",{className:zi.a.title},i,wt.a.createElement("div",{className:zi.a.communityIdentifier},a)),c=n.canOrWillIfCreator("kick_users"),l=n.canOrWillIfCreator("mute_users"),d=!!t.owner,h=!!t.creator,u=!!t.signed_in,p=n.canOrWillIfCreator("update_roles")&&!d&&!h,m=n.canOrWillIfCreator("update_roles")&&d&&!h,g=n.isHidden(s);return wt.a.createElement(ji.a,Wi({className:zi.a.clientInfoDialog,title:r,wide:!0},this.props),wt.a.createElement("div",{className:zi.a.roomInfo},wt.a.createElement("div",{className:zi.a.clientProfileImage},wt.a.createElement("img",{src:this.state.avatarThumbnailUrl})),wt.a.createElement("div",{className:zi.a.clientActionButtons},p&&wt.a.createElement("button",{onClick:()=>this.addOwner(),disabled:!u,title:u?"Promote":`${e.displayName} is signed out.`},wt.a.createElement("img",{className:zi.a.buttonIcon,src:Ni.a}),wt.a.createElement(ii.a,{id:"client-info.add-owner"})),m&&wt.a.createElement("button",{onClick:()=>this.removeOwner()},wt.a.createElement("img",{className:zi.a.buttonIcon,src:Ii.a}),wt.a.createElement(ii.a,{id:"client-info.remove-owner"})),!g&&wt.a.createElement("button",{onClick:()=>this.hide()},wt.a.createElement(ii.a,{id:"client-info.hide-button"})),g&&wt.a.createElement("button",{onClick:()=>this.unhide()},wt.a.createElement(ii.a,{id:"client-info.unhide-button"})),l&&wt.a.createElement("button",{onClick:()=>this.mute()},wt.a.createElement(ii.a,{id:"client-info.mute-button"})),c&&wt.a.createElement("button",{onClick:()=>this.kick()},wt.a.createElement(ii.a,{id:"client-info.kick-button"})),wt.a.createElement("button",{className:zi.a.cancel,onClick:o},wt.a.createElement(ii.a,{id:"client-info.cancel"})))))}}Yi($i,"propTypes",{clientId:Qt.a.string,history:Qt.a.object,hubChannel:Qt.a.object,presences:Qt.a.object,performConditionalSignIn:Qt.a.func,onClose:Qt.a.func,showNonHistoriedDialog:Qt.a.func});var Xi=i(33),Qi=i(2396),Ki=i.n(Qi);function Ji(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class Zi extends Et.Component{constructor(...e){super(...e),Ji(this,"doneWithInitialLoad",!1),Ji(this,"state",{loadingNum:0,loadedNum:0}),Ji(this,"onObjectLoading",()=>{!this.doneWithInitialLoad&&this.loadingTimeout&&(window.clearTimeout(this.loadingTimeout),this.loadingTimeout=null),this.setState(e=>({loadingNum:e.loadingNum+1}))}),Ji(this,"onObjectLoaded",()=>{this.setState(e=>({loadedNum:e.loadedNum+1})),this.tryFinishLoading()}),Ji(this,"tryFinishLoading",()=>{!this.doneWithInitialLoad&&this.loadingTimeout&&window.clearTimeout(this.loadingTimeout),this.environmentSceneLoaded&&(this.loadingTimeout=window.setTimeout(()=>{this.doneWithInitialLoad=!0,this.props.onLoaded&&this.props.onLoaded()},1500))})}componentDidMount(){this.props.scene.addEventListener("model-loading",this.onObjectLoading),this.props.scene.addEventListener("image-loading",this.onObjectLoading),this.props.scene.addEventListener("model-loaded",this.onObjectLoaded),this.props.scene.addEventListener("image-loaded",this.onObjectLoaded),this.props.scene.addEventListener("model-error",this.onObjectLoaded),this.props.scene.addEventListener("environment-scene-loaded",()=>{this.environmentSceneLoaded=!0,this.tryFinishLoading()},{once:!0})}componentWillUnmount(){this.props.scene.removeEventListener("model-loading",this.onObjectLoading),this.props.scene.removeEventListener("image-loading",this.onObjectLoading),this.props.scene.removeEventListener("model-loaded",this.onObjectLoaded),this.props.scene.removeEventListener("image-loaded",this.onObjectLoaded),this.props.scene.removeEventListener("model-error",this.onObjectLoaded)}render(){const e=wt.a.createElement("h4",{className:Ki.a.loadingText},wt.a.createElement(ii.a,{id:"loader.entering_lobby"})),t=0===this.state.loadingNum?" ":`${this.state.loadedNum} / ${this.state.loadingNum} `,i=wt.a.createElement("h4",{className:Ki.a.loadingText},wt.a.createElement(ii.a,{id:"loader.loading"}),t,wt.a.createElement(ii.a,{id:1!==this.state.loadingNum?"loader.objects":"loader.object"}),"...");return wt.a.createElement(ii.b,{locale:Xi.a,messages:Xi.b},wt.a.createElement("div",{className:"loading-panel"},wt.a.createElement("img",{className:"loading-panel__logo",style:{height:150,width:150},src:this.props.loadingIcon}),this.props.finished?e:i,wt.a.createElement("div",{className:"loader-wrap loader-bottom"},wt.a.createElement("div",{className:"loader"},wt.a.createElement("div",{className:"loader-center"})))))}}Ji(Zi,"propTypes",{scene:Qt.a.object,finished:Qt.a.bool,onLoaded:Qt.a.func});var ea=Zi;const ta=e=>wt.a.createElement("div",{className:"autoexit-panel"},wt.a.createElement("div",{className:"autoexit-panel__title"},wt.a.createElement(ii.a,{id:"autoexit.title"}),wt.a.createElement("span",null,e.secondsRemaining),wt.a.createElement(ii.a,{id:"autoexit.title_units"})),wt.a.createElement("div",{className:"autoexit-panel__subtitle"},wt.a.createElement(ii.a,{id:"autoexit.subtitle"})),wt.a.createElement(ki.b,null,wt.a.createElement("div",{className:"autoexit-panel__cancel-button",onClick:e.onCancel},wt.a.createElement(ii.a,{id:"autoexit.cancel"}))));ta.propTypes={secondsRemaining:Qt.a.number,onCancel:Qt.a.func};var ia=ta,aa=i(1242),na=i.n(aa),sa=i(1243),oa=i.n(sa),ra=i(1244),ca=i.n(ra),la=(i(1245),i(1246)),da=i.n(la);function ha(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},a=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),a.forEach(function(t){ua(e,t,i[t])})}return e}function ua(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const pa=e=>wt.a.createElement(ki.b,null,wt.a.createElement("button",{className:Jt()([{[Si.a.entryButton]:!0,[Si.a.entryButtonSecondary]:e.secondary}]),onClick:e.onClick},wt.a.createElement("img",{src:e.iconSrc,className:Si.a.icon}),wt.a.createElement("div",{className:Si.a.label},wt.a.createElement("div",{className:Si.a.contents},wt.a.createElement("span",null,wt.a.createElement(ii.a,{id:e.prefixMessageId})),wt.a.createElement("span",{className:Si.a.bolded},wt.a.createElement(ii.a,{id:e.mediumMessageId})),e.subtitle&&wt.a.createElement("div",{className:Si.a.subtitle},wt.a.createElement(ii.a,{id:e.subtitle}))))));pa.propTypes={onClick:Qt.a.func,iconSrc:Qt.a.string,secondary:Qt.a.bool,prefixMessageId:Qt.a.string,mediumMessageId:Qt.a.string,subtitle:Qt.a.string,isInHMD:Qt.a.bool};const ma=AFRAME.utils.device.isMobile()||AFRAME.utils.device.isMobileVR(),ga=e=>{const t=ha({},e,{iconSrc:ma?na.a:oa.a,prefixMessageId:"entry.screen-prefix",mediumMessageId:ma?"entry.mobile-screen":"entry.desktop-screen"});return wt.a.createElement(pa,t)},va=e=>{const t=ha({},e,{iconSrc:ca.a,prefixMessageId:"entry.generic-prefix",mediumMessageId:"entry.generic-medium",subtitle:ma?null:"entry.generic-subtitle-desktop"});return wt.a.createElement(pa,t)},fa=e=>{const t=ha({},e,{iconSrc:da.a,prefixMessageId:"entry.daydream-prefix",mediumMessageId:"entry.daydream-medium"});return wt.a.createElement(pa,t)};var ba=i(231),ya=i(15),_a=i(54),Ea=i(2398),wa=i.n(Ea),Sa=i(56),xa=i(68),Aa=i(230);function ka(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}function Ca(e){return function(){var t=this,i=arguments;return new Promise(function(a,n){var s=e.apply(t,i);function o(e){ka(s,a,n,o,r,"next",e)}function r(e){ka(s,a,n,o,r,"throw",e)}o(void 0)})}}function Ta(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class Ra extends Et.Component{constructor(e){var t;super(e),t=this,Ta(this,"state",{avatarId:null,displayName:null,avatar:null}),Ta(this,"getStateFromProfile",()=>{const{displayName:e,avatarId:t}=this.props.store.state.profile;return{displayName:e,avatarId:t}}),Ta(this,"storeUpdated",()=>this.setState(this.getStateFromProfile())),Ta(this,"saveStateAndFinish",e=>{e&&e.preventDefault();const{displayName:t}=this.props.store.state.profile,{hasChangedName:i}=this.props.store.state.activity,a=i||this.state.displayName!==t;this.props.store.update({activity:{hasChangedName:a,hasAcceptedProfile:!0},profile:{displayName:this.state.displayName,avatarId:this.state.avatarId}}),this.props.finished()}),Ta(this,"stopPropagation",e=>{e.stopPropagation()}),Ta(this,"setAvatarFromMediaResult",({detail:e})=>{this.setState({avatarId:e.id}),Object(kt.f)(this.props.history,this.props.history.location.state.key,"profile",{avatarId:e.id})}),Ta(this,"refetchAvatar",Ca(function*(){const e=yield Object(f.b)(t.state.avatarId);t.state.avatarId===e.avatar_id&&t.setState({avatar:e})})),this.state=this.getStateFromProfile(),e.avatarId&&(this.state.avatarId=e.avatarId),this.props.store.addEventListener("statechanged",this.storeUpdated),this.scene=document.querySelector("a-scene")}componentDidMount(){this.nameInput&&(this.nameInput.addEventListener("keydown",this.stopPropagation),this.nameInput.addEventListener("keypress",this.stopPropagation),this.nameInput.addEventListener("keyup",this.stopPropagation)),this.scene.addEventListener("action_selected_media_result_entry",this.setAvatarFromMediaResult),this.scene.addEventListener("action_avatar_saved",this.refetchAvatar),this.refetchAvatar()}componentDidUpdate(e,t){t.avatarId!==this.state.avatarId&&this.refetchAvatar()}componentWillUnmount(){this.props.store.removeEventListener("statechanged",this.storeUpdated),this.nameInput&&(this.nameInput.removeEventListener("keydown",this.stopPropagation),this.nameInput.removeEventListener("keypress",this.stopPropagation),this.nameInput.removeEventListener("keyup",this.stopPropagation)),this.scene.removeEventListener("action_selected_media_result_entry",this.setAvatarFromMediaResult),this.scene.removeEventListener("action_avatar_saved",this.refetchAvatar)}render(){const{formatMessage:e}=this.props.intl;return wt.a.createElement("div",{className:wa.a.profileEntry},wt.a.createElement("div",{className:wa.a.close},wt.a.createElement("a",{onClick:()=>this.props.onClose()},wt.a.createElement("i",null,wt.a.createElement(ya.a,{icon:xa.faTimes})))),wt.a.createElement("form",{onSubmit:this.saveStateAndFinish,className:wa.a.form},wt.a.createElement("div",{className:Jt()([wa.a.box,wa.a.darkened])},wt.a.createElement("label",{htmlFor:"#profile-entry-display-name",className:wa.a.title},wt.a.createElement(ii.a,{id:"profile.header"})),this.props.displayNameOverride?wt.a.createElement("span",{className:wa.a.displayName},this.props.displayNameOverride):wt.a.createElement("input",{id:"profile-entry-display-name",className:wa.a.formFieldText,value:this.state.displayName,onFocus:e=>Object(Sa.b)(e.target),onBlur:()=>Object(Sa.a)(),onChange:e=>this.setState({displayName:e.target.value}),required:!0,spellCheck:"false",pattern:_a.a.definitions.profile.properties.displayName.pattern,title:e({id:"profile.display_name.validation_warning"}),ref:e=>this.nameInput=e}),this.state.avatar?wt.a.createElement("div",{className:wa.a.preview},wt.a.createElement(Aa.a,{avatarGltfUrl:this.state.avatar.gltf_url}),this.state.avatar.account_id===this.props.store.credentialsAccountId&&wt.a.createElement(Ci.a,{stateKey:"overlay",stateValue:"avatar-editor",stateDetail:{avatarId:this.state.avatarId,hideDelete:!0,returnToProfile:!0},history:this.props.history,className:wa.a.editAvatar},wt.a.createElement(ya.a,{icon:ba.faPencilAlt})),wt.a.createElement("div",{className:wa.a.chooseAvatar},wt.a.createElement("a",{onClick:()=>this.props.mediaSearchStore.sourceNavigateWithNoNav("avatars")},wt.a.createElement(ii.a,{id:"profile.choose_avatar"})))):wt.a.createElement("div",{className:wa.a.preview},wt.a.createElement("div",{className:wa.a.chooseAvatar},wt.a.createElement("a",{onClick:()=>this.props.mediaSearchStore.sourceNavigateWithNoNav("avatars")},wt.a.createElement(ii.a,{id:"profile.choose_avatar"})))),wt.a.createElement(ki.b,null,wt.a.createElement("input",{className:wa.a.formSubmit,type:"submit",value:e({id:"profile.save"})})),wt.a.createElement("div",{className:wa.a.links},wt.a.createElement(ki.b,null,wt.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/mozilla/hubs/blob/master/TERMS.md"},wt.a.createElement(ii.a,{id:"profile.terms_of_use"}))),wt.a.createElement(ki.b,null,wt.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/mozilla/hubs/blob/master/PRIVACY.md"},wt.a.createElement(ii.a,{id:"profile.privacy_notice"})))))),wt.a.createElement("img",{className:wa.a.logo,src:this.props.logo}))}}Ta(Ra,"propTypes",{displayNameOverride:Qt.a.string,store:Qt.a.object,mediaSearchStore:Qt.a.object,messages:Qt.a.object,finished:Qt.a.func,intl:Qt.a.object,history:Qt.a.object,avatarId:Qt.a.string,onClose:Qt.a.func});var Ma=Object(ii.d)(Ra),Da=i(400),Pa=i(1247),Oa=i(533),Na=i(1248),Ha=i(1249),Ia=i(2372),ja=i.n(Ia),La=i(142),Fa=i(120),Ba=i(515);function Va(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Ua=AFRAME.utils.device.isMobile(),za=AFRAME.utils.device.isMobileVR(),Wa={videos:"https://privacy.microsoft.com/en-us/privacystatement",images:"https://privacy.microsoft.com/en-us/privacystatement",gifs:"https://tenor.com/legal-privacy",sketchfab:"https://sketchfab.com/privacy",poly:"https://policies.google.com/privacy",youtube:"https://policies.google.com/privacy",twitch:"https://www.twitch.tv/p/legal/privacy-policy/"},qa={sketchfab:[{text:"Animals",params:{filter:"animals-pets"}},{text:"Architecture",params:{filter:"architecture"}},{text:"Art",params:{filter:"art-abstract"}},{text:"Vehicles",params:{filter:"cars-vehicles"}},{text:"Characters",params:{filter:"characters-creatures"}},{text:"Culture",params:{filter:"cultural-heritage-history"}},{text:"Gadgets",params:{filter:"electronics-gadgets"}},{text:"Fashion",params:{filter:"fashion-style"}},{text:"Food",params:{filter:"food-drink"}},{text:"Furniture",params:{filter:"furniture-home"}},{text:"Music",params:{filter:"music"}},{text:"Nature",params:{filter:"nature-plants"}},{text:"News",params:{filter:"news-politics"}},{text:"People",params:{filter:"people"}},{text:"Places",params:{filter:"places-travel"}},{text:"Science",params:{filter:"science-technology"}},{text:"Sports",params:{filter:"sports-fitness"}},{text:"Weapons",params:{filter:"weapons-military"}}],poly:[{text:"Animals",params:{filter:"animals"}},{text:"Architecture",params:{filter:"architecture"}},{text:"Art",params:{filter:"art"}},{text:"Food",params:{filter:"food"}},{text:"Nature",params:{filter:"nature"}},{text:"Objects",params:{filter:"objects"}},{text:"People",params:{filter:"people"}},{text:"Scenes",params:{filter:"scenes"}},{text:"Transport",params:{filter:"transport"}}],avatars:[{text:"Featured",params:{filter:"featured"}},{text:"My Avatars",params:{filter:"my-avatars"}}],favorites:[],scenes:[{text:"Featured",params:{filter:"featured"}},{text:"My Scenes",params:{filter:"my-scenes"}}]};class Ga extends Et.Component{constructor(e){super(e),Va(this,"state",{query:"",facets:[],showNav:!0,selectNextResult:!1,clearStashedQueryOnClose:!1}),Va(this,"storeUpdated",()=>{const e=this.getStoreAndHistoryState(this.props);this.setState(e),this.state.selectNextResult&&(e.result&&e.result.entries.length>0?this.selectEntry(e.result.entries[0]):this.close())}),Va(this,"sourceChanged",()=>{!this.inputRef||Ua||za||this.inputRef.focus()}),Va(this,"getUrlSource",e=>e.get("media_source")||Object(kt.g)(this.props.history.location).substring(7)),Va(this,"getStoreAndHistoryState",e=>{const t=new URLSearchParams(e.history.location.search),i=e.mediaSearchStore.result,a={result:i,query:this.state.query||t.get("q")||""},n=this.getUrlSource(t);return a.showNav=!("false"===t.get("media_nav")),i&&i.suggestions&&i.suggestions.length>0?a.facets=i.suggestions.map(e=>({text:e,params:{q:e}})):a.facets=qa[n]||[],a}),Va(this,"handleQueryUpdated",(e,t)=>{this.setState({result:null}),this._sendQueryTimeout&&(clearTimeout(this._sendQueryTimeout),this._sendQueryTimeout=null),t?this.props.mediaSearchStore.filterQueryNavigate("",e):this._sendQueryTimeout=setTimeout(()=>{this.props.mediaSearchStore.filterQueryNavigate("",e),this._sendQueryTimeout=null},500),this.setState({query:e})}),Va(this,"handleEntryClicked",(e,t)=>{e.preventDefault(),t.lucky_query?(this.setState({clearStashedQueryOnClose:!0}),this.handleQueryUpdated(t.lucky_query,!0)):this.selectEntry(t)}),Va(this,"selectEntry",e=>{this.props.onMediaSearchResultEntrySelected&&(this.props.onMediaSearchResultEntrySelected(e),this.close())}),Va(this,"handleSourceClicked",e=>{this.props.mediaSearchStore.sourceNavigate(e)}),Va(this,"handleFacetClicked",e=>{const t=this.getSearchClearedSearchParams(!0,!0);for(const[i,a]of Object.entries(e.params))t.set(i,a);Object(kt.d)(this.props.history,this.props.history.location.pathname,t.toString())}),Va(this,"getSearchClearedSearchParams",(e,t)=>this.props.mediaSearchStore.getSearchClearedSearchParams(this.props.history.location,e,t)),Va(this,"pushExitMediaBrowserHistory",(e=!0)=>{this.props.mediaSearchStore.pushExitMediaBrowserHistory(this.props.history,e)}),Va(this,"showCustomMediaDialog",e=>{const t="scenes"===e,i="avatars"===e;this.pushExitMediaBrowserHistory(!i);const a=t?"change_scene":i?"avatar_url":"create";Object(kt.e)(this.props.history,"modal",a)}),Va(this,"close",()=>{Object(Fa.b)();const e=this.getUrlSource(new URLSearchParams(this.props.history.location.search));this.pushExitMediaBrowserHistory("avatars"!==e&&"favorites"!==e),this.state.clearStashedQueryOnClose&&this.props.mediaSearchStore.clearStashedQuery()}),Va(this,"handlePager",e=>{this.setState({result:null}),this.props.mediaSearchStore.pageNavigate(e),this.browserDiv.scrollTop=0}),this.state=this.getStoreAndHistoryState(e),this.props.mediaSearchStore.addEventListener("statechanged",this.storeUpdated),this.props.mediaSearchStore.addEventListener("sourcechanged",this.sourceChanged)}componentDidMount(){}componentWillUnmount(){this.props.mediaSearchStore.removeEventListener("statechanged",this.storeUpdated),this.props.mediaSearchStore.removeEventListener("sourcechanged",this.sourceChanged)}render(){const{formatMessage:e}=this.props.intl,t=new URLSearchParams(this.props.history.location.search),i=this.getUrlSource(t),a="scenes"===i,n=!("favorites"===i)&&(!a||this.props.hubChannel.canOrWillIfCreator("update_hub")),s=this.state.result&&this.state.result.entries||[],o="avatars"===i||"favorites"===i,r="avatars"!==i&&"scenes"!==i;if(this.state.selectNextResult)return wt.a.createElement("div",null);const c=e=>{"avatars"===e?this.showCustomMediaDialog(e):this.props.performConditionalSignIn(()=>!a||this.props.hubChannel.can("update_hub"),()=>this.showCustomMediaDialog(e),"change-scene")};return wt.a.createElement("div",{className:ja.a.mediaBrowser,ref:e=>this.browserDiv=e},wt.a.createElement("div",{className:Jt()([ja.a.box,ja.a.darkened])},wt.a.createElement("div",{className:Jt()(ja.a.header,{[ja.a.noSearch]:o})},wt.a.createElement("div",{className:ja.a.headerLeft},wt.a.createElement("a",{onClick:()=>this.close()},wt.a.createElement("i",null,wt.a.createElement(ya.a,{icon:xa.faTimes})))),wt.a.createElement("div",{className:ja.a.headerCenter},"favorites"===i&&wt.a.createElement("div",{className:ja.a.favoritesHeader},wt.a.createElement("i",null,wt.a.createElement(ya.a,{icon:Oa.faStar})),wt.a.createElement(ii.a,{id:"media-browser.favorites-header"})),!o&&wt.a.createElement("div",{className:ja.a.search},wt.a.createElement("i",null,wt.a.createElement(ya.a,{icon:Pa.faSearch})),wt.a.createElement("input",{type:"text",autoFocus:!Ua&&!za,ref:e=>this.inputRef=e,placeholder:e({id:`media-browser.search-placeholder.${i}`}),onFocus:e=>Object(Sa.b)(e.target),onBlur:()=>Object(Sa.a)(),onKeyDown:e=>{"Enter"===e.key&&e.ctrlKey?s.length>0&&!this._sendQueryTimeout?this.handleEntryClicked(e,s[0]):""!==this.state.query.trim()?(this.handleQueryUpdated(this.state.query,!0),this.setState({selectNextResult:!0})):this.close():("Escape"===e.key||"Enter"===e.key&&Ua)&&e.target.blur()},value:this.state.query,onChange:e=>this.handleQueryUpdated(e.target.value)})),wt.a.createElement("div",{className:ja.a.engineAttribution},!o&&"scenes"!==i&&"avatars"!==i&&"favorites"!==i&&wt.a.createElement("div",{className:ja.a.engineAttributionContents},wt.a.createElement(ii.a,{id:`media-browser.powered_by.${i}`}),Wa[i]&&wt.a.createElement("a",{href:Wa[i],target:"_blank",rel:"noreferrer noopener"},wt.a.createElement(ii.a,{id:"media-browser.privacy_policy"}))),"scenes"===i&&wt.a.createElement("div",{className:ja.a.engineAttributionContents},wt.a.createElement(ii.a,{id:`media-browser.powered_by.${i}`}),wt.a.createElement("a",{href:"/spoke",target:"_blank",rel:"noreferrer noopener"},wt.a.createElement(ii.a,{id:"media-browser.spoke"})),"|",wt.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"/?report"},wt.a.createElement(ii.a,{id:"media-browser.report_issue"}))))),wt.a.createElement("div",{className:ja.a.headerRight},n&&wt.a.createElement("a",{onClick:()=>c(i),className:ja.a.createButton},wt.a.createElement("i",null,wt.a.createElement(ya.a,{icon:["scenes","avatars"].includes(i)?Ha.faLink:Na.faCloudUploadAlt}))),n&&wt.a.createElement("a",{onClick:()=>c(i),className:ja.a.createLink},wt.a.createElement(ii.a,{id:`media-browser.add_custom_${this.state.result&&a?"scene":"avatars"===i?"avatar":"object"}`})))),this.state.showNav&&wt.a.createElement("div",{className:ja.a.nav},La.a.map(e=>wt.a.createElement("a",{onClick:()=>this.handleSourceClicked(e),key:e,className:Jt()({[ja.a.navSource]:!0,[ja.a.navSourceSelected]:i===e})},wt.a.createElement(ii.a,{id:`media-browser.nav_title.${e}`}))),wt.a.createElement("div",{className:ja.a.navRightPad}," "),wt.a.createElement("div",{className:ja.a.navScrollArrow},wt.a.createElement(ya.a,{icon:Da.faAngleRight}))),this.state.facets&&this.state.facets.length>0&&wt.a.createElement("div",{className:ja.a.facets},this.state.facets.map((e,t)=>wt.a.createElement("a",{onClick:()=>this.handleFacetClicked(e),key:t,className:ja.a.facet},e.text))),this.props.mediaSearchStore.isFetching||this._sendQueryTimeout||this.state.result&&this.state.result.entries.length>0||!r?wt.a.createElement(Ba.a,{result:this.state.result,history:this.props.history,urlSource:i,handleEntryClicked:this.handleEntryClicked,handlePager:this.handlePager}):wt.a.createElement("div",{className:ja.a.emptyString},wt.a.createElement(ii.a,{id:`media-browser.empty.${i}`}))))}}Va(Ga,"propTypes",{mediaSearchStore:Qt.a.object,history:Qt.a.object,intl:Qt.a.object,hubChannel:Qt.a.object,onMediaSearchResultEntrySelected:Qt.a.func,performConditionalSignIn:Qt.a.func});var Ya=Object(ii.d)(Ga),$a=i(1074),Xa=i.n($a),Qa=i(1250),Ka=i(2402),Ja=i.n(Ka);function Za(){return(Za=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}function en(e,t){if(null==e)return{};var i,a,n=function(e,t){if(null==e)return{};var i,a,n={},s=Object.keys(e);for(a=0;a<s.length;a++)i=s[a],t.indexOf(i)>=0||(n[i]=e[i]);return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)i=s[a],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}function tn(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const an={"giphy.com":Xa.a,"media.giphy.com":Xa.a},nn="https://asset-bundles-prod.reticulum.io/interactables/Ducky/DuckyMesh-438ff8e022.gltf",sn=AFRAME.utils.device.isMobile()||AFRAME.utils.device.isMobileVR(),on="Paste a URL to an image, video, model, scene, or upload.",rn=wt.a.createElement("span",null,"For models, try"," ",wt.a.createElement("a",{href:"https://sketchfab.com/search?features=downloadable&type=models",target:"_blank",rel:"noopener noreferrer"},"Sketchfab"),","," ",wt.a.createElement("a",{href:"http://poly.google.com/",target:"_blank",rel:"noopener noreferrer"},"Google Poly"),", or our"," ",wt.a.createElement("a",{href:"https://sketchfab.com/mozillareality",target:"_blank",rel:"noopener noreferrer"},"collection"),"."),cn=wt.a.createElement("div",null,wt.a.createElement("p",null,on),wt.a.createElement("p",null,rn)),ln=wt.a.createElement("div",null,wt.a.createElement("p",null,on),wt.a.createElement("p",null,rn),wt.a.createElement("p",null,"Tip: You can paste URLs directly into Hubs with Ctrl+V"));let dn="";const hn="file-input";class un extends Et.Component{constructor(...e){super(...e),tn(this,"state",{url:"",file:null,fileName:""}),tn(this,"onUrlChange",e=>{let t=this.state.attributionImage;if(e.target&&e.target.value&&e.target.validity.valid){const i=new URL(e.target.value);t=an[i.hostname]}this.setState({url:e.target&&e.target.value,attributionImage:t})}),tn(this,"onFileChange",e=>{this.setState({file:e.target.files[0],fileName:e.target.files[0].name})}),tn(this,"reset",e=>{e.preventDefault(),this.setState({url:"",file:null,fileName:""}),this.fileInput.value=null}),tn(this,"onCreateClicked",e=>{e.preventDefault(),this.props.onCreate(this.state.file||this.state.url||nn),this.props.onClose()})}componentDidMount(){this.setState({url:dn})}componentWillUnmount(){dn=this.state.url}render(){const e=this.props,{onCreate:t,onClose:i}=e,a=en(e,["onCreate","onClose"]),n=wt.a.createElement(ki.b,null,wt.a.createElement("label",{className:Jt()(Ja.a.smallButton,Ja.a.cancelIcon),onClick:this.reset},wt.a.createElement(ya.a,{icon:xa.faTimes}))),s=wt.a.createElement(ki.b,null,wt.a.createElement("label",{htmlFor:hn,className:Jt()(Ja.a.smallButton,Ja.a.uploadIcon)},wt.a.createElement(ya.a,{icon:Qa.faPaperclip}))),o=wt.a.createElement("label",{className:Jt()(Ja.a.leftSideOfInput)},this.state.fileName),r=wt.a.createElement("input",{className:Jt()(Ja.a.leftSideOfInput),placeholder:"Image/Video/glTF URL",onFocus:e=>Object(Sa.b)(e.target),onBlur:()=>Object(Sa.a)(),onChange:this.onUrlChange,type:"url",value:this.state.url});return wt.a.createElement(ji.a,Za({title:"Create Object",onClose:this.props.onClose},a),wt.a.createElement("div",null,sn?cn:ln,wt.a.createElement("form",{onSubmit:this.onCreateClicked},wt.a.createElement("div",{className:Ja.a.addMediaForm},wt.a.createElement("input",{id:hn,ref:e=>this.fileInput=e,className:Ja.a.hideFileInput,type:"file",onChange:this.onFileChange}),wt.a.createElement("div",{className:Ja.a.inputBorder},this.state.file?o:r,this.state.url||this.state.fileName?n:s),wt.a.createElement("div",{className:Ja.a.buttons},wt.a.createElement(ki.b,null,wt.a.createElement("button",{className:Ja.a.actionButton},wt.a.createElement("span",null,"Create")))),this.state.attributionImage?wt.a.createElement("div",null,wt.a.createElement("img",{src:this.state.attributionImage})):null))))}}tn(un,"propTypes",{onCreate:Qt.a.func,onClose:Qt.a.func});var pn=i(2404),mn=i.n(pn);function gn(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class vn extends Et.Component{constructor(...e){super(...e),gn(this,"state",{url:""}),gn(this,"onUrlChange",e=>{this.setState({url:e.target&&e.target.value})}),gn(this,"reset",e=>{e.preventDefault(),this.setState({url:""})}),gn(this,"onChangeClicked",e=>{e.preventDefault(),this.state.url&&this.props.onChange(this.state.url),this.props.onClose()})}render(){const{onChange:e,onClose:t}=this.props;return wt.a.createElement(ji.a,{title:"Custom Scene",onClose:this.props.onClose},wt.a.createElement("div",null,wt.a.createElement("div",null,wt.a.createElement("p",null,"Paste a URL to a"," ",wt.a.createElement("a",{href:"/spoke",target:"_blank",rel:"noopener noreferrer"},"Spoke")," ","scene or a URL to a"," ",wt.a.createElement("a",{href:"https://en.wikipedia.org/wiki/GlTF#GLB",target:"_blank",rel:"noopener noreferrer"},"GLB"),".")),wt.a.createElement("form",{onSubmit:this.onChangeClicked},wt.a.createElement("div",{className:mn.a.changeSceneForm},wt.a.createElement("div",{className:mn.a.inputBorder},wt.a.createElement("input",{className:Jt()(mn.a.leftSideOfInput),placeholder:"Scene URL",onFocus:e=>Object(Sa.b)(e.target),onBlur:()=>Object(Sa.a)(),onChange:this.onUrlChange,type:"url",value:this.state.url})),wt.a.createElement("div",{className:mn.a.buttons},wt.a.createElement("button",{className:mn.a.actionButton},wt.a.createElement(ii.a,{id:"change-scene-dialog.change-scene"}))),wt.a.createElement("div",{className:mn.a.spokeCreate},wt.a.createElement("div",null,wt.a.createElement(ii.a,{id:"change-scene-dialog.create-in-spoke"})),wt.a.createElement("a",{className:mn.a.spokeLaunch,href:"/spoke/new",target:"_blank",rel:"noopener noreferrer"},wt.a.createElement(ii.a,{id:"change-scene-dialog.new-spoke-project"})))))))}}gn(vn,"propTypes",{onChange:Qt.a.func,onClose:Qt.a.func});var fn=i(2406),bn=i.n(fn);function yn(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class _n extends Et.Component{constructor(...e){super(...e),yn(this,"state",{url:""}),yn(this,"onUrlChange",e=>{this.setState({url:e.target&&e.target.value})}),yn(this,"onChangeClicked",e=>{e.preventDefault(),this.state.url&&this.props.onChange(this.state.url),this.props.onClose()})}render(){return wt.a.createElement(ji.a,{title:"Custom Avatar URL",className:bn.a.avatarUrlDialog,onClose:this.props.onClose},wt.a.createElement("p",null,"Paste a URL to a"," ",wt.a.createElement("a",{href:"https://en.wikipedia.org/wiki/GlTF#GLB",target:"_blank",rel:"noopener noreferrer"},"GLB"),"."),wt.a.createElement("form",{className:"form",onSubmit:this.onChangeClicked},wt.a.createElement("input",{className:"url-field",placeholder:"Avatar GLB URL",onFocus:e=>Object(Sa.b)(e.target),onBlur:()=>Object(Sa.a)(),onChange:this.onUrlChange,type:"url",value:this.state.url}),wt.a.createElement("button",{className:"submit"},wt.a.createElement(ii.a,{id:"avatar-url-dialog.apply"}))))}}function En(){return(En=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}yn(_n,"propTypes",{onChange:Qt.a.func,onClose:Qt.a.func});class wn extends Et.Component{render(){return wt.a.createElement(ji.a,En({title:"Getting Started"},this.props),wt.a.createElement("div",{className:"info-dialog__help"},wt.a.createElement("p",{style:{textAlign:"center"}},"Join the Hubs community on"," ",wt.a.createElement(ki.b,null,wt.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://discord.gg/wHmY4nd"},"Discord")),"!"),wt.a.createElement("p",null,"When in a room, other avatars can see and hear you."),wt.a.createElement("p",null,"Use your controller's action button to teleport from place to place. If it has a grip, use it to pick up objects."),wt.a.createElement("p",null,"In VR, ",wt.a.createElement("b",null,"look up")," to find your menu."),wt.a.createElement("p",null,"The ",wt.a.createElement("b",null,"Mic Toggle")," mutes your mic."),wt.a.createElement("p",null,"The ",wt.a.createElement("b",null,"Pause Toggle")," pauses all other avatars and lets you block others or pin or remove objects."),wt.a.createElement("p",null,"See detailed"," ",wt.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/mozilla/hubs/wiki/Hubs-Features"},"feature")," ","and"," ",wt.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/mozilla/hubs/wiki/Hubs-Controls"},"controls")," ","documentation."),wt.a.createElement("p",{className:"dialog__box__contents__links"},wt.a.createElement(ki.b,null,wt.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/mozilla/hubs/blob/master/TERMS.md"},wt.a.createElement(ii.a,{id:"profile.terms_of_use"}))),wt.a.createElement(ki.b,null,wt.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/mozilla/hubs/blob/master/PRIVACY.md"},wt.a.createElement(ii.a,{id:"profile.privacy_notice"}))),wt.a.createElement(ki.b,null,wt.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"/?report"},wt.a.createElement(ii.a,{id:"help.report_issue"}))))))}}function Sn(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class xn extends Et.Component{constructor(...e){super(...e),Sn(this,"state",{copyButtonActive:!1,shareButtonActive:!1}),Sn(this,"shareClicked",e=>{this.setState({shareButtonActive:!0}),vi({url:e,title:"Join me now in #hubs!"}).then(()=>{this.setState({shareButtonActive:!1})})}),Sn(this,"copyClicked",e=>{this.setState({copyButtonActive:!0}),setTimeout(()=>this.setState({copyButtonActive:!1}),5e3),ei()(e)})}render(){const{entryCode:e,embedUrl:t}=this.props,i=function(e,t){let i=`${e}`;for(;i.length<t;)i=`0${i}`;return i}(e,6),a=`hub.link/${this.props.hubId}`,n="https://"+a,s=`<iframe src="${t}" style="width: 1024px; height: 768px;" allow="microphone; camera; vr; speaker;"></iframe>`;return wt.a.createElement("div",{className:Jt()({[Ai.a.dialog]:!0,[Ai.a.modal]:this.props.isModal})},!this.props.isModal&&wt.a.createElement("div",{className:Ai.a.attachPoint}),wt.a.createElement(ki.b,null,wt.a.createElement("button",{className:Ai.a.close,onClick:()=>this.props.onClose()},wt.a.createElement("i",null,wt.a.createElement(ya.a,{icon:xa.faTimes})))),wt.a.createElement("div",null,wt.a.createElement(ii.a,{id:`invite.enter_via${this.props.isModal?"_modal":""}`}),wt.a.createElement(ki.b,null,wt.a.createElement("a",{href:"https://hub.link",target:"_blank",className:Ai.a.hubLinkLink,rel:"noopener noreferrer"},"hub.link")),wt.a.createElement(ii.a,{id:"invite.and_enter_code"})),wt.a.createElement("div",{className:Ai.a.code},i.split("").map((e,t)=>wt.a.createElement("div",{className:Jt()({[Ai.a.digit]:!0,[Ai.a[`digit_${t}`]]:!0}),key:`link_code_${t}`},e))),wt.a.createElement("div",null,wt.a.createElement(ii.a,{id:`invite.or_visit${this.props.isModal?"_modal":""}`})),wt.a.createElement("div",{className:Ai.a.domain},wt.a.createElement("input",{type:"text",readOnly:!0,onFocus:e=>e.target.select(),value:a})),wt.a.createElement("div",{className:Ai.a.buttons},wt.a.createElement(ki.b,null,wt.a.createElement("button",{className:Ai.a.linkButton,onClick:this.copyClicked.bind(this,n)},wt.a.createElement("span",null,this.state.copyButtonActive?"copied!":"copy"))),this.props.allowShare&&gi()&&wt.a.createElement(ki.b,null,wt.a.createElement("button",{className:Ai.a.linkButton,onClick:this.shareClicked.bind(this,n)},wt.a.createElement("span",null,this.state.shareButtonActive?"sharing...":"share"))),this.props.allowShare&&!gi()&&wt.a.createElement(ki.b,null,wt.a.createElement("button",{className:Ai.a.linkButton,onClick:this.shareClicked.bind(this,n)},wt.a.createElement(ii.a,{id:"invite.tweet"})))),t&&wt.a.createElement("div",{className:Ai.a.embed},wt.a.createElement("div",null,wt.a.createElement(ii.a,{id:"invite.embed"})),wt.a.createElement("div",{className:Ai.a.embedText},wt.a.createElement("input",{type:"text",readOnly:!0,onFocus:e=>{e.target.select(),this.setState({showEmbedTip:!0})},onBlur:()=>this.setState({showEmbedTip:!1}),value:s})),this.state.showEmbedTip&&wt.a.createElement("div",{className:Ai.a.embedTipWrap},wt.a.createElement("div",{className:Ai.a.embedTip},wt.a.createElement("div",{className:Ai.a.embedTipAttachPoint}),wt.a.createElement(ii.a,{id:"invite.embed-tip"})))),this.props.hasPush&&wt.a.createElement("div",{className:Ai.a.subscribe},wt.a.createElement("input",{id:"subscribe",type:"checkbox",onChange:()=>this.props.onSubscribeChanged(),checked:this.props.isSubscribed}),wt.a.createElement("label",{htmlFor:"subscribe"},wt.a.createElement(ii.a,{id:"entry.notify_me"}))),this.props.isModal&&wt.a.createElement("button",{className:Ai.a.enterVrButton,onClick:()=>this.props.onClose()},wt.a.createElement(ii.a,{id:"entry.return-to-vr"})))}}function An(){return(An=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}function kn(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Sn(xn,"propTypes",{entryCode:Qt.a.number,hubId:Qt.a.string,allowShare:Qt.a.bool,isModal:Qt.a.bool,onClose:Qt.a.func,hasPush:Qt.a.bool,isSubscribed:Qt.a.bool,onSubscribeChanged:Qt.a.func,embedUrl:Qt.a.string});class Cn extends Et.Component{constructor(e){super(e),kn(this,"state",{inviteButtonText:"invite a hubs team member"}),kn(this,"inviteClicked",()=>{this.setState({inviteButtonText:"OK! We'll be there shortly."}),this.props.hubChannel.requestSupport()})}render(){return wt.a.createElement(ji.a,An({title:"Let's Chat!"},this.props),wt.a.createElement("div",null,wt.a.createElement("div",null,wt.a.createElement("p",null,"Have an idea for Hubs? Having trouble?"),wt.a.createElement("p",null,"We'd love to chat. Someone from our team will join you in just a few minutes.")),wt.a.createElement("div",{className:"invite-team-form"},wt.a.createElement("div",{className:"invite-team-form__buttons"},wt.a.createElement(ki.b,null,wt.a.createElement("button",{className:"invite-team-form__action-button",onClick:this.inviteClicked},wt.a.createElement("span",null,this.state.inviteButtonText)))))))}}kn(Cn,"propTypes",{hubChannel:Qt.a.object});var Tn=i(1251),Rn=i.n(Tn),Mn=i(2408),Dn=i.n(Mn);class Pn extends Et.Component{render(){const{linkCode:e}=this.props;return wt.a.createElement("div",{className:Dn.a.dialog},wt.a.createElement(ki.b,null,wt.a.createElement("div",{className:Dn.a.close,onClick:()=>this.props.onClose()},wt.a.createElement("span",null,"×"))),wt.a.createElement("div",null,!e&&wt.a.createElement("div",null,wt.a.createElement("div",{className:Jt()("loading-panel",Dn.a.codeLoadingPanel)},wt.a.createElement("div",{className:"loader-wrap"},wt.a.createElement("div",{className:"loader"},wt.a.createElement("div",{className:"loader-center"}))))),e&&wt.a.createElement("div",{className:Dn.a.contents},wt.a.createElement("img",{className:Dn.a.imageHeader,src:Rn.a}),wt.a.createElement("div",{className:Dn.a.header},wt.a.createElement(ii.a,{id:"link.connect_headset"})),wt.a.createElement("div",null,wt.a.createElement(ii.a,{id:"link.in_your_browser"})),wt.a.createElement(ki.b,null,wt.a.createElement("a",{href:"https://hub.link",className:Dn.a.domain,target:"_blank",rel:"noopener noreferrer"},"hub.link")),wt.a.createElement("div",null,wt.a.createElement(ii.a,{id:"link.enter_code"})),e&&wt.a.createElement("div",{className:Dn.a.code},e.split("").map((e,t)=>wt.a.createElement("span",{className:Dn.a.digit,key:`link_code_${t}`},e))),wt.a.createElement("div",{className:Dn.a.keepOpen},wt.a.createElement(ii.a,{id:"link.do_not_close"})),wt.a.createElement(ki.b,null,wt.a.createElement("button",{className:Dn.a.closeButton,onClick:()=>this.props.onClose()},wt.a.createElement(ii.a,{id:"link.cancel"}))))))}}function On(){return(On=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}function Nn(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}!function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(Pn,"propTypes",{linkCode:Qt.a.string,onClose:Qt.a.func});class Hn extends Et.Component{constructor(...e){super(...e),Nn(this,"state",{copyLinkButtonText:"copy"}),Nn(this,"copyLinkClicked",e=>{ei()(e),this.setState({copyLinkButtonText:"copied!"})})}render(){const e=this.copyLinkClicked.bind(this,document.location);return wt.a.createElement(ji.a,On({title:"Open in Safari"},this.props),wt.a.createElement("div",null,wt.a.createElement("div",null,"Axon Park does not support your current browser on iOS. Copy and paste this link directly in Safari."),wt.a.createElement("div",{className:"invite-form"},wt.a.createElement("input",{type:"text",readOnly:!0,onFocus:e=>e.target.select(),value:document.location,className:"invite-form__link_field"}),wt.a.createElement("div",{className:"invite-form__buttons"},wt.a.createElement(ki.b,null,wt.a.createElement("button",{className:"invite-form__action-button",onClick:e},wt.a.createElement("span",null,this.state.copyLinkButtonText)))))))}}function In(){return(In=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}class jn extends Et.Component{render(){return wt.a.createElement(ji.a,In({title:"Microphone Access Required"},this.props),wt.a.createElement("div",null,wt.a.createElement("div",null,"Hubs requires microphone permissions in Safari. ",wt.a.createElement("br",null),"Please reload and allow microphone access to continue."),wt.a.createElement("div",{className:"invite-form"},wt.a.createElement("div",{className:"invite-form__buttons"},wt.a.createElement("button",{className:"invite-form__action-button",onClick:()=>location.reload()},"Reload")))))}}var Ln=i(235),Fn=i(2410),Bn=i.n(Fn);function Vn(){return(Vn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}function Un(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},a=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),a.forEach(function(t){zn(e,t,i[t])})}return e}function zn(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class Wn extends Et.Component{constructor(e){super(e),zn(this,"onSubmit",e=>{e.preventDefault(),e.stopPropagation(),this.props.onChange(this.state),this.props.onClose()}),this.state=e.initialSettings}renderCheckbox(e,t,i){return wt.a.createElement("label",{className:Jt()(Bn.a.permission,{[Bn.a.permissionDisabled]:t}),key:e},wt.a.createElement("input",{type:"checkbox",checked:this.state.member_permissions[e],disabled:t,onChange:i||(t=>this.setState({member_permissions:Un({},this.state.member_permissions,{[e]:t.target.checked})}))}),wt.a.createElement(ii.a,{id:`room-settings.${e}`}))}render(){return wt.a.createElement(ji.a,Vn({title:"Room Settings"},this.props),wt.a.createElement("form",{onSubmit:this.onSubmit,className:Bn.a.roomSettingsForm},wt.a.createElement("span",{className:Bn.a.subtitle},wt.a.createElement(ii.a,{id:"room-settings.name-subtitle"})),wt.a.createElement("input",{name:"name",type:"text",required:!0,autoFocus:!0,autoComplete:"off",placeholder:"Room name",value:this.state.name,onFocus:e=>Object(Sa.b)(e.target),onBlur:()=>Object(Sa.a)(),onChange:e=>this.setState({name:e.target.value}),className:Bn.a.nameField}),wt.a.createElement("span",{className:Bn.a.subtitle},wt.a.createElement(ii.a,{id:"room-settings.permissions-subtitle"})),wt.a.createElement("div",{className:Bn.a.permissions},this.renderCheckbox("spawn_and_move_media",!1,e=>{const t={spawn_and_move_media:e.target.checked};e.target.checked||(t.spawn_camera=!1,t.pin_objects=!1),this.setState({member_permissions:Un({},this.state.member_permissions,t)})}),wt.a.createElement("div",{className:Bn.a.permissionsGroup},this.renderCheckbox("spawn_camera",!this.state.member_permissions.spawn_and_move_media),this.renderCheckbox("pin_objects",!this.state.member_permissions.spawn_and_move_media)),this.renderCheckbox("spawn_drawing")),wt.a.createElement("button",{type:"submit",className:Bn.a.nextButton},wt.a.createElement(ii.a,{id:"room-settings.apply"}))))}}zn(Wn,"propTypes",{initialSettings:Qt.a.object,onChange:Qt.a.func,onClose:Qt.a.func});var qn=i(2412),Gn=i.n(qn);function Yn(){return(Yn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}class $n extends Et.Component{render(){return wt.a.createElement(ji.a,Yn({title:"Close Room"},this.props),wt.a.createElement("div",{className:Gn.a.message},wt.a.createElement(ii.a,{id:"close-room.message"})),wt.a.createElement("button",{className:Gn.a.confirmButton,onClick:()=>{this.props.onConfirm(),this.props.onClose()}},wt.a.createElement(ii.a,{id:"close-room.confirm"})),wt.a.createElement("button",{className:Gn.a.cancelButton,onClick:()=>this.props.onClose()},wt.a.createElement(ii.a,{id:"close-room.cancel"})))}}!function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}($n,"propTypes",{onConfirm:Qt.a.func,onClose:Qt.a.func});var Xn=i(2414),Qn=i.n(Xn);const Kn=["feedback","invite","object_pin"],Jn=["feedback"];let Zn=null,es={};const ts=AFRAME.utils.device.isMobile(),is=AFRAME.utils.device.isMobileVR(),as=()=>is?"standalone":ts?"mobile":"desktop",ns={desktop:{top:["pen_mode","video_share_mode","mute_mode"],bottom:["look","locomotion","turning","spawn_menu","object_grab","object_zoom","object_scale","freeze_gesture","menu_hover","object_recenter_button","object_rotate_button","object_scale_button","object_pin","invite","pen_color","pen_size","feedback"]},mobile:{top:["pen_mode","video_share_mode","freeze_mode","mute_mode"],bottom:["look","locomotion","spawn_menu","object_grab","freeze_gesture","object_recenter_button","object_rotate_button","object_scale_button","object_pin","invite","feedback"]},standalone:{top:[],bottom:[]}}[as()],ss=e=>(null===Zn&&(Zn=JSON.parse(localStorage.getItem("__hubs_finished_tips"))),!(!Zn[e]||!Zn[e].finished)),os=e=>{const t=JSON.parse(localStorage.getItem("__hubs_finished_tips"));t[e]={finished:!0},localStorage.setItem("__hubs_finished_tips",JSON.stringify(t)),Zn=null},rs=(e,t)=>{const i=e.split(".")[1],a=Kn.includes(i)?[i]:ns[t];for(let e=0;e<a.length;e++){const t=a[e];Jn.includes(t)&&t!==i||os(t)}},cs={look:function(e){if(e.activeSets.includes(bt.cursorHoldingPen))return 0;return e.get(ts?x.a.device.touchscreen.touchCameraDelta:x.a.device.smartMouse.cameraDelta)?2:1},locomotion:function(e){if(e.activeSets.includes(bt.cursorHoldingPen))return 0;const t=e.get(x.a.actions.characterAcceleration);return!t||0===t[0]&&0===t[1]?1:2},turning:function(e){return e.activeSets.includes(bt.cursorHoldingPen)?0:e.get(x.a.actions.snapRotateLeft)||e.get(x.a.actions.snapRotateRight)?2:1},spawn_menu:function(e,t,i){return e.activeSets.includes(bt.cursorHoldingPen)?0:0===i.count()?1:2},freeze_gesture:function(e,t,i){return 0===i.count()?0:e.activeSets.includes(bt.cursorHoldingInteractable)?0:e.activeSets.includes(bt.cursorHoldingPen)?0:t.is("frozen")&&e.activeSets.includes(bt.cursorHoveringOnInteractable)?2:t.is("frozen")?0:1},menu_hover:function(e,t,i){return 0===i.count()?0:t.is("frozen")?e.activeSets.includes(bt.cursorHoldingPen)?0:t.is("frozen")&&e.activeSets.includes(bt.cursorHoveringOnInteractable)?2:1:0},invite:function(e,t){return e.activeSets.includes(bt.cursorHoldingPen)?0:e.activeSets.includes(bt.cursorHoldingCamera)?0:e.activeSets.includes(bt.cursorHoldingInteractable)?0:t.is("copresent")?2:1},object_grab:function(e,t,i){return t.is("frozen")?0:0===i.count()?0:e.activeSets.includes(bt.cursorHoldingPen)?0:e.activeSets.includes(bt.cursorHoldingCamera)?0:e.activeSets.includes(bt.cursorHoldingInteractable)?2:1},object_rotate_button:function(e,t,i,a){return t.is("frozen")?0===i.count()?0:a&&a.state.activity.hasRotated?2:1:0},object_scale_button:function(e,t,i,a){return t.is("frozen")?0===i.count()?0:a&&a.state.activity.hasScaled?2:1:0},object_recenter_button:function(e,t,i,a){return t.is("frozen")?0===i.count()?0:a&&a.state.activity.hasRecentered?2:1:0},object_pin:function(e,t,i,a){return t.is("frozen")?0===i.count()?0:a&&a.state.activity.hasPinned?2:1:0},object_zoom:function(e,t){return t.is("frozen")?0:e.activeSets.includes(bt.cursorHoldingPen)?0:e.activeSets.includes(bt.cursorHoldingCamera)?0:e.activeSets.includes(bt.cursorHoldingInteractable)?e.get(x.a.actions.cursor.modDelta)?2:1:0},object_scale:function(e,t){return t.is("frozen")?0:e.activeSets.includes(bt.cursorHoldingPen)?0:e.activeSets.includes(bt.cursorHoldingCamera)?0:e.activeSets.includes(bt.cursorHoldingInteractable)?e.get(x.a.actions.cursor.scaleGrabbedGrabbable)?2:1:0},pen_color:function(e){return e.activeSets.includes(bt.cursorHoldingPen)?e.get(x.a.actions.cursor.penNextColor)||e.get(x.a.actions.cursor.penPrevColor)?2:1:0},pen_size:function(e){return e.activeSets.includes(bt.cursorHoldingPen)?e.get(x.a.actions.cursor.scalePenTip)?2:1:0},pen_mode:function(e){return e.activeSets.includes(bt.cursorHoldingPen)?1:0},freeze_mode:function(e,t){return t.is("frozen")?1:0},video_share_mode:function(e,t){return t.is("sharing_video")?1:0},mute_mode:function(e,t){return t.is("muted")?1:0},feedback:function(e,t,i,a){return a&&a.state.activity.entryCount>=3?1:0}};AFRAME.registerSystem("tips",{init:function(){this.activeTips={},this._finishedScopes={},this._performStep=this._performStep.bind(this),null===localStorage.getItem("__hubs_finished_tips")&&localStorage.setItem("__hubs_finished_tips",JSON.stringify({}))},tick:function(){if(is)return;if(!this._userinput&&(this._userinput=this.el.systems.userinput,!this._userinput))return;if(!this._mediaCounter&&(this._mediaCounter=document.querySelector("#media-counter")&&document.querySelector("#media-counter").components["networked-counter"],!this._mediaCounter))return;const e=ns,t=this.activeTips.top,i=this.activeTips.bottom;this._performStep(e.top,"top"),this._performStep(e.bottom,"bottom"),t===this.activeTips.top&&i===this.activeTips.bottom||this.el.emit("tips_changed",this.activeTips)},_performStep:function(e,t){if(es[t])return;let i=null,a=0;for(let t=0;t<e.length;t++){const n=e[t];if(ss(n))a++;else{switch(cs[n](this._userinput,this.el,this._mediaCounter,window.APP.store)){case 2:os(n);break;case 1:i=`${as()}.${n}`}if(i)break}}this.activeTips[t]=i,a===e.length&&(es[t]=!0)}});class ls extends Et.Component{render(){const{tip:e,tipRegion:t,broadcastTarget:i,pushHistoryState:a}=this.props;let n;return n=[".spawn_menu","_button"].find(t=>e.endsWith(t))?wt.a.createElement("div",{className:Qn.a.splitTip},wt.a.createElement(ii.a,{id:`tips.${e}-pre`}),wt.a.createElement("div",{className:Jt()({[Qn.a.splitTipIcon]:!0,[Qn.a[e.split(".")[1]+"-icon"]]:!0})}),wt.a.createElement(ii.a,{id:`tips.${e}-post`})):"discord"===e?wt.a.createElement("div",{className:Qn.a.tip},wt.a.createElement("span",null,`Chat in this room is being bridged to ${i} on Discord.`)):"embed"===e?wt.a.createElement("div",{className:Qn.a.tip},wt.a.createElement(ii.a,{id:"embed.presence-warning"})):e.endsWith(".feedback")?wt.a.createElement("div",{className:Qn.a.tip},wt.a.createElement(ii.a,{id:`tips.${e}`})," ",wt.a.createElement("button",{className:Qn.a.tipLink,onClick:()=>{rs(e,t),a("modal","feedback")}},wt.a.createElement(ii.a,{id:`tips.${e}-link`}))):wt.a.createElement("div",{className:Qn.a.tip},wt.a.createElement(ii.a,{id:`tips.${e}`})),wt.a.createElement("div",{className:Qn.a.tipRoot},wt.a.createElement("button",{className:Qn.a.tipCancel,onClick:()=>this.props.onClose?this.props.onClose(e,t):rs(e,t)},wt.a.createElement("i",null,wt.a.createElement(ya.a,{icon:xa.faTimes}))),n)}}function ds(){return(ds=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}!function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(ls,"propTypes",{history:Qt.a.object,tip:Qt.a.string,tipRegion:Qt.a.string,broadcastTarget:Qt.a.string,pushHistoryState:Qt.a.func,onClose:Qt.a.func});class hs extends Et.Component{render(){return wt.a.createElement(ji.a,ds({title:"Share Screen"},this.props),wt.a.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},wt.a.createElement("p",null,"Your browser doesn't seem to support screen sharing.",wt.a.createElement("br",null),"To share your screen in Hubs, you can use Firefox."),wt.a.createElement("a",{className:"info-dialog--action-button",target:"_blank",rel:"noreferrer noopener",href:"https://www.mozilla.org/firefox"},"Download Firefox"),wt.a.createElement("p",{style:{fontSize:"0.8em"}},"You can try ",wt.a.createElement("a",{href:"https://www.webrtc-experiment.com/screen-sharing/#5591174797993739",target:"_blank",rel:"noopener noreferrer"},"testing WebRTC screen sharing")," in your browser.")))}}function us(){return(us=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}class ps extends Et.Component{render(){return wt.a.createElement(ji.a,us({title:"WebAssembly Unsupported"},this.props),wt.a.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},wt.a.createElement("p",null,"Your browser doesn't seem to support WebAssembly.",wt.a.createElement("br",null),"Please update or switch to a newer browser.")))}}function ms(){return(ms=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}class gs extends Et.Component{render(){return wt.a.createElement(ji.a,ms({title:"Enter in VR"},this.props),wt.a.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},wt.a.createElement("p",null,"To enter with Oculus or SteamVR, you can use Firefox."),wt.a.createElement(ki.b,null,wt.a.createElement("a",{className:"info-dialog--action-button",href:"https://www.mozilla.org/firefox",target:"_blank",rel:"noreferrer noopener"},"Download Firefox")),wt.a.createElement("p",{style:{fontSize:"0.8em"}},"For a list of browsers with experimental VR support, visit"," ",wt.a.createElement(ki.b,null,wt.a.createElement("a",{href:"https://webvr.rocks",target:"_blank",rel:"noopener noreferrer"},"WebVR Rocks")))))}}var vs=i(2421),fs=i.n(vs);function bs(){return(bs=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}class ys extends Et.Component{render(){return wt.a.createElement(ji.a,bs({wide:!0,title:""},this.props),wt.a.createElement("iframe",{className:fs.a.formFrame,src:"https://docs.google.com/forms/d/e/1FAIpQLSe1C-7hCA1XMT8IL8XBnjlxMAU1JXrwAW8YkbmbBJ4B3pDSsw/viewform?embedded=true",frameBorder:"0",marginHeight:"0",marginWidth:"0"},"Loading..."))}}var _s=i(2423),Es=i.n(_s);function ws(){return(ws=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}class Ss extends Et.Component{render(){return wt.a.createElement(ji.a,ws({title:"Leave Room"},this.props),wt.a.createElement("div",{className:Es.a.leaveRoom},wt.a.createElement("div",null,wt.a.createElement(ii.a,{id:`leave-room-dialog.${this.props.messageType}.message`})),wt.a.createElement("a",{href:this.props.destinationUrl,rel:"noopener noreferrer"},wt.a.createElement(ii.a,{id:`leave-room-dialog.${this.props.messageType}.confirm`}))))}}!function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(Ss,"propTypes",{messageType:Qt.a.string,destinationUrl:Qt.a.string});var xs=i(2425),As=i.n(xs);function ks(){return(ks=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}class Cs extends Et.Component{render(){const e=(e,t)=>{if(e.url){const i=e.url.includes("sketchfab.com")?"on Sketchfab":e.url.includes("poly.google.com")?"on Google Poly":"";return wt.a.createElement("div",{className:As.a.attribution,key:`${e.url} ${t}`},wt.a.createElement("div",{className:As.a.attributionName},wt.a.createElement("a",{href:e.url,target:"_blank",rel:"noopener noreferrer"},e.name)),wt.a.createElement("div",{className:As.a.attributionAuthor},"by ",e.author," ",i))}return wt.a.createElement("div",{className:As.a.attribution,key:`${e.name} ${e.author} {i}`},wt.a.createElement("div",{className:As.a.attributionName},e.name),wt.a.createElement("div",{className:As.a.attributionAuthor},"by ",e.author))};let t=null,i=null;this.props.scene.attributions&&(i=this.props.scene.attributions.creator,t=wt.a.createElement("div",null,this.props.scene.attributions.content&&this.props.scene.attributions.content.map(e)));const a=wt.a.createElement("div",{className:As.a.title},this.props.hubName);return wt.a.createElement(ji.a,ks({title:a,wide:!0},this.props),wt.a.createElement("div",{className:As.a.roomInfo},wt.a.createElement("div",{className:As.a.sceneScreenshot},wt.a.createElement("a",{href:this.props.scene.url,target:"_blank",rel:"noopener noreferrer"},wt.a.createElement("img",{src:Object(X.h)(this.props.scene.screenshot_url,400,480)}))),wt.a.createElement("div",{className:As.a.sceneDetails},wt.a.createElement("div",{className:As.a.sceneMain},wt.a.createElement("div",{className:As.a.sceneName},wt.a.createElement("a",{href:this.props.scene.url,target:"_blank",rel:"noopener noreferrer"},this.props.scene.name)),wt.a.createElement("div",{className:As.a.sceneCreator},i)),wt.a.createElement("div",{className:As.a.sceneAttributions},t),wt.a.createElement("div",{className:As.a.sceneButtons}," "))))}}!function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(Cs,"propTypes",{hubName:Qt.a.string,scene:Qt.a.object});var Ts=i(2427),Rs=i.n(Ts);function Ms(){return(Ms=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}class Ds extends Et.Component{renderSignInDisclaimer(e){return wt.a.createElement("div",null,wt.a.createElement("div",null,"You'll need to sign in to ",wt.a.createElement("span",{className:Rs.a.oauthTypeName},e)," to access this room."),wt.a.createElement("br",null),wt.a.createElement("div",null,"We'll ask for access to your e-mail address so you can skip signing in next time."),wt.a.createElement("p",{className:Rs.a.privacyNotice},"By proceeding, you agree to the"," ",wt.a.createElement("a",{rel:"noopener noreferrer",target:"_blank",href:"https://github.com/mozilla/hubs/blob/master/TERMS.md"},"terms of use")," ","and"," ",wt.a.createElement("a",{rel:"noopener noreferrer",target:"_blank",href:"https://github.com/mozilla/hubs/blob/master/PRIVACY.md"},"privacy notice"),"."))}renderTweetDisclaimer(){return wt.a.createElement("div",{className:Rs.a.twitterMessage},wt.a.createElement(ii.a,{id:"oauth-dialog.message.twitter"}))}render(){const e=this.props.oauthInfo&&this.props.oauthInfo[0],t=e&&"twitter"===e.type;return wt.a.createElement(ji.a,Ms({title:"",closable:t},this.props),wt.a.createElement("div",null,e&&("twitter"===e.type?this.renderTweetDisclaimer():this.renderSignInDisclaimer(e.type)),wt.a.createElement("div",{className:"invite-form"},wt.a.createElement("div",{className:`invite-form__buttons ${Rs.a.oauthButtons}`},e?wt.a.createElement("a",{href:e.url,key:e.type,className:Jt()({[Rs.a.oauthButton]:!0,[Rs.a.oauthTwitterButton]:"twitter"===e.type,[Rs.a.oauthDiscordButton]:"discord"===e.type})},wt.a.createElement(ii.a,{id:`oauth-dialog.sign-in.${e.type}`})):wt.a.createElement("div",{className:"loader-wrap loader-mid"},wt.a.createElement("div",{className:"loader"},wt.a.createElement("div",{className:"loader-center"})))))))}}!function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(Ds,"propTypes",{oauthInfo:Qt.a.array});var Ps=i(2429),Os=i.n(Ps),Ns=i(1075),Hs=i.n(Ns),Is=i(1252),js=i.n(Is),Ls=i(1253),Fs=i.n(Ls),Bs=i(1254),Vs=i.n(Bs),Us=i(1255),zs=i.n(Us),Ws=i(127);i(2431),i(2433),i(2435),i(2437);function qs(){return(qs=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}function Gs(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}const Ys=js()(),$s=Fs()(),Xs=Vs()(),Qs=zs()(),Ks=(e,t)=>{const i=t.getCurrentContent(),a=i.createEntity("emoji","IMMUTABLE",{emojiUnicode:e}).getLastCreatedEntityKey(),n=t.getSelection();let s,o=0,r=0;const c=Ws.Modifier.removeRange(i,n,"backward"),l=c.getSelectionAfter();s=Ws.Modifier.insertText(c,l,e,null,a),o=l.getAnchorOffset();const d=l.getAnchorKey();o===(r=i.getBlockForKey(d).getLength())&&(s=Ws.Modifier.insertText(s,s.getSelectionAfter()," "));const h=Ws.EditorState.push(t,s,"insert-emoji");return Ws.EditorState.forceSelection(h,s.getSelectionAfter())};class Js extends Et.Component{constructor(e){super(),this.state={editorState:Object(Ns.createEditorStateWithText)(e.history.location.state.detail.text||""),suggestions:[]}}componentDidMount(){setTimeout(()=>{this.editorRef.focus(),this.setState({editorState:Ks("🐤",this.state.editorState)})})}sendTweet(){var e,t=this;return(e=function*(){const e={media_stored_file_url:t.props.history.location.state.detail.url,body:t.state.editorState.getCurrentContent().getPlainText()};t.setState({posting:!0}),yield Object(s.d)("/api/v1/twitter/tweets","POST",e),t.setState({posting:!1,posted:!0})},function(){var t=this,i=arguments;return new Promise(function(a,n){var s=e.apply(t,i);function o(e){Gs(s,a,n,o,r,"next",e)}function r(e){Gs(s,a,n,o,r,"throw",e)}o(void 0)})})()}renderPostedDialog(){return wt.a.createElement(ji.a,qs({wide:!0,allowOverflow:!0,closable:!1,title:""},this.props),wt.a.createElement("div",{className:Os.a.posted},wt.a.createElement("div",{className:Os.a.message},wt.a.createElement(ii.a,{id:"tweet-dialog.posted"})),wt.a.createElement("div",{className:Os.a.buttons},wt.a.createElement("button",{className:Os.a.tweetButton,onClick:()=>this.props.onClose()},wt.a.createElement(ii.a,{id:"tweet-dialog.close"})))))}renderTweetDialog(){const{EmojiSuggestions:e,EmojiSelect:t}=Ys,{CharCounter:i}=Qs,{url:a,contentSubtype:n}=this.props.history.location.state.detail;return wt.a.createElement(ji.a,qs({wide:!0,allowOverflow:!0,title:"",additionalClass:Os.a.dialogBackground},this.props),wt.a.createElement("div",{className:Os.a.tweet},wt.a.createElement("div",{className:Os.a.editor,onClick:()=>this.editorRef.focus()},wt.a.createElement("div",{className:Os.a.editorInner},wt.a.createElement(Hs.a,{ref:e=>this.editorRef=e,editorState:this.state.editorState,onChange:e=>this.setState({editorState:e}),plugins:[Ys,$s,Xs,Qs]})),wt.a.createElement("div",{className:Os.a.emojiButton},wt.a.createElement(t,null)),wt.a.createElement("div",{className:Os.a.emojiSuggestions},wt.a.createElement(e,null)),this.state.editorState.getCurrentContent().getPlainText().length>200&&wt.a.createElement("div",{className:Os.a.counter},wt.a.createElement(i,{editorState:this.state.editorState,limit:280})," / 280"),wt.a.createElement("div",{className:Os.a.media},n&&n.startsWith("video")?wt.a.createElement("video",{src:a,width:450,height:255,controls:!0}):wt.a.createElement("img",{src:Object(X.h)(a,450,255)}))),this.state.posting?wt.a.createElement("div",{className:Jt()(["loader-wrap","loader-mid",Os.a.tweetLoader])},wt.a.createElement("div",{className:"loader"},wt.a.createElement("div",{className:"loader-center"}))):wt.a.createElement("div",{className:Os.a.buttons},wt.a.createElement("button",{className:Os.a.tweetButton,onClick:()=>this.sendTweet(),disabled:this.state.editorState.getCurrentContent().getPlainText().length>280},wt.a.createElement(ii.a,{id:"tweet-dialog.tweet"})))))}render(){return this.state.posted?this.renderPostedDialog():this.renderTweetDialog()}}!function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(Js,"propTypes",{history:Qt.a.object,onClose:Qt.a.func});var Zs=i(2439),eo=i.n(Zs),to=i(596);function io(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class ao extends Et.Component{constructor(...e){super(...e),io(this,"state",{pendingMessage:""}),io(this,"sendMessage",e=>{e.preventDefault(),this.props.onSendMessage&&this.props.onSendMessage(this.state.pendingMessage),this.setState({pendingMessage:""})})}render(){const e=this.state.pendingMessage.split("\n").length,t=28*e+"px",i=28*e+20+"px",a=this.props.discordBridges.map(e=>"#"+e).join(", "),n=`${this.props.occupantCount-1} other${this.props.occupantCount>2?"s":""}`,s=this.props.occupantCount<=1?"Nobody is here yet...":this.props.discordBridges.length?`Send message to ${n} and ${a}...`:`Send message to ${n}...`;return wt.a.createElement("form",{onSubmit:this.sendMessage},wt.a.createElement("div",{className:Jt()({[eo.a.messageEntry]:!0,[eo.a.messageEntryDisabled]:this.props.occupantCount<=1}),style:{height:i}},wt.a.createElement("textarea",{className:Jt()([eo.a.messageEntryInput,"chat-focus-target"]),value:this.state.pendingMessage,rows:e,style:{height:t},onFocus:e=>Object(Sa.b)(e.target),onBlur:()=>Object(Sa.a)(),onChange:e=>this.setState({pendingMessage:e.target.value}),disabled:this.props.occupantCount<=1,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey?"Escape"===e.key&&e.target.blur():this.sendMessage(e)},placeholder:s}),wt.a.createElement(ki.b,null,wt.a.createElement("button",{className:Jt()([eo.a.messageEntryButton,eo.a.messageEntrySubmit]),disabled:this.props.occupantCount<=1,type:"submit"},wt.a.createElement("i",null,wt.a.createElement(ya.a,{icon:to.faPaperPlane}))))))}}io(ao,"propTypes",{discordBridges:Qt.a.array,occupantCount:Qt.a.number,onSendMessage:Qt.a.func});var no=ao,so=i(2443),oo=i.n(so);class ro extends Et.Component{render(){const e=["leave","fly","grow","shrink","duck","debug","vrstats","scene <scene url>","rename <new name>"];return Object(U.a)("video_capture")&&e.push("capture [stop]"),wt.a.createElement("div",{className:Jt()({[oo.a.commandHelp]:!0,[oo.a.commandHelpOnTop]:this.props.onTop})},e.map(e=>(""===this.props.matchingPrefix||e.split(" ")[0].startsWith(this.props.matchingPrefix.split(" ")[0]))&&wt.a.createElement("div",{className:oo.a.entry,key:e},wt.a.createElement("div",{className:oo.a.command},"/",e),wt.a.createElement("div",null,wt.a.createElement(ii.a,{id:`commands.${e.split(" ")[0]}`})))))}}!function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(ro,"propTypes",{matchingPrefix:Qt.a.string,onTop:Qt.a.bool});var co=i(1256),lo=i(214),ho=i(2445),uo=i.n(ho),po=i(1257),mo=i.n(po),go=i(1076);const vo={},fo={BASE:!0,HEAD:!0,HTML:!0,META:!0,NOFRAME:!0,NOSCRIPT:!0,PARAM:!0,SCRIPT:!0,STYLE:!0,TITLE:!0},bo=["A","ABBR","ADDRESS","AREA","ARTICLE","ASIDE","AUDIO","B","BASE","BDI","BDO","BLOCKQUOTE","BODY","BR","BUTTON","CANVAS","CAPTION","CENTER","CITE","CODE","COL","COLGROUP","COMMAND","DATALIST","DD","DEL","DETAILS","DFN","DIV","DL","DT","EM","EMBED","FIELDSET","FIGCAPTION","FIGURE","FONT","FOOTER","FORM","H1","H2","H3","H4","H5","H6","HEAD","HEADER","HGROUP","HR","HTML","I","IFRAME","IMG","INPUT","INS","KBD","KEYGEN","LABEL","LEGEND","LI","LINK","MAP","MARK","MATH","MENU","META","METER","NAV","NOBR","NOSCRIPT","OBJECT","OL","OPTION","OPTGROUP","OUTPUT","P","PARAM","PRE","PROGRESS","Q","RP","RT","RUBY","S","SAMP","SCRIPT","SECTION","SELECT","SMALL","SOURCE","SPAN","STRONG","STYLE","SUB","SUMMARY","SUP","SVG","TABLE","TBODY","TD","TEXTAREA","TFOOT","TH","THEAD","TIME","TITLE","TR","TRACK","U","UL","VAR","VIDEO","WBR"];function yo(e){const t={},i=document.body.appendChild(document.createElement(e)),a=getComputedStyle(i);for(let e=0;e<a.length;e++)t[a[e]]=a[a[e]];return document.body.removeChild(i),t}function _o(){for(let e=0;e<bo.length;e++)fo[bo[e]]||(vo[bo[e]]=yo(bo[e]))}var Eo=i(2448),wo=i.n(Eo),So=i(1258),xo=i.n(So),Ao=i(1259),ko=i.n(Ao),Co=i(1260),To=i.n(Co),Ro=i(1261),Mo=i.n(Ro),Do=i(1262),Po=i.n(Do),Oo=i(514),No=i(1263);function Ho(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Io(e,t){const i=new URLSearchParams(e.location.search);"dev.reticulum.io"!==document.location.host?(i.set("client_id",t),Object(kt.d)(e,e.location.pathname,i.toString())):Object(kt.d)(e,Object(kt.h)(e.location,`/clients/${t}`),i.toString())}class jo extends Et.Component{constructor(...e){super(...e),Ho(this,"state",{expanded:!1}),Ho(this,"navigateToClientInfo",e=>{Io(this.props.history,e)}),Ho(this,"domForPresence",([e,t])=>{const i=t.metas[t.metas.length-1],a=i.context,n=i.profile,s=i.streaming||i.recording?Mo.a:function(e){return e&&e.mobile?xo.a:e&&e.hmd?Po.a:e&&e.discord?To.a:ko.a}(a),o=a&&a.discord,r=i.roles&&i.roles.owner&&wt.a.createElement("span",{className:wo.a.moderatorBadge,title:"Moderator"},"★");return wt.a.createElement(ki.b,{key:e},wt.a.createElement("div",{className:wo.a.row},wt.a.createElement("div",{className:wo.a.icon},wt.a.createElement("img",{src:s})),wt.a.createElement("div",{className:Jt()({[wo.a.listItem]:!0})},e===this.props.sessionId?wt.a.createElement(Ci.a,{className:wo.a.self,stateKey:"overlay",stateValue:"profile",history:this.props.history},n&&n.displayName,r,wt.a.createElement("i",null,wt.a.createElement(ya.a,{icon:ba.faPencilAlt}))):wt.a.createElement("div",null,o?wt.a.createElement("span",null,n&&n.displayName):wt.a.createElement("button",{className:wo.a.clientLink,onClick:()=>this.navigateToClientInfo(e)},n&&n.displayName),r)),wt.a.createElement("div",{className:wo.a.presence},wt.a.createElement(ii.a,{id:`presence.in_${i.presence}`}))))})}componentDidMount(){document.querySelector(".a-canvas").addEventListener("mouseup",()=>{this.state.expanded&&this.setState({expanded:!1})})}renderExpandedList(){return wt.a.createElement("div",{className:wo.a.presenceList},wt.a.createElement("div",{className:wo.a.attachPoint}),wt.a.createElement("div",{className:wo.a.contents},wt.a.createElement("div",{className:wo.a.rows},Object.entries(this.props.presences||{}).filter(([e])=>e===this.props.sessionId).map(this.domForPresence),Object.entries(this.props.presences||{}).filter(([e])=>e!==this.props.sessionId).map(this.domForPresence)),wt.a.createElement("div",{className:wo.a.signIn},this.props.signedIn?wt.a.createElement("div",null,wt.a.createElement("span",null,wt.a.createElement(ii.a,{id:"sign-in.as"})," ",Object(Oo.a)(this.props.email))," ",wt.a.createElement("a",{onClick:this.props.onSignOut},wt.a.createElement(ii.a,{id:"sign-in.out"}))):wt.a.createElement("a",{onClick:this.props.onSignIn},wt.a.createElement(ii.a,{id:"sign-in.in"})))))}render(){const e=this.props.presences?Object.entries(this.props.presences).length:0;return wt.a.createElement("div",null,wt.a.createElement("div",{onClick:()=>this.setState({expanded:!this.state.expanded}),className:Jt()({[Ei.a.presenceInfo]:!0,[Ei.a.presenceInfoSelected]:this.state.expanded})},wt.a.createElement(ya.a,{icon:No.faUsers}),wt.a.createElement("span",{className:Ei.a.occupantCount},e)),this.state.expanded&&this.renderExpandedList())}}function Lo(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}function Fo(e){return function(){var t=this,i=arguments;return new Promise(function(a,n){var s=e.apply(t,i);function o(e){Lo(s,a,n,o,r,"next",e)}function r(e){Lo(s,a,n,o,r,"throw",e)}o(void 0)})}}Ho(jo,"propTypes",{presences:Qt.a.object,history:Qt.a.object,sessionId:Qt.a.string,signedIn:Qt.a.bool,email:Qt.a.string,onSignIn:Qt.a.func,onSignOut:Qt.a.func});const Bo=document.createElement("canvas"),Vo=/(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|[\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|[\ud83c[\ude32-\ude3a]|[\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/,Uo=/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_+.~#?&\/\/=]*)$/,zo=new THREE.TextureLoader,Wo=(e,t,i,a,n)=>{const s=e.split("\n").length>1,o=s?uo.a.messageWrapMulti:uo.a.messageWrap,r=e.startsWith("`")&&e.endsWith("`"),c={[uo.a.messageBody]:!0,[uo.a.messageBodyMulti]:s,[uo.a.messageBodyMono]:r},l=a&&i&&n&&NAF.clientId!==i,d=l?()=>Io(n,i):()=>{};s||(e=(e=>{const t=e.split(" "),i=[];let a=0;for(let e=0;e<t.length;e++){const n=t[e];n.startsWith(":")&&n.endsWith(":")?a++:a+=n.length,i.push(n),a>=40&&(a=0,i.push("\n"))}return i.join(" ")})(e));const h=(r?e.substring(1,e.length-1):e).trim();return wt.a.createElement("div",{className:o},t&&wt.a.createElement("div",{onClick:d,className:Jt()({[uo.a.messageSource]:!0,[uo.a.messageSourceLink]:l})},t,":"),wt.a.createElement("div",{className:Jt()(c)},wt.a.createElement(mo.a,{properties:{target:"_blank",rel:"noopener referrer"}},Object(go.toArray)(h))))};function qo(e,t,i,a){const n=1===e.split("\n").length,s=Bo.getContext("2d"),o=Object(go.toArray)(e),r=i&&1===o.length&&o[0].props&&o[0].props.children.match&&o[0].props.children.match(Vo),c=document.createElement("div");c.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),c.setAttribute("class",`${uo.a.presenceLog} ${uo.a.presenceLogSpawn}`),document.body.appendChild(c);const l=wt.a.createElement("div",{className:Jt()({[uo.a.presenceLogEntry]:!r,[uo.a.presenceLogEntryOneLine]:!r&&n,[uo.a.presenceLogEmoji]:r})},Wo(e,t));return new Promise(e=>{_t.a.render(l,c,()=>{let t="8.33%",i=12;a&&(t="25%",i=4),Bo.width=c.offsetWidth*(i+.1),Bo.height=c.offsetHeight*(i+.1);const n=encodeURIComponent(`\n          <svg xmlns="http://www.w3.org/2000/svg" width="${Bo.width}" height="${Bo.height}">\n            <foreignObject width="${t}" height="${t}" style="transform: scale(${i});">\n              ${function(e){if(0===Object.keys(vo).length&&_o(),e.nodeType!==Node.ELEMENT_NODE)throw new TypeError;const t=[],i=e.querySelectorAll("*");for(let e=0;e<i.length;e++){const n=i[e];if(!fo[n.tagName]){const i=getComputedStyle(n),s=(a=(a=n.tagName).toUpperCase(),vo[a]||(vo[a]=yo(a)),vo[a]);t[e]=n.style.cssText;for(let e=0;e<i.length;e++){const t=i[e];t.startsWith("-webkit")||i[t]!==s[t]&&(n.style[t]=i[t])}}}var a;const n=e.outerHTML;for(let e=0;e<i.length;e++)i[e].style.cssText=t[e];return n}(c)}\n            </foreignObject>\n          </svg>\n    `),o=new Image;o.onload=Fo(function*(){s.drawImage(o,0,0);const t=yield new Promise(e=>Bo.toBlob(e));_t.a.unmountComponentAtNode(c),c.remove(),e(t)}),o.src="data:image/svg+xml,"+n})})}function Go(){return(Go=Fo(function*({name:e,type:t,body:i}){if("chat"!==t)return;const a=AFRAME.utils.device.isMobile()||AFRAME.utils.device.isMobileVR(),n=yield qo(i,e,!1,a),s=document.createElement("a-entity"),o=document.createElement("a-entity");document.querySelector("a-scene").appendChild(s),s.appendChild(o),s.setAttribute("follow-in-fov",{target:"#player-camera",offset:{x:0,y:0,z:-.8}});const r=URL.createObjectURL(n);o.setAttribute("animation__float",{property:"position",dur:1e4,from:{x:0,y:0,z:0},to:{x:0,y:.05,z:-.05},easing:"easeOutQuad"}),s.setAttribute("animation__spawn",{property:"scale",dur:200,from:{x:.1,y:.1,z:.1},to:{x:1,y:1,z:1},easing:"easeOutElastic"}),o.setAttribute("animation__opacity",{property:"meshMaterial.opacity",isRawProperty:!0,delay:3e3,dur:8e3,from:1,to:0,easing:"easeInQuad"}),o.addEventListener("animationcomplete__opacity",()=>{s.parentNode.removeChild(s)}),zo.load(r,e=>{const t=new THREE.MeshBasicMaterial;t.transparent=!0,t.map=e,t.generateMipmaps=!1,t.needsUpdate=!0;const i=new THREE.PlaneBufferGeometry(1,1,1,1,e.flipY),n=new THREE.Mesh(i,t);o.setObject3D("mesh",n),o.meshMaterial=t;const s=4e3/(a?3:1);o.object3DMap.mesh.scale.set(e.image.width/s,e.image.height/s,1)})})).apply(this,arguments)}function Yo(e,t){return $o.apply(this,arguments)}function $o(){return($o=Fo(function*(e,t){if(0===e.length)return;if(e.match(Uo))return void document.querySelector("a-scene").emit("add_media",e);const i=yield qo(e,t,!0,!1);document.querySelector("a-scene").emit("add_media",new File([i],"message.png",{type:"image/png"}))})).apply(this,arguments)}function Xo(e){return wt.a.createElement("div",{className:e.className},e.maySpawn&&wt.a.createElement("button",{className:Jt()(uo.a.iconButton,uo.a.spawnMessage),onClick:()=>Yo(e.body)}),Wo(e.body,e.name,e.sessionId,e.includeFromLink,e.history))}function Qo(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Xo.propTypes={name:Qt.a.string,maySpawn:Qt.a.bool,body:Qt.a.string,sessionId:Qt.a.string,history:Qt.a.object,className:Qt.a.string,includeFromLink:Qt.a.bool};const Ko=AFRAME.utils.device.isMobile();class Jo extends Et.Component{constructor(...e){super(...e),Qo(this,"state",{pendingMessage:""}),Qo(this,"sendMessage",e=>{e.preventDefault(),this.props.onSendMessage&&this.props.onSendMessage(this.state.pendingMessage),this.setState({pendingMessage:""})})}render(){const e=this.state.pendingMessage.split("\n").length,t=28*e+"px",i=28*e+20+"px",a=this.props.discordBridges.map(e=>"#"+e).join(", ");return wt.a.createElement("form",{onSubmit:this.sendMessage},wt.a.createElement("div",{className:Jt()({[eo.a.messageEntryInRoom]:!0,[eo.a.messageEntryOnMobile]:Ko}),style:{height:i}},this.state.pendingMessage.startsWith("/")&&wt.a.createElement(ro,{matchingPrefix:this.state.pendingMessage.substring(1)}),wt.a.createElement("input",{id:"message-entry-media-input",type:"file",style:{display:"none"},accept:Ko?"image/*":"*",multiple:!0,onChange:e=>{if(this.props.onObjectCreated)for(const t of e.target.files)this.props.onObjectCreated(t)}}),this.props.enableSpawning&&wt.a.createElement("label",{htmlFor:"message-entry-media-input",title:"Upload",className:Jt()([eo.a.messageEntryButton,eo.a.messageEntryButtonInRoom,eo.a.messageEntryUpload])},wt.a.createElement("i",null,wt.a.createElement(ya.a,{icon:Ko?co.faCamera:lo.faPlus}))),wt.a.createElement("textarea",{style:{height:t},className:Jt()([eo.a.messageEntryInput,eo.a.messageEntryInputInRoom,"chat-focus-target",!this.props.enableSpawning&&eo.a.messageEntryInputNoSpawn]),value:this.state.pendingMessage,rows:e,onFocus:e=>{Object(Sa.b)(e.target)},onBlur:()=>{Object(Sa.a)()},onChange:e=>{e.stopPropagation(),this.setState({pendingMessage:e.target.value})},onKeyDown:e=>{"Enter"!==e.key||e.ctrlKey||e.shiftKey?"Enter"===e.key&&e.ctrlKey?(Yo(e.target.value),this.setState({pendingMessage:""}),e.target.blur()):"Escape"===e.key&&e.target.blur():this.sendMessage(e)},placeholder:this.props.discordBridges.length?`Send to room and ${a}...`:"Send to room..."}),this.props.enableSpawning&&wt.a.createElement("button",{className:Jt()([eo.a.messageEntrySpawn]),onClick:()=>{this.state.pendingMessage.length>0?(Yo(this.state.pendingMessage),this.setState({pendingMessage:""})):Object(kt.e)(this.props.history,"modal","create")}}),wt.a.createElement("button",{type:"submit",className:Jt()([eo.a.messageEntryButton,eo.a.messageEntryButtonInRoom,eo.a.messageEntrySubmit])},wt.a.createElement("i",null,wt.a.createElement(ya.a,{icon:to.faPaperPlane})))))}}Qo(Jo,"propTypes",{discordBridges:Qt.a.array,onSendMessage:Qt.a.func,onObjectCreated:Qt.a.func,history:Qt.a.object,enableSpawning:Qt.a.bool});var Zo=Jo,er=i(2450),tr=i.n(er);function ir(){return(ir=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}function ar(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},a=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),a.forEach(function(t){or(e,t,i[t])})}return e}function nr(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}function sr(e){return function(){var t=this,i=arguments;return new Promise(function(a,n){var s=e.apply(t,i);function o(e){nr(s,a,n,o,r,"next",e)}function r(e){nr(s,a,n,o,r,"throw",e)}o(void 0)})}}function or(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const rr="/api/v1/avatars";class cr extends Et.Component{constructor(e){var t;super(e),t=this,or(this,"state",{avatar:{name:"My Avatar",parent_avatar_listing_id:"basebot",files:{}},previewGltfUrl:null}),or(this,"componentDidMount",sr(function*(){if(t.props.avatarId){const e=yield t.fetchAvatar(t.props.avatarId);e.creatorAttribution=e.attributions&&e.attributions.creator||"",Object.assign(t.inputFiles,e.files),t.setState({avatar:e,previewGltfUrl:e.base_gltf_url})}else{const{base_gltf_url:e}=yield t.fetchAvatar("basebot");t.setState({previewGltfUrl:e})}})),or(this,"fetchAvatar",e=>Object(s.d)(`${rr}/${e}`).then(({avatars:e})=>e[0])),or(this,"createOrUpdateAvatar",e=>Object(s.d)(e.avatar_id?`${rr}/${e.avatar_id}`:rr,e.avatar_id?"PUT":"POST",{avatar:e}).then(({avatars:e})=>e[0])),or(this,"uploadAvatar",function(){var e=sr(function*(e){if(e.preventDefault(),t.inputFiles.glb&&t.inputFiles.glb instanceof File){const e=new THREE.GLTFLoader,i=URL.createObjectURL(t.inputFiles.glb),a=console.log,n=yield new Promise((t,n)=>e.createParser(i,t,a,n));URL.revokeObjectURL(i);const{content:s,body:o}=n.extensions.KHR_binary_glTF;t.inputFiles.gltf=new File([s],"file.gltf",{type:"model/gltf"}),t.inputFiles.bin=new File([o],"file.bin",{type:"application/octet-stream"})}t.inputFiles.thumbnail=new File([yield t.preview.getWrappedInstance().snapshot()],"thumbnail.png",{type:"image/png"});const i=["gltf","bin","base_map","emissive_map","normal_map","orm_map","thumbnail"].filter(e=>null===t.inputFiles[e]||t.inputFiles[e]instanceof File);t.setState({uploading:!0});const a=yield Promise.all(i.map(e=>t.inputFiles[e]&&Object(N.h)(t.inputFiles[e]))),n=ar({},t.state.avatar,{attributions:{creator:t.state.avatar.creatorAttribution},files:a.map((e,t)=>[i[t],e&&[e.file_id,e.meta.access_token,e.meta.promotion_token]]).reduce((e,[t,i])=>ar({},e,{[t]:i}),{})});yield t.createOrUpdateAvatar(n),t.setState({uploading:!1}),t.props.onSave&&t.props.onSave()});return function(t){return e.apply(this,arguments)}}()),or(this,"deleteAvatar",function(){var e=sr(function*(e){e.preventDefault(),yield Object(s.d)(`${rr}/${t.state.avatar.avatar_id}`,"DELETE"),t.props.onSave&&t.props.onSave()});return function(t){return e.apply(this,arguments)}}()),or(this,"fileField",(e,t,i,a=!1,n)=>wt.a.createElement("div",{className:"file-input-row",key:e,title:n},wt.a.createElement("label",{htmlFor:`avatar-file_${e}`},wt.a.createElement("div",{className:"img-box"}),wt.a.createElement("span",null,t)),wt.a.createElement("input",{id:`avatar-file_${e}`,type:"file",accept:i,disabled:a,onChange:t=>{this.inputFiles[e]=t.target.files[0],t.target.value=null}}),this.state.avatar.files[e]&&wt.a.createElement("a",{onClick:()=>{this.inputFiles[e]=null}},wt.a.createElement("i",null,wt.a.createElement(ya.a,{icon:xa.faTimes}))))),or(this,"mapField",(e,t,i,a=!1,n)=>wt.a.createElement("div",{className:"file-input-row",key:e,title:n},wt.a.createElement("label",{htmlFor:`avatar-file_${e}`},wt.a.createElement("div",{className:"img-box"},this.state.avatar.files[e]&&wt.a.createElement("img",{src:this.state.avatar.files[e]})),wt.a.createElement("span",null,t)),wt.a.createElement("input",{id:`avatar-file_${e}`,type:"file",accept:i,disabled:a,onChange:t=>{const i=t.target.files[0];t.target.value=null,this.inputFiles[e]=i,URL.revokeObjectURL(this.state.avatar.files[e]),this.setState({avatar:ar({},this.state.avatar,{files:ar({},this.state.avatar.files,{[e]:URL.createObjectURL(i)})})})}}),this.state.avatar.files[e]&&wt.a.createElement("a",{onClick:()=>{this.inputFiles[e]=null,URL.revokeObjectURL(this.state.avatar.files[e]),this.setState({avatar:ar({},this.state.avatar,{files:ar({},this.state.avatar.files,{[e]:null})})})}},wt.a.createElement("i",null,wt.a.createElement(ya.a,{icon:xa.faTimes}))))),or(this,"textField",(e,t,i,a)=>wt.a.createElement("div",null,wt.a.createElement("input",{id:`avatar-${e}`,type:"text",disabled:i,required:a,placeholder:t,className:"text-field",value:this.state.avatar[e]||"",onChange:t=>this.setState({avatar:ar({},this.state.avatar,{[e]:t.target.value})})}))),or(this,"textarea",(e,t,i)=>wt.a.createElement("div",null,wt.a.createElement("textarea",{id:`avatar-${e}`,disabled:i,placeholder:t,className:"textarea",value:this.state.avatar[e]||"",onChange:t=>this.setState({avatar:ar({},this.state.avatar,{[e]:t.target.value})})}))),or(this,"checkbox",(e,t,i)=>wt.a.createElement("div",{className:"checkbox-container"},wt.a.createElement("input",{id:`avatar-${e}`,type:"checkbox",className:"checkbox",disabled:i,checked:!!this.state.avatar[e],onChange:t=>this.setState({avatar:ar({},this.state.avatar,{[e]:t.target.checked})})}),wt.a.createElement("label",{htmlFor:`#avatar-${e}`},t))),this.inputFiles={}}render(){const{debug:e}=this.props;return wt.a.createElement("div",{className:Jt()(tr.a.avatarEditor,this.props.className)},this.props.onClose&&wt.a.createElement("a",{className:"close-button",onClick:this.props.onClose},wt.a.createElement("i",null,wt.a.createElement(ya.a,{icon:xa.faTimes}))),this.props.signedIn?wt.a.createElement("form",{onSubmit:this.uploadAvatar,className:"center"},wt.a.createElement("div",{className:"split"},wt.a.createElement("div",{className:"form-body"},e&&this.textField("avatar_id","Avatar ID",!0),e&&this.textField("parent_avatar_id","Parent Avatar ID"),e&&this.textField("parent_avatar_listing_id","Parent Avatar Listing ID"),this.textField("name","Name",!1,!0),e&&this.textarea("description","Description"),e&&this.fileField("glb","Avatar GLB","model/gltf+binary,.glb"),this.mapField("base_map","Base Map","image/*"),this.mapField("emissive_map","Emissive Map","image/*"),this.mapField("normal_map","Normal Map","image/*"),this.mapField("orm_map","ORM Map","image/*",!1,"Occlussion (r), Roughness (g), Metallic (b)"),wt.a.createElement("hr",null),this.checkbox("allow_promotion",wt.a.createElement("span",null,"Allow"," ",wt.a.createElement("a",{href:"https://github.com/mozilla/hubs/blob/master/PROMOTION.md",target:"_blank",rel:"noopener noreferrer"},"Promotion"))),this.checkbox("allow_remixing",wt.a.createElement("span",null,"Allow"," ",wt.a.createElement("a",{href:"https://github.com/mozilla/hubs/blob/master/REMIXING.md",target:"_blank",rel:"noopener noreferrer"},"Remixing")," ",wt.a.createElement("span",{className:"license"},"(under"," ",wt.a.createElement("a",{href:"https://creativecommons.org/licenses/by/3.0/",target:"_blank",rel:"noopener noreferrer"},"CC-BY 3.0"),")"))),this.textField("creatorAttribution","Attribution (optional)",!1,!1)),wt.a.createElement(Aa.a,ir({className:"preview",avatarGltfUrl:this.state.previewGltfUrl},this.inputFiles,{ref:e=>this.preview=e}))),wt.a.createElement("div",{className:"info"},wt.a.createElement("p",null,wt.a.createElement(ii.a,{id:"avatar-editor.info"}),wt.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/j-conrad/hubs-avatar-pipelines"},wt.a.createElement(ii.a,{id:"avatar-editor.info-link"})))),wt.a.createElement("div",null,wt.a.createElement("input",{disabled:this.state.uploading,className:"form-submit",type:"submit",value:this.state.uploading?"Uploading...":"Save"})),!this.props.hideDelete&&wt.a.createElement("div",{className:"delete-avatar"},this.state.confirmDelete?wt.a.createElement("span",null,"are you sure? ",wt.a.createElement("a",{onClick:this.deleteAvatar},"yes")," /"," ",wt.a.createElement("a",{onClick:()=>this.setState({confirmDelete:!1})},"no")):wt.a.createElement("a",{onClick:()=>this.setState({confirmDelete:!0})},"delete avatar"))):wt.a.createElement("a",{onClick:this.props.onSignIn},wt.a.createElement(ii.a,{id:"sign-in.in"})))}}or(cr,"propTypes",{avatarId:Qt.a.string,onSignIn:Qt.a.func,onSave:Qt.a.func,onClose:Qt.a.func,signedIn:Qt.a.bool,hideDelete:Qt.a.bool,debug:Qt.a.bool,className:Qt.a.string});var lr=i(1264),dr=i.n(lr),hr=i(1265),ur=i.n(hr),pr=i(1266),mr=i.n(pr),gr=i(1267),vr=i.n(gr),fr=i(1268),br=i.n(fr),yr=i(1269),_r=i.n(yr),Er=i(1270),wr=i.n(Er);function Sr(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const xr=window.AudioContext||window.webkitAudioContext;class Ar extends Et.Component{constructor(...e){super(...e),Sr(this,"state",{micLevel:0})}componentDidMount(){null!=this.props.mediaStream&&this.props.hasAudioTrack&&this.startAnalyzer(this.props.mediaStream)}componentDidUpdate(e){this.props.mediaStream===e.mediaStream&&this.props.hasAudioTrack===e.hasAudioTrack||(this.stopAnalyzer(),null!=this.props.mediaStream&&this.props.hasAudioTrack&&this.startAnalyzer(this.props.mediaStream))}componentWillUnmount(){this.stopAnalyzer()}stopAnalyzer(){null!=this.micUpdateInterval&&clearInterval(this.micUpdateInterval),null!=this.micLevelAudioContext&&this.micLevelAudioContext.close()}startAnalyzer(e){this.micLevelAudioContext=new xr;const t=this.micLevelAudioContext.createMediaStreamSource(e),i=this.micLevelAudioContext.createAnalyser();i.fftSize=32;const a=new Uint8Array(i.frequencyBinCount);t.connect(i);const n=wr()(100);this.micUpdateInterval=setInterval(()=>{i.getByteTimeDomainData(a);let e=0;for(let t=0;t<a.length;t++)e=Math.max(a[t]-128,e);const t=e/128;n.push(Date.now(),6*t);const s=n.movingAverage();this.setState(e=>{if(Math.abs(s-e.micLevel)>1e-4)return{micLevel:s}})},50)}render(){const e={clip:`rect(${111-Math.floor(111*this.state.micLevel)}px, 111px, 111px, 0px)`};return wt.a.createElement("div",{className:"audio-setup-panel__levels__icon"},wt.a.createElement("img",{src:dr.a,srcSet:ur.a+" 2x",className:"audio-setup-panel__levels__icon-part"}),!this.props.muteOnEntry&&wt.a.createElement("img",{src:mr.a,srcSet:vr.a+" 2x",className:"audio-setup-panel__levels__icon-part",style:e}),this.props.hasAudioTrack&&!this.props.muteOnEntry?wt.a.createElement("img",{src:br.a,srcSet:_r.a+" 2x",className:"audio-setup-panel__levels__icon-part"}):wt.a.createElement("img",{src:Nt.a,srcSet:It.a+" 2x",className:"audio-setup-panel__levels__icon-part"}),this.props.hasAudioTrack&&!this.props.muteOnEntry&&wt.a.createElement("div",{className:"audio-setup-panel__levels__test_label"},wt.a.createElement(ii.a,{id:"audio.talk_to_test"})))}}Sr(Ar,"propTypes",{mediaStream:Qt.a.object,hasAudioTrack:Qt.a.bool,muteOnEntry:Qt.a.bool});var kr=i(1271),Cr=i.n(kr),Tr=i(1272),Rr=i.n(Tr),Mr=i(1273),Dr=i.n(Mr),Pr=i(1274),Or=i.n(Pr),Nr=i(1275),Hr=i.n(Nr),Ir=i(1276),jr=i.n(Ir),Lr=i(1277),Fr=i.n(Lr),Br=i(1278),Vr=i.n(Br),Ur=i(1279),zr=i.n(Ur),Wr=i(1280),qr=i.n(Wr);class Gr extends Et.Component{constructor(e){super(e),function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"state",{tonePlaying:!1}),this.playTestTone=this.playTestTone.bind(this),this.toneClip=document.createElement("audio"),this.toneClip.canPlayType("audio/webm")?this.toneClip.src=Fr.a:this.toneClip.canPlayType("audio/mpeg")?this.toneClip.src=Vr.a:this.toneClip.canPlayType("audio/ogg")?this.toneClip.src=zr.a:this.toneClip.src=qr.a}componentWillUnmount(){this.toneClip.pause(),this.toneClip.currentTime=0,null!=this.testToneTimeout&&clearTimeout(this.testToneTimeout)}playTestTone(){null!=this.testToneTimeout&&clearTimeout(this.testToneTimeout),this.toneClip.currentTime=0,this.toneClip.play(),this.setState({tonePlaying:!0}),this.testToneTimeout=setTimeout(()=>{this.setState({tonePlaying:!1})},1393)}render(){const e={clip:`rect(${this.state.tonePlaying?0:111}px, 111px, 111px, 0px)`};return wt.a.createElement(ki.b,null,wt.a.createElement("div",{className:"audio-setup-panel__levels__icon_clickable",onClick:this.playTestTone},wt.a.createElement("img",{src:Cr.a,srcSet:Rr.a+" 2x",className:"audio-setup-panel__levels__icon-part"}),wt.a.createElement("img",{src:Dr.a,srcSet:Or.a+" 2x",className:"audio-setup-panel__levels__icon-part",style:e}),wt.a.createElement("img",{src:Hr.a,srcSet:jr.a+" 2x",className:"audio-setup-panel__levels__icon-part"}),wt.a.createElement("div",{className:"audio-setup-panel__levels__test_label"},wt.a.createElement(ii.a,{id:"audio.click_to_test"}))))}}function Yr({name:e,body:{src:t},className:i,maySpawn:a,hubId:n}){const o=Object(s.e)(t),r=vi.bind(null,{url:o,title:`Taken in #hubs, join me at https://hub.link/${n}`});return wt.a.createElement("div",{className:i},a&&wt.a.createElement("button",{className:Jt()(uo.a.iconButton,uo.a.share),onClick:r}),wt.a.createElement("div",{className:uo.a.mediaBody},wt.a.createElement("span",null,wt.a.createElement("b",null,e)),wt.a.createElement("span",null,"took a ",wt.a.createElement("b",null,wt.a.createElement("a",{href:o,target:"_blank",rel:"noopener noreferrer"},"photo")),".")),wt.a.createElement("a",{href:o,target:"_blank",rel:"noopener noreferrer"},wt.a.createElement("img",{src:t})))}function $r({name:e,body:{src:t},className:i,maySpawn:a,hubId:n}){const s=vi.bind(null,{url:t,title:`Taken in #hubs, join me at https://hub.link/${n}`});return wt.a.createElement("div",{className:i},a&&wt.a.createElement("button",{className:Jt()(uo.a.iconButton,uo.a.share),onClick:s}),wt.a.createElement("div",{className:uo.a.mediaBody},wt.a.createElement("span",null,wt.a.createElement("b",null,e)),wt.a.createElement("span",null,"took a ",wt.a.createElement("b",null,wt.a.createElement("a",{href:t,target:"_blank",rel:"noopener noreferrer"},"video")),".")))}function Xr({name:e,body:{src:t},className:i,maySpawn:a}){return wt.a.createElement("div",{className:i},a&&wt.a.createElement("button",{className:Jt()(uo.a.iconButton,uo.a.spawnMessage),onClick:()=>(function(e){document.querySelector("a-scene").emit("add_media",e)})(t)}),wt.a.createElement("div",{className:uo.a.mediaBody},e&&wt.a.createElement("div",{className:uo.a.messageSource},e,":")),wt.a.createElement("a",{href:t,target:"_blank",rel:"noopener noreferrer"},wt.a.createElement("img",{src:Object(X.g)(t)})))}function Qr(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Yr.propTypes={name:Qt.a.string,maySpawn:Qt.a.bool,body:Qt.a.object,className:Qt.a.string,hubId:Qt.a.string},$r.propTypes={name:Qt.a.string,maySpawn:Qt.a.bool,body:Qt.a.object,className:Qt.a.string,hubId:Qt.a.string},Xr.propTypes={name:Qt.a.string,maySpawn:Qt.a.bool,body:Qt.a.object,className:Qt.a.string};class Kr extends Et.Component{constructor(e){super(e),Qr(this,"domForEntry",e=>{const t={[uo.a.presenceLogEntry]:!0,[uo.a.presenceLogEntryWithButton]:("chat"===e.type||"image"===e.type)&&e.maySpawn,[uo.a.presenceLogChat]:"chat"===e.type,[uo.a.expired]:!!e.expired},i=!!(e.sessionId?Object(s.f)(this.props.presences,e.sessionId):{}).discord;switch(e.type){case"join":case"entered":return wt.a.createElement("div",{key:e.key,className:Jt()(t)},wt.a.createElement("b",null,e.name)," ",wt.a.createElement(ii.a,{id:`presence.${e.type}_${e.presence}`}));case"leave":return wt.a.createElement("div",{key:e.key,className:Jt()(t)},wt.a.createElement("b",null,e.name)," ",wt.a.createElement(ii.a,{id:`presence.${e.type}`}));case"display_name_changed":return wt.a.createElement("div",{key:e.key,className:Jt()(t)},wt.a.createElement("b",null,e.oldName)," ",wt.a.createElement(ii.a,{id:"presence.name_change"})," ",wt.a.createElement("b",null,e.newName),".");case"scene_changed":return wt.a.createElement("div",{key:e.key,className:Jt()(t)},wt.a.createElement("b",null,e.name)," ",wt.a.createElement(ii.a,{id:"presence.scene_change"})," ",wt.a.createElement("b",null,e.sceneName),".");case"hub_name_changed":return wt.a.createElement("div",{key:e.key,className:Jt()(t)},wt.a.createElement("b",null,e.name)," ",wt.a.createElement(ii.a,{id:"presence.hub_name_change"})," ",wt.a.createElement("b",null,e.hubName),".");case"chat":return wt.a.createElement(Xo,{key:e.key,name:e.name,className:Jt()(t),body:e.body,maySpawn:e.maySpawn,sessionId:e.sessionId,includeFromLink:this.props.inRoom&&!i,history:this.props.history});case"image":return wt.a.createElement(Xr,{key:e.key,name:e.name,className:Jt()(t,uo.a.media),body:e.body,maySpawn:e.maySpawn});case"photo":return wt.a.createElement(Yr,{key:e.key,name:e.name,className:Jt()(t,uo.a.media),body:e.body,maySpawn:e.maySpawn,hubId:this.props.hubId});case"video":return wt.a.createElement($r,{key:e.key,name:e.name,className:Jt()(t,uo.a.media),body:e.body,maySpawn:e.maySpawn,hubId:this.props.hubId});case"log":return wt.a.createElement("div",{key:e.key,className:Jt()(t)},e.body)}})}render(){const e={[uo.a.presenceLog]:!0,[uo.a.presenceLogInRoom]:this.props.inRoom};return wt.a.createElement("div",{className:Jt()(e)},this.props.entries.map(this.domForEntry))}}Qr(Kr,"propTypes",{entries:Qt.a.array,inRoom:Qt.a.bool,hubId:Qt.a.string,history:Qt.a.object,presences:Qt.a.object});var Jr=i(1281),Zr=i.n(Jr),ec=(i(1282),i(1077)),tc=(i(1283),i(1284)),ic=(i(1918),i(1285)),ac=i(2452),nc=i.n(ac);function sc(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class oc extends Et.Component{constructor(...e){super(...e),sc(this,"state",{expanded:!1})}componentDidMount(){document.querySelector(".a-canvas").addEventListener("mouseup",()=>{this.state.expanded&&this.setState({expanded:!1})})}renderExpandedMenu(){const e=Jt()([nc.a.row,nc.a.settingsRow]),t=Jt()([nc.a.row,nc.a.settingsRow,nc.a.rowHeader]),i=this.props.scene.is("entered")&&!!this.props.hubChannel.canOrWillIfCreator("kick_users"),a=document.querySelector("#player-rig").getAttribute("character-controller","fly").fly;return console.log(a),wt.a.createElement("div",{className:nc.a.settingsMenu},wt.a.createElement("div",{className:nc.a.attachPoint}),wt.a.createElement("div",{className:nc.a.contents},wt.a.createElement("div",{className:nc.a.rows},wt.a.createElement("div",{className:t},wt.a.createElement(ii.a,{id:"settings.row-profile"})),wt.a.createElement("div",{className:e},wt.a.createElement("div",{className:nc.a.icon},wt.a.createElement("img",{src:Zr.a})),wt.a.createElement("div",{className:nc.a.listItem},wt.a.createElement(Ci.a,{stateKey:"overlay",stateValue:"profile",history:this.props.history,onClick:()=>this.setState({expanded:!1})},wt.a.createElement(ii.a,{id:"settings.change-avatar"})))),wt.a.createElement("div",{className:e},wt.a.createElement("div",{className:nc.a.icon},wt.a.createElement("i",null,wt.a.createElement(ya.a,{icon:Oa.faStar}))),wt.a.createElement("div",{className:nc.a.listItem},wt.a.createElement("div",{className:nc.a.listItemLink,onClick:()=>{this.props.toggleFlyMode(!a),this.setState({expanded:!1})}},a?"Disable":"Enable"," Fly Mode"))),wt.a.createElement("span",null),!1,!1,!1,!1,!1,wt.a.createElement("div",{className:e},wt.a.createElement("div",{className:nc.a.icon},wt.a.createElement("i",null,wt.a.createElement(ya.a,{icon:ec.faDoorClosed}))),wt.a.createElement("div",{className:nc.a.listItem},wt.a.createElement("a",{href:"#",onClick:e=>{e.preventDefault(),this.props.showNonHistoriedDialog(Ss,{destinationUrl:"/",messageType:"create-room"}),this.setState({expanded:!1})}},"Leave Room"))),i?wt.a.createElement("div",{className:t},wt.a.createElement(ii.a,{id:"settings.row-tools"})):wt.a.createElement("div",null),i?wt.a.createElement("div",{className:e},wt.a.createElement("div",{className:nc.a.icon},wt.a.createElement("i",null,wt.a.createElement(ya.a,{icon:ic.faVideo}))),wt.a.createElement("div",{className:nc.a.listItem},wt.a.createElement("div",{className:nc.a.listItemLink,onClick:()=>{this.props.toggleStreamerMode(!0),this.setState({expanded:!1})}},wt.a.createElement(ii.a,{id:"settings.enable-streamer-mode"})))):wt.a.createElement("div",null),!1,!1)))}render(){return wt.a.createElement("div",null,wt.a.createElement(ya.a,{icon:tc.faBars,onClick:()=>this.setState({expanded:!this.state.expanded}),className:Jt()({[Ei.a.cornerButton]:!0,[Ei.a.cornerButtonSelected]:this.state.expanded})}),this.state.expanded&&this.renderExpandedMenu())}}sc(oc,"propTypes",{history:Qt.a.object,isStreaming:Qt.a.bool,toggleStreamerMode:Qt.a.func,mediaSearchStore:Qt.a.object,scene:Qt.a.object,hubScene:Qt.a.object,hubChannel:Qt.a.object,performConditionalSignIn:Qt.a.func,showNonHistoriedDialog:Qt.a.func,pushHistoryState:Qt.a.func,toggleFlyMode:Qt.a.func});var rc=i(2454),cc=i.n(rc);const lc=AFRAME.utils.device.isMobile();class dc extends Et.Component{render(){return wt.a.createElement("div",{className:cc.a.treatment},wt.a.createElement("div",{className:cc.a.screenshot},this.props.hubScene&&wt.a.createElement("img",{className:cc.a.screenshot,src:this.props.hubScene.screenshot_url})),wt.a.createElement("a",{href:"/",target:"_blank",rel:"noopener noreferrer",className:cc.a.logo},wt.a.createElement("img",{src:this.props.logo})),wt.a.createElement("div",{className:cc.a.mainPanel},wt.a.createElement("div",{className:cc.a.hubName},this.props.hubName),this.props.onLoadClicked&&(lc?wt.a.createElement("a",{href:this.props.baseUrl,target:"_blank",className:cc.a.loadButton,rel:"noreferrer noopener"},wt.a.createElement(ii.a,{id:"embed.load-button"})):wt.a.createElement("button",{className:cc.a.loadButton,onClick:this.props.onLoadClicked},wt.a.createElement(ii.a,{id:"embed.load-button"})))))}}!function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(dc,"propTypes",{hubName:Qt.a.string,hubScene:Qt.a.object,baseUrl:Qt.a.string,onLoadClicked:Qt.a.func});var hc=i(2456),uc=i.n(hc);function pc(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const{detect:mc}=i(140),gc=mc(),vc=()=>{};class fc extends Et.Component{constructor(e){super(e),pc(this,"state",{showVideoShareOptions:!1,lastActiveMediaSource:null,cameraDisabled:!1,penDisabled:!1,mediaDisabled:!1}),pc(this,"onPermissionsUpdated",()=>{this.setState({cameraDisabled:!window.APP.hubChannel.can("spawn_camera"),penDisabled:!window.APP.hubChannel.can("spawn_drawing"),mediaDisabled:!window.APP.hubChannel.can("spawn_and_move_media")})}),pc(this,"handleVideoShareClicked",e=>{"screen"!==e&&"window"!==e||"firefox"===gc.name?this.props.videoShareMediaSource?this.props.onEndShareVideo():(this.props.onShareVideo(e),this.setState({lastActiveMediaSource:e})):this.props.onShareVideoNotCapable()}),pc(this,"buildVideoSharingButtons",()=>{const e=AFRAME.utils.device.isMobile()||AFRAME.utils.device.isMobileVR(),t=[],i=this.props.videoShareMediaSource||this.state.lastActiveMediaSource||(e?"camera":"screen");this.state.showVideoShareOptions&&(t.push(i),["screen","window","camera"].forEach(e=>{-1===t.indexOf(e)&&t.push(e)}));const a=()=>{e||(clearTimeout(this.hideVideoSharingButtonTimeout),this.props.videoShareMediaSource||this.setState({showVideoShareOptions:!0}))},n=e=>e[0].toUpperCase()+e.slice(1);return wt.a.createElement("div",{className:Jt()(uc.a.iconButton,uc.a[`share_${i}`],{[uc.a.active]:this.props.videoShareMediaSource===i,[uc.a.disabled]:this.state.mediaDisabled,[uc.a.videoShare]:!0}),title:null!==this.props.videoShareMediaSource?"Stop sharing":`Share ${n(i)}${this.state.mediaDisabled?" Disabled":""}`,onClick:this.state.mediaDisabled?vc:()=>{this.state.showVideoShareOptions||this.handleVideoShareClicked(i)},onMouseOver:this.state.mediaDisabled?vc:a},t.length>0&&wt.a.createElement("div",{className:Jt()(uc.a.videoShareExtraOptions),onMouseOut:()=>{this.hideVideoSharingButtonTimeout=setTimeout(()=>{this.setState({showVideoShareOptions:!1})},250)}},t.map(e=>wt.a.createElement("div",{key:e,className:Jt()(uc.a.iconButton,uc.a[`share_${e}`],{[uc.a.active]:this.props.videoShareMediaSource===e,[uc.a.disabled]:this.state.mediaDisabled}),title:this.props.videoShareMediaSource===e?"Stop sharing":`Share ${n(e)}${this.state.mediaDisabled?" Disabled":""}`,onClick:this.state.mediaDisabled?vc:()=>this.handleVideoShareClicked(e),onMouseOver:this.state.mediaDisabled?vc:a}))))}),this.state.cameraDisabled=!window.APP.hubChannel.can("spawn_camera"),this.state.penDisabled=!window.APP.hubChannel.can("spawn_drawing"),this.state.mediaDisabled=!window.APP.hubChannel.can("spawn_and_move_media")}componentDidMount(){window.APP.hubChannel.addEventListener("permissions_updated",this.onPermissionsUpdated)}componentWillUnMount(){window.APP.hubChannel.removeEventListener("permissions_updated",this.onPermissionsUpdated)}render(){const e=this.buildVideoSharingButtons(),t=AFRAME.utils.device.isMobile(),i=(e,t)=>wt.a.createElement("div",{className:Jt()(uc.a.topTip)},t&&wt.a.createElement("button",{className:uc.a.tipCancel,onClick:t},wt.a.createElement("i",null,wt.a.createElement(ya.a,{icon:xa.faTimes}))),!this.props.frozen&&wt.a.createElement("div",{className:Jt()([uc.a.attachPoint,uc.a[`attach_${e.split(".")[1]}`]])}),wt.a.createElement(ii.a,{id:`tips.${e}`}));let a;return this.props.watching?a=wt.a.createElement("div",{className:Jt()([uc.a.topTip,uc.a.topTipNoHud])},wt.a.createElement("button",{className:uc.a.tipCancel,onClick:()=>this.props.onWatchEnded()},wt.a.createElement("i",null,wt.a.createElement(ya.a,{icon:xa.faTimes}))),wt.a.createElement(ii.a,{id:`tips.${t?"mobile":"desktop"}.watching`}),!t&&wt.a.createElement("button",{className:uc.a.tipCancelText,onClick:()=>this.props.onWatchEnded()},wt.a.createElement(ii.a,{id:"tips.watching.back"}))):this.props.showVideoShareFailed?a=i(`${t?"mobile":"desktop"}.video_share_failed`,this.props.hideVideoShareFailedTip):this.props.activeTip&&(a=i(this.props.activeTip)),wt.a.createElement("div",{className:Jt()(uc.a.container,uc.a.top,uc.a.unselectable,Ei.a.uiInteractive)},this.props.frozen||this.props.watching?wt.a.createElement("div",{className:Jt()(Ei.a.uiInteractive,uc.a.panel)},a):wt.a.createElement("div",{className:Jt()(Ei.a.uiInteractive,uc.a.panel)},a,e,wt.a.createElement("div",{className:Jt()(uc.a.iconButton,uc.a.mute,{[uc.a.active]:this.props.muted}),title:this.props.muted?"Unmute Mic":"Mute Mic",onClick:this.props.onToggleMute}),wt.a.createElement("button",{className:Jt()(Ei.a.uiInteractive,uc.a.iconButton,uc.a.spawn,{[uc.a.disabled]:this.state.mediaDisabled}),onClick:this.state.mediaDisabled?vc:()=>this.props.mediaSearchStore.sourceNavigateToDefaultSource()}),wt.a.createElement("div",{className:Jt()(uc.a.iconButton,uc.a.pen,{[uc.a.active]:this.props.isCursorHoldingPen,[uc.a.disabled]:this.state.penDisabled}),title:`Pen${this.state.penDisabled?" Disabled":""}`,onClick:this.state.penDisabled?vc:this.props.onSpawnPen}),wt.a.createElement("div",{className:Jt()(uc.a.iconButton,uc.a.camera,{[uc.a.active]:this.props.hasActiveCamera,[uc.a.disabled]:this.state.cameraDisabled}),title:`Camera${this.state.cameraDisabled?" Disabled":""}`,onClick:this.state.cameraDisabled?vc:this.props.onSpawnCamera}),wt.a.createElement("div",{className:Jt()(uc.a.iconButton,uc.a.fly,{[uc.a.active]:this.props.flyingEnabled}),title:this.props.flyingEnabled?"Disable Flying":"Enable Flying",onClick:()=>this.props.onToggleFlying(!this.props.flyingEnabled)})))}}pc(fc,"propTypes",{muted:Qt.a.bool,flyingEnabled:Qt.a.bool,isCursorHoldingPen:Qt.a.bool,hasActiveCamera:Qt.a.bool,frozen:Qt.a.bool,watching:Qt.a.bool,onWatchEnded:Qt.a.func,videoShareMediaSource:Qt.a.string,showVideoShareFailed:Qt.a.bool,hideVideoShareFailedTip:Qt.a.func,activeTip:Qt.a.string,history:Qt.a.object,onToggleMute:Qt.a.func,onToggleFreeze:Qt.a.func,onSpawnPen:Qt.a.func,onSpawnCamera:Qt.a.func,onShareVideo:Qt.a.func,onEndShareVideo:Qt.a.func,onShareVideoNotCapable:Qt.a.func,mediaSearchStore:Qt.a.object,isStreaming:Qt.a.bool,showStreamingTip:Qt.a.bool,hideStreamingTip:Qt.a.func});var bc={TopHUD:fc},yc=i(2492),_c=i.n(yc);class Ec extends Et.Component{render(){return wt.a.createElement("div",{className:_c.a.label},wt.a.createElement(ii.a,{id:"lobby.watching"}),wt.a.createElement("b",null,this.props.name))}}!function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(Ec,"propTypes",{name:Qt.a.string});let wc=!1,Sc=null;const xc=AFRAME.utils.device.isMobileVR(),Ac=e=>{const t=document.querySelector("a-scene");t.addEventListener("2d-interstitial-gesture-complete",e,{once:!0}),t.emit("2d-interstitial-gesture-required")};function kc(e,t){const i=document.querySelector("a-scene");if(i.is("vr-mode"))if(wc=!0,Sc=t,xc)i.exitVR().then(()=>{Ac(()=>{Object(Fa.a)()})});else{const t=document.querySelector(".vr-notice");t.object3D.visible=!0,t.setAttribute("follow-in-fov",{angle:e?39:-15})}else xc&&Object(Fa.c)()&&Ac(()=>{Object(Fa.a)()})}function Cc(e){if(!e&&!wc)return;wc=!1,document.querySelector(".vr-notice").object3D.visible=!1;const t=document.querySelector("a-scene");xc?oi.a.isFullscreen?(oi.a.exit(),Ac(()=>t.enterVR())):t.enterVR():t.is("vr-mode")||t.enterVR()}function Tc(){return wc}var Rc=i(619);function Mc(){return(Mc=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}function Dc(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},a=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),a.forEach(function(t){Pc(e,t,i[t])})}return e}function Pc(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Oc(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}function Nc(e){return function(){var t=this,i=arguments;return new Promise(function(a,n){var s=e.apply(t,i);function o(e){Oc(s,a,n,o,r,"next",e)}function r(e){Oc(s,a,n,o,r,"throw",e)}o(void 0)})}}const Hc=Object(U.a)("avatarEditorDebug");Object(ii.c)([...ni.a]);const Ic=[/\Wvive\W/i,/\Wrift\W/i],jc=["/media"],Lc=["media_source"],Fc=["/media/scenes","/media/avatars","/media/favorites"],Bc=["media_source"],Vc=["scenes","avatars","favorites"];function Uc(){return(Uc=Nc(function*(){return(yield navigator.mediaDevices.enumerateDevices()).filter(e=>e.label&&"audioinput"===e.kind).map(e=>e.label)})).apply(this,arguments)}const zc=AFRAME.utils.device.isMobile(),Wc=AFRAME.utils.device.isMobileVR(),qc=zc||Wc,Gc=10;class Yc extends Et.Component{constructor(e){var t;super(e),t=this,Pc(this,"willCompileAndUploadMaterials",!1),Pc(this,"state",{enterInVR:!1,muteOnEntry:!1,entered:!1,dialog:null,showShareDialog:!1,broadcastTipDismissed:!1,linkCode:null,linkCodeCancel:null,miniInviteActivated:!1,didConnectToNetworkedScene:!1,noMoreLoadingUpdates:!1,hideLoader:!1,watching:!1,isStreaming:!1,showStreamingTip:!1,waitingOnAudio:!1,mediaStream:null,audioTrack:null,micDevices:[],autoExitTimerStartedAt:null,autoExitTimerInterval:null,secondsRemainingBeforeAutoExit:1/0,muted:!1,flyingEnabled:!1,frozen:!1,exited:!1,signedIn:!1,videoShareMediaSource:null,showVideoShareFailed:!1}),Pc(this,"showContextualSignInDialog",()=>{const{signInMessageId:e,authChannel:i,signInCompleteMessageId:a,signInContinueTextId:n,onContinueAfterSignIn:s}=this.props;this.showNonHistoriedDialog(Ln.a,{message:Xi.b[e],onSignIn:function(){var e=Nc(function*(e){const{authComplete:o}=yield i.startAuthentication(e,t.props.hubChannel);t.showNonHistoriedDialog(Ln.a,{authStarted:!0,onClose:s}),yield o,t.setState({signedIn:!0}),t.showNonHistoriedDialog(Ln.a,{authComplete:!0,message:Xi.b[a],continueText:Xi.b[n],onClose:s,onContinue:s})});return function(t){return e.apply(this,arguments)}}(),onClose:s})}),Pc(this,"updateSubscribedState",()=>{const e=this.props.subscriptions&&this.props.subscriptions.isSubscribed();this.setState({isSubscribed:e})}),Pc(this,"toggleFavorited",()=>{this.props.performConditionalSignIn(()=>this.props.hubChannel.signedIn,()=>{const e=this.isFavorited();this.props.hubChannel[e?"unfavorite":"favorite"](),this.setState({isFavorited:!e})},"favorite-room")}),Pc(this,"isFavorited",()=>void 0!==this.state.isFavorited?this.state.isFavorited:this.props.initialIsFavorited),Pc(this,"onLoadingFinished",()=>{this.setState({noMoreLoadingUpdates:!0}),this.props.onLoaded&&this.props.onLoaded()}),Pc(this,"onSceneLoaded",()=>{this.setState({sceneLoaded:!0})}),Pc(this,"onAframeStateChanged",e=>{"muted"!==e.detail&&"frozen"!==e.detail||this.setState({[e.detail]:this.props.scene.is(e.detail)})}),Pc(this,"onShareVideoEnabled",e=>{this.setState({videoShareMediaSource:e.detail.source})}),Pc(this,"onShareVideoDisabled",()=>{this.setState({videoShareMediaSource:null})}),Pc(this,"onShareVideoFailed",()=>{this.setState({showVideoShareFailed:!0})}),Pc(this,"toggleMute",()=>{this.props.scene.emit("action_mute")}),Pc(this,"toggleFreeze",()=>{this.props.scene.emit("action_freeze")}),Pc(this,"shareVideo",e=>{this.props.scene.emit(`action_share_${e}`)}),Pc(this,"endShareVideo",()=>{this.props.scene.emit("action_end_video_sharing")}),Pc(this,"spawnPen",()=>{this.props.scene.emit("penButtonPressed")}),Pc(this,"onSubscribeChanged",Nc(function*(){t.props.subscriptions&&(yield t.props.subscriptions.toggle(),t.updateSubscribedState())})),Pc(this,"handleForceEntry",()=>{this.props.forcedVREntryType&&(this.props.forcedVREntryType.startsWith("daydream")?this.enterDaydream():this.props.forcedVREntryType.startsWith("vr")?this.enterVR():this.props.forcedVREntryType.startsWith("2d")&&this.enter2D())}),Pc(this,"onConcurrentLoad",()=>{if(this.props.disableAutoExitOnConcurrentLoad)return;const e=setInterval(()=>{let e=1/0;if(this.state.autoExitTimerStartedAt){const t=(new Date-this.state.autoExitTimerStartedAt)/1e3;e=Math.max(0,Math.floor(Gc-t))}this.setState({secondsRemainingBeforeAutoExit:e}),this.checkForAutoExit()},500);this.setState({autoExitTimerStartedAt:new Date,autoExitTimerInterval:e})}),Pc(this,"checkForAutoExit",()=>{0===this.state.secondsRemainingBeforeAutoExit&&(this.endAutoExitTimer(),this.exit())}),Pc(this,"exit",e=>{this.props.exitScene(e),this.setState({exited:!0})}),Pc(this,"isWaitingForAutoExit",()=>this.state.secondsRemainingBeforeAutoExit<=Gc),Pc(this,"endAutoExitTimer",()=>{clearInterval(this.state.autoExitTimerInterval),this.setState({autoExitTimerStartedAt:null,autoExitTimerInterval:null,secondsRemainingBeforeAutoExit:1/0})}),Pc(this,"performDirectEntryFlow",function(){var e=Nc(function*(e){t.setState({enterInVR:e,waitingOnAudio:!0}),(yield function(){return Uc.apply(this,arguments)}()).length>0?(yield t.setMediaStreamToDefault(),t.beginOrSkipAudioSetup()):t.pushHistoryState("entry_step","mic_grant"),t.setState({waitingOnAudio:!1})});return function(t){return e.apply(this,arguments)}}()),Pc(this,"enter2D",Nc(function*(){yield t.performDirectEntryFlow(!1)})),Pc(this,"enterVR",Nc(function*(){t.props.forcedVREntryType||t.props.availableVREntryTypes.generic!==di.maybe?yield t.performDirectEntryFlow(!0):t.pushHistoryState("modal","webvr")})),Pc(this,"enterDaydream",Nc(function*(){yield t.performDirectEntryFlow(!0)})),Pc(this,"micDeviceChanged",function(){var e=Nc(function*(e){const i={audio:{deviceId:{exact:[e.target.value]}}};yield t.fetchAudioTrack(i),yield t.setupNewMediaStream()});return function(t){return e.apply(this,arguments)}}()),Pc(this,"setMediaStreamToDefault",Nc(function*(){let e=!1;const{lastUsedMicDeviceId:i}=t.props.store.state.settings;return e=i?yield t.fetchAudioTrack({audio:{deviceId:{ideal:i}}}):yield t.fetchAudioTrack({audio:!0}),yield t.setupNewMediaStream(),{hasAudio:e}})),Pc(this,"fetchAudioTrack",function(){var e=Nc(function*(e){t.state.audioTrack&&t.state.audioTrack.stop();try{const i=(yield navigator.mediaDevices.getUserMedia(e)).getAudioTracks()[0];if(t.setState({audioTrack:i}),/Oculus/.test(navigator.userAgent)){const t=function(){var i=Nc(function*(){console.warn("Oculus Browser 6 bug hit: Audio stream track ended without calling stop. Recreating audio stream.");const i=yield navigator.mediaDevices.getUserMedia(e),a=i.getAudioTracks()[0];NAF.connection.adapter.setLocalMediaStream(i),a.addEventListener("ended",t,{once:!0})});return function(){return i.apply(this,arguments)}}();i.addEventListener("ended",t,{once:!0})}return!0}catch(e){return t.setState({audioTrack:null}),!1}});return function(t){return e.apply(this,arguments)}}()),Pc(this,"setupNewMediaStream",Nc(function*(){const e=new MediaStream;if(yield t.fetchMicDevices(),t.state.audioTrack){e.addTrack(t.state.audioTrack);const i=t.micDeviceIdForMicLabel(t.micLabelForMediaStream(e));i&&t.props.store.update({settings:{lastUsedMicDeviceId:i}})}t.setState({mediaStream:e})})),Pc(this,"onMicGrantButton",Nc(function*(){if(t.props.location.state&&"mic_grant"===t.props.location.state.entry_step){const{hasAudio:e}=yield t.setMediaStreamToDefault();e?t.pushHistoryState("entry_step","mic_granted"):t.beginOrSkipAudioSetup()}else t.beginOrSkipAudioSetup()})),Pc(this,"beginOrSkipAudioSetup",()=>{this.props.forcedVREntryType&&this.props.forcedVREntryType.endsWith("_now")?this.onAudioReadyButton():this.pushHistoryState("entry_step","audio")}),Pc(this,"fetchMicDevices",()=>new Promise(e=>{navigator.mediaDevices.enumerateDevices().then(t=>{this.setState({micDevices:t.filter(e=>"audioinput"===e.kind).map(e=>({deviceId:e.deviceId,label:e.label}))},e)})})),Pc(this,"shouldShowHmdMicWarning",()=>!zc&&!AFRAME.utils.device.isMobileVR()&&(!!this.state.enterInVR&&(!!this.hasHmdMicrophone()&&!Ic.find(e=>this.selectedMicLabel().match(e))))),Pc(this,"hasHmdMicrophone",()=>!!this.state.micDevices.find(e=>Ic.find(t=>e.label.match(t)))),Pc(this,"micLabelForMediaStream",e=>e&&e.getAudioTracks().length>0&&e.getAudioTracks()[0].label||""),Pc(this,"selectedMicLabel",()=>this.micLabelForMediaStream(this.state.mediaStream)),Pc(this,"micDeviceIdForMicLabel",e=>this.state.micDevices.filter(t=>t.label===e).map(e=>e.deviceId)[0]),Pc(this,"selectedMicDeviceId",()=>this.micDeviceIdForMicLabel(this.selectedMicLabel())),Pc(this,"shouldShowFullScreen",()=>(zc||AFRAME.utils.device.isMobileVR())&&!AFRAME.utils.device.isIOS()&&!this.state.enterInVR&&oi.a.enabled),Pc(this,"onAudioReadyButton",()=>{this.state.enterInVR||Object(Fa.a)(),this.props.enterScene(this.state.mediaStream,this.state.enterInVR,this.state.muteOnEntry);const e=this.state.mediaStream;e&&(e.getAudioTracks().length>0&&console.log(`Using microphone: ${e.getAudioTracks()[0].label}`),e.getVideoTracks().length>0&&console.log("Screen sharing enabled.")),this.setState({entered:!0,showShareDialog:!1}),Object(kt.a)(this.props.history)}),Pc(this,"attemptLink",Nc(function*(){t.pushHistoryState("overlay","link");const{code:e,cancel:i,onFinished:a}=yield t.props.linkChannel.generateCode();t.setState({linkCode:e,linkCodeCancel:i}),a.then(()=>{t.setState({log:!1,linkCode:null,linkCodeCancel:null}),t.props.history.goBack()})})),Pc(this,"showShareDialog",()=>{this.props.store.update({activity:{hasOpenedShare:!0}}),this.setState({showShareDialog:!0})}),Pc(this,"toggleShareDialog",Nc(function*(){t.props.store.update({activity:{hasOpenedShare:!0}}),t.setState({showShareDialog:!t.state.showShareDialog})})),Pc(this,"createObject",e=>{this.props.scene.emit("add_media",e)}),Pc(this,"changeScene",e=>{this.props.hubChannel.updateScene(e)}),Pc(this,"setAvatarUrl",e=>{this.props.store.update({profile:Dc({},this.props.store.state.profile,{avatarId:e})})}),Pc(this,"closeDialog",()=>{this.state.dialog?this.setState({dialog:null}):this.props.history.goBack(),Tc()?Cc():Object(Fa.b)()}),Pc(this,"showNonHistoriedDialog",(e,t={})=>{this.setState({dialog:wt.a.createElement(e,Dc({onClose:this.closeDialog},t))})}),Pc(this,"toggleStreamerMode",e=>{document.querySelector("#player-rig").setAttribute("character-controller","fly",e),e?(this.props.hubChannel.beginStreaming(),this.setState({isStreaming:!0,showStreamingTip:!0})):(this.props.hubChannel.endStreaming(),this.setState({isStreaming:!1}))}),Pc(this,"toggleFlyMode",e=>{document.querySelector("#player-rig").setAttribute("character-controller","fly",e),this.setState({flyingEnabled:e})}),Pc(this,"renderDialog",(e,t={})=>wt.a.createElement(e,Dc({onClose:this.closeDialog},t))),Pc(this,"showSignInDialog",()=>{this.showNonHistoriedDialog(Ln.a,{message:Xi.b["sign-in.prompt"],onSignIn:function(){var e=Nc(function*(e){const{authComplete:i}=yield t.props.authChannel.startAuthentication(e,t.props.hubChannel);t.showNonHistoriedDialog(Ln.a,{authStarted:!0}),yield i,t.setState({signedIn:!0}),t.closeDialog()});return function(t){return e.apply(this,arguments)}}()})}),Pc(this,"signOut",Nc(function*(){yield t.props.authChannel.signOut(t.props.hubChannel),t.setState({signedIn:!1})})),Pc(this,"showWebRTCScreenshareUnsupportedDialog",()=>{this.pushHistoryState("modal","webrtc-screenshare")}),Pc(this,"onMiniInviteClicked",()=>{const e="https://hub.link/"+this.props.hubId;this.setState({miniInviteActivated:!0}),setTimeout(()=>{this.setState({miniInviteActivated:!1})},5e3),gi()?navigator.share({title:document.title,url:e}):ei()(e)}),Pc(this,"sendMessage",e=>{this.props.onSendMessage(e)}),Pc(this,"occupantCount",()=>this.props.presences?Object.entries(this.props.presences).length:0),Pc(this,"onStoreChanged",()=>{const e=this.props.store.state.confirmedBroadcastedRooms.includes(this.props.hubId);e!==this.state.broadcastTipDismissed&&this.setState({broadcastTipDismissed:e})}),Pc(this,"confirmBroadcastedRoom",()=>{this.props.store.update({confirmedBroadcastedRooms:[this.props.hubId]})}),Pc(this,"discordBridges",()=>this.props.presences?Object(s.c)(this.props.presences):[]),Pc(this,"hasEmbedPresence",()=>{if(!this.props.presences)return!1;for(const e of Object.values(this.props.presences))for(const t of e.metas)if(t.context&&t.context.embed)return!0;return!1}),Pc(this,"pushHistoryState",(e,t)=>Object(kt.e)(this.props.history,e,t)),Pc(this,"renderInterstitialPrompt",()=>wt.a.createElement(ii.b,{locale:Xi.a,messages:Xi.b},wt.a.createElement("div",{className:Ei.a.interstitial,onClick:()=>this.props.onInterstitialPromptClicked()},wt.a.createElement("div",null,wt.a.createElement(ii.a,{id:"interstitial.prompt"}))))),Pc(this,"renderExitedPane",()=>{let e=null;if("closed"===this.props.roomUnavailableReason)e=wt.a.createElement("div",null,"Sorry, this room is no longer available.",wt.a.createElement("p",null),"A room may be closed if we receive reports that it violates our"," ",wt.a.createElement(ki.b,null,wt.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"https://github.com/mozilla/hubs/blob/master/TERMS.md"},"Terms of Use")),".",wt.a.createElement("br",null),"If you have questions, contact us at"," ",wt.a.createElement(ki.b,null,wt.a.createElement("a",{href:"mailto:hubs@mozilla.com"},"hubs@mozilla.com")),".",wt.a.createElement("p",null),"If you'd like to run your own server, hubs's source code is available on"," ",wt.a.createElement(ki.b,null,wt.a.createElement("a",{href:"https://github.com/mozilla/hubs"},"GitHub")),".");else if("no_data_channels"===this.props.platformUnsupportedReason)e=wt.a.createElement("div",null,"Your browser does not support"," ",wt.a.createElement(ki.b,null,wt.a.createElement("a",{href:"https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/createDataChannel#Browser_compatibility",rel:"noreferrer noopener"},"WebRTC Data Channels")),", which is required to use Hubs.",wt.a.createElement("br",null),'If you"d like to use Hubs with Oculus or SteamVR, you can'," ",wt.a.createElement(ki.b,null,wt.a.createElement("a",{href:"https://www.mozilla.org/firefox",rel:"noreferrer noopener"},"Download Firefox")),".");else{const t=`exit.subtitle.${this.props.roomUnavailableReason||this.props.platformUnsupportedReason||"exited"}`;e=wt.a.createElement("div",null,wt.a.createElement(ii.a,{id:t}),wt.a.createElement("p",null),!["left","disconnected"].includes(this.props.roomUnavailableReason)&&wt.a.createElement("div",null,"You can also"," ",wt.a.createElement(ki.b,null,wt.a.createElement("a",{href:"/"},"create a new room")),"."))}return wt.a.createElement(ii.b,{locale:Xi.a,messages:Xi.b},wt.a.createElement("div",{className:"exited-panel"},wt.a.createElement("img",{className:"exited-panel__logo",src:Tt.a}),wt.a.createElement("div",{className:"exited-panel__subtitle"},e)))}),Pc(this,"renderBotMode",()=>wt.a.createElement("div",{className:"loading-panel"},wt.a.createElement("img",{className:"loading-panel__logo",src:Tt.a}),wt.a.createElement("input",{type:"file",id:"bot-audio-input",accept:"audio/*"}),wt.a.createElement("input",{type:"file",id:"bot-data-input",accept:"application/json"}))),Pc(this,"renderEntryStartPanel",()=>{const{hasAcceptedProfile:e,hasChangedName:t}=this.props.store.state.activity,i=this.props.hubIsBound?!e:!t;return wt.a.createElement("div",{className:Si.a.entryPanel},wt.a.createElement("div",{className:Si.a.name},wt.a.createElement("span",null,this.props.hubName),wt.a.createElement("span",null),wt.a.createElement("button",{onClick:()=>this.setState({watching:!0}),className:Si.a.collapseButton},wt.a.createElement("i",null,wt.a.createElement(ya.a,{icon:xa.faTimes}))),!1),wt.a.createElement("div",{className:Si.a.roomSubtitle},wt.a.createElement(ii.a,{id:"entry.lobby"})),wt.a.createElement("div",{className:Si.a.center},wt.a.createElement(no,{occupantCount:this.occupantCount(),discordBridges:this.discordBridges(),onSendMessage:this.sendMessage})),this.state.waitingOnAudio?wt.a.createElement("div",null,wt.a.createElement("div",{className:"loader-wrap loader-mid"},wt.a.createElement("div",{className:"loader"},wt.a.createElement("div",{className:"loader-center"})))):wt.a.createElement("div",{className:Si.a.buttonContainer},!Wc&&wt.a.createElement("a",{onClick:e=>{e.preventDefault(),this.attemptLink()},className:Jt()([Si.a.secondaryActionButton,Si.a.wideButton])},wt.a.createElement(ii.a,{id:"entry.device-medium"}),wt.a.createElement("div",{className:Si.a.buttonSubtitle},wt.a.createElement(ii.a,{id:zc?"entry.device-subtitle-mobile":"entry.device-subtitle-desktop"}))),i||!this.props.forcedVREntryType?wt.a.createElement(Ci.a,{stateKey:"entry_step",stateValue:i?"profile":"device",history:this.props.history,className:Jt()([Si.a.actionButton,Si.a.wideButton])},wt.a.createElement(ii.a,{id:"entry.enter-room"})):wt.a.createElement("a",{onClick:e=>{e.preventDefault(),this.handleForceEntry()},className:Jt()([Si.a.actionButton,Si.a.wideButton])},wt.a.createElement(ii.a,{id:"entry.enter-room"}))))}),Pc(this,"renderDevicePanel",()=>wt.a.createElement("div",{className:Si.a.entryPanel},wt.a.createElement("div",{onClick:()=>this.props.history.goBack(),className:Si.a.back},wt.a.createElement("i",null,wt.a.createElement(ya.a,{icon:Rc.faArrowLeft})),wt.a.createElement(ii.a,{id:"entry.back"})),wt.a.createElement("div",{className:Si.a.title},wt.a.createElement(ii.a,{id:"entry.choose-device"})),this.state.waitingOnAudio?wt.a.createElement("div",{className:Si.a.audioLoader},wt.a.createElement("div",{className:"loader-wrap loader-mid"},wt.a.createElement("div",{className:"loader"},wt.a.createElement("div",{className:"loader-center"})))):wt.a.createElement("div",{className:Si.a.buttonContainer},this.props.availableVREntryTypes.cardboard!==di.no&&wt.a.createElement("div",{className:Si.a.secondary,onClick:this.enterVR},wt.a.createElement(ii.a,{id:"entry.cardboard"})),this.props.availableVREntryTypes.generic!==di.no&&wt.a.createElement(va,{secondary:!0,onClick:this.enterVR}),this.props.availableVREntryTypes.daydream===di.yes&&wt.a.createElement(fa,{secondary:!0,onClick:this.enterDaydream,subtitle:null}),this.props.availableVREntryTypes.screen===di.yes&&wt.a.createElement(ga,{onClick:this.enter2D})))),Pc(this,"renderMicPanel",e=>wt.a.createElement("div",{className:"mic-grant-panel"},wt.a.createElement("div",{onClick:()=>this.props.history.goBack(),className:Si.a.back},wt.a.createElement("i",null,wt.a.createElement(ya.a,{icon:Rc.faArrowLeft})),wt.a.createElement(ii.a,{id:"entry.back"})),wt.a.createElement("div",{className:"mic-grant-panel__grant-container"},wt.a.createElement("div",{className:"mic-grant-panel__title"},wt.a.createElement(ii.a,{id:e?"audio.granted-title":"audio.grant-title"})),wt.a.createElement("div",{className:"mic-grant-panel__subtitle"},wt.a.createElement(ii.a,{id:e?"audio.granted-subtitle":"audio.grant-subtitle"})),wt.a.createElement("div",{className:"mic-grant-panel__button-container"},e?wt.a.createElement(ki.b,null,wt.a.createElement("button",{className:"mic-grant-panel__button",onClick:this.onMicGrantButton},wt.a.createElement("img",{src:Mt.a,srcSet:Pt.a+" 2x"}))):wt.a.createElement(ki.b,null,wt.a.createElement("button",{className:"mic-grant-panel__button",onClick:this.onMicGrantButton},wt.a.createElement("img",{src:Nt.a,srcSet:It.a+" 2x"})))),wt.a.createElement("div",{className:"mic-grant-panel__next-container"},wt.a.createElement(ki.b,null,wt.a.createElement("button",{className:Jt()("mic-grant-panel__next"),onClick:this.onMicGrantButton},wt.a.createElement(ii.a,{id:"audio.granted-next"}))))))),Pc(this,"renderAudioSetupPanel",()=>{const e=qc?"audio.subtitle-mobile":"audio.subtitle-desktop";return wt.a.createElement("div",{className:"audio-setup-panel"},wt.a.createElement("div",{onClick:()=>this.props.history.goBack(),className:Si.a.back},wt.a.createElement("i",null,wt.a.createElement(ya.a,{icon:Rc.faArrowLeft})),wt.a.createElement(ii.a,{id:"entry.back"})),wt.a.createElement("div",null,wt.a.createElement("div",{className:"audio-setup-panel__title"},wt.a.createElement(ii.a,{id:"audio.title"})),wt.a.createElement("div",{className:"audio-setup-panel__subtitle"},(qc||this.state.enterInVR)&&wt.a.createElement(ii.a,{id:e})),wt.a.createElement("div",{className:"audio-setup-panel__levels"},wt.a.createElement(Ar,{hasAudioTrack:!!this.state.audioTrack,muteOnEntry:this.state.muteOnEntry,mediaStream:this.state.mediaStream}),wt.a.createElement(Gr,null)),this.state.audioTrack&&this.state.micDevices.length>1?wt.a.createElement("div",{className:"audio-setup-panel__device-chooser"},wt.a.createElement(ki.b,null,wt.a.createElement("select",{className:"audio-setup-panel__device-chooser__dropdown",value:this.selectedMicDeviceId(),onChange:this.micDeviceChanged},this.state.micDevices.map(e=>wt.a.createElement("option",{key:e.deviceId,value:e.deviceId},"     ",e.label)))),wt.a.createElement("img",{className:"audio-setup-panel__device-chooser__mic-icon",src:Lt.a,srcSet:Bt.a+" 2x"}),wt.a.createElement("img",{className:"audio-setup-panel__device-chooser__dropdown-arrow",src:Ut.a,srcSet:Wt.a+" 2x"})):wt.a.createElement("div",null),this.shouldShowHmdMicWarning()&&wt.a.createElement("div",{className:"audio-setup-panel__hmd-mic-warning"},wt.a.createElement("img",{src:Gt.a,srcSet:$t.a+" 2x",className:"audio-setup-panel__hmd-mic-warning__icon"}),wt.a.createElement("span",{className:"audio-setup-panel__hmd-mic-warning__label"},wt.a.createElement(ii.a,{id:"audio.hmd-mic-warning"})))),wt.a.createElement("div",{className:"audio-setup-panel__mute-container"},wt.a.createElement("input",{id:"mute-on-entry",type:"checkbox",onChange:()=>this.setState({muteOnEntry:!this.state.muteOnEntry}),checked:this.state.muteOnEntry}),wt.a.createElement("label",{htmlFor:"mute-on-entry"},wt.a.createElement(ii.a,{id:"entry.mute-on-entry"}))),wt.a.createElement("div",{className:"audio-setup-panel__enter-button-container"},wt.a.createElement(ki.b,null,wt.a.createElement("button",{className:"audio-setup-panel__enter-button",onClick:this.onAudioReadyButton},wt.a.createElement(ii.a,{id:"audio.enter-now"})))))}),Pc(this,"isInModalOrOverlay",()=>!(!this.state.entered||!jc.find(e=>Object(kt.g)(this.props.history.location).startsWith(e))&&!Lc.find(e=>new URLSearchParams(this.props.history.location.search).get(e)))||(!(this.state.entered||!Fc.find(e=>Object(kt.g)(this.props.history.location).startsWith(e))&&!Bc.find((e,t)=>new URLSearchParams(this.props.history.location.search).get(e)===Vc[t]))||!!(this.props.history&&this.props.history.location.state&&(this.props.history.location.state.modal||this.props.history.location.state.overlay)||this.state.dialog))),e.showSafariMicDialog&&(this.state.dialog=wt.a.createElement(jn,{closable:!1})),e.showSafariDialog&&(this.state.dialog=wt.a.createElement(Hn,{closable:!1})),e.showWebAssemblyDialog&&(this.state.dialog=wt.a.createElement(ps,{closable:!1})),e.mediaSearchStore.setHistory(e.history),this.exitEventHandler=()=>this.exit(),this.state.airtableAssets=ti.b}componentDidUpdate(e){const{hubChannel:t,showSignInDialog:i}=this.props;if(t){const{signedIn:e}=t;e!==this.state.signedIn&&this.setState({signedIn:e})}e.showSignInDialog!==i&&(i?this.showContextualSignInDialog():this.closeDialog()),!this.willCompileAndUploadMaterials&&this.state.noMoreLoadingUpdates&&(this.willCompileAndUploadMaterials=!0,window.requestAnimationFrame(()=>{window.setTimeout(()=>{this.props.isBotMode||this.props.scene.renderer.compileAndUploadMaterials(this.props.scene.object3D,this.props.scene.camera),this.state.hideLoader||this.setState({hideLoader:!0})},0)}))}componentDidMount(){window.addEventListener("concurrentload",this.onConcurrentLoad),document.querySelector(".a-canvas").addEventListener("mouseup",()=>{this.state.showShareDialog&&this.setState({showShareDialog:!1})}),this.props.scene.addEventListener("didConnectToNetworkedScene",()=>{this.setState({didConnectToNetworkedScene:!0})},{once:!0}),this.props.scene.addEventListener("loaded",this.onSceneLoaded),this.props.scene.addEventListener("stateadded",this.onAframeStateChanged),this.props.scene.addEventListener("stateremoved",this.onAframeStateChanged),this.props.scene.addEventListener("share_video_enabled",this.onShareVideoEnabled),this.props.scene.addEventListener("share_video_disabled",this.onShareVideoDisabled),this.props.scene.addEventListener("share_video_failed",this.onShareVideoFailed),this.props.scene.addEventListener("exit",this.exitEventHandler),this.props.scene.addEventListener("action_exit_watch",()=>this.setState({watching:!1,hide:!1}));const e=this.props.scene;this.props.store.addEventListener("statechanged",this.onStoreChanged);const t=this.props.history.listen((e,i)=>{const a=e.state;if("POP"===i&&a&&a.entry_step&&this.state.entered)return t(),void Object(kt.b)(this.props.history)});this.props.history.location.state&&!Object(kt.g)(this.props.history.location).startsWith("/media")&&Object(kt.c)(this.props.history),this.setState({audioContext:{playSound:t=>{e.emit(t)},onMouseLeave:()=>{}}}),this.props.forcedVREntryType&&this.props.forcedVREntryType.endsWith("_now")&&setTimeout(()=>this.handleForceEntry(),2e3),ti.a.find("recHqITRS7cBMwn9i",(e,t)=>this.setState({airtableAssets:t.fields}))}componentWillUnmount(){this.props.scene.removeEventListener("loaded",this.onSceneLoaded),this.props.scene.removeEventListener("exit",this.exitEventHandler),this.props.scene.removeEventListener("share_video_enabled",this.onShareVideoEnabled),this.props.scene.removeEventListener("share_video_disabled",this.onShareVideoDisabled),this.props.scene.removeEventListener("share_video_failed",this.onShareVideoFailed)}render(){if(this.props.hide||this.state.hide)return wt.a.createElement("div",null);const e=this.state.exited||this.props.roomUnavailableReason||this.props.platformUnsupportedReason,t=this.props.showPreload,i=!(t||this.state.hideLoader&&this.state.didConnectToNetworkedScene||this.props.showSafariMicDialog||this.props.showSafariDialog||this.props.showWebAssemblyDialog),a={[Ei.a.ui]:!0,"ui-root":!0,"in-modal-or-overlay":this.isInModalOrOverlay()},n=navigator.serviceWorker&&"PushManager"in window;if(this.props.showOAuthDialog&&!this.props.showInterstitialPrompt)return wt.a.createElement(ii.b,{locale:Xi.a,messages:Xi.b},wt.a.createElement("div",{className:Jt()(a)},wt.a.createElement(Ds,{onClose:this.props.onCloseOAuthDialog,oauthInfo:this.props.oauthInfo})));if(e)return this.renderExitedPane();if(i)return wt.a.createElement(ea,{loadingIcon:this.state.airtableAssets.Icon,scene:this.props.scene,finished:this.state.noMoreLoadingUpdates,onLoaded:this.onLoadingFinished});if(this.props.showInterstitialPrompt)return this.renderInterstitialPrompt();if(this.props.isBotMode)return this.renderBotMode();const o=this.props.embed,r=this.state.entered,c=this.state.watching,l=r||c,d=r||c||t,h=`${location.protocol}//${location.host}${location.pathname}`,u=!!(this.props.history&&this.props.history.location.state&&this.props.history.location.state.entry_step),p=this.props.availableVREntryTypes&&!t&&(this.isWaitingForAutoExit()?wt.a.createElement(ia,{secondsRemaining:this.state.secondsRemainingBeforeAutoExit,onCancel:this.endAutoExitTimer}):wt.a.createElement("div",{className:Si.a.entryDialog},wt.a.createElement(Pi,{stateKey:"entry_step",stateValue:"device",history:this.props.history},this.renderDevicePanel()),wt.a.createElement(Pi,{stateKey:"entry_step",stateValue:"mic_grant",history:this.props.history},this.renderMicPanel(!1)),wt.a.createElement(Pi,{stateKey:"entry_step",stateValue:"mic_granted",history:this.props.history},this.renderMicPanel(!0)),wt.a.createElement(Pi,{stateKey:"entry_step",stateValue:"audio",history:this.props.history},this.renderAudioSetupPanel()),wt.a.createElement(Pi,{stateKey:"entry_step",stateValue:"",history:this.props.history},this.renderEntryStartPanel()))),m=Jt()({[Ei.a.uiInteractive]:!this.isInModalOrOverlay(),[Ei.a.uiDialogBoxContents]:!0,[Ei.a.backgrounded]:this.isInModalOrOverlay()}),g=r&&Wc,v=this.props.presenceLogEntries||[],f=this.props.mediaSearchStore.getUrlMediaSource(this.props.history.location),b=f&&(["scenes","avatars","favorites"].includes(f)||this.state.entered),y=this.props.activeTips&&this.props.activeTips.top||this.state.showVideoShareFailed,_=function(e){const{search:t}=e,i=new URLSearchParams(t),a=Object(kt.g)(e);return a.startsWith("/client")||i.get("client_id")?i.get("client_id")||a.substring(9):null}(this.props.history.location),E=!!_,w=this.discordBridges(),S=w.map(e=>"#"+e).join(", "),x=this.hasEmbedPresence(),A=w.length>0,k=(A||x&&!this.props.embed)&&!this.state.broadcastTipDismissed,C=!(g||y||r||o||t||c||y||u||this.props.store.state.activity.hasOpenedShare||!(this.occupantCount()<=1)),T=this.props.hubIsBound?Object(s.g)(this.props.presences,this.props.sessionId).displayName:null,R=this.state.isStreaming,M=R&&this.state.showStreamingTip&&wt.a.createElement("div",{className:Jt()([Ei.a.streamingTip])},wt.a.createElement("div",{className:Jt()([Ei.a.streamingTipAttachPoint])}),wt.a.createElement("button",{title:"Dismiss",className:Ei.a.streamingTipClose,onClick:()=>this.setState({showStreamingTip:!1})},wt.a.createElement(ya.a,{icon:xa.faTimes})),wt.a.createElement("div",{className:Ei.a.streamingTipMessage},wt.a.createElement(ii.a,{id:"tips.streaming"}))),D=Object(H.b)(),P=D&&D.displayName;return wt.a.createElement(ki.a.Provider,{value:this.state.audioContext},wt.a.createElement(ii.b,{locale:Xi.a,messages:Xi.b},wt.a.createElement("div",{className:Jt()(a)},this.state.dialog,t&&wt.a.createElement(dc,{hubName:this.props.hubName,hubScene:this.props.hubScene,baseUrl:h,onLoadClicked:this.props.onPreloadLoadClicked,logo:this.state.DarkLogo}),wt.a.createElement(Pi,{stateKey:"overlay",stateValue:"profile",history:this.props.history,render:e=>wt.a.createElement(Ma,Mc({},e,{displayNameOverride:T,finished:()=>this.pushHistoryState(),onClose:()=>this.pushHistoryState(),store:this.props.store,mediaSearchStore:this.props.mediaSearchStore,avatarId:e.location.state.detail&&e.location.state.detail.avatarId,logo:this.state.airtableAssets.DarkLogo}))}),wt.a.createElement(Pi,{stateKey:"overlay",stateValue:"avatar-editor",history:this.props.history,render:e=>wt.a.createElement(cr,{className:Ei.a.avatarEditor,signedIn:this.state.signedIn,onSignIn:this.showSignInDialog,onSave:()=>{e.location.state.detail&&e.location.state.detail.returnToProfile?this.props.history.goBack():(this.props.history.goBack(),this.props.mediaSearchStore.sourceNavigateWithNoNav("avatars")),this.props.onAvatarSaved()},onClose:()=>this.props.history.goBack(),store:this.props.store,debug:Hc,avatarId:e.location.state.detail&&e.location.state.detail.avatarId,hideDelete:e.location.state.detail&&e.location.state.detail.hideDelete})}),b&&wt.a.createElement(Ya,{history:this.props.history,mediaSearchStore:this.props.mediaSearchStore,hubChannel:this.props.hubChannel,onMediaSearchResultEntrySelected:e=>{"hub"===e.type?this.showNonHistoriedDialog(Ss,{destinationUrl:e.url,messageType:"join-room"}):this.props.onMediaSearchResultEntrySelected(e)},performConditionalSignIn:this.props.performConditionalSignIn}),wt.a.createElement(Pi,{stateKey:"entry_step",stateValue:"profile",history:this.props.history,render:e=>wt.a.createElement(Ma,Mc({},e,{displayNameOverride:T,finished:()=>{this.props.forcedVREntryType?(this.pushHistoryState(),this.handleForceEntry()):this.pushHistoryState("entry_step","device")},onClose:()=>this.pushHistoryState(),store:this.props.store,mediaSearchStore:this.props.mediaSearchStore,avatarId:e.location.state.detail&&e.location.state.detail.avatarId,logo:this.state.airtableAssets.DarkLogo}))}),wt.a.createElement(Pi,{stateKey:"modal",stateValue:"room_settings",history:this.props.history,render:()=>this.renderDialog(Wn,{initialSettings:{name:this.props.hubName,member_permissions:this.props.hubMemberPermissions},onChange:e=>this.props.hubChannel.updateHub(e)})}),wt.a.createElement(Pi,{stateKey:"modal",stateValue:"close_room",history:this.props.history,render:()=>this.renderDialog($n,{onConfirm:()=>this.props.hubChannel.closeHub()})}),wt.a.createElement(Pi,{stateKey:"modal",stateValue:"help",history:this.props.history,render:()=>this.renderDialog(wn)}),wt.a.createElement(Pi,{stateKey:"modal",stateValue:"support",history:this.props.history,render:()=>this.renderDialog(Cn,{hubChannel:this.props.hubChannel})}),wt.a.createElement(Pi,{stateKey:"modal",stateValue:"create",history:this.props.history,render:()=>this.renderDialog(un,{onCreate:this.createObject})}),wt.a.createElement(Pi,{stateKey:"modal",stateValue:"change_scene",history:this.props.history,render:()=>this.renderDialog(vn,{onChange:this.changeScene})}),wt.a.createElement(Pi,{stateKey:"modal",stateValue:"avatar_url",history:this.props.history,render:()=>this.renderDialog(_n,{onChange:this.setAvatarUrl})}),wt.a.createElement(Pi,{stateKey:"modal",stateValue:"webvr",history:this.props.history,render:()=>this.renderDialog(gs)}),wt.a.createElement(Pi,{stateKey:"modal",stateValue:"webrtc-screenshare",history:this.props.history,render:()=>this.renderDialog(hs)}),wt.a.createElement(Pi,{stateKey:"modal",stateValue:"room_info",history:this.props.history,render:()=>this.renderDialog(Cs,{scene:this.props.hubScene,hubName:this.props.hubName})}),wt.a.createElement(Pi,{stateKey:"modal",stateValue:"feedback",history:this.props.history,render:()=>this.renderDialog(ys,{history:this.props.history,onClose:()=>this.pushHistoryState("modal",null)})}),wt.a.createElement(Pi,{stateKey:"modal",stateValue:"tweet",history:this.props.history,render:()=>this.renderDialog(Js,{history:this.props.history,onClose:this.closeDialog})}),E&&wt.a.createElement($i,{clientId:_,onClose:this.closeDialog,history:this.props.history,presences:this.props.presences,hubChannel:this.props.hubChannel,showNonHistoriedDialog:this.showNonHistoriedDialog,performConditionalSignIn:this.props.performConditionalSignIn}),(!l||this.isWaitingForAutoExit())&&wt.a.createElement("div",{className:Ei.a.uiDialog},wt.a.createElement(Kr,{entries:v,presences:this.props.presences,hubId:this.props.hubId,history:this.props.history}),wt.a.createElement("div",{className:m},p)),d&&wt.a.createElement(Kr,{inRoom:!0,presences:this.props.presences,entries:v,hubId:this.props.hubId,history:this.props.history}),r&&this.props.activeTips&&this.props.activeTips.bottom&&(!v||0===v.length)&&!k&&wt.a.createElement(ls,{tip:this.props.activeTips.bottom,tipRegion:"bottom",pushHistoryState:this.pushHistoryState}),d&&k&&wt.a.createElement(ls,{tip:A?"discord":"embed",broadcastTarget:S,onClose:()=>this.confirmBroadcastedRoom()}),d&&wt.a.createElement(Zo,{discordBridges:w,onSendMessage:this.sendMessage,onObjectCreated:this.createObject,enableSpawning:r,history:this.props.history}),this.state.frozen&&wt.a.createElement("button",{className:Ei.a.leaveButton,onClick:()=>this.exit("left")},wt.a.createElement(ii.a,{id:"entry.leave-room"})),!this.state.frozen&&!c&&!t&&wt.a.createElement("div",{className:Jt()({[Ai.a.inviteContainer]:!0,[Ai.a.inviteContainerBelowHud]:r,[Ai.a.inviteContainerInverted]:this.state.showShareDialog})},!1,!1,C&&wt.a.createElement("div",{className:Ei.a.inviteTip},wt.a.createElement("div",{className:Ei.a.inviteTipAttachPoint}),wt.a.createElement(ii.a,{id:`entry.${zc?"mobile":"desktop"}.invite-tip`})),!o&&!g&&this.occupantCount()>1&&!y&&r&&!R&&wt.a.createElement(ki.b,null,wt.a.createElement("button",{onClick:this.onMiniInviteClicked,className:Ai.a.inviteMiniButton},wt.a.createElement("span",null,this.state.miniInviteActivated?navigator.share?"sharing...":"copied!":"hub.link/"+this.props.hubId))),g&&wt.a.createElement(ki.b,null,wt.a.createElement("button",{className:Ai.a.enterButton,onClick:()=>Cc(!0)},wt.a.createElement(ii.a,{id:"entry.enter-in-vr"}))),o&&wt.a.createElement("a",{href:h,className:Ai.a.enterButton,target:"_blank",rel:"noopener noreferrer"},wt.a.createElement(ii.a,{id:"entry.open-in-window"})),this.state.showShareDialog&&wt.a.createElement(xn,{allowShare:!Wc,entryCode:this.props.hubEntryCode,embedUrl:this.props.embedToken&&!qc?`${h}?embed_token=${this.props.embedToken}`:null,hasPush:n,isSubscribed:void 0===this.state.isSubscribed?this.props.initialIsSubscribed:this.state.isSubscribed,onSubscribeChanged:()=>this.onSubscribeChanged(),hubId:this.props.hubId,onClose:()=>this.setState({showShareDialog:!1})})),wt.a.createElement(Pi,{stateKey:"overlay",stateValue:"invite",history:this.props.history,render:()=>wt.a.createElement(xn,{allowShare:!!navigator.share,entryCode:this.props.hubEntryCode,hubId:this.props.hubId,isModal:!0,onClose:()=>{this.props.history.goBack(),Cc()}})}),wt.a.createElement(Pi,{stateKey:"overlay",stateValue:"link",history:this.props.history,render:()=>wt.a.createElement(Pn,{linkCode:this.state.linkCode,onClose:()=>{this.state.linkCodeCancel(),this.setState({linkCode:null,linkCodeCancel:null}),this.props.history.goBack()}})}),R&&wt.a.createElement("button",{title:"Exit Camera Mode",onClick:()=>this.toggleStreamerMode(!1),className:Jt()([Ei.a.cornerButton,Ei.a.cameraModeExitButton])},wt.a.createElement(ya.a,{icon:xa.faTimes})),M,wt.a.createElement(jo,{history:this.props.history,presences:this.props.presences,sessionId:this.props.sessionId,signedIn:this.state.signedIn,email:this.props.store.state.credentials.email,onSignIn:this.showSignInDialog,onSignOut:this.signOut}),!R&&!t&&wt.a.createElement(oc,{history:this.props.history,mediaSearchStore:this.props.mediaSearchStore,isStreaming:R,toggleStreamerMode:this.toggleStreamerMode,hubChannel:this.props.hubChannel,hubScene:this.props.hubScene,scene:this.props.scene,performConditionalSignIn:this.props.performConditionalSignIn,showNonHistoriedDialog:this.showNonHistoriedDialog,pushHistoryState:this.pushHistoryState,toggleFlyMode:this.toggleFlyMode}),!r&&!R&&!zc&&P&&wt.a.createElement(Ec,{name:P}),l&&wt.a.createElement("div",{className:Ei.a.topHud},wt.a.createElement(bc.TopHUD,{history:this.props.history,mediaSearchStore:this.props.mediaSearchStore,muted:this.state.muted,frozen:this.state.frozen,watching:this.state.watching,onWatchEnded:()=>this.setState({watching:!1}),videoShareMediaSource:this.state.videoShareMediaSource,showVideoShareFailed:this.state.showVideoShareFailed,hideVideoShareFailedTip:()=>this.setState({showVideoShareFailed:!1}),activeTip:this.props.activeTips&&this.props.activeTips.top,isCursorHoldingPen:this.props.isCursorHoldingPen,hasActiveCamera:this.props.hasActiveCamera,onToggleMute:this.toggleMute,onToggleFlying:this.toggleFlyMode,flyingEnabled:this.state.flyingEnabled,onToggleFreeze:this.toggleFreeze,onSpawnPen:this.spawnPen,onSpawnCamera:()=>this.props.scene.emit("action_toggle_camera"),onShareVideo:this.shareVideo,onEndShareVideo:this.endShareVideo,onShareVideoNotCapable:()=>this.showWebRTCScreenshareUnsupportedDialog(),isStreaming:R,showStreamingTip:this.state.showStreamingTip,hideStreamingTip:()=>{this.setState({showStreamingTip:!1})}}),wt.a.createElement("div",{className:Ei.a.nagCornerButton},wt.a.createElement("button",{onClick:()=>this.setState({hide:!0})},wt.a.createElement(ii.a,{id:"hide-ui.prompt"}))),!1))))}}Pc(Yc,"propTypes",{enterScene:Qt.a.func,exitScene:Qt.a.func,onSendMessage:Qt.a.func,disableAutoExitOnConcurrentLoad:Qt.a.bool,forcedVREntryType:Qt.a.string,isBotMode:Qt.a.bool,store:Qt.a.object,mediaSearchStore:Qt.a.object,scene:Qt.a.object,authChannel:Qt.a.object,hubChannel:Qt.a.object,linkChannel:Qt.a.object,hubEntryCode:Qt.a.number,availableVREntryTypes:Qt.a.object,environmentSceneLoaded:Qt.a.bool,roomUnavailableReason:Qt.a.string,platformUnsupportedReason:Qt.a.string,hubId:Qt.a.string,hubName:Qt.a.string,hubMemberPermissions:Qt.a.object,hubScene:Qt.a.object,hubIsBound:Qt.a.bool,isSupportAvailable:Qt.a.bool,presenceLogEntries:Qt.a.array,presences:Qt.a.object,sessionId:Qt.a.string,subscriptions:Qt.a.object,initialIsSubscribed:Qt.a.bool,initialIsFavorited:Qt.a.bool,showSignInDialog:Qt.a.bool,signInMessageId:Qt.a.string,signInCompleteMessageId:Qt.a.string,signInContinueTextId:Qt.a.string,onContinueAfterSignIn:Qt.a.func,showSafariDialog:Qt.a.bool,showSafariMicDialog:Qt.a.bool,showWebAssemblyDialog:Qt.a.bool,showOAuthDialog:Qt.a.bool,onCloseOAuthDialog:Qt.a.func,oauthInfo:Qt.a.array,isCursorHoldingPen:Qt.a.bool,hasActiveCamera:Qt.a.bool,onMediaSearchResultEntrySelected:Qt.a.func,onAvatarSaved:Qt.a.func,activeTips:Qt.a.object,location:Qt.a.object,history:Qt.a.object,showInterstitialPrompt:Qt.a.bool,onInterstitialPromptClicked:Qt.a.func,performConditionalSignIn:Qt.a.func,hide:Qt.a.bool,showPreload:Qt.a.bool,onPreloadLoadClicked:Qt.a.func,embed:Qt.a.bool,embedToken:Qt.a.string,onLoaded:Qt.a.func});var $c=Yc,Xc=i(374),Qc=i(143),Kc=i.n(Qc),Jc=i(82),Zc=i(128);function el(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}function tl(e){return function(){var t=this,i=arguments;return new Promise(function(a,n){var s=e.apply(t,i);function o(e){el(s,a,n,o,r,"next",e)}function r(e){el(s,a,n,o,r,"throw",e)}o(void 0)})}}function il(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const al=864e5,nl=2592e6;function sl(e,t){return e.getFullYear()==t.getFullYear()&&e.getMonth()==t.getMonth()}const ol=["update_hub","update_roles","close_hub","mute_users","kick_users"],rl=ol+["tweet","spawn_camera","spawn_drawing","spawn_and_move_media","pin_objects"];class cl extends Jc.a{constructor(e,t){var i;super(),i=this,il(this,"setPhoenixChannel",e=>{this.channel=e,this.presence=new Zc.a(e)}),il(this,"setPermissionsFromToken",e=>{this._permissions=Kc()(e),this.dispatchEvent(new CustomEvent("permissions_updated"));const t=new Date(1e3*this._permissions.exp-6e4)-new Date;setTimeout(tl(function*(){const e=yield i.fetchPermissions();i.dispatchEvent(new CustomEvent("permissions-refreshed",{detail:e}))}),t)}),il(this,"sendEntryEvent",tl(function*(){if(!i.channel)return void console.warn("No phoenix channel initialized before room entry.");let e="Screen";if(navigator.getVRDisplays){const t=(yield navigator.getVRDisplays()).find(e=>e.isPresenting);t&&(e=t.displayName)}let t=0;NAF.connection.adapter&&NAF.connection.adapter.publisher&&(t=NAF.connection.adapter.publisher.initialOccupants.length);const a=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},a=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),a.forEach(function(t){il(e,t,i[t])})}return e}({},i.getEntryTimingFlags(),{initialOccupantCount:t,entryDisplayType:e,userAgent:navigator.userAgent});i.channel.push("events:entered",a)})),il(this,"getEntryTimingFlags",()=>{const e={isNewDaily:!0,isNewMonthly:!0,isNewDayWindow:!0,isNewMonthWindow:!0},t=this.store.state.activity.lastEnteredAt;if(!t)return e;const i=new Date,a=new Date(t),n=i-a;return e.isNewDaily=!function(e,t){return sl(e,t)&&e.getDate()==t.getDate()}(i,a),e.isNewMonthly=!sl(i,a),e.isNewDayWindow=n>al,e.isNewMonthWindow=n>nl,e}),il(this,"sendObjectSpawnedEvent",e=>{if(!this.channel)return void console.warn("No phoenix channel initialized before object spawn.");const t={object_type:e};this.channel.push("events:object_spawned",t)}),il(this,"sendProfileUpdate",()=>{this.channel.push("events:profile_updated",{profile:this.store.state.profile})}),il(this,"updateScene",e=>{if(!this._permissions.update_hub)return"unauthorized";this.channel.push("update_scene",{url:e})}),il(this,"updateHub",e=>{if(!this._permissions.update_hub)return"unauthorized";this.channel.push("update_hub",e)}),il(this,"closeHub",()=>{if(!this._permissions.close_hub)return"unauthorized";this.channel.push("close_hub",{})}),il(this,"subscribe",e=>{this.channel.push("subscribe",{subscription:e})}),il(this,"allowNAFTraffic",e=>{this.channel.push(e?"unblock_naf":"block_naf",{})}),il(this,"unsubscribe",e=>new Promise(t=>this.channel.push("unsubscribe",{subscription:e}).receive("ok",t))),il(this,"sendMessage",(e,t="chat")=>{e&&this.channel.push("message",{body:e,type:t})}),il(this,"_getCreatorAssignmentToken",()=>{const e=this.store.state.creatorAssignmentTokens&&this.store.state.creatorAssignmentTokens.find(e=>e.hubId===this.hubId);return e&&e.creatorAssignmentToken}),il(this,"signIn",e=>new Promise((t,i)=>{const a=this._getCreatorAssignmentToken();this.channel.push("sign_in",{token:e,creator_assignment_token:a}).receive("ok",({perms_token:e})=>{this.setPermissionsFromToken(e),this._signedIn=!0,t()}).receive("error",e=>{"invalid_token"===e.reason?(console.warn("sign in failed",e),t()):(console.error("sign in failed",e),i())})})),il(this,"signOut",()=>new Promise((e,t)=>{this.channel.push("sign_out").receive("ok",tl(function*(){i._signedIn=!1,yield i.fetchPermissions(),e()})).receive("error",t)})),il(this,"getHost",()=>new Promise((e,t)=>{this.channel.push("get_host").receive("ok",t=>{e(t.host)}).receive("error",t)})),il(this,"getTwitterOAuthURL",()=>new Promise((e,t)=>{this.channel.push("oauth",{type:"twitter"}).receive("ok",t=>{e(t.oauth_url)}).receive("error",t)})),il(this,"discordBridges",()=>this.presence&&this.presence.state?Object(s.c)(this.presence.state):[]),il(this,"pin",(e,t,i,a,n)=>{const s={id:e,gltf_node:t};return i&&n&&(s.file_id=i,s.file_access_token=a,s.promotion_token=n),new Promise((e,t)=>{this.channel.push("pin",s).receive("ok",e).receive("error",t)})}),il(this,"unpin",(e,t)=>{const i={id:e};t&&(i.file_id=t),this.channel.push("unpin",i)}),il(this,"fetchPermissions",()=>new Promise((e,t)=>{this.channel.push("refresh_perms_token").receive("ok",t=>{this.setPermissionsFromToken(t.perms_token),e({permsToken:t.perms_token,permissions:this._permissions})}).receive("error",t)})),il(this,"mute",e=>this.channel.push("mute",{session_id:e})),il(this,"addOwner",e=>this.channel.push("add_owner",{session_id:e})),il(this,"removeOwner",e=>this.channel.push("remove_owner",{session_id:e})),il(this,"hide",e=>{NAF.connection.adapter.block(e),this._blockedSessionIds.add(e)}),il(this,"unhide",e=>{this._blockedSessionIds.has(e)&&(NAF.connection.adapter.unblock(e),NAF.connection.entities.completeSync(e),this._blockedSessionIds.delete(e))}),il(this,"isHidden",e=>this._blockedSessionIds.has(e)),il(this,"kick",function(){var e=tl(function*(e){const t=yield i.fetchPermissions();NAF.connection.adapter.kick(e,t),i.channel.push("kick",{session_id:e})});return function(t){return e.apply(this,arguments)}}()),il(this,"requestSupport",()=>this.channel.push("events:request_support",{})),il(this,"favorite",()=>this.channel.push("favorite",{})),il(this,"unfavorite",()=>this.channel.push("unfavorite",{})),il(this,"disconnect",()=>{this.channel&&this.channel.socket.disconnect()}),this.store=e,this.hubId=t,this._signedIn=!!this.store.state.credentials.token,this._permissions={},this._blockedSessionIds=new Set}get signedIn(){return this._signedIn}can(e){if(!rl.includes(e))throw new Error(`Invalid permission name: ${e}`);return this._permissions&&this._permissions[e]}canOrWillIfCreator(e){return!(!this._getCreatorAssignmentToken()||!ol.includes(e))||this.can(e)}migrateToSocket(e,t){var i=this;return tl(function*(){let a;i.presence&&(a={onJoin:i.presence.caller.onJoin,onLeave:i.presence.caller.onLeave,onSync:i.presence.caller.onSync},i.presence.onJoin(function(){}),i.presence.onLeave(function(){}),i.presence.onSync(function(){})),i.channel=yield Object(s.k)(i.channel,e,t),i.presence=new Zc.a(i.channel),a&&(i.presence.onJoin(a.onJoin),i.presence.onLeave(a.onLeave),i.presence.onSync(a.onSync))})()}beginStreaming(){this.channel.push("events:begin_streaming",{})}endStreaming(){this.channel.push("events:end_streaming",{})}beginRecording(){this.channel.push("events:begin_recording",{})}endRecording(){this.channel.push("events:end_recording",{})}}var ll=i(549),dl=i(209);const hl=i(224),ul=hl.SHAPE,pl=hl.FIT;function ml(e,t){const i=t.boundingData,a=(i[3]-i[0])*(i[4]-i[1])*(i[5]-i[2]);return!(a<.1)&&(!(e<100)&&e/a>1e3)}function gl(e){if(e.count){return!0===ml(e.count,e)||e.count}{const t=gl(e.left);if(!0===t)return!0;const i=gl(e.right);if(!0===i)return!0;const a=t+i;return!0===ml(a,e)||a}}function vl(e){const t=e.boundsTree._roots;for(let e=0;e<t.length;++e)return!0===gl(t[e]);return!1}const fl=function(){const e=[];return function(t){const i=t.object3DMap.mesh;for(;e.length>0;){const{id:t,entity:i}=e.pop();i.removeAttribute(t)}if(console.group("traverseMeshesAndAddShapes"),document.querySelector(["[ammo-shape__trimesh]","[ammo-shape__heightfield]"]))console.log("heightfield or trimesh found on scene");else{console.log("collision not found in scene");let a=!1;i.traverse(e=>{!e.isMesh||THREE.Sky&&e.__proto__==THREE.Sky.prototype||e.name.startsWith("Floor_Plan")||e.name.startsWith("Ground_Plane")||!e.geometry.boundsTree||!vl(e.geometry)||(a=!0)});let n=null;a&&(console.log("mesh contains high triangle density region"),n=document.querySelector("[nav-mesh]")),n?(console.log("mesh density exceeded, using floor plan only"),n.setAttribute("ammo-shape__floorPlan",{type:ul.MESH,margin:.01,fit:pl.ALL,includeInvisible:!0}),e.push({id:"ammo-shape__floorPlan",entity:n})):a?(t.setAttribute("ammo-shape__defaultFloor",{type:ul.BOX,margin:.01,halfExtents:{x:4e3,y:.5,z:4e3},offset:{x:0,y:-.5,z:0},fit:pl.MANUAL}),e.push({id:"ammo-shape__defaultFloor",entity:t}),console.log("adding default floor collision")):(t.setAttribute("ammo-shape__environment",{type:ul.MESH,margin:.01,fit:pl.ALL}),e.push({id:"ammo-shape__environment",entity:t}),console.log("adding mesh shape for all visible meshes"))}console.groupEnd()}}();function bl(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const yl="https://asset-bundles-prod.reticulum.io/interactables/Ducky/DuckyMesh-438ff8e022.gltf";class _l{constructor(e,t,i,a,n,s){bl(this,"log",e=>{this.addToPresenceLog({type:"log",body:e})}),bl(this,"dispatch",e=>{if(e.startsWith("/")){const t=e.substring(1).split(" ");this.dispatchCommand(t[0],...t.slice(1)),document.activeElement.blur()}else this.hubChannel.sendMessage(e)}),bl(this,"dispatchCommand",(e,...t)=>{if(!this.scene.is("entered"))return void this.addToPresenceLog({type:"log",body:"You must enter the room to use this command."});const i=document.querySelector("#player-rig"),a=[.0625,.125,.25,.5,1,1.5,3,5,7.5,12.5],n=i.object3D.scale;let s,o;const r=this.scene.systems["capture-system"];switch(e){case"fly":!0!==i.getAttribute("character-controller").fly?(i.setAttribute("character-controller","fly",!0),this.addToPresenceLog({type:"log",body:"Fly mode enabled."})):(i.setAttribute("character-controller","fly",!1),this.addToPresenceLog({type:"log",body:"Fly mode disabled."}));break;case"grow":for(let e=0;e<a.length;e++)if(a[e]>n.x){i.object3D.scale.set(a[e],a[e],a[e]),i.object3D.matrixNeedsUpdate=!0;break}break;case"shrink":for(let e=a.length-1;e>=0;e--)if(n.x>a[e]){i.object3D.scale.set(a[e],a[e],a[e]);break}break;case"leave":this.entryManager.exitScene(),this.remountUI({roomUnavailableReason:"left"});break;case"duck":Yo(yl),Math.random()<.01?this.scene.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(d.q):this.scene.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(d.n);break;case"debug":(o=document.querySelector("a-scene").systems.physics).setDebug(!o.debug);break;case"vrstats":document.getElementById("stats").components["stats-plus"].toggleVRStats();break;case"scene":t[0]?"unauthorized"===(s=this.hubChannel.updateScene(t[0]))&&this.addToPresenceLog({type:"log",body:"You do not have permission to change the scene."}):this.hubChannel.canOrWillIfCreator("update_hub")&&this.mediaSearchStore.sourceNavigateWithNoNav("scenes");break;case"rename":"unauthorized"===(s=this.hubChannel.rename(t.join(" ")))&&this.addToPresenceLog({type:"log",body:"You do not have permission to rename this room."});break;case"capture":if(!r.available()){this.log("Capture unavailable.");break}"stop"===t[0]?r.started()?(r.stop(),this.log("Capture stopped.")):this.log("Capture already stopped."):r.started()?this.log("Capture already running."):(r.start(),this.log("Capture started."))}}),this.scene=e,this.entryManager=t,this.hubChannel=i,this.addToPresenceLog=a,this.remountUI=n,this.mediaSearchStore=s}}function El(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}function wl(e){return function(){var t=this,i=arguments;return new Promise(function(a,n){var s=e.apply(t,i);function o(e){El(s,a,n,o,r,"next",e)}function r(e){El(s,a,n,o,r,"throw",e)}o(void 0)})}}function Sl(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const xl=Object(U.a)("bot"),Al=AFRAME.utils.device.isMobile(),kl=Object(U.a)("debug"),Cl=new URLSearchParams(location.search),Tl=AFRAME.utils.device.isIOS();class Rl{constructor(e,t,i,a){var n=this;Sl(this,"init",()=>{this.whenSceneLoaded(()=>{this.cursorController.components["cursor-controller"].enabled=!1})}),Sl(this,"hasEntered",()=>this._entered),Sl(this,"enterScene",function(){var e=wl(function*(e,t,i){document.querySelector("#player-camera").removeAttribute("scene-preview-camera"),kl&&(NAF.connection.adapter.session.options.verbose=!0),t&&(n.scene.addState("vr-entered"),navigator.getVRDisplays(),Cc(!0)),(Al||Object(U.a)("mobile"))&&n.playerRig.setAttribute("virtual-gamepad-controls",{}),n._setupPlayerRig(),n._setupBlocking(),n._setupKicking(),n._setupMedia(e),n._setupCamera(),Object(U.a)("offline")||(n._spawnAvatar(),n.scene.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(d.d),xl?n._runBot(e):(e&&NAF.connection.adapter.setLocalMediaStream(e),n.scene.classList.remove("hand-cursor"),n.scene.classList.add("no-cursor"),n.cursorController.components["cursor-controller"].enabled=!0,n._entered=!0,wl(function*(){for(;t&&!(yield navigator.getVRDisplays()).find(e=>e.isPresenting);)yield Object(o.a)();n.hubChannel.sendEntryEvent().then(()=>{n.store.update({activity:{lastEnteredAt:(new Date).toISOString()}})})})(),setTimeout(()=>n.store.bumpEntryCount(),3e4),n.scene.addState("entered"),i&&n.scene.emit("action_mute")))});return function(t,i,a){return e.apply(this,arguments)}}()),Sl(this,"whenSceneLoaded",e=>{this.scene.hasLoaded?e():this.scene.addEventListener("loaded",e)}),Sl(this,"enterSceneWhenLoaded",(e,t)=>{this.whenSceneLoaded(()=>this.enterScene(e,t))}),Sl(this,"exitScene",()=>{NAF.connection.adapter&&NAF.connection.adapter.localMediaStream&&NAF.connection.adapter.localMediaStream.getTracks().forEach(e=>e.stop()),this.hubChannel&&this.hubChannel.disconnect(),this.scene.renderer&&this.scene.renderer.setAnimationLoop(null),document.body.removeChild(this.scene)}),Sl(this,"_setupPlayerRig",()=>{this._setPlayerInfoFromProfile(),this.store.addEventListener("statechanged",this._setPlayerInfoFromProfile);const e=parseInt(Cl.get("avatar_scale"),10);e&&this.playerRig.setAttribute("scale",{x:e,y:e,z:e})}),Sl(this,"_setPlayerInfoFromProfile",wl(function*(){const e=n.store.state.profile.avatarId,t=yield Object(f.c)(e);n.playerRig.setAttribute("player-info",{avatarSrc:t,avatarType:Object(f.e)(e)})})),Sl(this,"_setupKicking",()=>{document.body.addEventListener("kicked",({detail:e})=>{const{clientId:t}=e,{entities:i}=NAF.connection.entities;for(const e in i){const a=i[e];NAF.utils.getCreator(a)===t&&(a.components.networked.data.persistent?(NAF.utils.takeOwnership(a),this._unpinElement(a),a.parentNode.removeChild(a)):NAF.entities.removeEntity(e))}})}),Sl(this,"_setupBlocking",()=>{document.body.addEventListener("blocked",e=>{NAF.connection.entities.removeEntitiesOfClient(e.detail.clientId)}),document.body.addEventListener("unblocked",e=>{NAF.connection.entities.completeSync(e.detail.clientId,!0)})}),Sl(this,"_pinElement",function(){var e=wl(function*(e){const{networkId:t}=e.components.networked.data,{fileId:i,src:a}=e.components["media-loader"].data;let s,o;if(i){s=new URL(a).searchParams.get("token");const e=Object(N.d)(i);e&&(o=e.promotionToken)}const r=function(e){if(!NAF.utils.isMine(e))return;const t=e.object3D,i=e.components,a=i.networked.data.networkId,n={},s={name:a,extensions:{HUBS_components:n}},o=(e,t)=>e.length===t.length&&e.every((e,i)=>e===t[i]),r=t.quaternion.toArray(),c=t.position.toArray(),l=t.scale.toArray();if(o(r,[0,0,0,1])||(s.rotation=r),o(c,[0,0,0])||(s.translation=c),o(l,[1,1,1])||(s.scale=l),i["media-loader"]){const e=i["media-loader"].data.src,t=i["media-loader"].data.contentSubtype;if(e.startsWith("hubs://")&&e.endsWith("/video"))return null;n.media={src:e,contentSubtype:t,id:a},i["media-pager"]&&(n.media.pageIndex=i["media-pager"].data.index),i["media-video"]&&i["media-video"].data.videoPaused&&(n.media.paused=!0,n.media.time=i["media-video"].data.time)}return n.pinnable={pinned:!0},s}(e);if(r){e.setAttribute("networked",{persistent:!0}),e.setAttribute("media-loader",{fileIsOwned:!0});try{yield n.hubChannel.pin(t,r,i,s,o),n.store.update({activity:{hasPinned:!0}})}catch(t){"invalid_token"===t.reason?(yield n.authChannel.signOut(n.hubChannel),n._signInAndPinOrUnpinElement(e)):console.warn("Pin failed for unknown reason",t)}}});return function(t){return e.apply(this,arguments)}}()),Sl(this,"_signInAndPinOrUnpinElement",(e,t)=>{const i=t?()=>this._pinElement(e):wl(function*(){return yield n._unpinElement(e)});this.performConditionalSignIn(()=>this.hubChannel.signedIn,i,t?"pin":"unpin",()=>{this._disableSignInOnPinAction=!0,e.setAttribute("pinnable","pinned",!t),this._disableSignInOnPinAction=!1})}),Sl(this,"_unpinElement",e=>{const t=e.components,i=t.networked;if(!i||!i.data||!NAF.utils.isMine(e))return;const a=t.networked.data.networkId;e.setAttribute("networked",{persistent:!1});const n=t["media-loader"],s=n.data&&n.data.fileId;this.hubChannel.unpin(a,s)}),Sl(this,"_setupMedia",e=>{const t={x:0,y:0,z:-1.5},i=(e,i)=>{if(!this.hubChannel.can("spawn_and_move_media"))return;const{entity:a,orientation:n}=Object(N.b)(e,"#interactable-media",i,null,!(e instanceof MediaStream),!0);return n.then(e=>{a.setAttribute("offset-relative-to",{target:"#player-camera",offset:t,orientation:e})}),a};let a;this.scene.addEventListener("add_media",e=>{const t=e.detail instanceof File?Me.a.FILE:Me.a.URL;i(e.detail,t)}),this.scene.addEventListener("pinned",e=>{this._disableSignInOnPinAction||this._signInAndPinOrUnpinElement(e.detail.el,!0)}),this.scene.addEventListener("unpinned",e=>{this._disableSignInOnPinAction||this._signInAndPinOrUnpinElement(e.detail.el,!1)}),this.scene.addEventListener("object_spawned",e=>{this.hubChannel.sendObjectSpawnedEvent(e.detail.objectType)}),this.scene.addEventListener("action_spawn",()=>{kc(!1,()=>window.APP.mediaSearchStore.pushExitMediaBrowserHistory()),window.APP.mediaSearchStore.sourceNavigateToDefaultSource()}),this.scene.addEventListener("action_invite",()=>{kc(!1,()=>this.history.goBack()),Object(kt.e)(this.history,"overlay","invite")}),this.scene.addEventListener("action_kick_client",({detail:{clientId:e}})=>{this.performConditionalSignIn(()=>this.hubChannel.can("kick_users"),wl(function*(){return yield window.APP.hubChannel.kick(e)}),"kick-user")}),this.scene.addEventListener("action_mute_client",({detail:{clientId:e}})=>{this.performConditionalSignIn(()=>this.hubChannel.can("mute_users"),()=>window.APP.hubChannel.mute(e),"mute-user")}),this.scene.addEventListener("action_vr_notice_closed",()=>void(wc&&(Sc&&(Sc(),Sc=null),Cc()))),document.addEventListener("paste",e=>{if((e.target.matches("input, textarea")||"true"===e.target.contentEditable)&&document.activeElement===e.target)return;const t=document.querySelector(".ui-root");if(t&&t.classList.contains("in-modal-or-overlay"))return;const a=e.clipboardData.getData("text"),n=e.clipboardData.files&&e.clipboardData.files;if(a)i(a,Me.a.URL);else for(const e of n)i(e,Me.a.CLIPBOARD)}),document.addEventListener("dragover",e=>e.preventDefault()),document.addEventListener("drop",e=>{e.preventDefault();const t=e.dataTransfer.getData("url"),a=e.dataTransfer.files;if(t)i(t,Me.a.URL);else for(const e of a)i(e,Me.a.FILE)});let s=!1;const o=function(){var t=wl(function*(t){if(s)return;let o;s=!0;try{o=yield navigator.mediaDevices.getUserMedia(t)}catch(e){return s=!1,void n.scene.emit("share_video_failed")}(o?o.getVideoTracks():[]).length>0&&(o.getVideoTracks().forEach(t=>e.addTrack(t)),NAF.connection.adapter.setLocalMediaStream(e),(a=i(e,void 0)).setAttribute("emit-scene-event-on-remove","event:action_end_video_sharing")),n.scene.emit("share_video_enabled",{source:t.video.mediaSource}),n.scene.addState("sharing_video"),s=!1});return function(e){return t.apply(this,arguments)}}();this.scene.addEventListener("action_share_camera",()=>{o({video:{mediaSource:"camera",width:Tl?{max:1280}:{max:1280,ideal:720},frameRate:30}})}),this.scene.addEventListener("action_share_window",()=>{o({video:{mediaSource:"window",width:screen.width/screen.height*720,height:720,frameRate:30}})}),this.scene.addEventListener("action_share_screen",()=>{o({video:{mediaSource:"screen",width:screen.width/screen.height*720,height:720,frameRate:30}})}),this.scene.addEventListener("action_end_video_sharing",()=>{if(!s){s=!0,a&&a.parentNode&&(NAF.utils.takeOwnership(a),a.parentNode.removeChild(a));for(const t of e.getVideoTracks())e.removeTrack(t);NAF.connection.adapter.setLocalMediaStream(e),a=null,this.scene.emit("share_video_disabled"),this.scene.removeState("sharing_video"),s=!1}}),this.scene.addEventListener("action_selected_media_result_entry",e=>{const t=e.detail;if(["avatar","avatar_listing"].includes(t.type))return;if(("scene_listing"===t.type||"scene"===t.type)&&this.hubChannel.can("update_hub"))return;const a=Tc()?3e3:0;setTimeout(()=>{i(t.url,Me.a.URL)},a),Cc()}),this.mediaSearchStore.addEventListener("media-exit",()=>{Cc()})}),Sl(this,"_setupCamera",()=>{this.scene.addEventListener("action_toggle_camera",()=>{if(!this.hubChannel.can("spawn_camera"))return;const e=this.scene.systems["camera-tools"].getMyCamera();if(e)e.parentNode.removeChild(e),this.scene.removeState("camera");else{const e=document.createElement("a-entity");e.setAttribute("networked",{template:"#interactable-camera"}),e.setAttribute("offset-relative-to",{target:"#player-camera",offset:{x:0,y:0,z:-1.5}}),this.scene.appendChild(e),this.scene.addState("camera")}setTimeout(()=>this.scene.emit("camera_toggled"))}),this.scene.addEventListener("photo_taken",e=>this.hubChannel.sendMessage({src:e.detail},"photo")),this.scene.addEventListener("video_taken",e=>this.hubChannel.sendMessage({src:e.detail},"video"))}),Sl(this,"_spawnAvatar",()=>{this.playerRig.setAttribute("networked","template: #remote-avatar; attachTemplateToLocal: false;"),this.playerRig.setAttribute("networked-avatar",""),this.playerRig.emit("entered")}),Sl(this,"_runBot",function(){var e=wl(function*(e){const t=document.createElement("audio");let i,a;do{i=document.querySelector("#bot-audio-input"),a=document.querySelector("#bot-data-input"),yield Object(o.a)()}while(!i||!a);const n=()=>{t.loop=!0,t.muted=!0,t.crossorigin="anonymous",t.src=URL.createObjectURL(i.files[0]),document.body.appendChild(t)};i.files&&i.files.length>0?n():i.onchange=n;const s=document.querySelector("#player-camera"),r=document.querySelector("#player-left-controller"),c=document.querySelector("#player-right-controller"),l=()=>{fetch(URL.createObjectURL(a.files[0])).then(e=>e.json()).then(e=>{s.setAttribute("replay",""),s.components.replay.poses=e.camera.poses,r.setAttribute("replay",""),r.components.replay.poses=e.left.poses,r.removeAttribute("visibility-by-path"),r.removeAttribute("track-pose"),r.setAttribute("visible",!0),c.setAttribute("replay",""),c.components.replay.poses=e.right.poses,c.removeAttribute("visibility-by-path"),c.removeAttribute("track-pose"),c.setAttribute("visible",!0)})};a.files&&a.files.length>0?l():a.onchange=l,yield new Promise(e=>t.addEventListener("canplay",e)),e.addTrack(t.captureStream?t.captureStream().getAudioTracks()[0]:t.mozCaptureStream?t.mozCaptureStream().getAudioTracks()[0]:null),NAF.connection.adapter.setLocalMediaStream(e),t.play()});return function(t){return e.apply(this,arguments)}}()),this.hubChannel=e,this.authChannel=t,this.availableVREntryTypes=i,this.store=window.APP.store,this.mediaSearchStore=window.APP.mediaSearchStore,this.scene=document.querySelector("a-scene"),this.cursorController=document.querySelector("#cursor-controller"),this.playerRig=document.querySelector("#player-rig"),this._entered=!1,this.performConditionalSignIn=()=>{},this.history=a}}function Ml(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}function Dl(e){return function(){var t=this,i=arguments;return new Promise(function(a,n){var s=e.apply(t,i);function o(e){Ml(s,a,n,o,r,"next",e)}function r(e){Ml(s,a,n,o,r,"throw",e)}o(void 0)})}}function Pl(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Ol=5e3;function Nl(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),i=window.atob(t),a=new Uint8Array(i.length);for(let e=0;e<i.length;++e)a[e]=i.charCodeAt(e);return a}class Hl{constructor(e){var t=this;Pl(this,"setHubChannel",e=>{this.hubChannel=e}),Pl(this,"setRegistration",e=>{this.registration=e}),Pl(this,"setRegistrationFailed",()=>{this.registration=null}),Pl(this,"setVapidPublicKey",e=>{this.vapidPublicKey=e}),Pl(this,"setSubscribed",e=>{this._isSubscribed=e}),Pl(this,"isSubscribed",()=>this._isSubscribed),Pl(this,"getCurrentEndpoint",Dl(function*(){if(!navigator.serviceWorker)return null;const e=performance.now();for(;void 0===t.registration&&performance.now()-e<Ol;)yield Object(o.a)();if(performance.now()-e>=Ol&&console.warn("Service worker registration timed out."),!t.registration||!t.registration.pushManager)return null;for(;void 0===t.vapidPublicKey;)yield Object(o.a)();if(null===t.vapidPublicKey)return null;try{const e=Nl(t.vapidPublicKey);if("granted"!==(yield t.registration.pushManager.permissionState({userVisibleOnly:!0,applicationServerKey:e})))return null}catch(e){return null}const i=yield t.registration.pushManager.getSubscription();return i?i.endpoint:null})),Pl(this,"toggle",Dl(function*(){if(t.registration){if(t._isSubscribed){const e=yield t.registration.pushManager.getSubscription(),i=yield t.hubChannel.unsubscribe(e);i&&!1===i.has_remaining_subscriptions&&e.unsubscribe()}else{let e=yield t.registration.pushManager.getSubscription();if(!e){const i=Nl(t.vapidPublicKey);e=yield t.registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:i})}t.hubChannel.subscribe(e)}t._isSubscribed=!t._isSubscribed}})),this.hubId=e}}i(870),i(1919);var Il=i(41);const jl=new AFRAME.THREE.Vector3,Ll=new AFRAME.THREE.Vector3,Fl=Object(U.a)("debug"),Bl=AFRAME.utils.device.isMobileVR();function Vl(e){const t=new THREE.SphereBufferGeometry(e,10,10),i=new THREE.WireframeGeometry(t),a=new THREE.LineSegments(i);return a.material.opacity=.5,a.material.transparent=!0,a}AFRAME.registerSystem("personal-space-bubble",{schema:{debug:{default:!1},enabled:{default:!0}},init(){this.invaders=[],this.bubbles=[],this.tickCount=0,this._updateInvaders=this._updateInvaders.bind(this)},registerBubble(e){this.bubbles.push(e)},unregisterBubble(e){const t=this.bubbles.indexOf(e);-1!==t&&this.bubbles.splice(t,1)},registerInvader(e){NAF.utils.getNetworkedEntity(e.el).then(t=>{NAF.utils.getNetworkOwner(t)!==NAF.clientId&&this.invaders.push(e)})},unregisterInvader(e){const t=this.invaders.indexOf(e);-1!==t&&this.invaders.splice(t,1)},update(){for(let e=0;e<this.bubbles.length;e++)this.bubbles[e].updateDebug();for(let e=0;e<this.invaders.length;e++)this.invaders[e].updateDebug(),this.data.enabled||this.invaders[e].setInvading(!1);this.data.enabled?this.el.addState("spacebubble"):this.el.removeState("spacebubble")},tick(){this._updateInvaders(),this.tickCount++},_updateInvaders:function(){const e=[],t=(t,i,a)=>{const n=i[t];jl.setFromMatrixPosition(n.el.object3D.matrixWorld);const s=Ll.distanceToSquared(jl),o=a.data.radius+n.data.radius;s<o*o&&(e[t]=!0)},i=(t,i)=>{i[t].invading!==e[t]&&i[t].setInvading(e[t])};return function(){if(this.data.enabled&&0!==this.invaders.length){e.length=0;for(let t=0;t<this.invaders.length;t++)this.invaders[t].el.object3D.updateMatrices(),e[t]=!1;for(let e=0;e<this.bubbles.length;e++){const i=this.bubbles[e];if(i.el.object3D.updateMatrices(),Ll.setFromMatrixPosition(i.el.object3D.matrixWorld),Bl)t(this.tickCount%this.invaders.length,this.invaders,i);else for(let e=0;e<this.invaders.length;e++)t(e,this.invaders,i)}if(Bl)i(this.tickCount%this.invaders.length,this.invaders);else for(let e=0;e<this.invaders.length;e++)i(e,this.invaders)}}}()}),AFRAME.registerComponent("space-invader-mesh",{schema:{meshName:{type:"string"}},update(){this.targetMesh=this.el.object3D.getObjectByName(this.data.meshName)}});AFRAME.registerComponent("personal-space-invader",{schema:{radius:{type:"number",default:.1},useMaterial:{default:!1},debug:{default:!1},invadingOpacity:{default:.3}},init(){if(this.el.sceneEl.systems["personal-space-bubble"].registerInvader(this),this.data.useMaterial){const e=function(e){for(;e&&(!e.components||!e.components["space-invader-mesh"]);)e=e.parentNode;return e&&e.components["space-invader-mesh"].targetMesh}(this.el);e&&(this.targetMesh=e)}this.invading=!1},update(){this.radiusSquared=this.data.radius*this.data.radius,this.updateDebug()},updateDebug(){this.el.sceneEl.systems["personal-space-bubble"].data.debug||this.data.debug?!this.el.object3DMap["psb-debug"]&&this.el.setObject3D("psb-debug",Vl(this.data.radius)):this.el.object3DMap["psb-debug"]&&this.el.removeObject3D("psb-debug")},remove(){this.el.sceneEl.systems["personal-space-bubble"].unregisterInvader(this)},setInvading(e){this.invading!==e&&(this.targetMesh&&this.targetMesh.material?Object(Il.a)(this.targetMesh,t=>{t.opacity=e?this.data.invadingOpacity:1,t.transparent=e}):this.el.object3D.visible=!e,this.invading=e)}}),AFRAME.registerComponent("personal-space-bubble",{schema:{radius:{type:"number",default:.8},debug:{default:!1}},init(){this.system.registerBubble(this)},update(){this.radiusSquared=this.data.radius*this.data.radius,this.updateDebug()},updateDebug(){Fl&&(this.system.data.debug||this.data.debug?!this.el.object3DMap["psb-debug"]&&this.el.setObject3D("psb-debug",Vl(this.data.radius)):this.el.object3DMap["psb-debug"]&&this.el.removeObject3D("psb-debug"))},remove(){this.system.unregisterBubble(this)}});i(1920),i(1921),i(1922),i(1923);const Ul={[WheelEvent.DOM_DELTA_PIXEL]:500,[WheelEvent.DOM_DELTA_LINE]:10,[WheelEvent.DOM_DELTA_PAGE]:2},zl=(()=>{let e=null;return function(){return e||(e=document.querySelector(".ui-root")),e&&e.classList.contains("in-modal-or-overlay")}})();class Wl{constructor(){this.events=[],this.coords=[0,0],this.movementXY=[0,0],this.buttonLeft=!1,this.buttonRight=!1,this.wheel=0;const e=this.events.push.bind(this.events),t=document.querySelector("canvas");["mousedown","wheel"].map(i=>t.addEventListener(i,e)),["mousemove","mouseup"].map(t=>window.addEventListener(t,e)),document.addEventListener("wheel",e=>{zl()||e.preventDefault()})}process(e){if("wheel"===e.type)return this.wheel+=(e.deltaX+e.deltaY)/Ul[e.deltaMode],!0;const t=0===e.button,i=2===e.button;if(this.coords[0]=e.clientX/window.innerWidth*2-1,this.coords[1]=-e.clientY/window.innerHeight*2+1,this.movementXY[0]+=e.movementX,this.movementXY[1]+=e.movementY,"mousedown"===e.type&&t)this.mouseDownLeftThisFrame=!0,this.buttonLeft=!0;else if("mousedown"===e.type&&i)this.mouseDownRightThisFrame=!0,this.buttonRight=!0;else if("mouseup"===e.type&&t){if(this.mouseDownLeftThisFrame)return!1;this.buttonLeft=!1}else if("mouseup"===e.type&&i){if(this.mouseDownRightThisFrame)return!1;this.buttonRight=!1}return!0}write(e){this.movementXY[0]=0,this.movementXY[1]=0,this.wheel=0,this.didStopProcessingEarly=!1,this.mouseDownLeftThisFrame=!1,this.mouseDownRightThisFrame=!1;for(let e=0;e<this.events.length;e++){const t=this.events[e];if(!this.process(t)){this.didStopProcessingEarly=!0,this.events.splice(0,e);break}}this.didStopProcessingEarly||(this.events.length=0),e.setVector2(x.a.device.mouse.coords,this.coords[0],this.coords[1]),e.setVector2(x.a.device.mouse.movementXY,this.movementXY[0],this.movementXY[1]),e.setValueType(x.a.device.mouse.buttonLeft,this.buttonLeft),e.setValueType(x.a.device.mouse.buttonRight,this.buttonRight),e.setValueType(x.a.device.mouse.wheel,this.wheel)}}function ql(e){return{items:e||[],has(e){return-1!==this.items.indexOf(e)},add(e){this.has(e)||this.items.push(e)},delete(e){const t=this.items.indexOf(e);-1!==t&&(this.items[t]=this.items[this.items.length-1],this.items.pop())},clear(){this.items.length=0}}}window.oncontextmenu=e=>{zl()||e.preventDefault()};class Gl{constructor(){this.seenKeys=new ql,this.keys={},this.events=[],["keydown","keyup"].map(e=>document.addEventListener(e,e=>{if(e.key)return this.events.push(e),("keydown"!==e.type||"/"!==e.key||["TEXTAREA","INPUT"].includes(document.activeElement&&document.activeElement.nodeName)||document.activeElement&&"true"===document.activeElement.contentEditable)&&(!e.ctrlKey||"1"!==e.key&&"2"!==e.key&&"3"!==e.key&&"4"!==e.key&&"5"!==e.key&&"6"!==e.key&&"7"!==e.key&&"8"!==e.key&&"9"!==e.key&&"0"!==e.key)&&"Tab"!==e.key?void 0:(e.preventDefault(),!1)})),["blur"].map(e=>window.addEventListener(e,this.events.push.bind(this.events)))}write(e){for(let e=0;e<this.events.length;e++){const t=this.events[e];if("blur"===t.type)this.keys={},this.seenKeys.clear();else{const e=t.key.toLowerCase();this.keys[e]="keydown"===t.type,this.seenKeys.add(e)}}this.events.length=0;for(let t=0;t<this.seenKeys.items.length;t++){const i=this.seenKeys.items[t],a=x.a.device.keyboard.key(i);e.setValueType(a,this.keys[i])}}}class Yl{constructor(){this.events=[],document.querySelector("a-scene").addEventListener("penButtonPressed",this.events.push.bind(this.events))}write(e){for(e.setValueType(x.a.device.hud.penButton,0!==this.events.length);this.events.length;)this.events.pop()}}class $l{constructor(e){this.gamepad=e,this.buttonMap=[{name:"a",buttonId:0},{name:"b",buttonId:1},{name:"x",buttonId:2},{name:"y",buttonId:3},{name:"leftBumper",buttonId:4},{name:"rightBumper",buttonId:5},{name:"leftTrigger",buttonId:6},{name:"rightTrigger",buttonId:7},{name:"back",buttonId:8},{name:"start",buttonId:9},{name:"leftJoystick",buttonId:10},{name:"rightJoystick",buttonId:11},{name:"dpadUp",buttonId:12},{name:"dpadDown",buttonId:13},{name:"dpadLeft",buttonId:14},{name:"dpadRight",buttonId:15}],this.axisMap=[{name:"leftJoystickHorizontal",axisId:0},{name:"leftJoystickVertical",axisId:1},{name:"rightJoystickHorizontal",axisId:2},{name:"rightJoystickVertical",axisId:3}]}write(e){if(this.gamepad=navigator.getGamepads()[this.gamepad.index],this.gamepad.connected){const t=x.a.device.xbox;this.buttonMap.forEach(i=>{const a=t.button(i.name),n=this.gamepad.buttons[i.buttonId];e.setValueType(a.pressed,!!n.pressed),e.setValueType(a.touched,!!n.touched),e.setValueType(a.value,n.value)}),e.setValueType(t.axesSum,0),this.axisMap.forEach(i=>{e.setValueType(t.axis(i.name),this.gamepad.axes[i.axisId]),e.setValueType(t.axesSum,e.get(t.axesSum)+Math.abs(this.gamepad.axes[i.axisId]))}),this.gamepad.hapticActuators&&this.gamepad.hapticActuators[0]&&e.setValueType(x.a.haptics.actuators[this.gamepad.hand],this.gamepad.hapticActuators[0])}}}const Xl="undefined"!=typeof window&&window.THREE,Ql=Xl&&Xl.Vector3||function(){},Kl=Xl&&Xl.Quaternion||function(){},Jl="undefined"!=typeof window&&window.THREE&&new Xl.Vector3(0,0,-1);function Zl(){return{position:new Ql,direction:new Ql,orientation:new Kl,fromOriginAndDirection:function(e,t){return this.position=e,this.direction=t,this.orientation=this.orientation.setFromUnitVectors(Jl,t),this},fromCameraProjection:function(e,t,i){return this.position.setFromMatrixPosition(e.matrixWorld),this.direction.set(t,i,.5).unproject(e).sub(this.position).normalize(),this.fromOriginAndDirection(this.position,this.direction),this},copy:function(e){this.position.copy(e.position),this.direction.copy(e.direction),this.orientation.copy(e.orientation)}}}const ed=.175,td=-.3,id=-.03,ad=0,nd=0,sd=-.175,od=function(){const e=new THREE.Euler,t=new THREE.Vector3,i=new THREE.Quaternion,a=new THREE.Vector3;return function(n,s,o,r){return o.updateMatrices(),a.copy(o.position),a.y=a.y-r,t.set(ed*("left"===s?-1:"right"===s?1:0),td,id),t.multiplyScalar(r),t.applyAxisAngle(o.up,o.rotation.y),a.add(t),t.set(ad,nd,sd),t.multiplyScalar(r),i.fromArray(n.orientation),e.setFromQuaternion(i),e.set(e.x,e.y,0),t.applyEuler(e),a.add(t),a}}(),rd=function(e){navigator.getVRDisplays&&navigator.getVRDisplays().then(t=>{t[0]&&t[0].stageParameters&&t[0].stageParameters.sittingToStandingTransform&&e.fromArray(t[0].stageParameters.sittingToStandingTransform)})},cd=new THREE.Vector3(1,1,1),ld=x.a.device.oculusgo.touchpad,dd=x.a.device.oculusgo.trigger;class hd{constructor(e){this.gamepad=e,this.rayObjectRotation=new THREE.Quaternion,this.pose=new Zl,this.q=new THREE.Quaternion,this.sittingToStandingMatrix=(new THREE.Matrix4).makeTranslation(0,1.6,0),rd(this.sittingToStandingMatrix),this.matrix=new THREE.Matrix4,this.orientation=new THREE.Quaternion,this.rayObject=document.querySelector("#player-right-controller").object3D,this.headObject3D=document.querySelector("#player-camera").object3D,navigator.getGamepads()}write(e){if(navigator.getGamepads(),this.gamepad.connected){e.setValueType(ld.axisX,this.gamepad.axes[0]),e.setValueType(ld.axisY,this.gamepad.axes[1]),e.setValueType(ld.pressed,this.gamepad.buttons[0].pressed),e.setValueType(ld.touched,this.gamepad.buttons[0].touched),e.setValueType(ld.value,this.gamepad.buttons[0].value),e.setValueType(dd.pressed,this.gamepad.buttons[1].pressed),e.setValueType(dd.touched,this.gamepad.buttons[1].touched),e.setValueType(dd.value,this.gamepad.buttons[1].value),this.rayObject.updateMatrices(),this.rayObject.getWorldQuaternion(this.q),e.setValueType(x.a.actions.rayObjectRotation,this.q);const t=this.rayObject.matrixWorld;this.rayObjectRotation.setFromRotationMatrix(t),this.pose.position.setFromMatrixPosition(t),this.pose.direction.set(0,0,-1).applyQuaternion(this.rayObjectRotation),this.pose.fromOriginAndDirection(this.pose.position,this.pose.direction),e.setPose(x.a.device.oculusgo.pose,this.pose),this.gamepad.pose.orientation&&e.setMatrix4(x.a.device.oculusgo.matrix,this.matrix.compose(od(this.gamepad.pose,this.gamepad.hand,this.headObject3D,1.6),this.orientation.fromArray(this.gamepad.pose.orientation),cd).premultiply(this.sittingToStandingMatrix))}}}const ud=new THREE.Vector3(1,1,1),pd=x.a.device.gearVRController.button("touchpad"),md=x.a.device.gearVRController.button("trigger"),gd=x.a.device.gearVRController.axis("touchpadX"),vd=x.a.device.gearVRController.axis("touchpadY");class fd{constructor(e){this.gamepad=e,this.buttonMap=[{name:"touchpad",buttonId:0},{name:"trigger",buttonId:1}],this.axisMap=[{name:"touchpadX",axisId:0},{name:"touchpadY",axisId:1}],this.rayObjectRotation=new THREE.Quaternion,this.selector=`#player-${e.hand}-controller`,this.pose=new Zl,this.sittingToStandingMatrix=(new THREE.Matrix4).makeTranslation(0,1.6,0),rd(this.sittingToStandingMatrix),this.matrix=new THREE.Matrix4,this.orientation=new THREE.Quaternion}write(e){if(navigator.getGamepads(),this.gamepad.connected){const t=this.gamepad.buttons[0];e.setValueType(pd.pressed,!!t.pressed),e.setValueType(pd.touched,!!t.touched),e.setValueType(pd.value,!!t.value);const i=this.gamepad.buttons[1];e.setValueType(md.pressed,!!i.pressed),e.setValueType(md.touched,!!i.touched),e.setValueType(md.value,!!i.value),e.setValueType(gd,this.gamepad.axes[0]),e.setValueType(vd,this.gamepad.axes[1]),this.rayObject||(this.rayObject=document.querySelector(this.selector).object3D),this.rayObject.updateMatrixWorld(),this.rayObjectRotation.setFromRotationMatrix(this.rayObject.matrixWorld),this.pose.position.setFromMatrixPosition(this.rayObject.matrixWorld),this.pose.direction.set(0,0,-1).applyQuaternion(this.rayObjectRotation),this.pose.fromOriginAndDirection(this.pose.position,this.pose.direction),e.setPose(x.a.device.gearVRController.pose,this.pose),this.headObject3D=this.headObject3D||document.querySelector("#player-camera").object3D,this.gamepad.pose.orientation&&e.setMatrix4(x.a.device.gearVRController.matrix,this.matrix.compose(od(this.gamepad.pose,this.gamepad.hand,this.headObject3D,1.6),this.orientation.fromArray(this.gamepad.pose.orientation),ud).premultiply(this.sittingToStandingMatrix))}}}const bd=new THREE.Vector3(1,1,1),yd=[{name:"thumbStick",buttonId:0},{name:"trigger",buttonId:1},{name:"grip",buttonId:2},{name:"x",buttonId:3},{name:"y",buttonId:4}],_d=[{name:"thumbStick",buttonId:0},{name:"trigger",buttonId:1},{name:"grip",buttonId:2},{name:"a",buttonId:3},{name:"b",buttonId:4}],Ed=(new THREE.Matrix4).makeTranslation(-.025,-.03,.1),wd=(new THREE.Matrix4).makeTranslation(.025,-.03,.1);class Sd{constructor(e){this.rayObjectRotation=new THREE.Quaternion,navigator.getVRDisplays();const t={left:yd,right:_d},i={left:x.a.device.leftOculusTouch,right:x.a.device.rightOculusTouch};this.gamepad=e,this.pose=new Zl,this.buttonMap=t[e.hand],this.axisMap=[{name:"joyX",axisId:0},{name:"joyY",axisId:1}],this.sittingToStandingMatrix=(new THREE.Matrix4).makeTranslation(0,1.6,0),rd(this.sittingToStandingMatrix),this.matrix=new THREE.Matrix4,this.path=i[e.hand],this.selector=`#player-${e.hand}-controller`,this.position=new THREE.Vector3,this.orientation=new THREE.Quaternion,this.handOffset="left"===this.gamepad.hand?Ed:wd}write(e){this.gamepad&&(this.gamepad=navigator.getGamepads()[this.gamepad.index],this.gamepad&&this.gamepad.connected&&(this.buttonMap.forEach(t=>{const i=this.path.button(t.name),a=this.gamepad.buttons[t.buttonId];e.setValueType(i.pressed,!!a.pressed),e.setValueType(i.touched,!!a.touched),e.setValueType(i.value,a.value)}),e.setValueType(this.path.axesSum,0),this.axisMap.forEach(t=>{e.setValueType(this.path.axis(t.name),this.gamepad.axes[t.axisId]),e.setValueType(this.path.axesSum,e.get(this.path.axesSum)+Math.abs(this.gamepad.axes[t.axisId]))}),this.rayObject=this.rayObject||document.querySelector(this.selector).object3D,this.rayObject.updateMatrixWorld(),this.rayObjectRotation.setFromRotationMatrix(this.rayObject.matrixWorld),this.pose.position.setFromMatrixPosition(this.rayObject.matrixWorld),this.pose.direction.set(0,0,-1).applyQuaternion(this.rayObjectRotation),this.pose.fromOriginAndDirection(this.pose.position,this.pose.direction),e.setPose(this.path.pose,this.pose),this.gamepad.pose.position&&this.gamepad.pose.orientation&&e.setMatrix4(this.path.matrix,this.matrix.compose(this.position.fromArray(this.gamepad.pose.position),this.orientation.fromArray(this.gamepad.pose.orientation),bd).premultiply(this.sittingToStandingMatrix).multiply(this.handOffset)),this.gamepad.hapticActuators&&this.gamepad.hapticActuators[0]&&e.setValueType(x.a.haptics.actuators[this.gamepad.hand],this.gamepad.hapticActuators[0])))}}const xd=new THREE.Vector3(1,1,1),Ad=(new THREE.Matrix4).makeTranslation(0,0,-.04),kd=x.a.device.daydream.button("touchpad"),Cd=x.a.device.daydream.axis("touchpadX"),Td=x.a.device.daydream.axis("touchpadY"),Rd=x.a.device.daydream.pose,Md=x.a.device.daydream.matrix;class Dd{constructor(e){this.gamepad=e,this.rayObjectRotation=new THREE.Quaternion,this.selector=`#player-${e.hand||"right"}-controller`,this.pose=new Zl,this.sittingToStandingMatrix=(new THREE.Matrix4).makeTranslation(0,1.6,0),rd(this.sittingToStandingMatrix),this.matrix=new THREE.Matrix4,this.orientation=new THREE.Quaternion}write(e){if(this.gamepad=navigator.getGamepads()[0],this.gamepad&&this.gamepad.connected){const t=this.gamepad.buttons[0];e.setValueType(kd.pressed,!!t.pressed),e.setValueType(kd.touched,!!t.touched),e.setValueType(kd.value,!!t.value),e.setValueType(Cd,this.gamepad.axes[0]),e.setValueType(Td,this.gamepad.axes[1]),this.rayObject||(this.rayObject=document.querySelector(this.selector).object3D),this.rayObject.updateMatrixWorld(),this.rayObjectRotation.setFromRotationMatrix(this.rayObject.matrixWorld),this.pose.position.setFromMatrixPosition(this.rayObject.matrixWorld),this.pose.direction.set(0,0,-1).applyQuaternion(this.rayObjectRotation),this.pose.fromOriginAndDirection(this.pose.position,this.pose.direction),e.setPose(Rd,this.pose),this.headObject3D=this.headObject3D||document.querySelector("#player-camera").object3D,this.gamepad.pose.orientation&&e.setMatrix4(Md,this.matrix.compose(od(this.gamepad.pose,this.gamepad.hand,this.headObject3D,1.6),this.orientation.fromArray(this.gamepad.pose.orientation),xd).premultiply(this.sittingToStandingMatrix).multiply(Ad))}}}const Pd=new THREE.Vector3(1,1,1),Od=(new THREE.Matrix4).compose(new THREE.Vector3(0,0,.13),(new THREE.Quaternion).setFromEuler(new THREE.Euler(-40*THREE.Math.DEG2RAD,0,0)),new THREE.Vector3(1,1,1)),Nd=(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(1,0,0),-Math.PI/12);class Hd{constructor(e){navigator.getVRDisplays(),this.gamepad=e,"HTC Vive Focus Plus Controller"===this.gamepad.id?this.buttonMap=[{name:"touchpad",buttonId:0},{name:"trigger",buttonId:1},{name:"grip",buttonId:2}]:this.buttonMap=[{name:"touchpad",buttonId:0},{name:"trigger",buttonId:1},{name:"grip",buttonId:2},{name:"top",buttonId:3}],this.axisMap=[{name:"joyX",axisId:0},{name:"joyY",axisId:1}],this.pose=new Zl,this.rayObjectRotation=new THREE.Quaternion,this.path=x.a.device.vive[e.hand||"right"],this.sittingToStandingMatrix=(new THREE.Matrix4).makeTranslation(0,1.6,0),rd(this.sittingToStandingMatrix),this.matrix=new THREE.Matrix4,this.position=new THREE.Vector3,this.orientation=new THREE.Quaternion}write(e){if(this.gamepad=navigator.getGamepads()[this.gamepad.index],!this.gamepad.connected)return;if(this.buttonMap.forEach(t=>{const i=this.path.button(t.name),a=this.gamepad.buttons[t.buttonId];e.setValueType(i.pressed,!!a.pressed),e.setValueType(i.touched,!!a.touched),e.setValueType(i.value,a.value)}),e.setValueType(this.path.axesSum,0),this.axisMap.forEach(t=>{e.setValueType(this.path.axis(t.name),this.gamepad.axes[t.axisId]),e.setValueType(this.path.axesSum,e.get(this.path.axesSum)+Math.abs(this.gamepad.axes[t.axisId]))}),!this.selector){if(!this.gamepad.hand)return;this.path=x.a.device.vive[this.gamepad.hand],this.selector=`#player-${this.gamepad.hand}-controller`,console.warn("gamepad hand eventually specified")}const t=document.querySelector(this.selector).object3D;t.updateMatrixWorld(),this.rayObjectRotation.setFromRotationMatrix(t.matrixWorld),this.pose.position.setFromMatrixPosition(t.matrixWorld),this.pose.direction.set(0,0,-1).applyQuaternion(Nd).applyQuaternion(this.rayObjectRotation),this.pose.fromOriginAndDirection(this.pose.position,this.pose.direction),e.setPose(this.path.pose,this.pose),this.gamepad.pose.position&&this.gamepad.pose.orientation&&e.setMatrix4(this.path.matrix,this.matrix.compose(this.position.fromArray(this.gamepad.pose.position),this.orientation.fromArray(this.gamepad.pose.orientation),Pd).premultiply(this.sittingToStandingMatrix).multiply(Od)),this.gamepad.hapticActuators&&this.gamepad.hapticActuators[0]&&e.setValueType(x.a.haptics.actuators[this.gamepad.hand],this.gamepad.hapticActuators[0])}}const Id=new THREE.Vector3(1,1,1),jd=(new THREE.Matrix4).compose(new THREE.Vector3(0,-.017,.13),(new THREE.Quaternion).setFromEuler(new THREE.Euler(-40*THREE.Math.DEG2RAD,0,0)),new THREE.Vector3(1,1,1));class Ld{constructor(e){this.rayObject=null,this.rayObjectRotation=new THREE.Quaternion,navigator.getVRDisplays(),this.gamepad=e,this.pose=new Zl,e.hand&&(this.selector=`#player-${e.hand}-controller`),this.sittingToStandingMatrix=(new THREE.Matrix4).makeTranslation(0,1.6,0),rd(this.sittingToStandingMatrix),this.matrix=new THREE.Matrix4,this.position=new THREE.Vector3,this.orientation=new THREE.Quaternion}write(e){if(this.gamepad=navigator.getGamepads()[this.gamepad.index],!this.gamepad.connected)return;const t=x.a.device.wmr[this.gamepad.hand||"right"];if(e.setValueType(t.touchpad.pressed,this.gamepad.buttons[0].pressed),e.setValueType(t.touchpad.touched,this.gamepad.buttons[0].touched),e.setValueType(t.touchpad.value,this.gamepad.buttons[0].value),e.setValueType(t.trigger.pressed,this.gamepad.buttons[1].pressed),e.setValueType(t.trigger.touched,this.gamepad.buttons[1].touched),e.setValueType(t.trigger.value,this.gamepad.buttons[1].value),e.setValueType(t.grip.pressed,this.gamepad.buttons[2].pressed),e.setValueType(t.grip.touched,this.gamepad.buttons[2].touched),e.setValueType(t.grip.value,this.gamepad.buttons[2].value),e.setValueType(t.menu.pressed,this.gamepad.buttons[3].pressed),e.setValueType(t.menu.touched,this.gamepad.buttons[3].touched),e.setValueType(t.menu.value,this.gamepad.buttons[3].value),e.setValueType(t.touchpad.axisX,this.gamepad.axes[0]),e.setValueType(t.touchpad.axisY,this.gamepad.axes[1]),e.setValueType(t.joystick.axisX,this.gamepad.axes[2]),e.setValueType(t.joystick.axisY,this.gamepad.axes[3]),!this.selector){if(!this.gamepad.hand)return;this.selector=`#player-${this.gamepad.hand}-controller`}this.rayObject=this.rayObject||document.querySelector(this.selector).object3D,this.rayObject.updateMatrixWorld(),this.rayObjectRotation.setFromRotationMatrix(this.rayObject.matrixWorld),this.pose.position.setFromMatrixPosition(this.rayObject.matrixWorld),this.pose.direction.set(0,0,-1).applyQuaternion(this.rayObjectRotation),this.pose.fromOriginAndDirection(this.pose.position,this.pose.direction),e.setPose(t.pose,this.pose),this.gamepad.pose.position&&this.gamepad.pose.orientation&&e.setMatrix4(t.matrix,this.matrix.compose(this.position.fromArray(this.gamepad.pose.position),this.orientation.fromArray(this.gamepad.pose.orientation),Id).premultiply(this.sittingToStandingMatrix).multiply(jd)),this.gamepad.hapticActuators&&this.gamepad.hapticActuators[0]&&e.setValueType(x.a.haptics.actuators[this.gamepad.hand],this.gamepad.hapticActuators[0])}}const Fd=2*Math.PI;class Bd{constructor(e){this.items=new Array(e).fill(0),this.writePtr=0}push(e){this.items[this.writePtr]=e,this.writePtr=(this.writePtr+1)%this.items.length}}const Vd=Math.abs,Ud=(e,t)=>{const i=e-t,a=e+Fd-t,n=e-(t+Fd);return Vd(i)<Vd(a)&&Vd(i)<Vd(n)?i:Vd(a)<Vd(n)?a:n},zd=e=>{let t=0;for(let i=0;i<e.length;i++){t+=e[i]}return t/e.length};class Wd{constructor(){this.hmdEuler=new THREE.Euler,this.hmdQuaternion=new THREE.Quaternion,this.prevX=this.hmdEuler.x,this.prevY=this.hmdEuler.y,this.dXBuffer=new Bd(6),this.dYBuffer=new Bd(6),this.hasPolyfill=window.webvrpolyfill,this.hasPolyfill&&(this.vrDisplay=window.webvrpolyfill.getPolyfillDisplays()[0],this.frameData=new window.webvrpolyfill.constructor.VRFrameData)}write(e){if(!this.hasPolyfill)return;const t=this.hmdEuler;if(this.vrDisplay.getFrameData(this.frameData),null!==this.frameData.pose.orientation&&(this.hmdQuaternion.fromArray(this.frameData.pose.orientation),t.setFromQuaternion(this.hmdQuaternion,"YXZ")),t.x<.475*-Math.PI)return;const i=THREE.Math.RAD2DEG*Ud(t.x,this.prevX),a=THREE.Math.RAD2DEG*Ud(t.y,this.prevY);this.dXBuffer.push(Math.abs(i)<.001?0:i),this.dYBuffer.push(Math.abs(a)<.001?0:a),this.averageDeltaX=zd(this.dXBuffer.items),this.averageDeltaY=zd(this.dYBuffer.items),this.prevX=t.x,this.prevY=t.y,e.setValueType(x.a.device.gyro.averageDeltaX,this.averageDeltaX),e.setValueType(x.a.device.gyro.averageDeltaY,this.averageDeltaY)}}var qd=i(169);function Gd(e){const t=AFRAME.scenes[0].systems.physics.driver,i=t.dispatcher.getNumManifolds(),a=Ammo.getPointer(e);for(let e=0;e<i;e++){const i=t.dispatcher.getManifoldByIndexInternal(e),n=Ammo.getPointer(i.getBody0()),s=Ammo.getPointer(i.getBody1());if(a!==n&&a!==s)continue;const o=i.getNumContacts();for(let e=0;e<o;e++){if(i.getContactPoint(e).getDistance()<=1e-5){const e=t.els.get(a===n?s:n).object3D;return e.el&&e.el.components.tags&&e.el.components.tags.data.isHandCollisionTarget?e.el:null}}}return null}const Yd=new Map;function $d(e){if(!e)return null;return Yd.get(e)||$d(e.parent)}AFRAME.registerComponent("is-remote-hover-target",{init:function(){Yd.set(this.el.object3D,this.el)},remove:function(){Yd.delete(this.el.object3D)}}),AFRAME.registerSystem("interaction",{updateCursorIntersection:function(e){this.rightRemoteHoverTarget=e&&$d(e.object)},isHeld(e){return this.state.leftHand.held===e||this.state.rightHand.held===e||this.state.rightRemote.held===e},init:function(){this.options={leftHand:{entity:null,grabPath:x.a.actions.leftHand.grab,dropPath:x.a.actions.leftHand.drop,hoverFn:Gd},rightHand:{entity:null,grabPath:x.a.actions.rightHand.grab,dropPath:x.a.actions.rightHand.drop,hoverFn:Gd},rightRemote:{entity:null,grabPath:x.a.actions.cursor.grab,dropPath:x.a.actions.cursor.drop,hoverFn:this.getRightRemoteHoverTarget}},this.state={leftHand:{hovered:null,held:null,spawning:null},rightHand:{hovered:null,held:null,spawning:null},rightRemote:{hovered:null,held:null,spawning:null}},this.previousState={leftHand:{hovered:null,held:null,spawning:null},rightHand:{hovered:null,held:null,spawning:null},rightRemote:{hovered:null,held:null,spawning:null}},Object(qd.a)().then(()=>{this.cursorController=document.querySelector("#cursor-controller"),this.options.leftHand.entity=document.querySelector("#player-left-controller"),this.options.rightHand.entity=document.querySelector("#player-right-controller"),this.options.rightRemote.entity=document.querySelector("#cursor")})},getRightRemoteHoverTarget(){return this.rightRemoteHoverTarget},tickInteractor(e,t){const i=AFRAME.scenes[0].systems.userinput;if(t.held){const a=t.held.components.networked,n=a&&a.data&&a.data.owner!==NAF.clientId;(i.get(e.dropPath)||n)&&(t.held=null)}else if(t.hovered=e.hoverFn.call(this,e.entity.body),t.hovered){const a=t.hovered,n=a.components.tags&&a.components.tags.data.isHoldable,s=this.el.is("frozen"),o=a.components.pinnable&&a.components.pinnable.data.pinned;n&&i.get(e.grabPath)&&(s||!o)&&Object(O.a)(a)&&(t.held=a)}},tick2(e){if(!this.el.is("entered"))return;Object.assign(this.previousState.rightHand,this.state.rightHand),Object.assign(this.previousState.rightRemote,this.state.rightRemote),Object.assign(this.previousState.leftHand,this.state.leftHand),this.rightHandTeleporter=this.rightHandTeleporter||document.querySelector("#player-right-controller").components.teleporter,this.gazeTeleporter=this.gazeTeleporter||document.querySelector("#gaze-teleport").components.teleporter,this.options.leftHand.entity.object3D.visible&&this.tickInteractor(this.options.leftHand,this.state.leftHand),this.options.rightHand.entity.object3D.visible&&!this.state.rightRemote.held&&this.tickInteractor(this.options.rightHand,this.state.rightHand),this.state.rightHand.held||this.state.rightHand.hovered||this.tickInteractor(this.options.rightRemote,this.state.rightRemote);const t=this.state.rightHand.hovered||this.state.rightHand.held,i=this.rightHandTeleporter.isTeleporting||this.gazeTeleporter.isTeleporting,a=this.el.sceneEl.is("vr-mode")&&this.state.rightRemote.held&&this.state.rightRemote.held.components&&this.state.rightRemote.held.components.tags&&this.state.rightRemote.held.components.tags.data.isPen&&this.state.rightRemote.held.children[0].components.pen.intersection,n=!t&&!i&&!a;var s;this.cursorController.components["cursor-controller"].enabled=n,n||(this.state.rightRemote.hovered=null),(this.state.leftHand.held!==this.previousState.leftHand.held||this.state.rightHand.held!==this.previousState.rightHand.held||this.state.rightRemote.held!==this.previousState.rightRemote.held||(s=this.state.rightRemote.hovered)&&s.components.tags&&(s.components.tags.data.singleActionButton||s.components.tags.data.holdableButton)&&this.state.rightRemote.hovered!==this.previousState.rightRemote.hovered)&&e.playSoundOneShot(d.f),this.el.systems.userinput.get(x.a.actions.logInteractionState)&&console.log("Interaction System State\nleftHand held",this.state.leftHand.held,"\nleftHand hovered",this.state.leftHand.hovered,"\nrightHand held",this.state.rightHand.held,"\nrightHand hovered",this.state.rightHand.hovered,"\nrightRemote held",this.state.rightRemote.held,"\nrightRemote hovered",this.state.rightRemote.hovered)}});const Xd=function(e,t,i,a,n){return i.setFromMatrixPosition(e.matrixWorld),a.set(t[0],t[1],.5).unproject(e).sub(i).normalize(),n.fromOriginAndDirection(i,a),n};class Qd{constructor(){this.prevButtonLeft=!1,this.clickedOnAnything=!1,this.cursorPose=new Zl,this.prevCursorPose=new Zl,this.origin=new THREE.Vector3,this.prevOrigin=new THREE.Vector3,this.direction=new THREE.Vector3,this.prevDirection=new THREE.Vector3}write(e){this.prevCursorPose.copy(this.cursorPose),this.prevOrigin.copy(this.origin),this.prevDirection.copy(this.prevDirection),this.cursorController||(this.cursorController=document.querySelector("[cursor-controller]").components["cursor-controller"]),this.camera||(this.camera=document.querySelector("#player-camera").components.camera.camera);const t=e.get(x.a.device.mouse.buttonLeft),i=e.get(x.a.device.mouse.buttonRight);if(t&&!this.prevButtonLeft){const e=[];this.cursorController.raycaster.intersectObjects(AFRAME.scenes[0].systems["hubs-systems"].cursorTargettingSystem.targets,!0,e);const t=e.find(e=>e.object.el),i=t&&$d(t.object),a=AFRAME.scenes[0].systems.userinput,n=t&&t.object.el.matches(".pen, .pen *, .video, .video *, .interactable, .interactable *"),s=i&&i.components.pinnable&&i.components.pinnable.data.pinned,o=AFRAME.scenes[0].is("frozen");this.clickedOnAnything=n&&(o||!s)&&Object(O.a)(i)||a.activeSets.includes(bt.cursorHoldingPen)||a.activeSets.includes(bt.cursorHoldingInteractable)||a.activeSets.includes(bt.cursorHoldingCamera)}if(this.prevButtonLeft=t,t||(this.clickedOnAnything=!1),!this.clickedOnAnything&&t||i){const t=e.get(x.a.device.mouse.movementXY);t&&e.setVector2(x.a.device.smartMouse.cameraDelta,t[0],t[1])}const a=e.get(x.a.device.mouse.coords);e.setPose(x.a.device.smartMouse.cursorPose,Xd(this.camera,a,this.origin,this.direction,this.cursorPose))}}function Kd(e,t){return void 0!==t.find(t=>t.touch.identifier===e.identifier)}function Jd(e,t){return void 0!==t.find(t=>t.job===e)}function Zd(e,t,i){if(Kd(e,i)||Jd(t,i))return void console.error("cannot reassign touches or jobs. unassign first");const a={job:t,touch:e};return i.push(a),a}function eh(e,t,i){i.splice(i.findIndex(function(i){return i.touch.identifier===e.identifier&&i.job===t}),1)}function th(e,t){return t.find(t=>t.job===e)}function ih(e,t){return t.find(t=>t.touch.identifier===e.identifier)}const ah="MOVE CURSOR",nh="MOVE CAMERA",sh="FIRST PINCHER",oh="SECOND PINCHER",rh=[x.a.device.touchscreen.tap1,x.a.device.touchscreen.tap2,x.a.device.touchscreen.tap3,x.a.device.touchscreen.tap4,x.a.device.touchscreen.tap5];function ch(e,t,i,a){const n=e-i,s=t-a;return Math.sqrt(n*n+s*s)}const lh=(()=>{let e;return function(){return e||(e=document.querySelector("#player-camera").components.camera.camera),e}})();class dh{constructor(){this.raycaster=new THREE.Raycaster(new THREE.Vector3,new THREE.Vector3,0,4),this.assignments=[],this.pinch={initialDistance:0,currentDistance:0,delta:0},this.pendingTap={maxTouchCount:0,startedAt:0},this.tapIndexToWriteNextFrame=0,this.events=[],["touchstart","touchend","touchmove","touchcancel"].map(e=>document.querySelector("canvas").addEventListener(e,this.events.push.bind(this.events)))}end(e){if(Kd(e,this.assignments)){const t=ih(e,this.assignments);switch(t.job){case ah:case nh:t.framesUntilGrab>=0?t.framesUntilUnassign=t.framesUntilGrab+2:eh(t.touch,t.job,this.assignments);break;case sh:if(eh(t.touch,t.job,this.assignments),this.pinch={initialDistance:0,currentDistance:0,delta:0},Jd(oh,this.assignments)){const e=th(oh,this.assignments);if(eh(e.touch,e.job,this.assignments),Jd(nh,this.assignments)){const t=Zd(e.touch,sh,this.assignments);t.clientX=e.clientX,t.clientY=e.clientY}else{const t=Zd(e.touch,nh,this.assignments);t.clientX=e.clientX,t.clientY=e.clientY,t.delta=[0,0]}}break;case oh:if(eh(t.touch,t.job,this.assignments),this.pinch={initialDistance:0,currentDistance:0,delta:0},Jd(sh,this.assignments)&&!Jd(nh,this.assignments)){const e=th(sh,this.assignments);eh(e.touch,e.job,this.assignments);const t=Zd(e.touch,nh,this.assignments);t.clientX=e.clientX,t.clientY=e.clientY,t.delta=[0,0]}}}else console.warn("touch does not have a job",e);0===this.assignments.length&&(this.pendingTap.maxTouchCount>0&&performance.now()-this.pendingTap.startedAt<=125&&(this.tapIndexToWriteNextFrame=this.pendingTap.maxTouchCount),this.pendingTap={maxTouchCount:0})}move(e){if(!Kd(e,this.assignments))return void(e.target.classList[0]&&e.target.classList[0].startsWith("virtual-gamepad-controls")||console.warn("touch does not have job",e));const t=ih(e,this.assignments);switch(t.job){case ah:t.cursorPose.fromCameraProjection(lh(),e.clientX/window.innerWidth*2-1,-e.clientY/window.innerHeight*2+1);break;case nh:t.delta[0]+=e.clientX-t.clientX,t.delta[1]+=e.clientY-t.clientY,t.clientX=e.clientX,t.clientY=e.clientY;break;case sh:case oh:if(t.clientX=e.clientX,t.clientY=e.clientY,Jd(sh,this.assignments)&&Jd(oh,this.assignments)){const e=th(sh,this.assignments),t=th(oh,this.assignments),i=ch(e.clientX,e.clientY,t.clientX,t.clientY);this.pinch.delta+=i-this.pinch.currentDistance,this.pinch.currentDistance=i}}}start(e){if(Kd(e,this.assignments))return void console.error("touch already has a job");const t=0===this.assignments.length,i=1===this.assignments.length,a=2===this.assignments.length,n=!!th(oh,this.assignments);if(t||a&&n){let t;!function(e,t){if(AFRAME.scenes[0].systems.interaction.state.rightRemote.held)return!0;const i=[];t.setFromCamera({x:e.clientX/window.innerWidth*2-1,y:-e.clientY/window.innerHeight*2+1},lh()),t.intersectObjects(AFRAME.scenes[0].systems["hubs-systems"].cursorTargettingSystem.targets,!0,i);const a=i.find(e=>e.object.el),n=a&&$d(a.object),s=a&&a.object.el.matches(".interactable, .interactable *"),o=n&&n.components.pinnable&&n.components.pinnable.data.pinned,r=AFRAME.scenes[0].is("frozen");return s&&(r||!o)&&Object(O.a)(n)}(e,this.raycaster)?(t=Zd(e,nh,this.assignments)).delta=[0,0]:(t=Zd(e,ah,this.assignments)).framesUntilGrab=2,t.clientX=e.clientX,t.clientY=e.clientY,t.cursorPose=(new Zl).fromCameraProjection(lh(),e.clientX/window.innerWidth*2-1,-e.clientY/window.innerHeight*2+1)}else if(i||a){const t=th(ah,this.assignments);if(i&&t&&t.framesUntilGrab<0){const t=Zd(e,sh,this.assignments);t.clientX=e.clientX,t.clientY=e.clientY}else{if(i){const e=this.assignments[0];eh(e.touch,e.job,this.assignments);const t=Zd(e.touch,sh,this.assignments);t.clientX=e.clientX,t.clientY=e.clientY}const t=th(sh,this.assignments);if(!t){const t=Zd(e,sh,this.assignments);return t.clientX=e.clientX,void(t.clientY=e.clientY)}{const i=Zd(e,oh,this.assignments);i.clientX=e.clientX,i.clientY=e.clientY;const a=ch(t.clientX,t.clientY,i.clientX,i.clientY);this.pinch={initialDistance:a,currentDistance:a,delta:0}}}}0===this.pendingTap.maxTouchCount&&this.assignments.length>0&&(this.pendingTap.startedAt=performance.now()),this.pendingTap.maxTouchCount=Math.max(this.pendingTap.maxTouchCount,this.assignments.length)}process(e){switch(e.type){case"touchstart":for(const t of e.changedTouches)this.start(t);break;case"touchmove":for(const t of e.touches)this.move(t);break;case"touchend":case"touchcancel":for(const t of e.changedTouches)this.end(t)}}write(e){this.pinch&&(this.pinch.delta=0);const t=Jd(nh,this.assignments)&&th(nh,this.assignments);for(t&&(t.delta[0]=0,t.delta[1]=0),this.events.forEach(e=>{this.process(e)});this.events.length;)this.events.pop();const i=x.a.device.touchscreen,a=Jd(ah,this.assignments),n=Jd(nh,this.assignments);if(a||n){e.setValueType(i.isTouching,!0);const t=th(ah,this.assignments)||th(nh,this.assignments);e.setPose(i.cursorPose,t.cursorPose)}if(e.setValueType(i.isTouchingGrabbable,!1),a){const t=th(ah,this.assignments);e.setValueType(i.isTouchingGrabbable,t.framesUntilGrab<=0),t.framesUntilGrab--,t.framesUntilUnassign>=0&&(0===t.framesUntilUnassign&&eh(t.touch,t.job,this.assignments),t.framesUntilUnassign--)}if(n){const t=th(nh,this.assignments).delta;e.setVector2(i.touchCameraDelta,t[0],t[1])}e.setValueType(i.pinch.delta,this.pinch.delta),e.setValueType(i.pinch.initialDistance,this.pinch.initialDistance),e.setValueType(i.pinch.currentDistance,this.pinch.currentDistance),this.tapIndexToWriteNextFrame&&this.tapIndexToWriteNextFrame<rh.length&&e.setValueType(rh[this.tapIndexToWriteNextFrame-1],!0),this.tapIndexToWriteNextFrame=0}}const hh={noop:function(){},copy:function(e,t,i){e.setValueType(i.value,e.get(t.value))},scale:function(e){return function(t,i,a){void 0!==t.get(i.value)&&t.setValueType(a.value,t.get(i.value)*e)}},scaleExp:function(e,t=1){return function(i,a,n){void 0!==i.get(a.value)&&(1===t?i.setValueType(n.value,i.get(a.value)*e):i.setValueType(n.value,Math.pow(i.get(a.value),t)*e))}},deadzone:function(e){return function(t,i,a){t.setValueType(a.value,Math.abs(t.get(i.value))<e?0:t.get(i.value))}},split_vec2:function(e,t,i){const a=e.get(t.value);void 0!==a&&(e.setValueType(i.x,a[0]),e.setValueType(i.y,a[1]))},compose_vec2:function(e,t,i){const a=e.get(t.x),n=e.get(t.y);void 0!==a&&void 0!==n&&e.setVector2(i.value,a,n)},negate:function(e,t,i){e.setValueType(i.value,-e.get(t.value))},copyIfFalse:function(e,t,i){e.setValueType(i.value,e.get(t.bool)?void 0:e.get(t.value))},copyIfTrue:function(e,t,i){e.setValueType(i.value,e.get(t.bool)?e.get(t.value):void 0)},zeroIfDefined:function(e,t,i){e.setValueType(i.value,void 0!==e.get(t.bool)?0:e.get(t.value))},true:function(e,t,i){e.setValueType(i.value,!0)},rising:function(e,t,i,a){return e.setValueType(i.value,e.get(t.value)&&!1===a),!!e.get(t.value)},risingWithFrameDelay:function(e){return function(t,i,a,n={values:new Array(e)}){return t.setValueType(a.value,n.values.shift()),n.values.push(t.get(i.value)&&!n.prev),n.prev=t.get(i.value),n}},falling:function(e,t,i,a){return e.setValueType(i.value,!e.get(t.value)&&a),!!e.get(t.value)},vec2Zero:function(e,t,i){e.setVector2(i.value,0,0)},poseFromCameraProjection:function(){let e;const t=new Zl;return function(i,a,n){e||(e=document.querySelector("#player-camera").components.camera.camera);const s=i.get(a.value);i.setPose(n.value,t.fromCameraProjection(e,s[0],s[1]))}},vec2dpad:function(e,t=!1,i=!1){const a=e*e;return function(e,n,s){if(!e.get(n.value))return;const[o,r]=e.get(n.value),c=o*o+r*r<a?"center":(l=((l=Math.atan2(t?-o:o,i?-r:r))*THREE.Math.RAD2DEG+180+45)%360)>0&&l<90?"north":l>=90&&l<180?"west":l>=180&&l<270?"south":"east";var l;s[c]&&e.setValueType(s[c],!0)}},always:function(e){return function(t,i,a){t.setValueType(a.value,e)}},wasd_to_vec2:function(e,{w:t,a:i,s:a,d:n},{vec2:s}){let o=0,r=0;e.get(i)&&(o-=1),e.get(n)&&(o+=1),e.get(t)&&(r+=1),e.get(a)&&(r-=1),e.setVector2(s,o,r)},add_vec2:function(e,t,i){const a=e.get(t.first),n=e.get(t.second);a&&n?e.setVector2(i.value,a[0]+n[0],a[1]+n[1]):n?e.setVector2(i.value,n[0],n[1]):a&&e.setVector2(i.value,a[0],a[1])},max_vec2:function(e,t,i){const a=e.get(t.first),n=e.get(t.second);if(a&&n){const t=a[0]*a[0]+a[1]*a[1]>n[0]*n[0]+n[1]*n[1]?a:n;e.setVector2(i.value,t[0],t[1])}else n?e.setVector2(i.value,n[0],n[1]):a&&e.setVector2(i.value,a[0],a[1])},normalize_vec2:function(e,t,i){const a=e.get(t.value);if(a)if(0===a[0]&&0===a[0])e.setVector2(i.value,a[0],a[1]);else{const t=Math.sqrt(a[0]*a[0]+a[1]*a[1]);e.setVector2(i.value,a[0]/t,a[1]/t)}},all:function(e,t,i){for(let a=0,n=t.length;a<n;a++){const n=t[a];if(!e.get(n))return void e.setValueType(i.value,!1)}e.setValueType(i.value,!0)},any:function(e,t,i){for(let a=0,n=t.length;a<n;a++){const n=t[a];if(e.get(n))return void e.setValueType(i.value,!0)}e.setValueType(i.value,!1)},touch_axis_scroll:(e=1,t)=>(function(i,a,n,s={value:0,touching:!1}){return(void 0===t||Math.abs(i.get(a.value)-s.value)>=t)&&i.setValueType(n.value,s.touching&&i.get(a.touching)?e*(i.get(a.value)-s.value):0),s.value=i.get(a.value),s.touching=i.get(a.touching),s})},uh=e=>{for(const t in e)for(const i of e[t])i.sets||(i.sets=[]),i.sets.push(t);return e},ph="/vars/mouse-and-keyboard/drop_pen_with_p",mh="/vars/mouse-and-keyboard/drop_pen_with_hud",gh=e=>`/keyboard-mouse-user/keyboard-var/${e}`,vh=uh({[bt.global]:[{src:{},dest:{value:x.a.actions.cursor.hideLine},xform:hh.always(!0)},{src:{w:x.a.device.keyboard.key("arrowup"),a:x.a.device.keyboard.key("arrowleft"),s:x.a.device.keyboard.key("arrowdown"),d:x.a.device.keyboard.key("arrowright")},dest:{vec2:"/var/mouse-and-keyboard/arrows_vec2"},xform:hh.wasd_to_vec2},{src:{w:x.a.device.keyboard.key("w"),a:x.a.device.keyboard.key("a"),s:x.a.device.keyboard.key("s"),d:x.a.device.keyboard.key("d")},dest:{vec2:"/var/mouse-and-keyboard/wasd_vec2"},xform:hh.wasd_to_vec2},{src:{first:"/var/mouse-and-keyboard/wasd_vec2",second:"/var/mouse-and-keyboard/arrows_vec2"},dest:{value:"/var/mouse-and-keyboard/keyboardCharacterAcceleration"},xform:hh.max_vec2},{src:{value:"/var/mouse-and-keyboard/keyboardCharacterAcceleration"},dest:{value:x.a.actions.characterAcceleration},xform:hh.normalize_vec2},{src:{value:x.a.device.keyboard.key("shift")},dest:{value:x.a.actions.boost},xform:hh.copy},{src:{value:x.a.device.keyboard.key("Escape")},dest:{value:x.a.actions.camera.exitMirror},xform:hh.falling},{src:{value:x.a.device.keyboard.key("q")},dest:{value:x.a.actions.snapRotateLeft},xform:hh.rising},{src:{value:x.a.device.keyboard.key("e")},dest:{value:x.a.actions.snapRotateRight},xform:hh.rising},{src:{value:x.a.device.keyboard.key("Tab")},dest:{value:x.a.actions.toggleFreeze},xform:hh.rising},{src:{value:x.a.device.keyboard.key(" ")},dest:{value:x.a.actions.ensureFrozen},xform:hh.copy},{src:{value:x.a.device.keyboard.key(" ")},dest:{value:x.a.actions.thaw},xform:hh.falling},{src:{value:x.a.device.keyboard.key("p")},dest:{value:ph},xform:hh.rising},{src:{value:x.a.device.hud.penButton},dest:{value:mh},xform:hh.rising},{src:[mh,ph],dest:{value:"/vars/mouse-and-keyboard/togglePen"},xform:hh.any},{src:{value:"/vars/mouse-and-keyboard/togglePen"},dest:{value:x.a.actions.spawnPen},xform:hh.rising,priority:100},{src:{value:x.a.device.keyboard.key("c")},dest:{value:x.a.actions.toggleCamera},xform:hh.rising},{src:{value:x.a.device.keyboard.key("x")},dest:{value:x.a.actions.takeSnapshot},xform:hh.copy},{src:{value:x.a.device.smartMouse.cursorPose},dest:{value:x.a.actions.cursor.pose},xform:hh.copy},{src:{value:x.a.device.smartMouse.cameraDelta},dest:{x:"/var/smartMouseCamDeltaX",y:"/var/smartMouseCamDeltaY"},xform:hh.split_vec2},{src:{value:"/var/smartMouseCamDeltaX"},dest:{value:"/var/smartMouseCamDeltaXScaled"},xform:hh.scale(-.2)},{src:{value:"/var/smartMouseCamDeltaY"},dest:{value:"/var/smartMouseCamDeltaYScaled"},xform:hh.scale(-.1)},{src:{x:"/var/smartMouseCamDeltaXScaled",y:"/var/smartMouseCamDeltaYScaled"},dest:{value:x.a.actions.cameraDelta},xform:hh.compose_vec2},{src:{value:x.a.actions.cameraDelta},dest:{value:x.a.actions.lobbyCameraDelta},xform:hh.copy},{src:{value:x.a.device.keyboard.key("m")},dest:{value:x.a.actions.muteMic},xform:hh.rising},{src:{value:x.a.device.keyboard.key("t")},dest:{value:x.a.actions.focusChat},xform:hh.rising},{src:{value:x.a.device.keyboard.key("/")},dest:{value:x.a.actions.focusChatCommand},xform:hh.rising},{src:{value:x.a.device.keyboard.key("Escape")},dest:{value:x.a.actions.mediaExit},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("1")},dest:{value:"/var/shift+1"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+1"},dest:{value:x.a.actions.mediaSearch1},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("2")},dest:{value:"/var/shift+2"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+2"},dest:{value:x.a.actions.mediaSearch2},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("3")},dest:{value:"/var/shift+3"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+3"},dest:{value:x.a.actions.mediaSearch3},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("4")},dest:{value:"/var/shift+4"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+4"},dest:{value:x.a.actions.mediaSearch4},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("5")},dest:{value:"/var/shift+5"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+5"},dest:{value:x.a.actions.mediaSearch5},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("6")},dest:{value:"/var/shift+6"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+6"},dest:{value:x.a.actions.mediaSearch6},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("7")},dest:{value:"/var/shift+7"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+7"},dest:{value:x.a.actions.mediaSearch7},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("8")},dest:{value:"/var/shift+8"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+8"},dest:{value:x.a.actions.mediaSearch8},xform:hh.rising},{src:{value:x.a.device.keyboard.key("l")},dest:{value:x.a.actions.logDebugFrame},xform:hh.rising},{src:{value:x.a.device.keyboard.key("k")},dest:{value:x.a.actions.logInteractionState},xform:hh.rising},{src:{value:x.a.device.mouse.buttonRight},dest:{value:x.a.actions.startGazeTeleport},xform:hh.rising,priority:100},{src:{value:x.a.device.mouse.buttonRight},dest:{value:x.a.actions.stopGazeTeleport},xform:hh.falling,priority:100}],[bt.cursorHoldingPen]:[{src:{bool:x.a.device.keyboard.key("shift"),value:x.a.device.keyboard.key("q")},dest:{value:"/var/shift+q"},xform:hh.copyIfTrue},{src:{value:"/var/shift+q"},dest:{value:x.a.actions.cursor.penPrevColor},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("shift"),value:x.a.device.keyboard.key("e")},dest:{value:"/var/shift+e"},xform:hh.copyIfTrue},{src:{value:"/var/shift+e"},dest:{value:x.a.actions.cursor.penNextColor},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("shift"),value:x.a.device.keyboard.key("q")},dest:{value:"/var/notshift+q"},xform:hh.copyIfFalse},{src:{value:"/var/notshift+q"},dest:{value:x.a.actions.snapRotateLeft},xform:hh.rising,priority:200},{src:{bool:x.a.device.keyboard.key("shift"),value:x.a.device.keyboard.key("e")},dest:{value:"/var/notshift+e"},xform:hh.copyIfFalse},{src:{value:"/var/notshift+e"},dest:{value:x.a.actions.snapRotateRight},xform:hh.rising,priority:200},{src:{value:x.a.device.mouse.buttonLeft},dest:{value:x.a.actions.cursor.startDrawing},xform:hh.rising,priority:3},{src:{value:x.a.device.mouse.buttonLeft},dest:{value:x.a.actions.cursor.stopDrawing},xform:hh.falling,priority:3},{src:{value:gh("wheelWithShift")},dest:{value:"/var/cursorScalePenTipWheel"},xform:hh.copy,priority:200},{src:{value:"/var/cursorScalePenTipWheel"},dest:{value:x.a.actions.cursor.scalePenTip},xform:hh.scale(.03)},{src:{value:x.a.device.mouse.buttonRight},dest:{value:"/vars/mouse-and-keyboard/drop_pen_with_RMB"},xform:hh.falling,priority:200},{src:{value:x.a.device.keyboard.key("Escape")},dest:{value:"/vars/mouse-and-keyboard/drop_pen_with_esc"},xform:hh.rising},{src:["/vars/mouse-and-keyboard/drop_pen_with_RMB","/vars/mouse-and-keyboard/drop_pen_with_esc",ph,mh],dest:{value:"/vars/mouse-and-keyboard/togglePen"},xform:hh.any},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("z")},dest:{value:x.a.actions.cursor.undoDrawing},priority:1001,xform:hh.rising},{src:{value:"/vars/mouse-and-keyboard/togglePen"},dest:{value:x.a.actions.cursor.drop},xform:hh.rising,priority:200},{src:{value:"/vars/mouse-and-keyboard/togglePen"},dest:{value:x.a.actions.pen.remove},xform:hh.rising,priority:200}],[bt.cursorHoldingCamera]:[{src:{value:x.a.device.mouse.buttonLeft},dest:{value:x.a.actions.cursor.drop},xform:hh.falling,priority:2}],[bt.cursorHoldingInteractable]:[{src:{bool:x.a.device.keyboard.key("shift"),value:x.a.device.mouse.wheel},dest:{value:gh("wheelWithShift")},xform:hh.copyIfTrue},{src:{bool:x.a.device.keyboard.key("shift"),value:x.a.device.mouse.wheel},dest:{value:gh("wheelWithoutShift")},xform:hh.copyIfFalse},{src:{value:gh("wheelWithoutShift")},dest:{value:x.a.actions.cursor.modDelta},xform:hh.copy},{src:{value:gh("wheelWithShift")},dest:{value:x.a.actions.cursor.scaleGrabbedGrabbable},xform:hh.copy},{src:{value:x.a.device.mouse.buttonLeft},dest:{value:x.a.actions.cursor.drop},xform:hh.falling,priority:2}],[bt.cursorHoldingUI]:[{src:{value:x.a.device.mouse.buttonLeft},dest:{value:x.a.actions.cursor.drop},xform:hh.falling,priority:3},{src:{value:x.a.device.keyboard.key("shift")},dest:{value:x.a.actions.transformModifier},xform:hh.copy}],[bt.cursorHoveringOnInteractable]:[{src:{value:x.a.device.mouse.buttonLeft},dest:{value:x.a.actions.cursor.grab},xform:hh.rising,priority:1}],[bt.cursorHoveringOnVideo]:[{src:{value:x.a.device.mouse.wheel},dest:{value:x.a.actions.cursor.mediaVolumeMod},xform:hh.scale(-.3)}],[bt.inputFocused]:[{src:{value:"/device/keyboard"},dest:{value:x.a.noop},xform:hh.noop,priority:1e3}],[bt.cursorHoveringOnUI]:[{src:{value:x.a.device.mouse.buttonLeft},dest:{value:x.a.actions.cursor.grab},xform:hh.rising}]}),fh="vars/touchscreen/touchCameraDelta",bh=uh({[bt.global]:[{src:{},dest:{value:x.a.actions.cursor.hideLine},xform:hh.always(!0)},{src:{value:x.a.device.touchscreen.pinch.delta},dest:{value:"/vars/touchscreen/pinchDeltaForward"},xform:hh.scale(.25)},{src:{value:x.a.device.touchscreen.tap2},dest:{value:x.a.actions.toggleFreeze},xform:hh.copy},{src:{},dest:{value:"/vars/touchscreen/zero"},xform:hh.always(0)},{src:{x:"/vars/touchscreen/zero",y:"/vars/touchscreen/pinchDeltaForward"},dest:{value:x.a.actions.characterAcceleration},xform:hh.compose_vec2},{src:{value:x.a.device.touchscreen.cursorPose},dest:{value:x.a.actions.cursor.pose},xform:hh.copy},{src:{value:x.a.device.touchscreen.touchCameraDelta},dest:{x:"vars/touchscreen/touchCameraDelta/x",y:"vars/touchscreen/touchCameraDelta/y"},xform:hh.split_vec2},{src:{value:"vars/touchscreen/touchCameraDelta/x"},dest:{value:"vars/touchscreen/touchCameraDelta/x/scaled"},xform:hh.scale(.18)},{src:{value:"vars/touchscreen/touchCameraDelta/y"},dest:{value:"vars/touchscreen/touchCameraDelta/y/scaled"},xform:hh.scale(.35)},{src:{x:"vars/touchscreen/touchCameraDelta/x/scaled",y:"vars/touchscreen/touchCameraDelta/y/scaled"},dest:{value:fh},xform:hh.compose_vec2},{src:{value:x.a.device.gyro.averageDeltaX},dest:{value:"vars/gyro/gyroCameraDelta/x/scaled"},xform:hh.scale(1)},{src:{value:x.a.device.gyro.averageDeltaY},dest:{value:"vars/gyro/gyroCameraDelta/y/scaled"},xform:hh.scale(1)},{src:{x:"vars/gyro/gyroCameraDelta/y/scaled",y:"vars/gyro/gyroCameraDelta/x/scaled"},dest:{value:"vars/gyro/gyroCameraDelta"},xform:hh.compose_vec2},{src:{first:fh,second:"vars/gyro/gyroCameraDelta"},dest:{value:x.a.actions.cameraDelta},xform:hh.add_vec2},{src:{value:fh},dest:{value:x.a.actions.lobbyCameraDelta},xform:hh.copy},{src:{value:x.a.device.touchscreen.isTouchingGrabbable},dest:{value:x.a.actions.cursor.grab},xform:hh.rising},{src:{value:x.a.device.hud.penButton},dest:{value:"/vars/touchscreen/togglePen"},xform:hh.rising},{src:{value:"/vars/touchscreen/togglePen"},dest:{value:x.a.actions.spawnPen},xform:hh.rising,priority:2}],[bt.cursorHoldingInteractable]:[{src:{value:x.a.device.touchscreen.isTouchingGrabbable},dest:{value:x.a.actions.cursor.drop},xform:hh.falling,priority:1}],[bt.cursorHoveringOnPen]:[],[bt.cursorHoldingPen]:[{src:{value:x.a.device.touchscreen.isTouchingGrabbable},dest:{value:x.a.actions.cursor.startDrawing},xform:hh.risingWithFrameDelay(5),priority:2},{src:{value:x.a.device.touchscreen.isTouchingGrabbable},dest:{value:x.a.actions.cursor.stopDrawing},xform:hh.falling,priority:2},{src:{value:"/vars/touchscreen/togglePen"},dest:{value:x.a.actions.cursor.drop},xform:hh.rising,priority:3},{src:{value:"/vars/touchscreen/togglePen"},dest:{value:x.a.actions.pen.remove},xform:hh.rising,priority:3}]}),yh=uh({[bt.global]:[{src:{value:x.a.device.keyboard.key("l")},dest:{value:x.a.actions.logDebugFrame},xform:hh.rising}]}),_h=x.a.device.leftOculusTouch.button,Eh=x.a.device.leftOculusTouch.axis,wh=x.a.device.leftOculusTouch.pose,Sh=x.a.device.rightOculusTouch.button,xh=x.a.device.rightOculusTouch.axis,Ah=x.a.device.rightOculusTouch.pose,kh="/touch/var/right/grip/RisingGrab",Ch="/touch/var/buttons/lower",Th=e=>"/oculus-touch-user-vars/"+e,Rh=Th("leftGripPressed1"),Mh=Th("leftGripPressed2"),Dh=Th("rightGripPressed1"),Ph=Th("rightGripPressed2"),Oh=Th("leftTriggerPressed1"),Nh=Th("leftTriggerPressed2"),Hh=Th("rightTriggerPressed1"),Ih=Th("rightTriggerPressed2"),jh=uh({[bt.global]:[{src:{value:x.a.device.leftOculusTouch.matrix},dest:{value:x.a.actions.leftHand.matrix},xform:hh.copy},{src:{value:x.a.device.rightOculusTouch.matrix},dest:{value:x.a.actions.rightHand.matrix},xform:hh.copy},{src:["/touch/var/buttons/ensureFrozen","/touch/var/keyboard/ensureFrozen"],dest:{value:x.a.actions.ensureFrozen},xform:hh.any},{src:["/touch/var/buttons/thaw","/touch/var/keyboard/thaw"],dest:{value:x.a.actions.thaw},xform:hh.any},{src:{value:_h("grip").pressed},dest:{value:Rh},xform:hh.copy},{src:{value:_h("grip").pressed},dest:{value:Mh},xform:hh.copy},{src:{value:Rh},dest:{value:x.a.actions.leftHand.middleRingPinky},xform:hh.copy},{src:[_h("x").touched,_h("y").touched,_h("thumbStick").touched],dest:{value:x.a.actions.leftHand.thumb},xform:hh.any},{src:{value:_h("trigger").pressed},dest:{value:Oh},xform:hh.copy},{src:{value:_h("trigger").pressed},dest:{value:Nh},xform:hh.copy},{src:{value:Oh},dest:{value:x.a.actions.leftHand.index},xform:hh.copy},{src:{value:Sh("grip").pressed},dest:{value:Dh},xform:hh.copy},{src:{value:Sh("grip").pressed},dest:{value:Ph},xform:hh.copy},{src:{value:Dh},dest:{value:x.a.actions.rightHand.middleRingPinky},xform:hh.copy},{src:[Sh("a").touched,Sh("b").touched,Sh("thumbStick").touched],dest:{value:x.a.actions.rightHand.thumb},xform:hh.any},{src:{value:Sh("trigger").pressed},dest:{value:Hh},xform:hh.copy},{src:{value:Sh("trigger").pressed},dest:{value:Ih},xform:hh.copy},{src:{value:Hh},dest:{value:x.a.actions.rightHand.index},xform:hh.copy},{src:{x:Eh("joyX"),y:Eh("joyY")},dest:{value:"/touch/var/left/joy"},xform:hh.compose_vec2},{src:{value:"/touch/var/left/joy"},dest:{north:"/touch/var/leftDpad/north",south:"/touch/var/leftDpad/south",east:"/touch/var/leftDpad/east",west:"/touch/var/leftDpad/west",center:"/touch/var/leftDpad/center"},xform:hh.vec2dpad(.2,!1,!0)},{src:{value:xh("joyY")},dest:{value:"/touch/var/right/joyY1"},xform:hh.copy},{src:{value:xh("joyY")},dest:{value:"/touch/var/right/joyY2"},xform:hh.copy},{src:{x:xh("joyX"),y:"/touch/var/right/joyY1"},dest:{value:"/touch/var/right/joy"},xform:hh.compose_vec2},{src:{value:"/touch/var/right/joy"},dest:{north:"/touch/var/rightDpad/north",south:"/touch/var/rightDpad/south",east:"/touch/var/rightDpad/east",west:"/touch/var/rightDpad/west",center:"/touch/var/rightDpad/center"},xform:hh.vec2dpad(.2,!1,!0)},{src:{value:"/touch/var/rightDpad/east"},dest:{value:"/touch/var//right/snap-right"},xform:hh.rising,priority:1},{src:{value:x.a.device.keyboard.key("e")},dest:{value:"/touch/var//keyboard/snap-right"},xform:hh.rising},{src:["/touch/var//right/snap-right","/touch/var//keyboard/snap-right"],dest:{value:x.a.actions.snapRotateRight},xform:hh.any},{src:{value:x.a.device.keyboard.key("Tab")},dest:{value:x.a.actions.toggleFreeze},xform:hh.rising},{src:{value:x.a.device.keyboard.key(" ")},dest:{value:"/touch/var/keyboard/ensureFrozen"},xform:hh.copy},{src:[_h("x").pressed,Sh("a").pressed],dest:{value:Ch},xform:hh.any},{src:{value:Ch},dest:{value:"/touch/var/buttons/ensureFrozen"},xform:hh.copy},{src:{value:Ch},dest:{value:"/touch/var/buttons/thaw"},xform:hh.falling},{src:{value:x.a.device.keyboard.key(" ")},dest:{value:"/touch/var/keyboard/thaw"},xform:hh.falling},{src:{value:"/touch/var/rightDpad/west"},dest:{value:"/touch/var//right/snap-left"},xform:hh.rising,priority:1},{src:{value:x.a.device.keyboard.key("q")},dest:{value:"/touch/var//keyboard/snap-left"},xform:hh.rising},{src:["/touch/var//right/snap-left","/touch/var//keyboard/snap-left"],dest:{value:x.a.actions.snapRotateLeft},xform:hh.any},{src:{value:Eh("joyY")},dest:{value:"/touch/var/left/joy/y/deadzoned"},xform:hh.deadzone(.1)},{src:{value:"/touch/var/left/joy/y/deadzoned"},dest:{value:"/touch/var/left/scaledJoyY"},xform:hh.scale(-1.5)},{src:{value:Eh("joyX")},dest:{value:"/touch/var/left/joy/x/deadzoned"},xform:hh.deadzone(.1)},{src:{value:"/touch/var/left/joy/x/deadzoned"},dest:{value:"/touch/var/left/scaledJoyX"},xform:hh.scale(1.5)},{src:{x:"/touch/var/left/scaledJoyX",y:"/touch/var/left/scaledJoyY"},dest:{value:"/touch/var/characterAcceleration"},xform:hh.compose_vec2},{src:{w:x.a.device.keyboard.key("arrowup"),a:x.a.device.keyboard.key("arrowleft"),s:x.a.device.keyboard.key("arrowdown"),d:x.a.device.keyboard.key("arrowright")},dest:{vec2:"/var/keyboard/arrows_vec2"},xform:hh.wasd_to_vec2},{src:{w:x.a.device.keyboard.key("w"),a:x.a.device.keyboard.key("a"),s:x.a.device.keyboard.key("s"),d:x.a.device.keyboard.key("d")},dest:{vec2:"/var/keyboard/wasd_vec2"},xform:hh.wasd_to_vec2},{src:{first:"/var/keyboard/wasd_vec2",second:"/var/keyboard/arrows_vec2"},dest:{value:"/var/keyboard/characterAcceleration"},xform:hh.max_vec2},{src:{first:"/touch/var/characterAcceleration",second:"/var/keyboard/characterAcceleration"},dest:{value:"/var/oculus-touch/nonNormalizedCharacterAcceleration"},xform:hh.max_vec2},{src:{value:"/var/oculus-touch/nonNormalizedCharacterAcceleration",override:"/device/overrides/foo"},dest:{value:x.a.actions.characterAcceleration},xform:hh.copy},{src:{value:x.a.device.keyboard.key("shift")},dest:{value:"/var/keyboard-oculus/boost"},xform:hh.copy},{src:{value:_h("y").pressed},dest:{value:"/var/left-oculus/boost"},xform:hh.copy},{src:{value:Sh("b").pressed},dest:{value:"/var/right-oculus/boost"},xform:hh.copy},{src:["/var/keyboard-oculus/boost","/var/left-oculus/boost","/var/right-oculus/boost"],dest:{value:x.a.actions.boost},xform:hh.any},{src:{value:x.a.device.keyboard.key("t")},dest:{value:x.a.actions.focusChat},xform:hh.rising},{src:{value:x.a.device.keyboard.key("/")},dest:{value:x.a.actions.focusChatCommand},xform:hh.rising},{src:{value:x.a.device.keyboard.key("Escape")},dest:{value:x.a.actions.mediaExit},xform:hh.rising},{src:{value:x.a.device.keyboard.key("p")},dest:{value:x.a.actions.spawnPen},xform:hh.rising},{src:{value:x.a.device.keyboard.key("c")},dest:{value:x.a.actions.toggleCamera},xform:hh.rising},{src:{value:x.a.device.keyboard.key("x")},dest:{value:x.a.actions.takeSnapshot},xform:hh.copy},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("1")},dest:{value:"/var/shift+1"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+1"},dest:{value:x.a.actions.mediaSearch1},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("2")},dest:{value:"/var/shift+2"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+2"},dest:{value:x.a.actions.mediaSearch2},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("3")},dest:{value:"/var/shift+3"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+3"},dest:{value:x.a.actions.mediaSearch3},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("4")},dest:{value:"/var/shift+4"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+4"},dest:{value:x.a.actions.mediaSearch4},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("5")},dest:{value:"/var/shift+5"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+5"},dest:{value:x.a.actions.mediaSearch5},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("6")},dest:{value:"/var/shift+6"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+6"},dest:{value:x.a.actions.mediaSearch6},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("7")},dest:{value:"/var/shift+7"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+7"},dest:{value:x.a.actions.mediaSearch7},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("8")},dest:{value:"/var/shift+8"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+8"},dest:{value:x.a.actions.mediaSearch8},xform:hh.rising},{src:{value:x.a.device.keyboard.key("l")},dest:{value:x.a.actions.logDebugFrame},xform:hh.rising},{src:{value:x.a.device.keyboard.key("k")},dest:{value:x.a.actions.logInteractionState},xform:hh.rising},{src:{value:x.a.device.keyboard.key("m")},dest:{value:x.a.actions.muteMic},xform:hh.rising},{src:{value:Ah},dest:{value:x.a.actions.cursor.pose},xform:hh.copy},{src:{value:Ah},dest:{value:x.a.actions.rightHand.pose},xform:hh.copy},{src:{value:wh},dest:{value:x.a.actions.leftHand.pose},xform:hh.copy},{src:{value:Ih},dest:{value:x.a.actions.rightHand.stopTeleport},xform:hh.falling,priority:1},{src:{value:Nh},dest:{value:x.a.actions.leftHand.stopTeleport},xform:hh.falling,priority:1}],[bt.leftHandHoveringOnNothing]:[{src:{value:Nh},dest:{value:x.a.actions.leftHand.startTeleport},xform:hh.rising,priority:1}],[bt.cursorHoveringOnUI]:[{src:{value:Ih},dest:{value:x.a.actions.cursor.grab},xform:hh.rising,priority:2}],[bt.cursorHoveringOnVideo]:[{src:{value:xh("joyY")},dest:{value:x.a.actions.cursor.mediaVolumeMod},xform:hh.scale(-.01)}],[bt.cursorHoveringOnNothing]:[{src:{value:Ih},dest:{value:x.a.actions.rightHand.startTeleport},xform:hh.rising,priority:1}],[bt.leftHandHoveringOnInteractable]:[{src:{value:Mh},dest:{value:"/touch/var/left/grip/RisingGrab"},xform:hh.rising},{src:{value:Nh},dest:{value:"/touch/var/left/trigger/RisingGrab"},xform:hh.rising,priority:2},{src:["/touch/var/left/grip/RisingGrab"],dest:{value:x.a.actions.leftHand.grab},xform:hh.any,priority:2}],[bt.leftHandHoldingInteractable]:[{src:{value:Mh},dest:{value:x.a.actions.leftHand.drop},xform:hh.falling},{src:{},dest:{value:"/touch/var/buttons/ensureFrozen"},priority:1,xform:hh.always(!1)}],[bt.leftHandHoveringOnPen]:[],[bt.leftHandHoldingPen]:[{src:{value:Nh},dest:{value:x.a.actions.leftHand.startDrawing},xform:hh.rising,priority:3},{src:{value:Nh},dest:{value:x.a.actions.leftHand.stopDrawing},xform:hh.falling,priority:3},{src:{value:"/touch/var/leftDpad/east",override:"/device/overrides/foo"},dest:{value:x.a.actions.leftHand.penNextColor},xform:hh.rising,priority:2},{src:{value:"/touch/var/leftDpad/west",override:"/device/overrides/foo"},dest:{value:x.a.actions.leftHand.penPrevColor},xform:hh.rising,priority:2},{src:{value:"/touch/var/left/joy/y/deadzoned"},dest:{value:x.a.actions.leftHand.scalePenTip},xform:hh.scaleExp(-.005,5),priority:1},{src:{value:_h("y").pressed},dest:{value:x.a.actions.leftHand.switchDrawMode},xform:hh.rising,priority:1},{src:{value:_h("x").pressed},dest:{value:x.a.actions.leftHand.undoDrawing},xform:hh.rising,priority:1}],[bt.cursorHoveringOnInteractable]:[{src:{value:Ph},dest:{value:kh},xform:hh.rising,priority:2},{src:{value:Ih},dest:{value:"/touch/var/right/trigger/RisingGrab"},xform:hh.rising,priority:2},{src:[kh],dest:{value:x.a.actions.cursor.grab},xform:hh.any,priority:2}],[bt.cursorHoldingUI]:[{src:{value:Ih},dest:{value:"/touch/var/right/cursorDrop2"},xform:hh.falling,priority:5}],[bt.cursorHoldingInteractable]:[{src:{value:xh("joyY")},dest:{value:x.a.actions.cursor.modDelta},xform:hh.scale(.1)},{src:{value:Ph},dest:{value:"/touch/var/right/cursorDrop1"},xform:hh.falling,priority:3},{src:["/touch/var/right/cursorDrop1","/touch/var/right/cursorDrop2"],dest:{value:x.a.actions.cursor.drop},xform:hh.any,priority:2},{src:{},dest:{value:"/touch/var/buttons/ensureFrozen"},priority:1,xform:hh.always(!1)}],[bt.cursorHoveringOnPen]:[],[bt.cursorHoldingPen]:[{src:{value:Ih},dest:{value:x.a.actions.cursor.startDrawing},xform:hh.rising,priority:3},{src:{value:Ih},dest:{value:x.a.actions.cursor.stopDrawing},xform:hh.falling,priority:3},{src:{value:Sh("b").pressed},dest:{value:x.a.actions.cursor.undoDrawing},xform:hh.rising,priority:1}],[bt.rightHandHoveringOnInteractable]:[{src:{value:Ph},dest:{value:kh},xform:hh.rising,priority:2},{src:{value:Ih},dest:{value:"/touch/var/right/trigger/RisingGrab"},xform:hh.rising,priority:2},{src:[kh],dest:{value:x.a.actions.rightHand.grab},xform:hh.any,priority:2}],[bt.rightHandHoldingInteractable]:[{src:{value:Ph},dest:{value:"/touch/var/right/rightHandDrop2"},xform:hh.falling,priority:3},{src:["/touch/var/right/rightHandDrop2"],dest:{value:x.a.actions.rightHand.drop},xform:hh.any,priority:2},{src:{},dest:{value:"/touch/var/buttons/ensureFrozen"},priority:1,xform:hh.always(!1)}],[bt.rightHandHoveringOnPen]:[],[bt.rightHandHoldingPen]:[{src:{value:Ih},dest:{value:x.a.actions.rightHand.startDrawing},xform:hh.rising,priority:3},{src:{value:Ih},dest:{value:x.a.actions.rightHand.stopDrawing},xform:hh.falling,priority:3},{src:{value:"/touch/var/rightDpad/east"},dest:{value:x.a.actions.rightHand.penNextColor},xform:hh.rising,priority:2},{src:{value:"/touch/var/rightDpad/west"},dest:{value:x.a.actions.rightHand.penPrevColor},xform:hh.rising,priority:2},{src:{value:xh("joyY")},dest:{value:"/touch/var/right/joy/y/deadzoned"},xform:hh.deadzone(.1)},{src:{value:"/touch/var/right/joy/y/deadzoned"},dest:{value:x.a.actions.rightHand.scalePenTip},xform:hh.scaleExp(-.005,5),priority:2},{src:{value:Ph},dest:{value:x.a.actions.rightHand.drop},xform:hh.falling,priority:3},{src:{value:Sh("b").pressed},dest:{value:x.a.actions.rightHand.switchDrawMode},xform:hh.rising,priority:1},{src:{value:Sh("a").pressed},dest:{value:x.a.actions.rightHand.undoDrawing},xform:hh.rising,priority:1}],[bt.cursorHoveringOnCamera]:[],[bt.rightHandHoveringOnCamera]:[],[bt.leftHandHoveringOnCamera]:[],[bt.rightHandHoldingCamera]:[{src:{value:Ih},dest:{value:x.a.actions.rightHand.takeSnapshot},xform:hh.copy,priority:4}],[bt.leftHandHoldingCamera]:[{src:{value:Nh},dest:{value:x.a.actions.leftHand.takeSnapshot},xform:hh.copy,priority:4}],[bt.cursorHoldingCamera]:[{src:{value:Ih},dest:{value:x.a.actions.cursor.takeSnapshot},xform:hh.copy,priority:4}],[bt.rightHandHoveringOnNothing]:[],[bt.inputFocused]:[{src:{value:"/device/keyboard"},dest:{value:x.a.noop},xform:hh.noop,priority:1e3}]}),Lh=e=>`/vive-user/vive-var/${e}`,Fh=x.a.device.vive.left.button,Bh=x.a.device.vive.left.axis,Vh=x.a.device.vive.left.pose,Uh=Lh("left/joy"),zh=Lh("left/joy/scaled"),Wh=Lh("left/joyX/scaled"),qh=Lh("left/joyY/scaled"),Gh=Lh("left/dpad/north"),Yh=Lh("left/dpad/south"),$h=Lh("left/dpad/east"),Xh=Lh("left/dpad/west"),Qh=Lh("left/dpad/center"),Kh=Lh("left/trigger/falling/stopDrawing"),Jh=Lh("left/grip/falling/stopDrawing"),Zh=Lh("left/trigger/rising/grab"),eu=Lh("left/grab/rising/grab"),tu=Lh("left/touchpad/rising2"),iu=Lh("left/touchpad/rising1"),au=Lh("left/characterAcceleration"),nu=Lh("nonNormalizedCharacterAcceleration"),su=Lh("left/boost"),ou=x.a.device.vive.right.button,ru=x.a.device.vive.right.axis,cu=x.a.device.vive.right.pose,lu=Lh("right/joy"),du=Lh("right/dpad/north"),hu=Lh("right/dpad/south"),uu=Lh("right/dpad/east"),pu=Lh("right/dpad/west"),mu=Lh("right/dpad/center"),gu=Lh("right/dpad/centerStrip"),vu=Lh("right/touchpad/rising"),fu=Lh("right/touchpad/falling"),bu=Lh("right/boost"),yu=Lh("right/trigger/rising/grab"),_u=Lh("right/grab/rising/grab"),Eu=Lh("right/cursorDrop1"),wu=Lh("right/cursorDrop2"),Su=Lh("right/drop1"),xu=Lh("right/drop2"),Au=Lh("right/trigger/stopTeleport"),ku=Lh("right/touchpad/stopTeleport"),Cu=Lh("dpad/ensureFrozen"),Tu=Lh("keyboard/ensureFrozen"),Ru=Lh("dpad/thaw"),Mu=Lh("keyboard/thaw"),Du=Lh("right/snap-right"),Pu=Lh("right/snap-left"),Ou=e=>`/vive-user/keyboard-var/${e}`,Nu=Ou("snap-right"),Hu=Ou("snap-left"),Iu=Ou("characterAcceleration"),ju=Ou("wasd_vec2"),Lu=Ou("arrows_vec2"),Fu=Ou("boost"),Bu=Lh("leftGripPressed1"),Vu=Lh("leftGripPressed2"),Uu=Lh("rightGripPressed1"),zu=Lh("rightGripPressed2"),Wu=Lh("leftTriggerPressed1"),qu=Lh("leftTriggerPressed2"),Gu=Lh("leftTouchpadPressed1"),Yu=Lh("leftTouchpadPressed2"),$u=Lh("rightTriggerPressed1"),Xu=Lh("rightTriggerPressed2"),Qu=Lh("leftTouchpadFallingStopTeleport"),Ku=Lh("leftTriggerFallingStopTeleport"),Ju=Lh("leftGripFallingWhileHoldingPen"),Zu=uh({[bt.global]:[{src:{value:x.a.device.vive.left.matrix},dest:{value:x.a.actions.leftHand.matrix},xform:hh.copy},{src:{value:x.a.device.vive.right.matrix},dest:{value:x.a.actions.rightHand.matrix},xform:hh.copy},{src:[Cu,Tu],dest:{value:x.a.actions.ensureFrozen},xform:hh.any},{src:[Ru,Mu],dest:{value:x.a.actions.thaw},xform:hh.any},{src:{value:Fh("grip").pressed},dest:{value:Bu},xform:hh.copy},{src:{value:Bu},dest:{value:x.a.actions.leftHand.middleRingPinky},xform:hh.copy},{src:{value:Fh("grip").pressed},dest:{value:Vu},xform:hh.copy},{src:[Fh("touchpad").touched,Fh("top").touched],dest:{value:x.a.actions.leftHand.thumb},xform:hh.any},{src:{value:Wu},dest:{value:x.a.actions.leftHand.index},xform:hh.copy},{src:{value:Fh("trigger").pressed},dest:{value:Wu},xform:hh.copy},{src:{value:Fh("trigger").pressed},dest:{value:qu},xform:hh.copy},{src:{value:ou("grip").pressed},dest:{value:Uu},xform:hh.copy},{src:{value:ou("grip").pressed},dest:{value:zu},xform:hh.copy},{src:{value:Uu},dest:{value:x.a.actions.rightHand.middleRingPinky},xform:hh.copy},{src:[ou("touchpad").touched,ou("top").touched],dest:{value:x.a.actions.rightHand.thumb},xform:hh.any},{src:{value:ou("trigger").pressed},dest:{value:$u},xform:hh.copy},{src:{value:ou("trigger").pressed},dest:{value:Xu},xform:hh.copy},{src:{value:$u},dest:{value:x.a.actions.rightHand.index},xform:hh.copy},{src:{x:Bh("joyX"),y:Bh("joyY")},dest:{value:Uh},xform:hh.compose_vec2},{src:{value:Uh},dest:{north:Gh,south:Yh,east:$h,west:Xh,center:Qh},xform:hh.vec2dpad(.35)},{src:{value:Fh("touchpad").pressed},dest:{value:Gu},xform:hh.copy},{src:{value:Fh("touchpad").pressed},dest:{value:Yu},xform:hh.copy},{src:{x:ru("joyX"),y:ru("joyY")},dest:{value:lu},xform:hh.compose_vec2},{src:{value:lu},dest:{north:du,south:hu,east:uu,west:pu,center:mu},xform:hh.vec2dpad(.35,!1,!0)},{src:[du,hu,mu],dest:{value:gu},xform:hh.any},{src:{value:ou("touchpad").pressed},dest:{value:vu},xform:hh.rising},{src:{value:ou("touchpad").pressed},dest:{value:fu},xform:hh.falling},{src:{bool:vu,value:uu},dest:{value:Du},xform:hh.copyIfTrue,priority:1},{src:{value:x.a.device.keyboard.key("e")},dest:{value:Nu},xform:hh.rising},{src:[Du,Nu],dest:{value:x.a.actions.snapRotateRight},xform:hh.any},{src:{value:x.a.device.keyboard.key("Tab")},dest:{value:x.a.actions.toggleFreeze},xform:hh.rising},{src:{value:x.a.device.keyboard.key(" ")},dest:{value:Tu},xform:hh.copy},{src:{value:x.a.device.keyboard.key(" ")},dest:{value:Mu},xform:hh.falling},{src:{value:x.a.device.keyboard.key("p")},dest:{value:x.a.actions.spawnPen},xform:hh.rising},{src:{value:x.a.device.keyboard.key("c")},dest:{value:x.a.actions.toggleCamera},xform:hh.rising},{src:{value:x.a.device.keyboard.key("x")},dest:{value:x.a.actions.takeSnapshot},xform:hh.copy},{src:{value:ou("touchpad").pressed,bool:gu},dest:{value:Cu},root:"rootForFrozenOverrideWhenHolding",xform:hh.copyIfTrue},{src:{value:fu},dest:{value:Ru},xform:hh.copy},{src:{bool:vu,value:pu},dest:{value:Pu},xform:hh.copyIfTrue,priority:1},{src:{value:x.a.device.keyboard.key("q")},dest:{value:Hu},xform:hh.rising},{src:[Pu,Hu],dest:{value:x.a.actions.snapRotateLeft},xform:hh.any},{src:{value:Bh("joyX")},dest:{value:Wh},xform:hh.scale(1.5)},{src:{value:Bh("joyY")},dest:{value:qh},xform:hh.scale(1.5)},{src:{x:Wh,y:qh},dest:{value:zh},xform:hh.compose_vec2},{src:{bool:Yu,value:zh},dest:{value:au},xform:hh.copyIfTrue},{src:{w:x.a.device.keyboard.key("arrowup"),a:x.a.device.keyboard.key("arrowleft"),s:x.a.device.keyboard.key("arrowdown"),d:x.a.device.keyboard.key("arrowright")},dest:{vec2:Lu},xform:hh.wasd_to_vec2},{src:{w:x.a.device.keyboard.key("w"),a:x.a.device.keyboard.key("a"),s:x.a.device.keyboard.key("s"),d:x.a.device.keyboard.key("d")},dest:{vec2:ju},xform:hh.wasd_to_vec2},{src:{value:x.a.device.keyboard.key("t")},dest:{value:x.a.actions.focusChat},xform:hh.rising},{src:{value:x.a.device.keyboard.key("/")},dest:{value:x.a.actions.focusChatCommand},xform:hh.rising},{src:{value:x.a.device.keyboard.key("Escape")},dest:{value:x.a.actions.mediaExit},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("1")},dest:{value:"/var/shift+1"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+1"},dest:{value:x.a.actions.mediaSearch1},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("2")},dest:{value:"/var/shift+2"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+2"},dest:{value:x.a.actions.mediaSearch2},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("3")},dest:{value:"/var/shift+3"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+3"},dest:{value:x.a.actions.mediaSearch3},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("4")},dest:{value:"/var/shift+4"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+4"},dest:{value:x.a.actions.mediaSearch4},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("5")},dest:{value:"/var/shift+5"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+5"},dest:{value:x.a.actions.mediaSearch5},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("6")},dest:{value:"/var/shift+6"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+6"},dest:{value:x.a.actions.mediaSearch6},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("7")},dest:{value:"/var/shift+7"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+7"},dest:{value:x.a.actions.mediaSearch7},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("8")},dest:{value:"/var/shift+8"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+8"},dest:{value:x.a.actions.mediaSearch8},xform:hh.rising},{src:{value:x.a.device.keyboard.key("l")},dest:{value:x.a.actions.logDebugFrame},xform:hh.rising},{src:{value:x.a.device.keyboard.key("k")},dest:{value:x.a.actions.logInteractionState},xform:hh.rising},{src:{value:x.a.device.keyboard.key("m")},dest:{value:x.a.actions.muteMic},xform:hh.rising},{src:{first:ju,second:Lu},dest:{value:Iu},xform:hh.max_vec2},{src:{first:au,second:Iu},dest:{value:nu},xform:hh.max_vec2},{src:{value:nu},dest:{value:x.a.actions.characterAcceleration},xform:hh.normalize_vec2},{src:{value:x.a.device.keyboard.key("shift")},dest:{value:Fu},xform:hh.copy},{src:{value:Fh("top").pressed},dest:{value:su},xform:hh.copy},{src:{value:ou("top").pressed},dest:{value:bu},xform:hh.copy},{src:[Fu,su,bu],dest:{value:x.a.actions.boost},xform:hh.any},{src:{value:cu},dest:{value:x.a.actions.cursor.pose},xform:hh.copy},{src:{value:cu},dest:{value:x.a.actions.rightHand.pose},xform:hh.copy},{src:{value:Vh},dest:{value:x.a.actions.leftHand.pose},xform:hh.copy}],[bt.rightHandTeleporting]:[{src:{value:Xu},dest:{value:Au},xform:hh.falling,priority:1},{src:{value:ou("touchpad").pressed},dest:{value:ku},xform:hh.falling},{src:[Au,ku],dest:{value:x.a.actions.rightHand.stopTeleport},xform:hh.any}],[bt.leftHandHoveringOnNothing]:[{src:{value:qu},dest:{value:x.a.actions.leftHand.startTeleport},xform:hh.rising}],[bt.leftHandTeleporting]:[{src:{value:qu},dest:{value:Ku},xform:hh.falling,priority:1},{src:[Ku,Qu,Ju],dest:{value:x.a.actions.leftHand.stopTeleport},xform:hh.any}],[bt.rightHandHoveringOnNothing]:[{src:{value:Xu},dest:{value:x.a.actions.rightHand.startTeleport},xform:hh.rising,priority:1}],[bt.cursorHoveringOnNothing]:[],[bt.cursorHoveringOnUI]:[{src:{value:Xu},dest:{value:x.a.actions.cursor.grab},xform:hh.rising,priority:1}],[bt.cursorHoveringOnVideo]:[{src:{value:ru("joyY"),touching:ou("touchpad").touched},dest:{value:x.a.actions.cursor.mediaVolumeMod},xform:hh.touch_axis_scroll(.1)}],[bt.leftHandHoveringOnInteractable]:[{src:{value:Vu},dest:{value:eu},xform:hh.rising},{src:{value:qu},dest:{value:Zh},xform:hh.rising,priority:1},{src:[eu],dest:{value:x.a.actions.leftHand.grab},xform:hh.any}],[bt.leftHandHoldingInteractable]:[{src:{value:Vu},dest:{value:x.a.actions.leftHand.drop},xform:hh.falling,priority:1}],[bt.leftHandHoveringOnPen]:[],[bt.leftHandHoldingPen]:[{src:{value:Vu},dest:{value:x.a.actions.leftHand.drop},xform:hh.rising,priority:2},{src:{value:Vu},dest:{value:x.a.actions.leftHand.drop},xform:hh.noop,priority:2},{src:{value:Yu},dest:{value:Qu},xform:hh.falling,priority:1},{src:{value:Yu},dest:{value:iu},xform:hh.rising,priority:1},{src:{bool:iu,value:Qh},dest:{value:x.a.actions.leftHand.startTeleport},xform:hh.copyIfTrue,priority:1},{src:{value:qu},dest:{value:x.a.actions.leftHand.startDrawing},xform:hh.rising,priority:2},{src:{value:qu},dest:{value:Kh},xform:hh.falling,priority:2},{src:{value:Vu},dest:{value:Jh},xform:hh.falling,priority:1},{src:{value:Vu},dest:{value:Ju},xform:hh.falling,priority:1},{src:[Kh,Jh],dest:{value:x.a.actions.leftHand.stopDrawing},xform:hh.any},{src:{value:Yu},dest:{value:tu},xform:hh.rising,priority:1},{src:{bool:tu,value:Gh},dest:{value:x.a.actions.leftHand.penNextColor},xform:hh.copyIfTrue,priority:2},{src:{bool:tu,value:Yh},dest:{value:x.a.actions.leftHand.penPrevColor},xform:hh.copyIfTrue,priority:2},{src:{value:Bh("joyX"),touching:Fh("touchpad").touched},dest:{value:x.a.actions.leftHand.scalePenTip},xform:hh.touch_axis_scroll(.05)},{src:{value:ou("top").pressed},dest:{value:x.a.actions.leftHand.undoDrawing},xform:hh.rising,priority:2},{src:{value:Fh("top").pressed},dest:{value:x.a.actions.leftHand.switchDrawMode},xform:hh.rising,priority:2}],[bt.cursorHoveringOnInteractable]:[{src:{value:zu},dest:{value:_u},xform:hh.rising},{src:{value:Xu},dest:{value:yu},xform:hh.rising,priority:1},{src:[_u],dest:{value:x.a.actions.cursor.grab},xform:hh.any}],[bt.cursorHoldingUI]:[{src:{value:Xu},dest:{value:wu},xform:hh.falling,priority:4}],[bt.cursorHoldingInteractable]:[{src:{value:ru("joyY"),touching:ou("touchpad").touched},dest:{value:x.a.actions.cursor.modDelta},xform:hh.touch_axis_scroll(-1)},{src:{value:zu},dest:{value:Eu},xform:hh.falling,priority:1},{src:[Eu,wu],dest:{value:x.a.actions.cursor.drop},xform:hh.any},{src:{},dest:{value:Cu},root:"rootForFrozenOverrideWhenHolding",xform:hh.always(!1)}],[bt.cursorHoveringOnPen]:[],[bt.cursorHoldingPen]:[{src:[Eu],dest:{value:x.a.actions.cursor.drop},xform:hh.noop,priority:1},{src:[wu],dest:{value:x.a.actions.cursor.drop},xform:hh.noop,priority:1},{src:{value:zu},dest:{value:x.a.actions.cursor.drop},xform:hh.rising,priority:1},{src:{bool:vu,value:mu},dest:{value:x.a.actions.rightHand.startTeleport},xform:hh.copyIfTrue,priority:2},{src:{value:Xu},dest:{value:x.a.actions.cursor.startDrawing},xform:hh.rising,priority:3},{src:{value:Xu},dest:{value:x.a.actions.cursor.stopDrawing},xform:hh.falling,priority:3},{src:{value:ru("joyX"),touching:ou("touchpad").touched},dest:{value:x.a.actions.cursor.scalePenTip},xform:hh.touch_axis_scroll(.1)},{src:{bool:vu,value:du},dest:{value:x.a.actions.cursor.penNextColor},xform:hh.copyIfTrue,priority:2},{src:{bool:vu,value:hu},dest:{value:x.a.actions.cursor.penPrevColor},xform:hh.copyIfTrue,priority:2},{src:{value:ou("top").pressed},dest:{value:x.a.actions.cursor.undoDrawing},xform:hh.rising,priority:2}],[bt.rightHandHoveringOnInteractable]:[{src:{value:zu},dest:{value:_u},xform:hh.rising},{src:{value:Xu},dest:{value:yu},xform:hh.rising,priority:2},{src:[_u],dest:{value:x.a.actions.rightHand.grab},xform:hh.any}],[bt.rightHandHoldingInteractable]:[{src:{value:zu},dest:{value:Su},xform:hh.falling,priority:1},{src:{value:Xu},dest:{value:xu},xform:hh.falling,priority:2},{src:[Su],dest:{value:x.a.actions.rightHand.drop},xform:hh.any,priority:2},{src:{},dest:{value:Cu},root:"rootForFrozenOverrideWhenHolding",xform:hh.always(!1)}],[bt.rightHandHoveringOnPen]:[],[bt.rightHandHoldingPen]:[{src:[Su],dest:{value:x.a.actions.rightHand.drop},xform:hh.noop,priority:1},{src:{value:zu},dest:{value:x.a.actions.rightHand.drop},xform:hh.rising,priority:1},{src:{bool:vu,value:mu},dest:{value:x.a.actions.rightHand.startTeleport},xform:hh.copyIfTrue},{src:{value:Xu},dest:{value:x.a.actions.rightHand.startDrawing},xform:hh.rising,priority:3},{src:{value:Xu},dest:{value:x.a.actions.rightHand.stopDrawing},xform:hh.falling,priority:3},{src:{bool:vu,value:du},dest:{value:x.a.actions.rightHand.penNextColor},xform:hh.copyIfTrue,priority:2},{src:{bool:vu,value:hu},dest:{value:x.a.actions.rightHand.penPrevColor},xform:hh.copyIfTrue,priority:2},{src:{value:ru("joyX"),touching:ou("touchpad").touched},dest:{value:x.a.actions.rightHand.scalePenTip},xform:hh.touch_axis_scroll(.05)},{src:{value:Fh("top").pressed},dest:{value:x.a.actions.rightHand.undoDrawing},xform:hh.rising,priority:2},{src:{value:ou("top").pressed},dest:{value:x.a.actions.rightHand.switchDrawMode},xform:hh.rising,priority:2}],[bt.cursorHoveringOnCamera]:[],[bt.rightHandHoveringOnCamera]:[],[bt.leftHandHoveringOnCamera]:[],[bt.rightHandHoldingCamera]:[{src:{value:Xu},dest:{value:x.a.actions.rightHand.takeSnapshot},xform:hh.copy,priority:3},{src:{value:Xu},dest:{value:x.a.noop},xform:hh.falling,priority:3}],[bt.leftHandHoldingCamera]:[{src:{value:Fh("trigger").pressed},dest:{value:x.a.actions.leftHand.takeSnapshot},xform:hh.copy}],[bt.cursorHoldingCamera]:[{src:{value:Xu},dest:{value:x.a.actions.cursor.takeSnapshot},xform:hh.copy,priority:3},{src:{value:Xu},dest:{value:x.a.noop},xform:hh.falling,priority:3}],[bt.inputFocused]:[{src:{value:"/device/keyboard"},dest:{value:x.a.noop},xform:hh.noop,priority:1e3}]}),ep=x.a.device.wmr.left.grip.pressed,tp=x.a.device.wmr.right.grip.pressed,ip=x.a.device.wmr.right.trigger.pressed,ap=x.a.device.wmr.v("right/joy/north"),np=x.a.device.wmr.v("right/grip/rising"),sp=x.a.device.wmr.v("right/trigger/rising"),op=x.a.device.wmr.v("right/grip/falling"),rp=x.a.device.wmr.v("right/trigger/falling");function cp(e){return{padWest:x.a.device.wmr.v(e+"/pad/west"),padEast:x.a.device.wmr.v(e+"/pad/east"),padNorth:x.a.device.wmr.v(e+"/pad/north"),padSouth:x.a.device.wmr.v(e+"/pad/south"),padCenter:x.a.device.wmr.v(e+"/pad/center"),padCenterStrip:x.a.device.wmr.v(e+"/pad/centerStrip")}}function lp(e){const{padWest:t,padEast:i,padNorth:a,padSouth:n,padCenter:s,padCenterStrip:o}=cp(e),r=x.a.device.wmr.v(e+"/pad");return[{src:{x:x.a.device.wmr[e].touchpad.axisX,y:x.a.device.wmr[e].touchpad.axisY},dest:{value:r},xform:hh.compose_vec2},{src:{value:r},dest:{west:t,east:i,north:a,south:n,center:s},xform:hh.vec2dpad(.5,!1,!1)},{src:[a,s,n],dest:{value:o},xform:hh.any}]}const dp={src:{},dest:{value:x.a.actions.ensureFrozen},xform:hh.always(!1)};function hp(e,t){const i=x.a.device.wmr[e].touchpad.axisY,a=x.a.device.wmr[e].trigger.pressed,n=x.a.device.wmr[e].touchpad.pressed,s=x.a.device.wmr[e].touchpad.touched,o=x.a.device.wmr.v(e+"/pad/rising"),r=x.a.device.wmr.v(e+"/pad/centerStrip/touched"),{padWest:c,padEast:l,padCenter:d,padCenterStrip:h}=cp(e),u=x.a.actions[t?"cursor":e+"Hand"];return[dp,...lp(e),{src:{value:a},dest:{value:u.startDrawing},xform:hh.rising},{src:{value:a},dest:{value:u.stopDrawing},xform:hh.falling},{src:{value:n},dest:{value:o},xform:hh.rising},{src:{bool:o,value:c},dest:{value:u.penPrevColor},xform:hh.copyIfTrue},{src:{bool:o,value:l},dest:{value:u.penNextColor},xform:hh.copyIfTrue},{src:[h,s],dest:{value:r},xform:hh.all},{src:{value:i,touching:r},dest:{value:u.scalePenTip},xform:hh.touch_axis_scroll(-.05)},{src:[o,d],dest:{value:u.undoDrawing},xform:hh.all}]}function up(e){const t=x.a.device.wmr[e].touchpad.touched,i=x.a.device.wmr[e].trigger.pressed,a=x.a.device.wmr[e].grip.pressed,n=x.a.actions[e+"Hand"];return[{src:{value:t},dest:{value:n.thumb},xform:hh.copy},{src:{value:i},dest:{value:n.index},xform:hh.copy},{src:{value:a},dest:{value:n.middleRingPinky},xform:hh.copy}]}function pp(e,t){const i=x.a.actions[t?"cursor":e+"Hand"];return[dp,{src:{value:x.a.device.wmr[e].trigger.pressed},dest:{value:i.takeSnapshot},xform:hh.copy}]}const mp=uh({[bt.global]:[{src:{value:x.a.device.wmr.left.matrix},dest:{value:x.a.actions.leftHand.matrix},xform:hh.copy},{src:{value:x.a.device.wmr.right.matrix},dest:{value:x.a.actions.rightHand.matrix},xform:hh.copy},{src:{value:x.a.device.wmr.left.pose},dest:{value:x.a.actions.leftHand.pose},xform:hh.copy},{src:{value:x.a.device.wmr.right.pose},dest:{value:x.a.actions.cursor.pose},xform:hh.copy},{src:{value:x.a.device.wmr.right.pose},dest:{value:x.a.actions.rightHand.pose},xform:hh.copy},...up("left"),...up("right"),...function(){const e=x.a.device.wmr.left.touchpad.pressed,t=x.a.device.wmr.right.touchpad.pressed,i=x.a.device.wmr.v("left/touchpad/falling"),a=x.a.device.wmr.v("right/touchpad/falling"),n=x.a.device.wmr.k("space/falling");return[{src:[x.a.device.keyboard.key(" "),e,t],dest:{value:x.a.actions.ensureFrozen},xform:hh.any},{src:{value:x.a.device.keyboard.key(" ")},dest:{value:n},xform:hh.falling},{src:{value:x.a.device.keyboard.key("Tab")},dest:{value:x.a.actions.toggleFreeze},xform:hh.rising},{src:{value:e},dest:{value:i},xform:hh.falling},{src:{value:t},dest:{value:a},xform:hh.falling},{src:[n,i,a],dest:{value:x.a.actions.thaw},xform:hh.any}]}(),...function(){const e=x.a.device.wmr.v("right/joy"),t=x.a.device.wmr.v("right/joy/west"),i=x.a.device.wmr.v("right/joy/East"),a=x.a.device.wmr.v("right/joy/west/rising"),n=x.a.device.wmr.v("right/joy/east/rising"),s=x.a.device.wmr.k("q/rising"),o=x.a.device.wmr.k("e/rising");return[{src:{x:x.a.device.wmr.right.joystick.axisX,y:x.a.device.wmr.right.joystick.axisY},dest:{value:e},xform:hh.compose_vec2},{src:{value:e},dest:{north:ap,west:t,east:i},xform:hh.vec2dpad(.2,!1,!1)},{src:{value:ap},dest:{value:x.a.actions.rightHand.startTeleport},xform:hh.rising},{src:{value:t},dest:{value:a},xform:hh.rising},{src:{value:i},dest:{value:n},xform:hh.rising},{src:{value:x.a.device.keyboard.key("q")},dest:{value:s},xform:hh.rising},{src:{value:x.a.device.keyboard.key("e")},dest:{value:o},xform:hh.rising},{src:[a,s],dest:{value:x.a.actions.snapRotateLeft},xform:hh.any},{src:[n,o],dest:{value:x.a.actions.snapRotateRight},xform:hh.any}]}(),...function(){const e=x.a.device.wmr.k("wasd_vec2"),t=x.a.device.wmr.k("arrows_vec2"),i=x.a.device.wmr.k("characterAcceleration"),a=x.a.device.wmr.v("left/joy/x/deadzoned"),n=x.a.device.wmr.v("left/joy/y/deadzoned"),s=x.a.device.wmr.v("left/joy/x/scaled"),o=x.a.device.wmr.v("left/joy/y/scaled"),r=x.a.device.wmr.v("left/characterAcceleration");return[{src:{w:x.a.device.keyboard.key("arrowup"),a:x.a.device.keyboard.key("arrowleft"),s:x.a.device.keyboard.key("arrowdown"),d:x.a.device.keyboard.key("arrowright")},dest:{vec2:t},xform:hh.wasd_to_vec2},{src:{w:x.a.device.keyboard.key("w"),a:x.a.device.keyboard.key("a"),s:x.a.device.keyboard.key("s"),d:x.a.device.keyboard.key("d")},dest:{vec2:e},xform:hh.wasd_to_vec2},{src:{first:e,second:t},dest:{value:i},xform:hh.max_vec2},{src:{value:x.a.device.wmr.left.joystick.axisX},dest:{value:a},xform:hh.deadzone(.1)},{src:{value:a},dest:{value:s},xform:hh.scale(1.5)},{src:{value:x.a.device.wmr.left.joystick.axisY},dest:{value:n},xform:hh.deadzone(.1)},{src:{value:n},dest:{value:o},xform:hh.scale(-1.5)},{src:{x:s,y:o},dest:{value:r},xform:hh.compose_vec2},{src:{first:r,second:i},dest:{value:x.a.actions.characterAcceleration},xform:hh.max_vec2},{src:[x.a.device.wmr.left.trigger.pressed,x.a.device.wmr.right.trigger.pressed,x.a.device.keyboard.key("shift")],dest:{value:x.a.actions.boost},xform:hh.any}]}(),{src:{value:x.a.device.keyboard.key("m")},dest:{value:x.a.actions.muteMic},xform:hh.rising},{src:{value:x.a.device.keyboard.key("t")},dest:{value:x.a.actions.focusChat},xform:hh.rising},{src:{value:x.a.device.keyboard.key("/")},dest:{value:x.a.actions.focusChatCommand},xform:hh.rising},{src:{value:x.a.device.keyboard.key("Escape")},dest:{value:x.a.actions.mediaExit},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("1")},dest:{value:"/var/shift+1"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+1"},dest:{value:x.a.actions.mediaSearch1},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("2")},dest:{value:"/var/shift+2"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+2"},dest:{value:x.a.actions.mediaSearch2},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("3")},dest:{value:"/var/shift+3"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+3"},dest:{value:x.a.actions.mediaSearch3},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("4")},dest:{value:"/var/shift+4"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+4"},dest:{value:x.a.actions.mediaSearch4},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("5")},dest:{value:"/var/shift+5"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+5"},dest:{value:x.a.actions.mediaSearch5},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("6")},dest:{value:"/var/shift+6"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+6"},dest:{value:x.a.actions.mediaSearch6},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("7")},dest:{value:"/var/shift+7"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+7"},dest:{value:x.a.actions.mediaSearch7},xform:hh.rising},{src:{bool:x.a.device.keyboard.key("control"),value:x.a.device.keyboard.key("8")},dest:{value:"/var/shift+8"},priority:1001,xform:hh.copyIfTrue},{src:{value:"/var/shift+8"},dest:{value:x.a.actions.mediaSearch8},xform:hh.rising}],[bt.leftHandHoveringOnNothing]:[],[bt.cursorHoveringOnNothing]:[],[bt.rightHandHoveringOnNothing]:[],[bt.rightHandTeleporting]:[{src:{value:ap},dest:{value:x.a.actions.rightHand.stopTeleport},xform:hh.falling}],[bt.cursorHoveringOnUI]:[{src:{value:ip},dest:{value:x.a.actions.cursor.grab},xform:hh.rising}],[bt.cursorHoveringOnVideo]:[...function(){const e="right",t=x.a.device.wmr.right.touchpad.axisY,i=x.a.device.wmr.right.touchpad.touched,a=x.a.device.wmr.v("right/pad/centerStrip/touched"),{padCenterStrip:n}=cp(e);return[...lp(e),{src:[n,i],dest:{value:a},xform:hh.all},{src:{value:t,touching:a},dest:{value:x.a.actions.cursor.mediaVolumeMod},xform:hh.touch_axis_scroll(-.1)}]}()],[bt.leftHandHoveringOnInteractable]:[{src:{value:ep},dest:{value:x.a.actions.leftHand.grab},xform:hh.rising}],[bt.cursorHoveringOnInteractable]:[{src:{value:tp},dest:{value:np},xform:hh.rising},{src:{value:ip},dest:{value:sp},xform:hh.rising},{src:[np,sp],dest:{value:x.a.actions.cursor.grab},xform:hh.any}],[bt.rightHandHoveringOnInteractable]:[{src:{value:tp},dest:{value:x.a.actions.rightHand.grab},xform:hh.rising}],[bt.leftHandHoldingInteractable]:[dp,{src:{value:ep},dest:{value:x.a.actions.leftHand.drop},xform:hh.falling}],[bt.cursorHoldingInteractable]:[dp,...function(){const{padNorth:e,padSouth:t}=cp("right"),i=x.a.device.wmr.v("right/pad/northOrSouth"),a=x.a.device.wmr.v("right/pad/northOrSouth/pressed"),n=x.a.device.wmr.v("right/pad/northOrSouthpressed/y");return[...lp("right"),{src:[e,t],dest:{value:i},xform:hh.any},{src:[i,x.a.device.wmr.right.touchpad.pressed],dest:{value:a},xform:hh.all},{src:{bool:a,value:x.a.device.wmr.right.touchpad.axisY},dest:{value:n},xform:hh.copyIfTrue},{src:{value:n},dest:{value:x.a.actions.cursor.modDelta},xform:hh.scale(.1)}]}(),{src:{value:tp},dest:{value:op},xform:hh.falling},{src:{value:ip},dest:{value:rp},xform:hh.falling},{src:[op,rp],dest:{value:x.a.actions.cursor.drop},xform:hh.any}],[bt.rightHandHoldingInteractable]:[dp,{src:{value:tp},dest:{value:x.a.actions.rightHand.drop},xform:hh.falling}],[bt.leftHandHoveringOnPen]:[],[bt.cursorHoveringOnPen]:[],[bt.rightHandHoveringOnPen]:[],[bt.leftHandHoldingPen]:hp("left"),[bt.cursorHoldingPen]:hp("right",!0),[bt.rightHandHoldingPen]:hp("right"),[bt.leftHandHoveringOnCamera]:[],[bt.cursorHoveringOnCamera]:[],[bt.rightHandHoveringOnCamera]:[],[bt.leftHandHoldingCamera]:pp("left"),[bt.cursorHoldingCamera]:pp("right",!0),[bt.rightHandHoldingCamera]:pp("right"),[bt.inputFocused]:[{src:{value:"/device/keyboard"},dest:{value:x.a.noop},xform:hh.noop,priority:1e3}]}),gp=x.a.device.xbox.button,vp=x.a.device.xbox.axis,fp=x.a.device.xbox.v("scaledRightJoystickVertical"),bp=x.a.device.xbox.v("scaledLeftJoystickCursorDelta"),yp=x.a.device.xbox.v("deadzonedRightJoystickHorizontal"),_p=x.a.device.xbox.v("deadzonedRightJoystickVertical"),Ep=x.a.device.xbox.v("deadzonedLeftJoystickHorizontal"),wp=x.a.device.xbox.v("deadzonedLeftJoystickVertical"),Sp=x.a.device.xbox.v("vec2Zero"),xp=x.a.device.xbox.v("zero");function Ap(e){const t=x.a.device.xbox.v("scaledLeftJoystickHorizontal"),i=x.a.device.xbox.v("scaledLeftJoystickVertical"),a=x.a.device.xbox.v("scaledLeftJoystickForwardAcceleration");return[{src:{value:Ep},dest:{value:t},xform:hh.scale(1.5)},{src:{value:wp},dest:{value:i},xform:hh.scale(-1.25)},{src:{bool:gp("leftTrigger").pressed,value:i},dest:{value:a},xform:e?hh.copyIfFalse:hh.copy},{src:{x:t,y:a},dest:{value:x.a.actions.characterAcceleration},xform:hh.compose_vec2}]}const kp=uh({[bt.cursorHoldingPen]:[{src:{value:gp("rightTrigger").pressed},dest:{value:x.a.actions.cursor.startDrawing},xform:hh.rising,priority:200},{src:{value:gp("rightTrigger").pressed},dest:{value:x.a.actions.cursor.stopDrawing},xform:hh.falling,priority:200},{src:{value:gp("b").pressed},dest:{value:x.a.actions.cursor.drop},xform:hh.rising},{src:{value:gp("y").pressed},dest:{value:x.a.actions.cursor.undoDrawing},xform:hh.rising,priority:200},{src:{value:gp("a").pressed},dest:{value:x.a.actions.cursor.penNextColor},xform:hh.rising},{src:{value:gp("x").pressed},dest:{value:x.a.actions.cursor.penPrevColor},xform:hh.rising}],[bt.global]:[{src:{},dest:{value:x.a.actions.cursor.hideLine},xform:hh.always(!0)},{src:{value:vp("rightJoystickHorizontal")},dest:{value:yp},xform:hh.deadzone(.1)},{src:{value:yp},dest:{value:x.a.actions.angularVelocity},xform:hh.scale(.6)},{src:{value:vp("rightJoystickVertical")},dest:{value:_p},xform:hh.deadzone(.1)},{src:{value:_p},dest:{value:fp},xform:hh.scale(-1.25)},{src:{},dest:{value:xp},xform:hh.always(0)},{src:{x:xp,y:fp},dest:{value:x.a.actions.cameraDelta},xform:hh.compose_vec2},{src:{value:x.a.actions.cameraDelta},dest:{value:x.a.actions.lobbyCameraDelta},xform:hh.copy},{src:{value:vp("leftJoystickHorizontal")},dest:{value:Ep},xform:hh.deadzone(.1)},{src:{value:vp("leftJoystickVertical")},dest:{value:wp},xform:hh.deadzone(.1)},{src:{value:gp("leftTrigger").pressed},dest:{value:x.a.actions.boost},xform:hh.copy},{src:{value:gp("leftBumper").pressed},dest:{value:x.a.actions.snapRotateLeft},xform:hh.rising},{src:{value:gp("rightBumper").pressed},dest:{value:x.a.actions.snapRotateRight},xform:hh.rising},{src:{},dest:{value:Sp},xform:hh.vec2Zero},{src:{value:Sp},dest:{value:x.a.actions.cursor.pose},xform:hh.poseFromCameraProjection()},{src:{value:gp("y").pressed},dest:{value:x.a.actions.spawnPen},xform:hh.rising,priority:100},{src:{value:gp("dpadUp").pressed},dest:{value:x.a.actions.ensureFrozen},xform:hh.copy},{src:{value:gp("dpadUp").pressed},dest:{value:x.a.actions.thaw},xform:hh.falling},{src:{value:gp("start").pressed},dest:{value:x.a.actions.toggleFreeze},xform:hh.rising},{src:{value:gp("a").pressed},dest:{value:x.a.actions.startGazeTeleport},xform:hh.rising},{src:{value:gp("a").pressed},dest:{value:x.a.actions.stopGazeTeleport},xform:hh.falling}],[bt.cursorHoldingNothing]:[...Ap()],[bt.cursorHoldingInteractable]:[...Ap(!0),{src:{value:gp("rightTrigger").pressed},dest:{value:x.a.actions.cursor.drop},xform:hh.falling,priority:100},{src:{value:wp},dest:{value:bp},xform:hh.scale(.25)},{src:{bool:gp("leftTrigger").pressed,value:bp},dest:{value:x.a.actions.cursor.modDelta},xform:hh.copyIfTrue}],[bt.cursorHoveringOnUI]:[{src:{value:gp("rightTrigger").pressed},dest:{value:x.a.actions.cursor.grab},xform:hh.rising}],[bt.cursorHoveringOnInteractable]:[...Ap(),{src:{value:gp("rightTrigger").pressed},dest:{value:x.a.actions.cursor.grab},xform:hh.rising,priority:100}]}),Cp=e=>`/vars/daydream/${e}`,Tp=Cp("touchpad/axis"),Rp=Cp("touchpad/rising"),Mp=Cp("touchpad/falling"),Dp=Cp("touchpad/pressed"),Pp=Cp("dpad/north"),Op=Cp("dpad/south"),Np=Cp("dpad/east"),Hp=Cp("dpad/west"),Ip=Cp("dpad/center"),jp=Cp("brushSizeDelta"),Lp=Cp("cursorModDelta"),Fp=Cp("dropSouth"),Bp=Cp("dropCenter"),Vp=[{src:{value:Ip,bool:Rp},dest:{value:x.a.actions.cursor.grab},xform:hh.copyIfTrue,priority:100}],Up=[{src:{value:Ip,bool:Rp},dest:{value:Bp},xform:hh.copyIfTrue,priority:100},{src:{value:Op,bool:Rp},dest:{value:Fp},xform:hh.copyIfTrue,priority:100},{src:[Bp,Fp],dest:{value:x.a.actions.cursor.drop},xform:hh.any}],zp=uh({[bt.global]:[{src:{value:x.a.device.daydream.matrix},dest:{value:x.a.actions.rightHand.matrix},xform:hh.copy},{src:{x:x.a.device.daydream.axis("touchpadX"),y:x.a.device.daydream.axis("touchpadY")},dest:{value:Tp},xform:hh.compose_vec2},{src:{value:x.a.device.daydream.button("touchpad").pressed},dest:{value:Rp},xform:hh.rising},{src:{value:x.a.device.daydream.button("touchpad").pressed},dest:{value:Mp},xform:hh.falling},{src:{value:x.a.device.daydream.button("touchpad").pressed},dest:{value:Dp},xform:hh.copy},{src:{value:Tp},dest:{north:Pp,south:Op,east:Np,west:Hp,center:Ip},xform:hh.vec2dpad(.5)},{src:{value:Np,bool:Rp},dest:{value:x.a.actions.snapRotateRight},xform:hh.copyIfTrue},{src:{value:Hp,bool:Rp},dest:{value:x.a.actions.snapRotateLeft},xform:hh.copyIfTrue},{src:{value:Ip,bool:Rp},dest:{value:x.a.actions.rightHand.startTeleport},xform:hh.copyIfTrue},{src:{value:x.a.device.daydream.pose},dest:{value:x.a.actions.cursor.pose},xform:hh.copy},{src:{value:x.a.device.daydream.pose},dest:{value:x.a.actions.rightHand.pose},xform:hh.copy}],[bt.cursorHoveringOnInteractable]:Vp,[bt.cursorHoveringOnUI]:Vp,[bt.cursorHoveringOnVideo]:[{src:{value:x.a.device.daydream.axis("touchpadY"),touching:x.a.device.daydream.button("touchpad").touched},dest:{value:x.a.actions.cursor.mediaVolumeMod},xform:hh.touch_axis_scroll(-.1)}],[bt.cursorHoldingInteractable]:[{src:{value:Mp},dest:{value:x.a.actions.cursor.drop},xform:hh.copy},{src:{value:x.a.device.daydream.axis("touchpadY"),touching:x.a.device.daydream.button("touchpad").touched},dest:{value:Lp},xform:hh.touch_axis_scroll()},{src:{value:Lp},dest:{value:x.a.actions.cursor.modDelta},xform:hh.copy}],[bt.rightHandTeleporting]:[{src:{value:Mp},dest:{value:x.a.actions.rightHand.stopTeleport},xform:hh.copy}],[bt.cursorHoldingPen]:[{src:{value:Pp,bool:Rp},dest:{value:x.a.actions.cursor.startDrawing},xform:hh.copyIfTrue,priority:100},{src:{value:Mp},dest:{value:x.a.actions.cursor.stopDrawing},xform:hh.copy,priority:100},{src:{value:x.a.device.daydream.axis("touchpadX"),touching:x.a.device.daydream.button("touchpad").touched},dest:{value:jp},xform:hh.touch_axis_scroll(-.1)},{src:{value:jp,bool:Dp},dest:{value:x.a.actions.cursor.scalePenTip},xform:hh.copyIfFalse,priority:100},{src:{value:Np,bool:Rp},dest:{value:x.a.actions.cursor.penPrevColor},xform:hh.copyIfTrue,priority:100},{src:{value:Hp,bool:Rp},dest:{value:x.a.actions.cursor.penNextColor},xform:hh.copyIfTrue,priority:100},{src:{value:Lp,bool:Dp},dest:{value:x.a.actions.cursor.modDelta},xform:hh.copyIfFalse,priority:100},...Up],[bt.cursorHoldingCamera]:[{src:{value:Mp},xform:hh.noop,priority:100},{src:{value:Pp,bool:Rp},dest:{value:x.a.actions.cursor.takeSnapshot},xform:hh.copy,priority:100},...Up]}),Wp=uh({[bt.global]:[{src:{value:x.a.device.touchscreen.isTouching},dest:{value:x.a.actions.startGazeTeleport},xform:hh.rising},{src:{value:x.a.device.touchscreen.isTouching},dest:{value:x.a.actions.stopGazeTeleport},xform:hh.falling}]});function qp(e){const t=e.v("touchpad"),i=e.button("touchpad"),a=e.button("trigger"),n=e.axis("touchpadX"),s=e.axis("touchpadXForPen"),o=e.axis("touchpadY"),r=e.axis("touchpadYForPen"),c=e.v("touchpad/rising"),l=e.v("touchpad/falling"),d=e.v("trigger/rising"),h=e.v("trigger/falling"),u=e.v("dpad/north"),p=e.v("dpad/south"),m=e.v("dpad/east"),g=e.v("dpad/west"),v=e.v("dpad/center"),f=e.v("dpad/centerStrip"),b=e.v("dpad/bottomCenterStrip"),y="/vars/oculus-go/togglePen",_={src:{value:d},dest:{value:x.a.actions.cursor.grab},xform:hh.copy,priority:200},E={src:{value:h},dest:{value:x.a.actions.cursor.drop},xform:hh.copy,priority:200};return uh({[bt.global]:[{src:{value:e.matrix},dest:{value:x.a.actions.rightHand.matrix},xform:hh.copy},{src:{value:a.pressed},dest:{value:d},xform:hh.rising},{src:{value:a.pressed},dest:{value:h},xform:hh.falling},{src:{value:i.pressed},dest:{value:c},xform:hh.rising,priority:100},{src:{value:i.pressed},dest:{value:l},xform:hh.falling,priority:100},{src:{x:n,y:o},dest:{value:t},xform:hh.compose_vec2},{src:{value:n},dest:{value:s},xform:hh.copy},{src:{value:o},dest:{value:r},xform:hh.copy},{src:{value:t},dest:{north:u,south:p,east:m,west:g,center:v},xform:hh.vec2dpad(.3)},{src:[v,p],dest:{value:b},xform:hh.any},{src:[u,b],dest:{value:f},xform:hh.any},{src:{value:f,bool:i.pressed},dest:{value:x.a.actions.ensureFrozen},priority:100,xform:hh.copyIfTrue},{src:{value:l},dest:{value:x.a.actions.thaw},xform:hh.copy},{src:{value:m,bool:c},dest:{value:x.a.actions.snapRotateRight},xform:hh.copyIfTrue,priority:100},{src:{value:g,bool:c},dest:{value:x.a.actions.snapRotateLeft},xform:hh.copyIfTrue,priority:100},{src:{value:d},dest:{value:x.a.actions.rightHand.startTeleport},xform:hh.copy,priority:100},{src:{value:e.pose},dest:{value:x.a.actions.cursor.pose},xform:hh.copy},{src:{value:e.pose},dest:{value:x.a.actions.rightHand.pose},xform:hh.copy},{src:{value:i.touched},dest:{value:x.a.actions.rightHand.thumb},xform:hh.copy},{src:{value:a.pressed},dest:{value:x.a.actions.rightHand.index},xform:hh.copy},{src:{value:a.pressed},dest:{value:x.a.actions.rightHand.middleRingPinky},xform:hh.copy}],[bt.cursorHoveringOnInteractable]:[_],[bt.cursorHoveringOnUI]:[_],[bt.cursorHoldingUI]:[E],[bt.cursorHoveringOnVideo]:[{src:{value:o,touching:i.touched},dest:{value:x.a.actions.cursor.mediaVolumeMod},xform:hh.touch_axis_scroll(-.1)}],[bt.cursorHoldingInteractable]:[{src:{value:h},dest:{value:x.a.actions.cursor.drop},xform:hh.copy,priority:200},{src:{value:o,touching:i.touched},dest:{value:x.a.actions.cursor.modDelta},xform:hh.touch_axis_scroll()},{src:{value:f},priority:200,xform:hh.noop}],[bt.rightHandTeleporting]:[{src:{value:h},dest:{value:x.a.actions.rightHand.stopTeleport},xform:hh.copy,priority:100}],[bt.cursorHoldingPen]:[{src:{value:d},dest:{value:x.a.actions.cursor.startDrawing},xform:hh.copy,priority:300},{src:{value:h},dest:{value:x.a.actions.cursor.stopDrawing},xform:hh.copy,priority:300},{src:{value:s,touching:i.touched},dest:{value:x.a.actions.cursor.scalePenTip},xform:hh.touch_axis_scroll(.1,.1),priority:200},{src:{value:r,touching:i.touched},dest:{value:x.a.actions.cursor.modDelta},xform:hh.touch_axis_scroll(1,.1),priority:200},{src:{value:b,bool:l},dest:{value:y},xform:hh.copyIfTrue,priority:300},{src:{value:y},dest:{value:x.a.actions.cursor.drop},xform:hh.rising,priority:200},{src:{value:y},dest:{value:x.a.actions.pen.remove},xform:hh.rising,priority:200},{src:{value:m,bool:c},dest:{value:x.a.actions.cursor.penPrevColor},xform:hh.copyIfTrue,priority:200},{src:{value:g,bool:c},dest:{value:x.a.actions.cursor.penNextColor},xform:hh.copyIfTrue,priority:200},{src:{value:u,bool:c},dest:{value:x.a.actions.cursor.undoDrawing},xform:hh.copyIfTrue,priority:200}],[bt.cursorHoldingCamera]:[{src:{value:d},dest:{value:x.a.actions.cursor.takeSnapshot},xform:hh.copy,priority:300}]})}let Gp,Yp;class $p{constructor(e){this.gamepad=e}write(e){this.gamepad.connected&&(this.gamepad.buttons.forEach((t,i)=>{const a=x.a.device.gamepad(this.gamepad.index).button(i);e.setValueType(a.pressed,!!t.pressed),e.setValueType(a.touched,!!t.touched),e.setValueType(a.value,t.value)}),this.gamepad.axes.forEach((t,i)=>{e.setValueType(x.a.device.gamepad(this.gamepad.index).axis(i),t)}))}}const Xp={},Qp=qp(x.a.device.oculusgo),Kp=qp(x.a.device.gearVRController);const Jp=(e,t)=>{for(const i in e.dest)if(-1!==e.dest[i].indexOf(t))return!0;return!1},Zp=(e,t)=>{for(const i of e)if(Jp(i,t))return!0;return!1},em=(e,t)=>{for(const i of Object.values(e.src))if(!i.startsWith("/device/")&&!Zp(t,i))return!1;return!0};function tm(e,t){if(void 0===e.priority&&(e.priority=0),void 0===t.priority&&(t.priority=0),t.priority>=e.priority)return!1;for(const i in e.src){const a=e.src[i];for(const e in t.src){if(-1!==t.src[e].indexOf(a))return!0}}return!1}function im(e,t){for(let i=0;i<e.sets.length;i++)if(t.includes(e.sets[i]))return!0;return!1}AFRAME.registerSystem("userinput",{get(e){if(this.frame)return this.frame.get(e)},toggleSet(e,t){this.pendingSetChanges.push(e),this.pendingSetChanges.push(!!t)},init(){this.frame={generation:0,values:{},generations:{},get:function(e){if(this.generations[e]===this.generation)return this.values[e]},setValueType:function(e,t){this.values[e]=t,this.generations[e]=this.generation},setVector2:function(e,t,i){const a=this.values[e]||[];a[0]=t,a[1]=i,this.values[e]=a,this.generations[e]=this.generation},setPose:function(e,t){this.setValueType(e,t)},setMatrix4:function(e,t){const i=this.values[e]||new THREE.Matrix4;i.copy(t),this.values[e]=i,this.generations[e]=this.generation}},this.prevActiveSets=[],this.activeSets=[bt.global],this.pendingSetChanges=[],this.xformStates=new Map,this.activeDevices=new ql([new Yl]);const e=AFRAME.utils.device.isMobile(),t=AFRAME.utils.device.isMobileVR();e||t?t||(this.activeDevices.add(new dh),this.activeDevices.add(new Gl),this.activeDevices.add(new Wd)):(this.activeDevices.add(new Wl),this.activeDevices.add(new Qd),this.activeDevices.add(new Gl)),this.isMobile=e,this.isMobileVR=t,this.registeredMappings=new Set([yh]),this.registeredMappingsChanged=!0;const i=new Map;i.set(Ld,mp),i.set(Hd,Zu),i.set(Sd,jh),i.set(hd,Qp),i.set(fd,Kp),i.set(Dd,zp);const a=new Map;a.set($l,kp),a.set($p,Xp);const n=()=>{const e=this.el.sceneEl.is("vr-mode"),t=AFRAME.utils.device.isMobile();if(e){console.log("Using VR bindings."),this.registeredMappings.delete(t?bh:vh);for(let e=0;e<this.activeDevices.items.length;e++){const t=this.activeDevices.items[e],a=i.get(t.constructor);a&&this.registeredMappings.add(a)}t&&ui().then(e=>{e.cardboard===di.yes&&(this.registeredMappings.add(Wp),this.registeredMappingsChanged=!0)})}else{console.log("Using Non-VR bindings.");for(let e=0;e<this.activeDevices.items.length;e++){const t=this.activeDevices.items[e];this.registeredMappings.delete(i.get(t.constructor))}this.registeredMappings.add(t?bh:vh)}for(let e=0;e<this.activeDevices.items.length;e++){const t=this.activeDevices.items[e],i=a.get(t.constructor);i&&this.registeredMappings.add(i)}this.registeredMappingsChanged=!0},s=e=>{let t;for(let t=0;t<this.activeDevices.items.length;t++){const i=this.activeDevices.items[t];if(i.gamepad&&i.gamepad.index===e.gamepad.index)return void console.warn("connected already fired for gamepad",e.gamepad)}t=e.gamepad.id.startsWith("OpenVR Gamepad")||"HTC Vive Focus Plus Controller"===e.gamepad.id?new Hd(e.gamepad):e.gamepad.id.startsWith("Oculus Touch")?new Sd(e.gamepad):e.gamepad.id.startsWith("Spatial Controller")?new Ld(e.gamepad):"Oculus Go Controller"===e.gamepad.id?new hd(e.gamepad):"Gear VR Controller"===e.gamepad.id||"HTC Vive Focus Controller"===e.gamepad.id?new fd(e.gamepad):"Daydream Controller"===e.gamepad.id?new Dd(e.gamepad):"standard"===e.gamepad.mapping?new $l(e.gamepad):new $p(e.gamepad),this.activeDevices.add(t),n()};window.addEventListener("gamepadconnected",s,!1),window.addEventListener("gamepaddisconnected",e=>{for(let t=0;t<this.activeDevices.items.length;t++){const n=this.activeDevices.items[t];if(n.gamepad&&n.gamepad.index===e.gamepad.index)return this.registeredMappings.delete(i.get(n.constructor)||a.get(n.constructor)),void this.activeDevices.delete(n)}n()},!1);for(const e of navigator.getGamepads())e&&s({gamepad:e});this.el.sceneEl.addEventListener("enter-vr",n),this.el.sceneEl.addEventListener("exit-vr",n),n()},maybeToggleXboxMapping(){if(this.isMobile||this.isMobileVR)return;const e=(this.get(x.a.device.vive.left.axesSum)||0)+(this.get(x.a.device.vive.right.axesSum)||0)+(this.get(x.a.device.leftOculusTouch.axesSum)||0)+(this.get(x.a.device.rightOculusTouch.axesSum)||0),t=this.get(x.a.device.mouse.movementXY),i=(t[0]||t[1])>2||e>.5,a=this.registeredMappings.has(kp);i&&a?(this.registeredMappings.delete(kp),this.registeredMappingsChanged=!0):this.get(x.a.device.xbox.axesSum)>.5&&!a&&(this.registeredMappings.add(kp),this.registeredMappingsChanged=!0)},tick2(){this.frame.generation+=1;const e=this.registeredMappingsChanged;e&&(this.registeredMappingsChanged=!1,this.prevSortedBindings=this.sortedBindings,this.sortedBindings=function(e){const t=[];for(const i of e)for(const e in i)for(const a of i[e])t.push(a);const i=[];for(;t.length>0;){const e=t.shift();em(e,i)?i.push(e):t.push(e)}return i}(this.registeredMappings),this.prevSortedBindings||(this.prevSortedBindings=this.sortedBindings),this.masks=function(e){const t=new Array(e.length);for(let i=0;i<e.length;i++){const a=t[i]=[],n=e[i];for(let t=0;t<e.length;t++)tm(e[t],n)&&a.push(t)}return t}(this.sortedBindings)),this.prevActiveSets.length=0;for(let e=0;e<this.activeSets.length;e++){const t=this.activeSets[e];this.prevActiveSets.push(t)}!function(){Gp=Gp||document.querySelector("#player-left-controller").components.teleporter,Yp=Yp||document.querySelector("#player-right-controller").components.teleporter;const e=AFRAME.scenes[0].systems.userinput,{leftHand:t,rightHand:i,rightRemote:a}=AFRAME.scenes[0].systems.interaction.state;e.toggleSet(bt.leftHandHoveringOnNothing,!t.held&&!t.hovered),e.toggleSet(bt.leftHandHoveringOnPen,!t.held&&t.hovered&&t.hovered.components.tags&&t.hovered.components.tags.data.isPen),e.toggleSet(bt.leftHandHoveringOnCamera,!t.held&&t.hovered&&t.hovered.components["camera-tool"]),e.toggleSet(bt.leftHandHoveringOnInteractable,!t.held&&t.hovered&&(t.hovered.components.tags&&t.hovered.components.tags.data.offersRemoteConstraint||t.hovered.components["super-spawner"])),e.toggleSet(bt.leftHandHoveringOnVideo,!t.held&&t.hovered&&t.hovered.components["media-video"]),e.toggleSet(bt.leftHandHoldingPen,t.held&&t.held.components.tags&&t.held.components.tags.data.isPen),e.toggleSet(bt.leftHandHoldingCamera,t.held&&t.held.components["camera-tool"]),e.toggleSet(bt.leftHandHoldingInteractable,t.held),e.toggleSet(bt.rightHandHoveringOnNothing,!(a.held||a.hovered||i.held||i.hovered)),e.toggleSet(bt.rightHandHoveringOnPen,!i.held&&i.hovered&&i.hovered.components.tags&&i.hovered.components.tags.data.isPen),e.toggleSet(bt.rightHandHoveringOnCamera,!i.held&&i.hovered&&i.hovered.components["camera-tool"]),e.toggleSet(bt.rightHandHoveringOnInteractable,!i.held&&i.hovered&&(i.hovered.components.tags&&i.hovered.components.tags.data.offersRemoteConstraint||i.hovered.components["super-spawner"])),e.toggleSet(bt.rightHandHoveringOnVideo,!i.held&&i.hovered&&i.hovered.components["media-video"]),e.toggleSet(bt.rightHandHoldingPen,i.held&&i.held.components.tags&&i.held.components.tags.data.isPen),e.toggleSet(bt.rightHandHoldingCamera,i.held&&i.held.components["camera-tool"]),e.toggleSet(bt.rightHandHoldingInteractable,i.held),e.toggleSet(bt.cursorHoveringOnNothing,!(i.held||i.hovered||a.held||a.hovered)),e.toggleSet(bt.cursorHoveringOnPen,!i.held&&!i.hovered&&!a.held&&a.hovered&&a.hovered.components.tags&&a.hovered.components.tags.data.isPen),e.toggleSet(bt.cursorHoveringOnCamera,!i.held&&!i.hovered&&!a.held&&a.hovered&&a.hovered.components["camera-tool"]),e.toggleSet(bt.cursorHoveringOnInteractable,!i.held&&!i.hovered&&!a.held&&a.hovered&&(a.hovered.components.tags&&a.hovered.components.tags.data.offersRemoteConstraint||a.hovered.components["super-spawner"])),e.toggleSet(bt.cursorHoveringOnUI,!i.held&&!i.hovered&&!a.held&&a.hovered&&a.hovered.components.tags&&(a.hovered.components.tags.data.singleActionButton||a.hovered.components.tags.data.holdableButton)),e.toggleSet(bt.cursorHoveringOnVideo,!i.held&&!i.hovered&&!a.held&&a.hovered&&a.hovered.components["media-video"]),e.toggleSet(bt.cursorHoldingNothing,!i.held&&!a.held),e.toggleSet(bt.cursorHoldingPen,!i.held&&!i.hovered&&a.held&&a.held.components.tags&&a.held.components.tags.data.isPen),e.toggleSet(bt.cursorHoldingCamera,!i.held&&!i.hovered&&a.held&&a.held.components["camera-tool"]),e.toggleSet(bt.cursorHoldingUI,!i.held&&!i.hovered&&a.held&&a.held.components.tags&&a.held.components.tags.data.holdableButton),e.toggleSet(bt.cursorHoldingInteractable,a.held),e.toggleSet(bt.leftHandTeleporting,Gp.isTeleporting),e.toggleSet(bt.rightHandTeleporting,Yp.isTeleporting),e.toggleSet(bt.inputFocused,"INPUT"===document.activeElement.nodeName||"TEXTAREA"===document.activeElement.nodeName||"true"===document.activeElement.contentEditable)}();for(let e=0,t=this.pendingSetChanges.length;e<t;e+=2){const t=this.pendingSetChanges[e];if(this.pendingSetChanges[e+1])this.activeSets.includes(t)||this.activeSets.push(t);else{const e=this.activeSets.indexOf(t);e>-1&&this.activeSets.splice(e,1)}}const t=function(e,t){if(e.length!==t.length)return!0;for(let i=0,a=e.length;i<a;i++){const a=e[i];let n=!1;for(let e=0,i=t.length;e<i;e++)if(a===t[e]){n=!0;break}if(!n)return!0}return!1}(this.prevActiveSets,this.activeSets);if(this.pendingSetChanges.length=0,e||t||!this.actives&&!this.masked){this.prevActives=this.actives,this.prevMasked=this.masked;const{actives:e,masked:t}=function(e,t,i){const a=new Array(e.length);for(let t=0;t<e.length;t++)a[t]=im(e[t],i);const n=new Array(e.length);for(let i=0;i<e.length;i++){const s=n[i]=[],o=t[i];for(let t=0;t<e.length;t++)a[t]&&-1!==o.indexOf(t)&&s.push(t)}return{actives:a,masked:n}}(this.sortedBindings,this.masks,this.activeSets);this.actives=e,this.masked=t}for(let e=0;e<this.activeDevices.items.length;e++)this.activeDevices.items[e].write(this.frame);for(let i=0;i<this.sortedBindings.length;i++){if(!this.actives[i]||this.masked[i].length>0)continue;const a=this.sortedBindings[i];let n=!0;if(!e&&t&&this.prevSortedBindings){const e=this.prevSortedBindings.indexOf(a);n=e>-1&&this.prevActives[e]&&0===this.prevMasked[e].length}n||this.xformStates.delete(a);const{src:s,dest:o,xform:r,debug:c}=a;let l;c&&(l=this.frame.get(o.value));const d=r(this.frame,s,o,this.xformStates.get(a));c&&console.log(`${JSON.stringify(s.value)} (${s.value&&JSON.stringify(this.frame.get(s.value))}) to ${JSON.stringify(o)}: ${l} -> ${this.frame.get(o.value)}`),void 0!==d&&this.xformStates.set(a,d)}this.prevSortedBindings=this.sortedBindings,this.maybeToggleXboxMapping()}});const am=["/actions/","/device/"];AFRAME.registerSystem("userinput-debug",{active:!0,tick(){if(!this.active)return;const e=AFRAME.scenes[0].systems.userinput;if(this.userinputFrameStatus){const t=(e,t)=>"number"==typeof t?`${t>=0?"+":""}${t.toFixed(3)}`:t,i=[],{frame:a}=e;for(const e in a.values){if(!a.get(e))continue;if(!am.some(t=>e.startsWith(t)))continue;let n=JSON.stringify(a.get(e),t);n&&(n=n.replace(/{"(\w{3,})":/g,'{\n  "$1":').replace(/,"(\w{3,})":/g,',\n  "$1":')),i.push(`${e} -> ${n}`)}this.userinputFrameStatus.textContent=i.join("\n")}if(e.get(x.a.actions.logDebugFrame)){Object(U.a)("userinput_debug")&&!this.userinputFrameStatus&&(this.userinputFrameStatus=document.createElement("div"),this.userinputFrameStatus.id="userinput-frame-status",this.userinputFrameStatus.style="\n          position: absolute;\n          z-index: 2;\n          left: 0; bottom: 0;\n          background: white;\n          white-space: pre;\n          font-family: monospace;\n          font-size: 8pt;\n        ",document.body.append(this.userinputFrameStatus)),console.log(e),console.log("sorted",e.sortedBindings),console.log("actives",e.actives),console.log("masks",e.masks),console.log("masked",e.masked),console.log("devices",e.activeDevices),console.log("activeSets",e.activeSets),console.log("frame",e.frame),console.log("xformStates",e.xformStates);const{sortedBindings:t,actives:i,masked:a}=e;for(const e in t){const n=[];if(a[e].length>0)for(const i of a[e])n.push(JSON.stringify(t[i]));this.logBindings&&console.log("binding: ",e,"\n",t[e],"\n","dest: ",t[e].dest&&Object.values(t[e].dest),"\n","active: ",i[e],"\n","maskedBy: ",a[e],"\n",n.join("\n"),"\n")}}}});const nm=[x.a.actions.mediaSearch1,x.a.actions.mediaSearch2,x.a.actions.mediaSearch3,x.a.actions.mediaSearch4,x.a.actions.mediaSearch5,x.a.actions.mediaSearch6,x.a.actions.mediaSearch7,x.a.actions.mediaSearch8];AFRAME.registerSystem("ui-hotkeys",{init(){this.mediaSearchStore=window.APP.mediaSearchStore},tick:function(){this.userinput||(this.userinput=this.el.systems.userinput),this.userinput.get(x.a.actions.focusChat)&&this.focusChat(),this.userinput.get(x.a.actions.focusChatCommand)&&this.focusChat("/"),this.userinput.get(x.a.actions.mediaExit)&&(window.APP.history.location.state&&"avatar-editor"!==window.APP.history.location.state.value&&this.mediaSearchStore.pushExitMediaBrowserHistory(),this.el.emit("action_exit_watch"));for(let e=0;e<nm.length;e++)this.userinput.get(nm[e])&&window.APP.hubChannel.can("spawn_and_move_media")&&this.mediaSearchStore.sourceNavigate(La.a[e]);this.userinput.get(x.a.actions.toggleCamera)&&this.el.emit("action_toggle_camera")},focusChat:function(e){const t=document.querySelector(".chat-focus-target");t&&(t.focus(),e&&(t.value=e))}});class sm{constructor(){this.targets=[],this.setDirty=this.setDirty.bind(this),this.dirty=!0,this.observer=new MutationObserver(this.setDirty),Object(qd.a)().then(()=>{const e=document.querySelector("a-scene");this.rightRemote=document.querySelector("#cursor-controller"),this.observer.observe(e,{childList:!0,attributes:!0,subtree:!0}),e.addEventListener("object3dset",this.setDirty),e.addEventListener("object3dremove",this.setDirty)})}setDirty(){this.dirty=!0}tick(e){this.dirty&&(this.populateEntities(this.targets),this.dirty=!1),this.rightRemote.components["cursor-controller"].tick2(e)}populateEntities(e){e.length=0;const t=AFRAME.scenes[0].querySelectorAll(".collidable, .interactable, .ui");for(let i=0;i<t.length;i++)t[i].object3D&&e.push(t[i].object3D)}remove(){this.observer.disconnect(),AFRAME.scenes[0].removeEventListener("object3dset",this.setDirty),AFRAME.scenes[0].removeEventListener("object3dremove",this.setDirty)}}const om=i(224).ACTIVATION_STATE;class rm{constructor(){this.prevLeftHand={held:null,hovered:null,spawning:null},this.prevRightHand={held:null,hovered:null,spawning:null},this.prevRightRemote={held:null,hovered:null,spawning:null}}tickInteractor(e,t,i,a){if(a.held!==i.held){if(a.held&&a.held.components.tags.data[e]){a.held.removeAttribute("ammo-constraint__"+t);let e=!1;for(const t in a.held.components)t.startsWith("ammo-constraint")&&(e=!0);e||a.held.setAttribute("ammo-body",{activationState:om.ACTIVE_TAG})}!i.spawning&&i.held&&i.held.components.tags.data[e]&&(!i.held.components.networked||NAF.utils.isMine(i.held)||NAF.utils.takeOwnership(i.held)?(i.held.setAttribute("ammo-body",{type:"dynamic",activationState:om.DISABLE_DEACTIVATION}),i.held.setAttribute("ammo-constraint__"+t,{target:"#"+t})):console.log("Failed to obtain ownership while trying to create constraint on networked object."))}else!i.spawning&&a.spawning&&i.held&&i.held.components.tags.data[e]&&(i.held.setAttribute("ammo-body",{type:"dynamic",activationState:om.DISABLE_DEACTIVATION}),i.held.setAttribute("ammo-constraint__"+t,{target:"#"+t}))}tick(){const e=AFRAME.scenes[0].systems.interaction;this.tickInteractor("offersHandConstraint",e.options.leftHand.entity.id,e.state.leftHand,this.prevLeftHand),this.tickInteractor("offersHandConstraint",e.options.rightHand.entity.id,e.state.rightHand,this.prevRightHand),this.tickInteractor("offersRemoteConstraint",e.options.rightRemote.entity.id,e.state.rightRemote,this.prevRightRemote),Object.assign(this.prevLeftHand,e.state.leftHand),Object.assign(this.prevRightHand,e.state.rightHand),Object.assign(this.prevRightRemote,e.state.rightRemote)}}const cm={collisionFilterMask:i(195).COLLISION_LAYERS.HANDS},lm=(()=>{const e=new THREE.Vector3,t=new THREE.Vector3;return function(i,a){return i.getWorldPosition(e),a.getWorldPosition(t),e.distanceTo(t)}})();class dm{constructor(){this.initialScale=new THREE.Vector3}tick(){const e=AFRAME.scenes[0].systems.interaction,{leftHand:t,rightHand:i,rightRemote:a}=e.state;let n,s;t.held&&(t.held===i.held||t.held===a.held)&&(n=e.options.leftHand.entity.object3D,s=t.held===i.held?e.options.rightHand.entity.object3D:e.options.rightRemote.entity.object3D,n===this.previousLeftStretcher&&s===this.previousRightStretcher&&t.held===this.stretched||(this.initialStretchDistance=lm(n,s),this.stretched=t.held,this.initialScale.copy(this.stretched.object3D.scale),this.stretched.components["ammo-body"]&&this.stretched.setAttribute("ammo-body",cm)),this.stretched.object3D.scale.copy(this.initialScale).multiplyScalar(lm(n,s)/this.initialStretchDistance),this.stretched.object3D.matrixNeedsUpdate=!0),this.previousLeftStretcher=n,this.previousRightStretcher=s}}class hm{tick(){this.didInteractThisFrame=!1;const e=AFRAME.scenes[0].systems.interaction,t=AFRAME.scenes[0].systems.userinput,i=e.state.rightRemote.hovered;i&&t.get(e.options.rightRemote.grabPath)&&i.components.tags&&i.components.tags.data.singleActionButton&&(this.didInteractThisFrame=!0,i.object3D.dispatchEvent({type:"interact",object3D:e.options.rightRemote.entity.object3D}))}}class um{tick(){const e=AFRAME.scenes[0].systems.interaction,t=e.state.rightRemote.held;this.prevHeld&&this.prevHeld!==t&&this.prevHeld.object3D.dispatchEvent({type:"holdable-button-up",object3D:e.options.rightRemote.entity.object3D}),t&&this.prevHeld!==t&&t.object3D.dispatchEvent({type:"holdable-button-down",object3D:e.options.rightRemote.entity.object3D}),this.prevHeld=t}}const pm=function(){const e=["icon-button","text-button","pin-networked-object-button"];return function(t){for(let i=0;i<e.length;i++)if(t[e[i]])return!0;return!1}}();function mm(e,t){if(e.object3D.dispatchEvent(t),e.children)for(let i=0;i<e.children.length;i++)pm(e.children[i].components)&&e.children[i].object3D.dispatchEvent(t)}const gm={type:"hovered"},vm={type:"unhovered"};class fm{tick(){const e=function(e){if(!e)return null;if(pm(e.components))return e;if(e.children)for(let t=0;t<e.children.length;t++)if(pm(e.children[t].components))return e.children[t];return null}(AFRAME.scenes[0].systems.interaction.state.rightRemote.hovered);this.prevButton&&this.prevButton!==e&&mm(this.prevButton,vm),e&&this.prevButton!==e&&mm(e,gm),this.prevButton=e}}function bm(e){return e.components["hover-menu"]||e.components["hover-menu__video"]||e.components["hover-menu__hubs-item"]||e.components["hover-menu__link"]||e.components["hover-menu__photo"]}class ym{tick(){const e=function(e){if(!e)return null;const t=bm(e);if(t)return t;if(!e.components.tags||!e.components.tags.data.isHoverMenuChild)return null;let i=e.parentNode;for(;!bm(i);)i=i.parentNode;return bm(i)}(AFRAME.scenes[0].systems.interaction.state.rightRemote.hovered);this.prevHoverMenu&&this.prevHoverMenu!==e&&(this.prevHoverMenu.hovering=!1,this.prevHoverMenu.applyHoverState()),e&&this.prevHoverMenu!==e&&(e.hovering=!0,e.applyHoverState()),this.prevHoverMenu=e}}class _m{maybeSpawn(e,t,i){const a=AFRAME.scenes[0].systems.userinput,n=e.hovered&&e.hovered.components["super-spawner"];n&&!n.cooldownTimeout&&a.get(i)&&window.APP.hubChannel.can("spawn_and_move_media")&&this.performSpawn(e,t,i,a,n)}performSpawn(e,t,i,a,n){t.object3D.updateMatrices(),t.object3D.matrix.decompose(t.object3D.position,t.object3D.quaternion,t.object3D.scale);const s=n.data,o=Object(N.b)(s.src,s.template,Me.a.SPAWNER,null,s.resolve,s.resize,!1).entity;o.object3D.position.copy(s.useCustomSpawnPosition?s.spawnPosition:n.el.object3D.position),o.object3D.rotation.copy(s.useCustomSpawnRotation?s.spawnRotation:n.el.object3D.rotation),o.object3D.scale.copy(s.useCustomSpawnScale?s.spawnScale:n.el.object3D.scale),o.object3D.matrixNeedsUpdate=!0,e.held=o,n.activateCooldown(),e.spawning=!0,o.addEventListener("body-loaded",()=>{setTimeout(()=>{e.spawning=!1,o.object3D.position.copy(s.useCustomSpawnPosition?s.spawnPosition:n.el.object3D.position),s.centerSpawnedObject&&o.body.position.copy(t.object3D.position),o.object3D.matrixNeedsUpdate=!0})},{once:!0})}tick(){const e=AFRAME.scenes[0].systems.interaction;this.maybeSpawn(e.state.leftHand,e.options.leftHand.entity,e.options.leftHand.grabPath),this.maybeSpawn(e.state.rightHand,e.options.rightHand.entity,e.options.rightHand.grabPath),this.maybeSpawn(e.state.rightRemote,e.options.rightRemote.entity,e.options.rightRemote.grabPath)}}function Em(e,t,i){e.held=t.held,e.hovered=t.hovered,e.isTeleporting=i}const wm={DROP:.1,PICKUP:.2,BUTTON_PRESSED:.2,HOVER:.08,STRETCH_BASE:.05,STRETCH_DISTANCE:.2,TELEPORTING:.08,TELEPORTED:.2};function Sm(e,t,i){return e.held&&!t.held?wm.DROP:!e.held&&t.held?wm.PICKUP:!e.hovered&&t.hovered?wm.HOVER:i?wm.TELEPORTING:e.isTeleporting&&!i?wm.TELEPORTED:0}class xm{constructor(){this.state={rightHand:{held:null,hovered:null,isTeleporting:!1},rightRemote:{held:null,hovered:null,isTeleporting:!1},leftHand:{held:null,hovered:null,isTeleporting:!1}}}tick(e,t){const i=AFRAME.scenes[0].systems.userinput,a=i.get(x.a.haptics.actuators.left),n=i.get(x.a.haptics.actuators.right);if(!a&&!n)return;const s=AFRAME.scenes[0].systems.interaction,{leftHand:o,rightHand:r,rightRemote:c}=s.state;this.leftTeleporter=this.leftTeleporter||document.querySelector("#player-left-controller").components.teleporter,this.rightTeleporter=this.rightTeleporter||document.querySelector("#player-right-controller").components.teleporter;const l=Sm(this.state.leftHand,o,this.leftTeleporter.isTeleporting),d=Sm(this.state.rightHand,r,this.rightTeleporter.isTeleporting),h=Sm(this.state.rightRemote,c,!1),u=t?wm.BUTTON_PRESSED:0,p=(m=e).stretcherLeft&&m.stretcherRight?THREE.Math.clamp(wm.STRETCH_BASE+wm.STRETCH_DISTANCE*Math.abs(lm(m.stretcherLeft,m.stretcherRight)-m.initialStretchDistance),0,.5):0;var m;const g=Math.max(l,p),v=Math.max(d,h,p,u);g&&a&&a.pulse(g,15),v&&n&&n.pulse(v,15),Em(this.state.rightHand,r,this.rightTeleporter.isTeleporting),Em(this.state.leftHand,o,this.leftTeleporter.isTeleporting),Em(this.state.rightRemote,c,!1)}}var Am=i(618);const km=new Array(3),Cm=new Array(4),Tm=112,Rm=new THREE.Color(1,1,1),Mm=(new THREE.Matrix4).makeScale(0,0,0);function Dm(e){return e*Tm+(4*e*4+32)}class Pm extends Am.b{constructor(e,t){super(e,"InstanceData",new ArrayBuffer(Dm(e)));let i=this.offset;this.hubs_sweepParams=new Float32Array(this.data,i,4*e),i+=this.hubs_sweepParams.byteLength,this.hubs_interactorOnePos=new Float32Array(this.data,i,3),i+=this.hubs_interactorOnePos.byteLength,this.hubs_isFrozen=new Uint32Array(this.data,i,1),i+=this.hubs_isFrozen.byteLength,this.hubs_interactorTwoPos=new Float32Array(this.data,i,3),i+=this.hubs_interactorTwoPos.byteLength,this.hubs_time=new Float32Array(this.data,i,1),i+=this.hubs_time.byteLength,this.offset=i,this.meshToEl=t}update(e){const t=AFRAME.scenes[0].systems.interaction;let i,a;for(let e=0;e<this.meshes.length;e++){const n=this.meshes[e];if(!n)continue;n.updateMatrices(),this.setInstanceTransform(e,n.visible&&n.parent.visible?n.matrixWorld:Mm),this.setInstanceColor(e,n.material.color||Rm,n.material.opacity||1);const s=this.meshToEl.get(n);if(s){const n=s.object3D,o=s.components["hoverable-visuals"],r=n.matrixWorld.elements[13],c=n.scale.y*o.boundingSphere.radius,l=s.components.pinnable&&s.components.pinnable.data.pinned,d=!!s.components["super-spawner"],h=s.sceneEl.is("frozen"),u=!d&&l&&!h;let p,m;t.state.leftHand.hovered!==s&&t.state.leftHand.held!==s||(i=t.options.leftHand.entity.object3D,p=!0),t.state.rightRemote.hovered===s||t.state.rightRemote.held===s?(a=t.options.rightRemote.entity.object3D,m=!0):t.state.rightHand.hovered!==s&&t.state.rightHand.held!==s||(a=t.options.rightHand.entity.object3D,m=!0),Cm[0]=r-c,Cm[1]=r+c,Cm[2]=!!p&&!u,Cm[3]=!!m&&!u,this.hubs_sweepParams.set(Cm,4*e)}}i&&(km[0]=i.matrixWorld.elements[12],km[1]=i.matrixWorld.elements[13],km[2]=i.matrixWorld.elements[14],this.hubs_interactorOnePos.set(km)),a&&(km[0]=a.matrixWorld.elements[12],km[1]=a.matrixWorld.elements[13],km[2]=a.matrixWorld.elements[14],this.hubs_interactorTwoPos.set(km)),this.hubs_time[0]=e,this.hubs_isFrozen[0]=AFRAME.scenes[0].is("frozen")?1:0}}var Om=i(1286),Nm=i.n(Om),Hm=i(1287),Im=i.n(Hm);const jm=500,Lm=Dm(jm);class Fm{constructor(e,t){this.meshToEl=new WeakMap;const i=t.context;Object(U.a)("enableBatching")?window.WebGL2RenderingContext&&i instanceof WebGL2RenderingContext?Lm>i.getParameter(i.MAX_UNIFORM_BLOCK_SIZE)?console.warn("Insufficient MAX_UNIFORM_BLOCK_SIZE, Disabling batching"):(this.batchingEnabled=!0,this.ubo=new Pm(jm,this.meshToEl),this.batchManager=new Am.a(e,t,{maxInstances:jm,ubo:this.ubo,shaders:{unlit:{vertexShader:Nm.a,fragmentShader:Im.a}}})):console.warn("Batching requires WebGL 2. Disabling batching."):console.warn("Batching is not on by default and must be turned on with enableBatching. Disabling batching.")}addObject(e){if(!this.batchingEnabled)return 0;let t=0;return e.traverse(e=>{e.isMesh&&this.batchManager.addMesh(e)&&t++}),t}removeObject(e){this.batchingEnabled&&e.traverse(e=>{e.isMesh&&this.batchManager.removeMesh(e)})}tick(e){this.batchingEnabled&&this.batchManager.update(e)}}class Bm{tick(){const e=document.querySelector("[scene-preview-camera]");e&&e.components["scene-preview-camera"].tick2()}}AFRAME.registerSystem("hubs-systems",{init(){this.cursorTargettingSystem=new sm,this.constraintsSystem=new rm,this.twoPointStretchingSystem=new dm,this.singleActionButtonSystem=new hm,this.holdableButtonSystem=new um,this.hoverButtonSystem=new fm,this.hoverMenuSystem=new ym,this.superSpawnerSystem=new _m,this.hapticFeedbackSystem=new xm,this.soundEffectsSystem=new d.v,this.lobbyCameraSystem=new Bm,this.batchManagerSystem=new Fm(this.el.sceneEl.object3D,this.el.sceneEl.renderer)},tick(e){const t=AFRAME.scenes[0].systems;t.userinput.tick2(),t.interaction.tick2(this.soundEffectsSystem),this.superSpawnerSystem.tick(),this.cursorTargettingSystem.tick(e),this.constraintsSystem.tick(),this.twoPointStretchingSystem.tick(),this.singleActionButtonSystem.tick(),this.holdableButtonSystem.tick(),this.hoverButtonSystem.tick(),this.hoverMenuSystem.tick(),this.hapticFeedbackSystem.tick(this.twoPointStretchingSystem,this.singleActionButtonSystem.didInteractThisFrame),this.soundEffectsSystem.tick(),this.lobbyCameraSystem.tick()},remove(){this.cursorTargettingSystem.remove()}}),AFRAME.registerSystem("capture-system",{init(){this._gotAudioTrack=!1,this._recorderTimeout=null},_initRecorder(){if(!this.available())return;this._stream=new MediaStream;const e=this.el.canvas.captureStream().getVideoTracks()[0];this._stream.addTrack(e),this._recorder=new MediaRecorder(this._stream,{mimeType:"video/webm; codecs=vp8"});const t=[];this._recorder.ondataavailable=e=>{t.push(e.data)},this._recorder.onstop=()=>{if(0===t.length)return;const e=t[0].type,i=new Blob(t,{type:e});t.length=0,this.el.emit("add_media",new File([i],"capture",{type:e}))}},available:()=>Object(U.a)("video_capture")&&window.MediaRecorder&&MediaRecorder.isTypeSupported("video/webm; codecs=vp8"),started(){return this._recorder&&"inactive"!==this._recorder.state},_tryAddingAudioTrack(){if(this._gotAudioTrack||!this.el.audioListener)return;const e=this.el.audioListener,t=e.context.createMediaStreamDestination();e.getInput().connect(t);const i=t.stream.getAudioTracks()[0];this._stream.addTrack(i),this._gotAudioTrack=!0},start(){this._recorder||this._initRecorder(),this._tryAddingAudioTrack(),this.started()||(this._recorder.start(),this._recorderTimeout=setTimeout(()=>{this.started()&&this._recorder.stop()},15e3))},stop(){this.started()&&(clearTimeout(this._recorderTimeout),this._recorder.stop())}});i(1050);var Vm=i(210),Um=i(1288),zm=i(1289),Wm=i.n(zm),qm=i(1290),Gm=i.n(qm),Ym=i(1291),$m=i.n(Ym);const Xm=["#version 300 es","#define attribute in","#define varying out","#define texture2D texture","#extension GL_OVR_multiview : require","layout(num_views = 2) in;","uniform mat4 modelViewMatrix;","uniform mat4 modelViewMatrix2;","#define modelViewMatrix (gl_ViewID_OVR==0u?modelViewMatrix:modelViewMatrix2)","uniform mat4 projectionMatrix;","uniform mat4 projectionMatrix2;","#define projectionMatrix (gl_ViewID_OVR==0u?projectionMatrix:projectionMatrix2)",""].join("\n"),Qm=["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;",""].join("\n"),Km=["#version 300 es","#define varying in","out highp vec4 pc_fragColor;","#define gl_FragColor pc_fragColor","#define texture2D texture",""].join("\n"),Jm="";function Zm(e){return!!e.visible&&(!e.parent||Zm(e.parent))}AFRAME.registerComponent("sprite",{schema:{name:{type:"string"}},tick(){if(!this.didRegisterWithSystem&&!this.didFailToRegister&&this.el.sceneEl.systems["post-physics"]){const e=this.el.sceneEl.systems["post-physics"].spriteSystem.add(this);this.didRegisterWithSystem=e>0,this.didFailToRegister=e<0}},update(){this.didRegisterWithSystem&&this.el.sceneEl.systems["post-physics"].spriteSystem.updateUVs(this)},remove(){this.didRegisterWithSystem&&this.el.sceneEl.systems["post-physics"].spriteSystem.remove(this)}});const eg=function(){const e=new Map;return function(t,i,a){let n=e.get(t);if(n)return n;{if(!i.frames[t])return-1===a.indexOf(t)&&a.push(t),n={x:0,y:0,w:0,h:0},e.set(t,n),n;const s=i.meta.size,o=i.frames[t].frame;return n={x:o.x/s.w,y:o.y/s.h,w:o.w/s.w,h:o.h/s.h},e.set(t,n),n}}}(),tg=function(){const e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Vector3,n=new THREE.Vector3,s={distance:0,point:n,object:null};return function(o,r){e.set(-.5,.5,0).applyMatrix4(this.matrixWorld),t.set(.5,.5,0).applyMatrix4(this.matrixWorld),i.set(-.5,-.5,0).applyMatrix4(this.matrixWorld);let c=o.ray.intersectTriangle(e,i,t,!1,n);if(null===c&&(a.set(.5,-.5,0).applyMatrix4(this.matrixWorld),null===(c=o.ray.intersectTriangle(t,i,a,!1,n))))return;const l=o.ray.origin.distanceTo(n);l<o.near||l>o.far||(s.distance=l,s.point=n,s.object=this,r.push(s))}}();function ig(e){return e&&e.components?e.components["hoverable-visuals"]?e.components["hoverable-visuals"]:ig(e.parentEl):null}function ag(e){const t=ig(e.el);if(!t)return!1;const i=t.el.components.pinnable&&t.el.components.pinnable.data.pinned,a=!!t.el.components["super-spawner"],n=t.el.sceneEl.is("frozen"),s=!a&&i&&!n;return t.data.enableSweepingEffect&&!s}const ng=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class sg{raycast(e,t){for(let i=0;i<this.slots.length;i++){if(!this.slots[i])continue;const a=this.indexWithSprite.get(i).el.object3D;Zm(a)&&tg.call(a,e,t)}return t}constructor(e){this.missingSprites=[],this.maxSprites=512,this.slots=new Array(this.maxSprites),this.spriteWithIndex=new Map,this.indexWithSprite=new Map,this.stack=new Array(this.maxSprites);for(let e=0;e<this.maxSprites;e++)this.stack[e]=this.maxSprites-1-e;const t=String.prototype.concat(e.renderer.vr.multiview?Xm:Qm,Gm.a),i=String.prototype.concat(e.renderer.vr.multiview?Km:Jm,$m.a);Promise.all([Object(N.c)(Wm.a),Object(qd.a)()]).then(([a])=>{const n=new THREE.RawShaderMaterial({uniforms:{u_spritesheet:{value:a},hubs_Time:{value:0}},vertexShader:t,fragmentShader:i,side:THREE.DoubleSide,transparent:!0});this.mesh=new THREE.Mesh(function(e){const t=new THREE.BufferGeometry;t.addAttribute("a_vertices",new THREE.BufferAttribute(new Float32Array(3*e*4),3,!1)),t.addAttribute("a_hubs_EnableSweepingEffect",new THREE.BufferAttribute(new Float32Array(4*e),1,!1)),t.addAttribute("a_hubs_SweepParams",new THREE.BufferAttribute(new Float32Array(4*e*2),2,!1)),t.addAttribute("a_uvs",new THREE.BufferAttribute(new Float32Array(2*e*4),2,!1));const i=new THREE.InterleavedBuffer(new Float32Array(16*e*4),16);t.addAttribute("mvCol0",new THREE.InterleavedBufferAttribute(i,4,0,!1)),t.addAttribute("mvCol1",new THREE.InterleavedBufferAttribute(i,4,4,!1)),t.addAttribute("mvCol2",new THREE.InterleavedBufferAttribute(i,4,8,!1)),t.addAttribute("mvCol3",new THREE.InterleavedBufferAttribute(i,4,12,!1));const a=new Array(6*e);for(let t=0;t<e;t++)a[3*t*2+0]=4*t+0,a[3*t*2+1]=4*t+2,a[3*t*2+2]=4*t+1,a[3*t*2+3]=4*t+1,a[3*t*2+4]=4*t+2,a[3*t*2+5]=4*t+3;return t.setIndex(a),t}(this.maxSprites),n);const s=document.createElement("a-entity");s.classList.add("ui"),e.appendChild(s),s.setObject3D("mesh",this.mesh),this.mesh.frustumCulled=!1,this.mesh.renderOrder=window.APP.RENDER_ORDER.HUD_ICONS,this.mesh.raycast=this.raycast.bind(this)})}tick(e){if(!this.mesh)return;this.mesh.material.uniforms.hubs_Time.value=e,this.mesh.material.uniformsNeedUpdate=!0;const t=this.mesh.geometry.attributes.mvCol0.data,i=this.mesh.geometry.attributes.a_hubs_EnableSweepingEffect,a=this.mesh.geometry.attributes.a_hubs_SweepParams;for(let e=0;e<this.slots.length;e++){if(!this.slots[e])continue;const n=this.indexWithSprite.get(e);if(Zm(n.el.object3D)){const s=ag(n)?1:0;if(i.array[4*e+0]=s,i.array[4*e+1]=s,i.array[4*e+2]=s,i.array[4*e+3]=s,i.needsUpdate=!0,s){const t=ig(n.el),i=t.sweepParams[0],s=t.sweepParams[1];a.setXY(4*e+0,i,s),a.setXY(4*e+1,i,s),a.setXY(4*e+2,i,s),a.setXY(4*e+3,i,s),a.needsUpdate=!0}n.el.object3D.updateMatrices();const o=n.el.object3D.matrixWorld;t.array.set(o.elements,4*e*16+0),t.array.set(o.elements,4*e*16+16),t.array.set(o.elements,4*e*16+32),t.array.set(o.elements,4*e*16+48),t.needsUpdate=!0}else t.array.set(ng,4*e*16+0),t.array.set(ng,4*e*16+16),t.array.set(ng,4*e*16+32),t.array.set(ng,4*e*16+48),t.needsUpdate=!0}}updateUVs(e){const t=this.mesh.material.uniforms.u_spritesheet.value.flipY,i=this.spriteWithIndex.get(e),a=eg(e.data.name,Um,this.missingSprites),n=this.mesh.geometry.attributes.a_uvs;n.setXY(4*i+0,a.x,t?1-a.y:a.y),n.setXY(4*i+1,a.x+a.w,t?1-a.y:a.y),n.setXY(4*i+2,a.x,t?1-a.y-a.h:a.y+a.h),n.setXY(4*i+3,a.x+a.w,t?1-a.y-a.h:a.y+a.h),n.needsUpdate=!0}add(e){if(!this.mesh)return 0;const t=this.stack.pop();if(void 0===t)return console.error("Too many sprites"),-1;this.slots[t]=!0,this.spriteWithIndex.set(e,t),this.indexWithSprite.set(t,e),this.updateUVs(e);const i=this.mesh.geometry.attributes.a_vertices;return i.setXYZ(4*t+0,-.5,.5,0),i.setXYZ(4*t+1,.5,.5,0),i.setXYZ(4*t+2,-.5,-.5,0),i.setXYZ(4*t+3,.5,-.5,0),i.needsUpdate=!0,1}remove(e){const t=this.spriteWithIndex.get(e);this.spriteWithIndex.delete(e),this.indexWithSprite.delete(t),this.slots[t]=!1,this.stack.push(t);const i=this.mesh.geometry.attributes.mvCol0.data;i.array.set(ng,4*t*16+0),i.array.set(ng,4*t*16+16),i.array.set(ng,4*t*16+32),i.array.set(ng,4*t*16+48),i.needsUpdate=!0}}const og=window.setInterval(()=>{AFRAME.scenes[0]&&AFRAME.scenes[0].systems&&AFRAME.scenes[0].systems.physics&&(AFRAME.registerSystem("post-physics",{init(){this.spriteSystem=new sg(this.el),this.hubsSystems=this.el.sceneEl.systems["hubs-systems"]},tick(e,t){this.spriteSystem.tick(e,t),this.hubsSystems.batchManagerSystem.tick(e)}}),window.clearInterval(og))},1e3);i(1969),i(1970);AFRAME.registerComponent("scalable-when-grabbed",{tick:function(){const e=AFRAME.scenes[0].systems.userinput;if(AFRAME.scenes[0].systems.interaction.state.rightRemote.held!==this.el)return;const t=e.get(x.a.actions.cursor.scaleGrabbedGrabbable);t&&(this.el.object3D.scale.addScalar(t).clampScalar(.1,100),this.el.object3D.matrixNeedsUpdate=!0)}});i(1971),i(875),i(1972);const rg=new THREE.Color(23/255,64/255,118/255),cg=new THREE.Color(190/255,190/255,190/255),lg=new THREE.Color(150/255,80/255,150/255),dg=new THREE.Color(23/255,64/255,118/255);AFRAME.registerComponent("cursor-controller",{schema:{cursor:{type:"selector"},camera:{type:"selector"},far:{default:25},near:{default:.01},defaultDistance:{default:4},minDistance:{default:.18}},init:function(){this.enabled=!0,this.data.cursor.addEventListener("loaded",()=>{this.data.cursor.object3DMap.mesh.renderOrder=window.APP.RENDER_ORDER.CURSOR},{once:!0}),this.raycaster=new THREE.Raycaster,this.raycaster.firstHitOnly=!0,this.distance=this.data.far,this.color=new THREE.Color(0,0,0);const e=new THREE.BufferGeometry;e.addAttribute("position",new THREE.BufferAttribute(new Float32Array(6),3)),this.line=new THREE.Line(e,new THREE.LineBasicMaterial({color:"white",opacity:.2,transparent:!0,visible:!1})),this.el.setObject3D("line",this.line)},update:function(){this.raycaster.far=this.data.far,this.raycaster.near=this.data.near},tick2:(()=>{const e=[],t=new THREE.Vector3;return function(i){const a=AFRAME.scenes[0].systems.userinput,n=a.get(x.a.actions.cursor.pose),s=a.get(x.a.actions.cursor.hideLine);if(this.data.cursor.object3D.visible=this.enabled&&!!n,this.line.material.visible=!(!this.enabled||s),!this.enabled||!n)return;const o=AFRAME.scenes[0].systems.interaction;let r;const c=!!o.state.rightRemote.held;c||(e.length=0,this.raycaster.ray.origin=n.position,this.raycaster.ray.direction=n.direction,this.raycaster.intersectObjects(AFRAME.scenes[0].systems["hubs-systems"].cursorTargettingSystem.targets,!0,e),r=e[0],o.updateCursorIntersection(r),this.distance=r?r.distance:this.data.defaultDistance);const{cursor:l,minDistance:d,far:h,camera:u}=this.data,p=a.get(x.a.actions.cursor.modDelta)||0;if(c&&!a.activeSets.includes(bt.cursorHoldingUI)&&(this.distance=THREE.Math.clamp(this.distance-p,d,h)),l.object3D.position.copy(n.position).addScaledVector(n.direction,this.distance),Object(B.b)(u.object3D,t),t.y=l.object3D.position.y,l.object3D.lookAt(t),l.object3D.scale.setScalar(.75*Math.pow(this.distance,.315)),l.object3D.matrixNeedsUpdate=!0,AFRAME.scenes[0].systems["transform-selected-object"].transforming?this.color.copy(lg).lerpHSL(dg,.5+.5*Math.sin(i/1e3)):r||c?this.color.copy(rg):this.color.copy(cg),this.data.cursor.object3DMap.mesh.material.color.equals(this.color)||(this.data.cursor.object3DMap.mesh.material.color.copy(this.color),this.data.cursor.object3DMap.mesh.material.needsUpdate=!0),this.line.material.visible){const e=n.position,t=l.object3D.position,i=this.line.geometry.attributes.position.array;i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=t.x,i[4]=t.y,i[5]=t.z,this.line.geometry.attributes.position.needsUpdate=!0,this.line.geometry.computeBoundingSphere()}}})()});i(1973);var hg=i(141);const ug={"player-right-controller":{startDrawing:x.a.actions.rightHand.startDrawing,stopDrawing:x.a.actions.rightHand.stopDrawing,undoDrawing:x.a.actions.rightHand.undoDrawing,switchDrawMode:x.a.actions.rightHand.switchDrawMode,penNextColor:x.a.actions.rightHand.penNextColor,penPrevColor:x.a.actions.rightHand.penPrevColor,scalePenTip:x.a.actions.rightHand.scalePenTip},"player-left-controller":{startDrawing:x.a.actions.leftHand.startDrawing,stopDrawing:x.a.actions.leftHand.stopDrawing,undoDrawing:x.a.actions.leftHand.undoDrawing,switchDrawMode:x.a.actions.leftHand.switchDrawMode,penNextColor:x.a.actions.leftHand.penNextColor,penPrevColor:x.a.actions.leftHand.penPrevColor,scalePenTip:x.a.actions.leftHand.scalePenTip},cursor:{pose:x.a.actions.cursor.pose,startDrawing:x.a.actions.cursor.startDrawing,stopDrawing:x.a.actions.cursor.stopDrawing,undoDrawing:x.a.actions.cursor.undoDrawing,penNextColor:x.a.actions.cursor.penNextColor,penPrevColor:x.a.actions.cursor.penPrevColor,scalePenTip:x.a.actions.cursor.scalePenTip}},pg=0,mg=1;AFRAME.registerComponent("pen",{schema:{drawFrequency:{default:5},minDistanceBetweenPoints:{default:.01},camera:{type:"selector"},drawingManager:{type:"string"},color:{type:"color",default:"#FF0033"},availableColors:{default:["#FF0033","#FFFF00","#0099FF","#00FF33","#9900FF","#FF6600","#8D5524","#C68642","#E0AC69","#F1C27D","#FFDBAC","#FFFFFF","#222222","#111111","#000000"]},radius:{default:.01},minRadius:{default:.005},maxRadius:{default:.2},far:{default:100},near:{default:.01}},init(){this.timeSinceLastDraw=0,this.lastPosition=new THREE.Vector3,this.lastPosition.copy(this.el.object3D.position),this.direction=new THREE.Vector3(1,0,0),this.currentDrawing=null,this.normal=new THREE.Vector3,this.worldPosition=new THREE.Vector3,this.colorIndex=0,this.grabbed=!1,this.raycaster=new THREE.Raycaster,this.raycaster.firstHitOnly=!0,this.originalPosition=this.el.object3D.position.clone(),this.intersection=null,this.lastIntersectionDistance=0;const e=new THREE.BufferGeometry;e.addAttribute("position",new THREE.BufferAttribute(new Float32Array(6),3)),this.line=new THREE.Line(e,new THREE.LineBasicMaterial({color:"red",opacity:.2,transparent:!0,visible:!0})),this.line.raycast=function(){},this.el.parentEl.setObject3D("penline",this.line),this.drawMode=pg,this.targets=[],this.setDirty=this.setDirty.bind(this),this.dirty=!0;let t=new THREE.MeshStandardMaterial;window.APP&&"low"===window.APP.quality&&(t=hg.a.fromStandardMaterial(t)),this.penTip=new THREE.Mesh(new THREE.SphereBufferGeometry(1,16,12),t),this.penTip.scale.setScalar(this.data.radius/this.el.parentEl.object3D.scale.x),this.penTip.matrixNeedsUpdate=!0,this.el.setObject3D("mesh",this.penTip);const i=this.el.sceneEl.components["environment-map"];i&&i.applyEnvironmentMap(this.el.parentEl.object3D),this.observer=new MutationObserver(this.setDirty),Object(qd.a)().then(()=>{const e=document.querySelector("a-scene");this.rightRemote=document.querySelector("#cursor-controller"),this.observer.observe(e,{childList:!0,attributes:!0,subtree:!0}),e.addEventListener("object3dset",this.setDirty),e.addEventListener("object3dremove",this.setDirty)})},play(){this.drawingManager=document.querySelector(this.data.drawingManager).components["drawing-manager"],this.drawingManager.createDrawing()},update(e){e.color!=this.data.color&&(this.penTip.material.color.set(this.data.color),this.line.material.color.set(this.data.color)),e.radius!=this.data.radius&&this.el.setAttribute("radius",this.data.radius),this.raycaster.far=this.data.far,this.raycaster.near=this.data.near},tick:(()=>{const e=[],t=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Quaternion;return function(n,s){const o=AFRAME.scenes[0].systems.userinput,r=AFRAME.scenes[0].systems.interaction;if(r.state.rightHand.held===this.el.parentNode?this.grabberId="player-right-controller":r.state.leftHand.held===this.el.parentNode?this.grabberId="player-left-controller":r.state.rightRemote.held===this.el.parentNode?(this.grabberId="cursor",this.drawMode=mg):this.grabberId=null,this.grabberId&&ug[this.grabberId]){const e=this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem,t=ug[this.grabberId];o.get(t.startDrawing)&&(this._startDraw(),e.playSoundOneShot(d.j)),o.get(t.stopDrawing)&&(this._endDraw(),e.playSoundOneShot(d.k));const i=o.get(t.scalePenTip);i&&this._changeRadius(i),o.get(t.penNextColor)&&(this._changeColor(1),e.playSoundOneShot(d.i)),o.get(t.penPrevColor)&&(this._changeColor(-1),e.playSoundOneShot(d.i)),o.get(t.undoDrawing)&&(this._undoDraw(),e.playSoundOneShot(d.l)),t.switchDrawMode&&o.get(t.switchDrawMode)&&(this.drawMode=this.drawMode===pg?mg:pg)}let c;if(e.length=0,this.intersection=null,this.drawMode===mg){if("cursor"===this.grabberId?(c=o.get(ug.cursor.pose))&&(this.raycaster.ray.origin.copy(c.position),this.raycaster.ray.direction.copy(c.direction)):null!==this.grabberId&&(Object(B.b)(this.el.parentEl.object3D,this.raycaster.ray.origin),Object(B.c)(this.el.parentEl.object3D,a),this.raycaster.ray.direction.set(0,-1,0),this.raycaster.ray.direction.applyQuaternion(a)),null!==this.grabberId){if(this.raycaster.intersectObjects(this.targets,!0,e),this.intersection=e[0],this.intersection){c?(t.copy(c.position),this.el.parentEl.object3D.worldToLocal(t)):t.set(0,0,0),i.copy(this.intersection.point),this.el.parentEl.object3D.worldToLocal(i);const e=this.line.geometry.attributes.position.array;e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=i.x,e[4]=i.y,e[5]=i.z,this.line.geometry.attributes.position.needsUpdate=!0}this.intersection?(this.el.object3D.position.copy(this.intersection.point),this.el.parentEl.object3D.worldToLocal(this.el.object3D.position),this.el.object3D.matrixNeedsUpdate=!0,this.worldPosition.copy(this.intersection.point)):(this.el.object3D.position.copy(this.originalPosition),this.el.object3D.matrixNeedsUpdate=!0,Object(B.b)(this.el.object3D,this.worldPosition))}}else this.el.object3D.position.copy(this.originalPosition),this.el.object3D.matrixNeedsUpdate=!0,Object(B.b)(this.el.object3D,this.worldPosition);var l,h,u;if(this._setPenVisible("cursor"!==this.grabberId||!this.intersection),this._setLineVisible(this.el.sceneEl.is("vr-mode")&&this.drawMode===mg&&this.intersection),this.currentDrawing&&this.lastIntersectedObject!==(this.intersection?this.intersection.object:null)&&(!this.intersection||Math.abs(this.intersection.distance-this.lastIntersectionDistance)>1)&&(this.worldPosition.copy(this.lastPosition),this._endDraw()),this.lastIntersectionDistance=this.intersection?this.intersection.distance:0,this.lastIntersectedObject=this.intersection?this.intersection.object:null,l=.005,h=this.worldPosition,u=this.lastPosition,Math.abs(h.x-u.x)<l&&Math.abs(h.y-u.y)<l&&Math.abs(h.z-u.z)<l||(this.direction.subVectors(this.worldPosition,this.lastPosition).normalize(),this.lastPosition.copy(this.worldPosition)),this.currentDrawing){const e=this.timeSinceLastDraw+s;e>=this.data.drawFrequency&&this.currentDrawing.getLastPoint().distanceTo(this.worldPosition)>=this.data.minDistanceBetweenPoints&&(this._getNormal(this.normal,this.worldPosition,this.direction),this.currentDrawing.draw(this.worldPosition,this.direction,this.normal,this.data.color,this.data.radius)),this.timeSinceLastDraw=e%this.data.drawFrequency}this.currentDrawing&&!this.grabberId&&this._endDraw(),this.dirty&&(this.populateEntities(this.targets),this.dirty=!1),this.el.object3D.matrixNeedsUpdate=!0}})(),_setPenVisible(e){this.el.parentEl.object3DMap.mesh&&this.el.parentEl.object3DMap.mesh.visible!==e&&(this.el.parentEl.object3DMap.mesh.visible=e)},_setLineVisible(e){this.line.material.visible!==e&&(this.line.material.visible=e)},_getNormal:(()=>{const e=new THREE.Vector3;return function(t,i,a){e.subVectors(i,this.data.camera.object3D.position).normalize(),t.crossVectors(a,e)}})(),_startDraw(){this.currentDrawing=this.drawingManager.getDrawing(this),this.currentDrawing&&(this._getNormal(this.normal,this.worldPosition,this.direction),this.currentDrawing.startDraw(this.worldPosition,this.direction,this.normal,this.data.color,this.data.radius))},_endDraw(){this.currentDrawing&&(this.timeSinceLastDraw=0,this._getNormal(this.normal,this.worldPosition,this.direction),this.currentDrawing.endDraw(this.worldPosition,this.direction,this.normal),this.drawingManager.returnDrawing(this),this.currentDrawing=null)},_undoDraw(){const e=this.drawingManager.getDrawing(this);e&&(e.undoDraw(),this.drawingManager.returnDrawing(this))},_changeColor(e){this.colorIndex=(this.colorIndex+e+this.data.availableColors.length)%this.data.availableColors.length,this.data.color=this.data.availableColors[this.colorIndex],this.penTip.material.color.set(this.data.color),this.line.material.color.set(this.data.color)},_changeRadius(e){this.data.radius=Math.max(this.data.minRadius,Math.min(this.data.radius+e,this.data.maxRadius)),this.penTip.scale.setScalar(this.data.radius/this.el.parentEl.object3D.scale.x),this.penTip.matrixNeedsUpdate=!0},setDirty(){this.dirty=!0},populateEntities(e){e.length=0;const t=AFRAME.scenes[0].querySelectorAll(".collidable, .interactable, #environment-root");for(let i=0;i<t.length;i++)!t[i].classList.contains("pen")&&t[i].object3D&&e.push(t[i].object3D)},remove(){this.observer.disconnect(),AFRAME.scenes[0].removeEventListener("object3dset",this.setDirty),AFRAME.scenes[0].removeEventListener("object3dremove",this.setDirty),this.el.parentEl.removeObject3D("penline")}});class gg{constructor(e,t,i){this.material=e,this.primitiveMode=t,this.maxBufferSize=i,this.geometries=[],this.current=null,this.drawing=new THREE.Object3D,this.addBuffer()}restartPrimitive(){if(this.idx.position>=this.current.attributes.position.count)console.error("maxBufferSize limit exceeded");else if(0!==this.idx.position){let e=3*(this.idx.position-1);const t=this.current.attributes.position.array;this.addVertex(t[e++],t[e++],t[e++]),this.idx.color++,this.idx.normal++}}remove(e,t){if(this.idx.position>t.position)for(const i in this.idx){const a=3;let n=e[i]*a;const s=(t[i]+1)*a,o=this.idx[i]*a;for(let e=s;e<o;e++)this.current.attributes[i].array[n++]=this.current.attributes[i].array[e];const r=t[i]-e[i]+1;this.idx[i]-=r}else for(const i in this.idx){const a=t[i]-e[i];this.idx[i]-=a}this.update()}undo(e){this.idx=e,this.update()}addBuffer(){const e=new THREE.BufferGeometry,t=new Float32Array(3*this.maxBufferSize),i=new Float32Array(3*this.maxBufferSize),a=new Float32Array(3*this.maxBufferSize),n=new THREE.Mesh(e,this.material);n.drawMode=this.primitiveMode,n.frustumCulled=!1,n.vertices=t;const s=new THREE.Object3D;this.drawing.add(s),s.add(n),e.setDrawRange(0,0),e.addAttribute("position",new THREE.BufferAttribute(t,3).setDynamic(!0)),e.addAttribute("normal",new THREE.BufferAttribute(i,3).setDynamic(!0)),e.addAttribute("color",new THREE.BufferAttribute(a,3).setDynamic(!0)),this.previous=null,this.geometries.length>0&&(this.previous=this.current),this.idx={position:0,normal:0,color:0},this.geometries.push(e),this.current=e}addColor(e,t,i){this.current.attributes.color.setXYZ(this.idx.color++,e,t,i)}addNormal(e,t,i){this.current.attributes.normal.setXYZ(this.idx.normal++,e,t,i)}addVertex(e,t,i){const a=this.current.attributes.position;this.idx.position===a.count&&console.error("maxBufferSize limit exceeded"),a.setXYZ(this.idx.position++,e,t,i)}update(){this.current.setDrawRange(0,this.idx.position),this.current.attributes.color.needsUpdate=!0,this.current.attributes.normal.needsUpdate=!0,this.current.attributes.position.needsUpdate=!0}}class vg{constructor(){this.sharedBuffers={}}addSharedBuffer(e,t,i,a){this.sharedBuffers[e]=new gg(t,i,a)}getSharedBuffer(e){return this.sharedBuffers[e]}}function fg(e,t,i,a){let n=i-1,s=-1;for(;n+1<=a;)t[++s]=e[++n]}AFRAME.registerComponent("networked-drawing",{schema:{segments:{default:8},defaultRadius:{default:.01},maxDrawTimeout:{default:6e5},maxLines:{default:50},maxPointsPerLine:{default:250}},init(){this._receiveData=this._receiveData.bind(this),this.networkBuffer=[],this.sendNetworkBufferQueue=[],this.drawStarted=!1,this.lineStarted=!1,this.remoteLineStarted=!1,this.receivedBufferParts=0,this.bufferIndex=0,this.connectedToOwner=!1,this.networkBufferInitialized=!1;const e={vertexColors:THREE.VertexColors};this.color=new THREE.Color,this.radius=this.data.defaultRadius,this.segments=this.data.segments;let t=new THREE.MeshStandardMaterial(e);window.APP&&"low"===window.APP.quality&&(t=hg.a.fromStandardMaterial(t)),this.sharedBufferGeometryManager=new vg;const i=Math.round(20*this.data.maxPointsPerLine*(this.data.maxLines+1)*.333);this.sharedBufferGeometryManager.addSharedBuffer(0,t,THREE.TriangleStripDrawMode,i),this.lastPoint=new THREE.Vector3,this.lastSegments=[],this.currentSegments=[];for(let e=0;e<this.segments;e++)this.lastSegments[e]={position:new THREE.Vector3,normal:new THREE.Vector3},this.currentSegments[e]={position:new THREE.Vector3,normal:new THREE.Vector3};this.sharedBuffer=this.sharedBufferGeometryManager.getSharedBuffer(0),this.drawing=this.sharedBuffer.drawing;const a=document.querySelector("a-scene");this.scene=a.object3D,this.scene.add(this.drawing);const n=this.el.sceneEl.components["environment-map"];n&&n.applyEnvironmentMap(this.drawing),this.prevIdx=Object.assign({},this.sharedBuffer.idx),this.idx=Object.assign({},this.sharedBuffer.idx),this.vertexCount=0,this.networkBufferCount=0,this.currentPointCount=0,this.invalidPointRead=!1,this.lastReadPointCount=0,this.networkBufferHistory=[],NAF.connection.onConnect(()=>{NAF.utils.getNetworkedEntity(this.el).then(e=>{this.networkedEl=e,this.networkId=NAF.utils.getNetworkId(this.networkedEl),this.drawingId="drawing-"+this.networkId,NAF.connection.subscribeToDataChannel(this.drawingId,this._receiveData)})})},remove(){NAF.connection.unsubscribeToDataChannel(this.drawingId,this._receiveData),this.scene.remove(this.drawing)},tick(e){const t=NAF.connection.isConnected()&&this.networkedEl,i=t&&NAF.utils.isMine(this.networkedEl);if(!this.connectedToOwner&&t){const e=NAF.utils.getNetworkOwner(this.networkedEl);!i&&NAF.connection.hasActiveDataChannel(e)&&(NAF.connection.sendDataGuaranteed(e,this.drawingId,{type:0,clientId:NAF.clientId}),this.connectedToOwner=!0)}if(this.networkBuffer.length>0&&t&&(i?this.bufferIndex<this.networkBuffer.length&&this._broadcastDrawing():this._drawFromNetwork()),i&&this.sendNetworkBufferQueue.length>0){const e=[];for(let t=0;t<this.sendNetworkBufferQueue.length;t++)NAF.connection.hasActiveDataChannel(this.sendNetworkBufferQueue[t])&&e.push(this.sendNetworkBufferQueue[t]);for(let t=0;t<e.length;t++){const i=this.sendNetworkBufferQueue.indexOf(e[t]);this._sendNetworkBuffer(e[t]),this.sendNetworkBufferQueue.splice(i,1)}}this._deleteExpiredLines(e)},_broadcastDrawing:(()=>{const e=[];return function(){e.length=0,fg(this.networkBuffer,e,this.bufferIndex,this.networkBuffer.length-1);let t=-1;for(;-1!=(t=this.networkBuffer.indexOf("-"));)this.networkBuffer.splice(t,1);this.bufferIndex=this.networkBuffer.length,NAF.connection.broadcastDataGuaranteed(this.drawingId,{type:1,buffer:e})}})(),_drawFromNetwork:(()=>{const e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3;return function(){let a=this.networkBuffer[0];"-"===a&&(this._undoDraw(),this.networkBuffer.shift(),a=this.networkBuffer[0]);let n=!1;for(;null!=a&&this.networkBuffer.length>=11;){const a=this.networkBuffer[0];a!==this.lastReadPointCount+1&&(this.invalidPointRead=!0,console.error(`Draw networking error: ID ${this.drawingId} expected point ${this.lastReadPointCount+1} but received ${a}`)),this.lastReadPointCount=a,e.set(this.networkBuffer[1],this.networkBuffer[2],this.networkBuffer[3]),t.set(this.networkBuffer[4],this.networkBuffer[5],this.networkBuffer[6]),this.radius=Math.round(1e3*t.length())/1e3,t.normalize(),i.set(this.networkBuffer[7],this.networkBuffer[8],this.networkBuffer[9]),this.color.setHex(Math.round(i.length())-1),i.normalize(),this.networkBuffer.splice(0,10),this.remoteLineStarted||(this.startDraw(e,t,i),this.remoteLineStarted=!0),null===this.networkBuffer[0]?(this.invalidPointRead||this._endDraw(e,t,i),this.remoteLineStarted=!1,this.networkBuffer.shift(),this.lastReadPointCount=0,this.invalidPointRead=!1):this.invalidPointRead||(this._draw(e,t,i),n=!0)}n&&this._updateBuffer()}})(),_deleteExpiredLines(e){const t=this.networkBufferHistory.length;if(t>0){const i=this.networkBufferHistory[0].time;if(t>this.data.maxLines||i+this.data.maxDrawTimeout<=e){const e=this.networkBufferHistory[0];t>1&&(e.idxLength+=2-this.segments%2,this.networkBufferHistory[1].idxLength-=2-this.segments%2),this.idx.position=e.idxLength,this.idx.uv=e.idxLength,this.idx.normal=e.idxLength,this.idx.color=e.idxLength,this.sharedBuffer.remove(this.prevIdx,this.idx),this.networkBufferHistory.shift(),this.networkedEl&&NAF.utils.isMine(this.networkedEl)&&(this.networkBuffer.splice(0,e.networkBufferCount),this.bufferIndex-=e.networkBufferCount)}}},_sendNetworkBuffer:(()=>{const e=[];return function(t){if(NAF.utils.isMine(this.networkedEl))if(this.networkBuffer.length<=3e3)NAF.connection.sendDataGuaranteed(t,this.drawingId,{type:2,parts:1,buffer:this.networkBuffer});else{let i=0,a=0;for(;a<this.networkBuffer.length;)a=Math.min(a+3e3,this.networkBuffer.length),e.length=0,fg(this.networkBuffer,e,i,a-1),i=a,NAF.connection.sendDataGuaranteed(t,this.drawingId,{type:2,parts:Math.ceil(this.networkBuffer.length/3e3),buffer:e})}}})(),_receiveData(e,t,i){switch(i.type){case 0:this.sendNetworkBufferQueue.push(i.clientId);break;case 1:this.networkBufferInitialized&&this.networkBuffer.push.apply(this.networkBuffer,i.buffer);break;case 2:this.networkBuffer.push.apply(this.networkBuffer,i.buffer),++this.receivedBufferParts>=i.parts&&(this.networkBufferInitialized=!0)}},getLastPoint(){return this.lastPoint},startDraw(e,t,i,a,n){NAF.connection.isConnected()&&(this.drawStarted=!0,a&&this.color.set(a),n&&(this.radius=n),this.lastPoint.copy(e),this._addToNetworkBuffer(e,t,i))},draw(e,t,i,a,n){NAF.connection.isConnected()&&this.drawStarted&&(a&&a!="#"+this.color.getHexString().toUpperCase()&&this.color.set(a),n&&(this.radius=n),this._addToNetworkBuffer(e,t,i),this._draw(e,t,i),this._updateBuffer())},_draw:(()=>{const e=new THREE.Vector3;return function(t,i,a,n=1){if(this.lineStarted)this._generateSegments(this.currentSegments,t,i,a,this.radius*n),this._drawCylinder(),this.currentPointCount>this.data.maxPointsPerLine&&(this._drawEndCap(t,i),this._endLine());else{this._generateSegments(this.lastSegments,t,i,a,this.radius*n),0===this.networkBufferHistory.length?this._addDegenerateTriangle():(this._restartPrimitive(),this._addDegenerateTriangle(),this.segments%2==0&&this._addDegenerateTriangle()),e.copy(i).negate();for(let t=0;t<this.segments;t++)this.lastSegments[t].normal.add(e).multiplyScalar(.5);this._drawCap(this.lastPoint,this.lastSegments,e),this.segments%2!=0&&this._addDegenerateTriangle(),this.lineStarted=!0}this.lastPoint.copy(t)}})(),undoDraw(){NAF.connection.isConnected()&&!this.drawStarted&&(this._undoDraw(),this._pushToNetworkBuffer("-"))},_undoDraw(){const e=this.networkBufferHistory.length;if(e>0){const t=this.networkBufferHistory.pop();this.idx.position=0,this.idx.uv=0,this.idx.normal=0,this.idx.color=0,e>1&&(t.idxLength+=1-this.segments%2,this.idx.position=this.sharedBuffer.idx.position-t.idxLength,this.idx.uv=this.sharedBuffer.idx.uv-t.idxLength,this.idx.normal=this.sharedBuffer.idx.normal-t.idxLength,this.idx.color=this.sharedBuffer.idx.color-t.idxLength),this.sharedBuffer.remove(this.idx,this.sharedBuffer.idx),this.networkedEl&&NAF.utils.isMine(this.networkedEl)&&(this.networkBuffer.splice(this.networkBuffer.length-t.networkBufferCount,t.networkBufferCount),this.bufferIndex-=t.networkBufferCount)}},endDraw(e,t,i){this._endDraw(e,t,i),this._updateBuffer()},_endDraw(e,t,i){!this.lineStarted&&this.drawStarted?this._drawPoint(e):this.lineStarted&&this.drawStarted&&(this._addToNetworkBuffer(e,t,i),this._draw(e,t,i),this._drawEndCap(e,t)),this._endLine()},_drawEndCap:(()=>{const e=new THREE.Vector3,t=new THREE.Vector3;return function(i,a){this.lineStarted&&this.drawStarted&&(e.copy(a).multiplyScalar(this.radius),t.copy(i).add(e),this._addDegenerateTriangle(),this._drawCap(t,this.lastSegments,a))}})(),_endLine(){if(!this.drawStarted)return;this.networkedEl&&NAF.utils.isMine(this.networkedEl)&&this._pushToNetworkBuffer(null);const e={networkBufferCount:this.networkBufferCount,idxLength:this.vertexCount-1,time:1e3*this.el.sceneEl.clock.elapsedTime};this.networkBufferHistory.push(e),this.vertexCount=0,this.networkBufferCount=0,this.currentPointCount=0,this.lineStarted=!1,this.drawStarted=!1},_addToNetworkBuffer:(()=>{const e=new THREE.Vector3,t=new THREE.Vector3;return function(i,a,n){this.networkedEl&&NAF.utils.isMine(this.networkedEl)&&(++this.currentPointCount,this._pushToNetworkBuffer(this.currentPointCount),this._pushToNetworkBuffer(i.x),this._pushToNetworkBuffer(i.y),this._pushToNetworkBuffer(i.z),e.copy(a),e.setLength(this.radius),this._pushToNetworkBuffer(e.x),this._pushToNetworkBuffer(e.y),this._pushToNetworkBuffer(e.z),t.copy(n),t.setLength(this.color.getHex()+1),this._pushToNetworkBuffer(t.x),this._pushToNetworkBuffer(t.y),this._pushToNetworkBuffer(t.z))}})(),_pushToNetworkBuffer(e){"-"!==e&&++this.networkBufferCount,this.networkBuffer.push(e)},_drawCylinder(){for(let e=0;e<this.segments;e++)this.currentSegments[e].normal.add(this.lastSegments[e].normal).multiplyScalar(.5);for(let e=0;e!=this.segments+1;e++)this._addVertex(this.lastSegments[e%this.segments]),this._addVertex(this.currentSegments[e%this.segments]);for(let e=0;e<this.segments;e++)this.lastSegments[e].position.copy(this.currentSegments[e].position),this.lastSegments[e].normal.copy(this.currentSegments[e].normal)},_drawPoint:(()=>{const e=new THREE.Vector3(0,1,0),t=new THREE.Vector3(0,-1,0),i=new THREE.Vector3(1,0,0),a=new THREE.Vector3,n=new THREE.Vector3;return function(s){a.copy(e).multiplyScalar(.75*this.radius),n.copy(s).add(a),this.lastPoint.copy(n),a.copy(e).multiplyScalar(.5*this.radius),n.copy(s).add(a),this._draw(n,t,i,.75),this._draw(s,t,i),a.copy(t).multiplyScalar(.5*this.radius),n.copy(s).add(a),this._draw(n,t,i,.75),a.copy(t).multiplyScalar(.75*this.radius),n.copy(s).add(a),this._addDegenerateTriangle(),this._drawCap(n,this.lastSegments,t)}})(),_drawCap(e,t,i){let a=0;for(let n=0;n<2*this.segments-this.segments%2;n++)(n-2)%4==0?this._addVertex({position:e,normal:i}):(this._addVertex(t[a%this.segments]),(n+1)%5!=0&&++a)},_restartPrimitive(){this.sharedBuffer.restartPrimitive(),++this.vertexCount},_updateBuffer(){this.sharedBuffer.update()},_addVertex(e){const t=e.position,i=e.normal;this.sharedBuffer.addVertex(t.x,t.y,t.z),this.sharedBuffer.addColor(this.color.r,this.color.g,this.color.b),i?this.sharedBuffer.addNormal(i.x,i.y,i.z):++this.sharedBuffer.idx.normal,++this.sharedBuffer.idx.uv,++this.vertexCount},_addDegenerateTriangle(){this._addVertex(this.lastSegments[0])},_generateSegments(e,t,i,a,n){const s=2*Math.PI/this.segments;for(let o=0;o<this.segments;o++){const r=e[o].position;this._rotatePointAroundAxis(r,t,i,a,s*o,n),e[o].normal.subVectors(r,t).normalize()}},_rotatePointAroundAxis:(()=>{const e=new THREE.Vector3;return function(t,i,a,n,s,o){e.copy(n),e.applyAxisAngle(a,s),t.copy(i).add(e.normalize().multiplyScalar(o))}})()});i(1974);var bg=function(){const e=e=>()=>{let t=null;return i=>null===t?(t=new THREE.Vector3(i.x,i.y,i.z),!0):!NAF.utils.almostEqualVec3(t,i,e)&&(t.copy(i),!0)};NAF.schemas.add({template:"#remote-avatar",components:[{component:"position",requiresNetworkUpdate:e(.001)},{component:"rotation",requiresNetworkUpdate:e(.5)},"scale","player-info","networked-avatar",{selector:".camera",component:"position",requiresNetworkUpdate:e(.001)},{selector:".camera",component:"rotation",requiresNetworkUpdate:e(.5)},{selector:".left-controller",component:"position",requiresNetworkUpdate:e(.001)},{selector:".left-controller",component:"rotation",requiresNetworkUpdate:e(.5)},{selector:".left-controller",component:"visible"},{selector:".right-controller",component:"position",requiresNetworkUpdate:e(.001)},{selector:".right-controller",component:"rotation",requiresNetworkUpdate:e(.5)},{selector:".right-controller",component:"visible"}]}),NAF.schemas.add({template:"#interactable-media",components:[{component:"position",requiresNetworkUpdate:e(.001)},{component:"rotation",requiresNetworkUpdate:e(.5)},"scale","media-loader",{component:"media-video",property:"time"},{component:"media-video",property:"videoPaused"},{component:"media-pager",property:"index"},"pinnable"]}),NAF.schemas.add({template:"#static-media",components:["media-loader",{component:"media-video",property:"time"}]}),NAF.schemas.add({template:"#static-controlled-media",components:["media-loader",{component:"media-video",property:"time"},{component:"media-video",property:"videoPaused"},{component:"media-pager",property:"index"}]}),NAF.schemas.add({template:"#interactable-drawing",components:[{component:"position",requiresNetworkUpdate:e(.001)},{component:"rotation",requiresNetworkUpdate:e(.5)},"scale","networked-drawing"]}),NAF.schemas.add({template:"#interactable-camera",components:["position","rotation",{component:"camera-tool",property:"isSnapping"},{component:"camera-tool",property:"isRecording"},{component:"camera-tool",property:"label"}]}),NAF.schemas.add({template:"#interactable-pen",components:[{component:"position",requiresNetworkUpdate:e(.001)},{component:"rotation",requiresNetworkUpdate:e(.5)},"scale","media-loader",{selector:"#pen",component:"pen",property:"radius"},{selector:"#pen",component:"pen",property:"color"}]})},yg=i(78);function _g(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}function Eg(e){return function(){var t=this,i=arguments;return new Promise(function(a,n){var s=e.apply(t,i);function o(e){_g(s,a,n,o,r,"next",e)}function r(e){_g(s,a,n,o,r,"throw",e)}o(void 0)})}}function wg(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},a=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),a.forEach(function(t){Sg(e,t,i[t])})}return e}function Sg(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}console.log(`Hubs version: ${{NODE_ENV:"production",DEFAULT_SCENE_SID:"JGLt8DP",RETICULUM_SERVER:"dev.reticulum.io",FARSPARK_SERVER:"farspark-dev.reticulum.io",NON_CORS_PROXY_DOMAINS:"hubs.local,dev.reticulum.io",ASSET_BUNDLE_SERVER:"https://asset-bundles-prod.reticulum.io",EXTRA_ENVIRONMENTS:"",POSTGREST_SERVER:"hubs.local:3000"}.BUILD_VERSION||"?"}`),Object(a.a)(),window.APP=new Vm.a,window.APP.RENDER_ORDER={HUD_BACKGROUND:1,HUD_ICONS:2,CURSOR:3};const xg=window.APP.store,Ag=window.APP.mediaSearchStore,kg=new URLSearchParams(location.search),Cg=AFRAME.utils.device.isMobile(),Tg=AFRAME.utils.device.isMobileVR(),Rg=window.self!==window.top;if(Rg&&!kg.get("embed_token"))throw new Error("no embed token");THREE.Object3D.DefaultMatrixAutoUpdate=!1,window.APP.quality=kg.get("quality")||Cg||Tg?"low":"high";const Mg=i(1924),Dg=i(1925);window.Ammo=Mg.bind(void 0,{locateFile:e=>e.endsWith(".wasm")?Dg:e}),i(1173);NAF.options.firstSyncSource="phx-reliable",NAF.options.syncSource="phx-reliable";const Pg=Object(U.a)("bot"),Og=Object(U.a)("disable_telemetry"),Ng=Object(U.a)("debug"),Hg=Object(X.g)("https://uploads-prod.reticulum.io/files/61d77151-7a74-40a6-b427-0c5a350c4502.glb");Pg||Og||Object(yg.a)("/hub","Room Landing Page"),Object(dl.a)(),function(e="global"){const t=`___concurrent_load_detector_${e}`;localStorage.setItem(t,JSON.stringify({started_at:new Date}));const i=e=>{e.key===t&&(window.dispatchEvent(new CustomEvent("concurrentload")),window.removeEventListener("storage",i))};window.addEventListener("storage",i)}(),xg.init();let Ig={},jg=document.location.pathname.split("/").slice(0,2).join("/");document.location.pathname.includes("hub.html")&&(jg="");const Lg=Object(At.a)({basename:jg});window.APP.history=Lg;const Fg=kg.get("vr_entry_type");function Bg(e){!function(e={}){const t=document.querySelector("a-scene"),i=Object(U.a)("allow_multi"),a=t&&t.systems.userinput.activeSets.includes(bt.cursorHoldingPen),n=t&&!!t.systems["camera-tools"].getMyCamera(),s=Fg;_t.a.render(wt.a.createElement(St.a,{history:Lg},wt.a.createElement(xt.a,{render:o=>wt.a.createElement($c,wg({scene:t,isBotMode:Pg,disableAutoExitOnConcurrentLoad:i,forcedVREntryType:s,store:xg,mediaSearchStore:Ag,isCursorHoldingPen:a,hasActiveCamera:n},e,o))})),document.getElementById("ui-root"))}(Ig=wg({},Ig,e))}function Vg(e){return Ug.apply(this,arguments)}function Ug(){return(Ug=Eg(function*(e){Bg({hubId:e.hub_id,hubName:e.name,hubMemberPermissions:e.member_permissions,hubScene:e.scene,hubEntryCode:e.entry_code})})).apply(this,arguments)}function zg(e){return Wg.apply(this,arguments)}function Wg(){return(Wg=Eg(function*(e){let t,i="https://www.dropbox.com/s/ayl3t33p2ymnxux/Axon%20Park_Cliffside.glb";const a=document.querySelector("#environment-scene"),n=document.querySelector("a-scene");if(e.scene)t=!1,i=e.scene.model_url;else if(null===e.scene)i=Hg;else{const a=e.topics[0],n=a.assets.find(e=>"glb"===e.asset_type),s=a.assets.find(e=>"gltf_bundle"===e.asset_type);i=(n||s).src;const o=/\.gltf/i.test(i)||/\.glb/i.test(i);t=!(n||o)}if(t){const e=yield fetch(i),t=yield e.json(),a=new URL(THREE.LoaderUtils.extractUrlBase(i),window.location.href);i=new URL(t.assets[0].src,a).href}else i=Object(X.g)(i);console.log(`Scene URL: ${i}`);let s=null;if(0===a.childNodes.length){const e=document.createElement("a-entity");e.setAttribute("gltf-model-plus",{src:i,useCache:!1,inflate:!0}),a.appendChild(e),e.addEventListener("model-loaded",()=>{document.querySelector(".a-canvas").classList.remove("a-hidden"),fl(e)},{once:!0})}else s=a.childNodes[0],THREE.Cache.clear(),s.addEventListener("model-loaded",()=>{s.addEventListener("model-loaded",()=>{fl(s),n.is("entered")&&document.querySelector("#player-rig").components["spawn-controller"].moveToSpawnPoint()},{once:!0}),s.setAttribute("gltf-model-plus",{src:i})},{once:!0}),s.setAttribute("gltf-model-plus",{src:Hg})})).apply(this,arguments)}function qg(){return(qg=Eg(function*(e,t,i,a){const n=document.querySelector("a-scene");if(NAF.connection.isConnected())return n.is("entered")&&t.sendEntryEvent(),void NAF.connection.entities.completeSync(null,!0);Rg&&t.allowNAFTraffic(!1);const r=a.hubs[0];let c=r.embed_token;if(!c){const e=xg.state.embedTokens&&xg.state.embedTokens.find(e=>e.hubId===r.hub_id);e&&(c=e.embedToken)}console.log(`Janus host: ${r.host}`),Bg({onSendMessage:i.dispatch,onLoaded:()=>xg.executeOnLoadActions(n),onMediaSearchResultEntrySelected:e=>n.emit("action_selected_media_result_entry",e),onMediaSearchCancelled:e=>n.emit("action_media_search_cancelled",e),onAvatarSaved:e=>n.emit("action_avatar_saved",e),embedToken:c}),n.addEventListener("action_selected_media_result_entry",e=>{const i=e.detail;"scene_listing"!==i.type&&"scene"!==i.type||t.can("update_hub")&&t.updateScene(i.url)}),n.addEventListener("2d-interstitial-gesture-required",()=>{Bg({showInterstitialPrompt:!0,onInterstitialPromptClicked:()=>{n.emit("2d-interstitial-gesture-complete"),Bg({showInterstitialPrompt:!1,onInterstitialPromptClicked:null})}})});const l=document.querySelector("#objects-scene"),d=Object(s.h)(`/${r.hub_id}/objects.gltf`),h=document.createElement("a-entity");h.setAttribute("gltf-model-plus",{src:d,useCache:!1,inflate:!0}),Pg||l.appendChild(h);const u=function(){var i=Eg(function*(){for(n.setAttribute("networked-scene",{room:r.hub_id,serverURL:`wss://${r.host}`,debug:!!Ng});!n.components["networked-scene"]||!n.components["networked-scene"].data;)yield Object(o.a)();n.addEventListener("adapter-ready",({detail:e})=>{let i=null;e.setReconnectionListeners(()=>{i||(i=setInterval(Eg(function*(){const i=NAF.connection.adapter.serverUrl,a=`wss://${yield t.getHost()}`;i!==a&&(console.log("Connecting to new Janus server "+a),n.setAttribute("networked-scene",{serverURL:a}),e.serverUrl=a)}),1e3))},()=>{clearInterval(i),i=null},null);const a=e=>(i,a,n)=>{const s={dataType:a,data:n};i&&(s.clientId=i);const o="open"===t.channel.socket.connectionState();(o||e)&&(o?t.channel.push("naf",s):t.channel.push("naf",AFRAME.utils.clone(s)))};e.reliableTransport=a(!0),e.unreliableTransport=a(!1)});const i=()=>{zg(r),n.components["networked-scene"].connect().then(()=>n.emit("didConnectToNetworkedScene")).catch(t=>{const i=t.error&&t.error.msg.match(/\bfull\b/i);console.error(t),Bg({roomUnavailableReason:i?"full":"connect_error"}),e.exitScene()})};Vg(r),Rg?Bg({onPreloadLoadClicked:()=>{t.allowNAFTraffic(!0),Bg({showPreload:!1}),i()}}):i()});return function(){return i.apply(this,arguments)}}();Pg?u():h.addEventListener("model-loaded",function(){var e=Eg(function*(e){e.target===h&&u()});return function(t){return e.apply(this,arguments)}}())})).apply(this,arguments)}function Gg(){return(Gg=Eg(function*(e,t){const i=()=>{};for(e.renderer={setAnimationLoop:i,render:i};!NAF.connection.isConnected();)yield Object(o.a)();t.enterSceneWhenLoaded(new MediaStream,!1)})).apply(this,arguments)}document.addEventListener("DOMContentLoaded",Eg(function*(){if(document.querySelector(".a-canvas").classList.add("a-hidden"),_o(),!window.WebAssembly)return void Bg({showWebAssemblyDialog:!0});const e=Object(n.detectOS)(navigator.userAgent);if("iOS"===e&&!navigator.mediaDevices)return void Bg({showSafariDialog:!0});const t=Object(n.detect)();if(["iOS","Mac OS"].includes(e)&&["safari","ios"].includes(t.name))try{yield navigator.mediaDevices.getUserMedia({audio:!0})}catch(e){return void Bg({showSafariMicDialog:!0})}const i=kg.get("hub_id")||document.location.pathname.substring(1).split("/")[0];console.log(`Hub ID: ${i}`);const a=new Hl(i);if(navigator.serviceWorker)try{navigator.serviceWorker.register("/hub.service.js").then(()=>{navigator.serviceWorker.ready.then(e=>a.setRegistration(e)).catch(()=>a.setRegistrationFailed())}).catch(()=>a.setRegistrationFailed())}catch(e){a.setRegistrationFailed()}else a.setRegistrationFailed();const c=document.querySelector("a-scene");for(c.setAttribute("shadow",{enabled:"low"!==window.APP.quality});!c.systems.physics.initialized;)yield Object(o.a)();const h=()=>{const e=c.systems.physics;e.setDebug(Ng||e.data.debug),function(){const e=AFRAME.scenes[0].renderer,t=e.context;e.state.texImage2D=function(e,i,a,n,s,o,r,c,l){try{void 0===r?t.texImage2D(e,i,a,n,s,o):t.texImage2D(e,i,a,n,s,o,r,c,l)}catch(e){console.error("THREE.WebGLState:",e)}},e.state.compressedTexImage2D=function(e,i,a,n,s,o,r,c,l,d){try{void 0===c?t.compressedTexImage2D(e,i,a,n,s,o,r):void 0===l?t.compressedTexImage2D(e,i,a,n,s,o,r,c):void 0===d?t.compressedTexImage2D(e,i,a,n,s,o,r,c,l):t.compressedTexImage2D(e,i,a,n,s,o,r,c,l,d)}catch(e){console.error("THREE.WebGLState:",e)}}}()};c.hasLoaded?h():c.addEventListener("loaded",h,{once:!0}),(yield Object(f.c)(xg.state.profile.avatarId))||xg.resetToRandomLegacyAvatar();const u=new Xc.a(xg),p=new cl(xg,i),m=yield ui(),g=new Rl(p,u,m,Lg),v=function(){var e=Eg(function*(e,t,i,a){if(e())return t();const n=c.is("vr-mode")?"entry.return-to-vr":"dialog.close";var s;kc(!0,()=>Bg({showSignInDialog:!1})),Bg({showSignInDialog:!0,signInMessageId:`sign-in.${i}`,signInCompleteMessageId:`sign-in.${i}-complete`,signInContinueTextId:n,onContinueAfterSignIn:(s=Eg(function*(){Bg({showSignInDialog:!1});let i=null;if(e())try{yield t()}catch(e){i=e}else i=new Error("Predicate failed post sign-in");i&&a&&a(i),Cc()}),function(){return s.apply(this,arguments)})})});return function(t,i,a,n){return e.apply(this,arguments)}}();window.addEventListener("action_create_avatar",()=>{v(()=>p.signedIn,()=>Object(kt.e)(Lg,"overlay","avatar-editor"),"create-avatar")}),c.addEventListener("scene_media_selected",e=>{const t=e.detail;v(()=>p.can("update_hub"),()=>p.updateScene(t),"change-scene")}),c.addEventListener("action_media_tweet",e=>{let t=!1,i=!1;const a=()=>{i=!1,xg.clearOnLoadActions(),Bg({showOAuthDialog:!1,oauthInfo:null})};kc(!0,()=>{t&&Lg.goBack(),i&&a()}),v(()=>p.signedIn,Eg(function*(){const n={};if(Object.assign(n,e.detail),delete n.el,p.can("tweet"))t=!0,Object(kt.e)(Lg,"modal","tweet",n);else{e.detail.el&&e.detail.el.setAttribute("pinnable","pinned",!0);const t=yield p.getTwitterOAuthURL();i=!0,xg.enqueueOnLoadAction("emit_scene_event",{event:"action_media_tweet",detail:n}),Bg({showOAuthDialog:!0,oauthInfo:[{type:"twitter",url:t}],onCloseOAuthDialog:()=>a()})}}),"tweet")}),Bg({performConditionalSignIn:v,embed:Rg,showPreload:Rg}),g.performConditionalSignIn=v,g.init();const b=new ll.a(xg);window.APP.scene=c,window.APP.hubChannel=p,window.dispatchEvent(new CustomEvent("hub_channel_ready"));const y=()=>!(!c.is("vr-mode")||c.is("vr-entered"))&&(console.log("Pre-emptively exiting VR mode."),c.exitVR(),!0);c.addEventListener("enter-vr",()=>{if(y())return!0;Tg&&Bg({hide:!0}),document.body.classList.add("vr-mode"),(Cg||Tg)&&m.cardboard===di.yes||document.body.classList.add("vr-mode-stretch")}),y(),window.addEventListener("vrdisplaypresentchange",()=>{if(c.is("vr-entered"))return;if(c.is("vr-mode"))return;const e=AFRAME.utils.device.getVRDisplay();e&&e.isPresenting&&(c.is("vr-mode")||(console.warn("Hit A-Frame bug where VR display is presenting but A-Frame has not entered VR mode."),c.enterVR()))},{once:!0}),c.addEventListener("exit-vr",()=>{document.body.classList.remove("vr-mode"),document.body.classList.remove("vr-mode-stretch"),Bg({hide:!1}),/OculusBrowser\/5/i.test(window.navigator.userAgent)&&document.querySelectorAll("[media-video]").forEach(e=>{const t=e.components["media-video"].video;t&&!t.paused&&setTimeout(()=>t.play(),1e3)})}),bg(),Bg({authChannel:u,hubChannel:p,linkChannel:b,subscriptions:a,enterScene:g.enterScene,exitScene:e=>{g.exitScene(),e&&Bg({roomUnavailableReason:e})},initialIsSubscribed:a.isSubscribed(),activeTips:c.systems.tips.activeTips}),c.addEventListener("action_focus_chat",()=>{const e=document.querySelector(".chat-focus-target");e&&e.focus()}),c.addEventListener("tips_changed",e=>{Bg({activeTips:e.detail})}),c.addEventListener("leave_room_requested",()=>{c.exitVR(),g.exitScene("left"),Bg({roomUnavailableReason:"left"})}),c.addEventListener("camera_toggled",()=>Bg({})),c.addEventListener("camera_removed",()=>Bg({})),c.addEventListener("hub_closed",()=>{c.exitVR(),g.exitScene("closed"),Bg({roomUnavailableReason:"closed"})}),c.addEventListener("action_camera_recording_started",()=>p.beginRecording()),c.addEventListener("action_camera_recording_ended",()=>p.endRecording());const _="undefined"==typeof RTCDataChannelEvent?"no_data_channels":null;if(_)return Bg({platformUnsupportedReason:_}),void g.exitScene();if(kg.get("required_version")&&{NODE_ENV:"production",DEFAULT_SCENE_SID:"JGLt8DP",RETICULUM_SERVER:"dev.reticulum.io",FARSPARK_SERVER:"farspark-dev.reticulum.io",NON_CORS_PROXY_DOMAINS:"hubs.local,dev.reticulum.io",ASSET_BUNDLE_SERVER:"https://asset-bundles-prod.reticulum.io",EXTRA_ENVIRONMENTS:"",POSTGREST_SERVER:"hubs.local:3000"}.BUILD_VERSION){const e={NODE_ENV:"production",DEFAULT_SCENE_SID:"JGLt8DP",RETICULUM_SERVER:"dev.reticulum.io",FARSPARK_SERVER:"farspark-dev.reticulum.io",NON_CORS_PROXY_DOMAINS:"hubs.local,dev.reticulum.io",ASSET_BUNDLE_SERVER:"https://asset-bundles-prod.reticulum.io",EXTRA_ENVIRONMENTS:"",POSTGREST_SERVER:"hubs.local:3000"}.BUILD_VERSION.split(" ",1)[0];if(kg.get("required_version")!==e)return Bg({roomUnavailableReason:"version_mismatch"}),setTimeout(()=>document.location.reload(),5e3),void g.exitScene()}if(Object(s.i)().then(e=>{if(console.log(`Reticulum @ ${e.phx_host}: v${e.version} on ${e.pool}`),kg.get("required_ret_version")&&(kg.get("required_ret_version")!==e.version||kg.get("required_ret_pool")!==e.pool))return Bg({roomUnavailableReason:"version_mismatch"}),setTimeout(()=>document.location.reload(),5e3),void g.exitScene()}),Tg){if(Bg({availableVREntryTypes:m,forcedVREntryType:"vr"}),/Oculus/.test(navigator.userAgent)){const e=yield navigator.getVRDisplays(),t=e.length&&e[0];AFRAME.utils.device.getVRDisplay=()=>t}}else{const e=m.cardboard!==di.no||m.generic!==di.no||m.daydream!==di.no;Bg({availableVREntryTypes:m,forcedVREntryType:Fg||(e?null:"2d")})}const E=document.querySelector("#environment-scene"),w=()=>{c.is("entered")||function(){const e=document.querySelector("#player-camera"),t=document.querySelector("#environment-scene").object3D.getObjectByName("scene-preview-camera");if(t)e.object3D.position.copy(t.position),e.object3D.rotation.copy(t.rotation),e.object3D.rotation.reorder("YXZ");else{const t=e.object3D.position;e.object3D.position.set(t.x,2.5,t.z)}e.object3D.matrixNeedsUpdate=!0,e.setAttribute("scene-preview-camera","positionOnly: true; duration: 60"),e.components["pitch-yaw-rotator"].set(e.object3D.rotation.x,e.object3D.rotation.y)}(),Pg&&function(e,t){Gg.apply(this,arguments)}(c,g),E.removeEventListener("model-loaded",w)};E.addEventListener("model-loaded",w),E.addEventListener("model-loaded",()=>{Bg({environmentSceneLoaded:!0}),c.emit("environment-scene-loaded"),document.querySelectorAll("a-entity[teleporter]").forEach(e=>e.components.teleporter.queryCollisionEntities());for(const e of E.children)Object(r.a)(e)});const S=yield Object(s.a)(Ng);let x;S.onClose(e=>{1e3===e.code&&(g.exitScene(),Bg({roomUnavailableReason:"disconnected"}))});let A=S.channel("ret",{hub_id:i});A.join().receive("ok",function(){var e=Eg(function*(e){return a.setVapidPublicKey(e.vapid_public_key)});return function(t){return e.apply(this,arguments)}}()).receive("error",e=>{a.setVapidPublicKey(null),console.error(e)});const k=yield a.getCurrentEndpoint(),C=l.a.get("ret-oauth-flow-perms-token");C&&l.a.remove("ret-oauth-flow-perms-token");const T=e=>{const t={profile:xg.state.profile,push_subscription_endpoint:k,auth_token:null,perms_token:null,context:{mobile:Cg||Tg,hmd:m.isInHMD,embed:Rg}};e&&(t.perms_token=e);const{token:i}=xg.state.credentials;return i&&(console.log(`Logged into account ${xg.credentialsAccountId}`),t.auth_token=i),t},R=function(){var e=Eg(function*(e){console.log(`Reticulum deploy detected v${e.ret_version} on ${e.ret_pool}`),clearInterval(x),setTimeout(()=>{const t=function(){var t=Eg(function*(){Object(s.j)();const t=yield Object(s.i)();if(t.pool===e.ret_pool&&t.version===e.ret_version){console.log("Reticulum reconnecting."),clearInterval(x);const e=A.socket,t=yield Object(s.a)(Ng,e.params());A=yield Object(s.k)(A,t),yield p.migrateToSocket(t,T()),u.setSocket(t),b.setSocket(t),setTimeout(()=>{console.log("Reconnection complete. Disconnecting old reticulum socket."),e.teardown()},1e4)}});return function(){return t.apply(this,arguments)}}();x=setInterval(t,5e3),t()},Math.floor(15e3*Math.random()))});return function(t){return e.apply(this,arguments)}}();A.on("notice",function(){var e=Eg(function*(e){"ret-deploy"===e.event&&(yield R(e))});return function(t){return e.apply(this,arguments)}}());const M=S.channel(`hub:${i}`,T(C)),D=[],P=e=>{e.key=Date.now().toString(),D.push(e),Bg({presenceLogEntries:D}),"chat"===e.type&&c.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(d.c),setTimeout(()=>{e.expired=!0,Bg({presenceLogEntries:D}),setTimeout(()=>{D.splice(D.indexOf(e),1),Bg({presenceLogEntries:D})},5e3)},2e4)},O=new _l(c,g,p,P,Bg,Ag);let N=!0;p.setPhoenixChannel(M),M.join().receive("ok",function(){var e=Eg(function*(e){S.params().session_id=e.session_id,S.params().session_token=e.session_token;const t=document.querySelector("#hud-presence-count");N&&(xg.addEventListener("profilechanged",p.sendProfileUpdate.bind(p)),p.presence.onSync(()=>{const e=p.presence;Bg({sessionId:S.params().session_id,presences:e.state});const i=Object.entries(e.state).length;t.setAttribute("text","value",i.toString()),i>1?c.addState("copresent"):c.removeState("copresent"),e.__hadInitialSync=!0,e.onJoin((e,t,i)=>{if(!p.presence.__hadInitialSync)return;const a=i.metas[i.metas.length-1];if(Object.entries(p.presence.state).length<=12)if(t){const i=e===S.params().session_id,n=t.metas[0];!i&&n.presence!==a.presence&&"room"===a.presence&&a.profile.displayName&&P({type:"entered",presence:a.presence,name:a.profile.displayName}),n.profile&&a.profile&&n.profile.displayName!==a.profile.displayName&&P({type:"display_name_changed",oldName:n.profile.displayName,newName:a.profile.displayName})}else if(1===i.metas.length){const e=i.metas[0];e.presence&&e.profile.displayName&&P({type:"join",presence:e.presence,name:e.profile.displayName})}c.emit("presence_updated",{sessionId:e,profile:a.profile,roles:a.roles,streaming:a.streaming,recording:a.recording})}),e.onLeave((e,t,i)=>{if(!p.presence.__hadInitialSync)return;if(t&&t.metas.length>0)return;if(Object.entries(p.presence.state).length>12)return;const a=i.metas[0];a.profile.displayName&&P({type:"leave",name:a.profile.displayName})})})),N=!1;const i=C||e.perms_token;p.setPermissionsFromToken(i),c.addEventListener("adapter-ready",({detail:t})=>{t.setClientId(S.params().session_id),t.setJoinToken(e.perms_token),p.addEventListener("permissions-refreshed",e=>t.setJoinToken(e.detail.permsToken))}),a.setHubChannel(p),a.setSubscribed(e.subscriptions.web_push),Bg({hubIsBound:e.hub_requires_oauth,initialIsFavorited:e.subscriptions.favorites,initialIsSubscribed:a.isSubscribed()}),yield function(e,t,i,a){return qg.apply(this,arguments)}(g,p,O,e)});return function(t){return e.apply(this,arguments)}}()).receive("error",e=>{"closed"===e.reason?(g.exitScene(),Bg({roomUnavailableReason:"closed"})):"oauth_required"===e.reason?(g.exitScene(),Bg({oauthInfo:e.oauth_info,showOAuthDialog:!0})):"join_denied"===e.reason&&(g.exitScene(),Bg({roomUnavailableReason:"denied"})),console.error(e)}),M.on("naf",e=>{NAF.connection.adapter&&NAF.connection.adapter.onData(e,"phx-reliable")}),M.on("message",({session_id:e,type:t,body:i,from:a})=>{const n={name:(()=>{const t=p.presence.state[e];return a||(t?t.metas[0].profile.displayName:"Mystery user")})(),type:t,body:i,maySpawn:c.is("entered"),sessionId:e};c.is("vr-mode")&&function(e){Go.apply(this,arguments)}(n),P(n)}),M.on("hub_refresh",({session_id:e,hubs:t,stale_fields:i})=>{const a=t[0],n=p.presence.state[e];if(Vg(a),i.includes("scene")&&(zg(a),P({type:"scene_changed",name:n.metas[0].profile.displayName,sceneName:a.scene?a.scene.name:"a custom URL"})),i.includes("member_permissions")&&p.fetchPermissions(),i.includes("name")){const e=document.title.split(" | ");e[0]=a.name,document.title=e.join(" | ");const t=Lg.location.pathname.split("/")[1],{search:i,state:s}=Lg.location,o=Lg.location.pathname.replace(`/${t}`,`/${a.slug}`);Lg.replace({pathname:o,search:i,state:s}),P({type:"hub_name_changed",name:n.metas[0].profile.displayName,hubName:a.name})}"deny"===a.entry_mode&&c.emit("hub_closed")}),M.on("permissions_updated",()=>p.fetchPermissions()),M.on("mute",({session_id:e})=>{e!==NAF.clientId||c.is("muted")||c.emit("action_mute")}),u.setSocket(S),b.setSocket(S)}))},22:function(e,t,i){"use strict";i.d(t,"b",function(){return r}),i.d(t,"a",function(){return c}),i.d(t,"c",function(){return l});var a=i(74),n=i.n(a);function s(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}n.a.configure({endpointUrl:"https://api.airtable.com",apiKey:"keyOHSVeLr3ryLrL5"});const o=n.a.base("appIR0AlHDFG5WR8z"),r={DarkLogo:null,Name:null,Icon:null},c=o("Assets"),l=o("Messages").select({view:"Grid view"}).firstPage(function(){var e,t=(e=function*(e,t){if(!e)return t[0];console.error(e)},function(){var t=this,i=arguments;return new Promise(function(a,n){var o=e.apply(t,i);function r(e){s(o,a,n,r,c,"next",e)}function c(e){s(o,a,n,r,c,"throw",e)}r(void 0)})});return function(e,i){return t.apply(this,arguments)}}())},228:function(e,t,i){e.exports=i.p+"assets/images/warning_icon-739d2a2ea906737505bcbc2cb51123a8.png"},229:function(e,t,i){e.exports=i.p+"assets/images/warning_icon@2x-706e4a4db33f9456bac320e956b4120d.png"},23:function(e,t,i){"use strict";i.d(t,"f",function(){return N}),i.d(t,"t",function(){return H}),i.d(t,"k",function(){return I}),i.d(t,"l",function(){return j}),i.d(t,"i",function(){return L}),i.d(t,"u",function(){return F}),i.d(t,"s",function(){return B}),i.d(t,"r",function(){return V}),i.d(t,"o",function(){return U}),i.d(t,"p",function(){return z}),i.d(t,"j",function(){return W}),i.d(t,"b",function(){return q}),i.d(t,"d",function(){return G}),i.d(t,"n",function(){return Y}),i.d(t,"q",function(){return $}),i.d(t,"c",function(){return X}),i.d(t,"e",function(){return Q}),i.d(t,"m",function(){return K}),i.d(t,"h",function(){return J}),i.d(t,"g",function(){return Z}),i.d(t,"a",function(){return ee}),i.d(t,"v",function(){return te});var a=i(125),n=i.n(a),s=i(518),o=i.n(s),r=i(519),c=i.n(r),l=i(520),d=i.n(l),h=i(521),u=i.n(h),p=i(522),m=i.n(p),g=i(523),v=i.n(g),f=i(524),b=i.n(f),y=i(525),_=i.n(y),E=i(526),w=i.n(E),S=i(527),x=i.n(S),A=i(528),k=i.n(A),C=i(529),T=i.n(C),R=i(530),M=i.n(R),D=i(531),P=i.n(D);let O=0;const N=O++,H=O++,I=O++,j=O++,L=O++,F=O++,B=O++,V=O++,U=O++,z=O++,W=O++,q=O++,G=O++,Y=O++,$=O++,X=O++,Q=O++,K=O++,J=O++,Z=O++,ee=O++;class te{constructor(){this.pendingEffects=[],this.audioContext=THREE.AudioContext.getContext();const e=[[N,n.a],[H,n.a],[I,n.a],[j,n.a],[L,n.a],[F,n.a],[ee,n.a],[B,o.a],[V,c.a],[U,d.a],[z,u.a],[W,m.a],[q,v.a],[G,b.a],[Y,_.a],[$,w.a],[X,x.a],[Q,k.a],[K,T.a],[J,P.a],[Z,M.a]],t=new Map,i=e=>{let i=t.get(e);return i||(i=fetch(e).then(e=>e.arrayBuffer()).then(e=>(function(e,t){return new Promise((i,a)=>{e.decodeAudioData(t,i,a)})})(this.audioContext,e)),t.set(e,i)),i};this.sounds=new Map,e.map(([e,t])=>{i(t).then(t=>{this.sounds.set(e,t)})})}enqueueSound(e,t){const i=this.sounds.get(e);if(!i)return null;const a=this.audioContext.createBufferSource();return a.buffer=i,a.connect(this.audioContext.destination),a.loop=t,this.pendingEffects.push(a),a}playSoundOneShot(e){return this.enqueueSound(e,!1)}playSoundLooped(e){return this.enqueueSound(e,!0)}playSoundLoopedWithGain(e){const t=this.sounds.get(e);if(!t)return null;const i=this.audioContext.createBufferSource(),a=this.audioContext.createGain();return i.buffer=t,i.connect(a),a.connect(this.audioContext.destination),i.loop=!0,this.pendingEffects.push(i),{gain:a,source:i}}stopSoundNode(e){const t=this.pendingEffects.indexOf(e);-1!==t?this.pendingEffects.splice(t,1):e.stop()}tick(){for(let e=0;e<this.pendingEffects.length;e++)this.pendingEffects[e].start();this.pendingEffects.length=0}}},230:function(e,t,i){"use strict";var a=i(228),n=i.n(a),s=i(229),o=i.n(s),r=i(0),c=i.n(r),l=i(1),d=i.n(l),h=i(4),u=i(3),p=i.n(u),m=(i(853),i(201)),g=i(164),v=i(40),f=i(87),b=i(2400),y=i.n(b);function _(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}function E(e){return function(){var t=this,i=arguments;return new Promise(function(a,n){var s=e.apply(t,i);function o(e){_(s,a,n,o,r,"next",e)}function r(e){_(s,a,n,o,r,"throw",e)}o(void 0)})}}function w(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const S={base_map:["map"],emissive_map:["emissiveMap"],normal_map:["normalMap"],orm_map:["aoMap","roughnessMap","metalnessMap"]},x=Object.keys(S);function A(e,t=!1,i=!0){const a=e.getContext("webgl2",{alpha:t,depth:!0,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"}),n=new THREE.WebGLRenderer({alpha:t,canvas:e,context:a});return n.gammaOutput=!0,n.gammaFactor=2.2,n.physicallyCorrectLights=!0,i&&n.setPixelRatio(window.devicePixelRatio),n}const k=e=>fetch(e).then(e=>e.blob()).then(f.a),C=new THREE.Euler(-30*THREE.Math.DEG2RAD,30*THREE.Math.DEG2RAD,0),T=1;function R(e,t,i,a=T){const n=Math.max(t.max.y-i.y,i.y-t.min.y),s=THREE.Math.degToRad(e.fov/2);e.position.set(0,0,(n/Math.tan(s)+t.max.z)*a),e.position.applyEuler(C),e.position.add(i),e.lookAt(i)}class M extends r.Component{constructor(e){var t;super(e),t=this,w(this,"componentDidMount",()=>{this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(55,this.canvas.clientWidth/this.canvas.clientHeight,.1,1e3),this.controls=new THREE.OrbitControls(this.camera,this.canvas),this.controls.enablePan=!1;const e=new THREE.DirectionalLight(16250607,1);e.position.set(0,10,10),this.scene.add(e),this.scene.add(new THREE.HemisphereLight(11658239,11658239,2.5)),this.camera.position.set(-.2,.5,.5),this.camera.matrixAutoUpdate=!0,this.controls.target.set(0,.45,0),this.controls.update(),this.props.avatarGltfUrl&&this.loadPreviewAvatar(this.props.avatarGltfUrl).then(this.setAvatar);const t=new THREE.Clock;this.snapshotCanvas=document.createElement("canvas"),this.snapshotCanvas.width=720,this.snapshotCanvas.height=1280,this.snapshotCamera=new THREE.PerspectiveCamera(55,.5625,.1,1e3),this.snapshotCamera.matrixAutoUpdate=!0,this.snapshotRenderer=A(this.snapshotCanvas,!0,!1),this.snapshotRenderer.setClearAlpha(0),this.previewRenderer=A(this.canvas),this.previewRenderer.setClearColor(15395562),this.previewRenderer.setAnimationLoop(()=>{const e=t.getDelta();this.mixer&&this.mixer.update(e),this.previewRenderer.render(this.scene,this.camera)}),window.addEventListener("resize",this.resize),this.resize()}),w(this,"resize",()=>{const e=this.canvas.parentElement.offsetWidth,t=this.canvas.parentElement.offsetHeight;this.previewRenderer.setSize(e,t),this.camera.aspect=e/t,this.camera.updateProjectionMatrix()}),w(this,"setAvatar",e=>{e&&(this.avatar=e,this.scene.add(e),this.resetCamera(),this.setState({error:null,loading:!1}))}),w(this,"resetCamera",(()=>{const e=new THREE.Box3,t=new THREE.Vector3;return()=>{e.setFromObject(this.avatar),e.getCenter(t),t.y=.6*(e.max.y-e.min.y)+e.min.y,R(this.camera,e,t),R(this.snapshotCamera,e,t,.7),this.controls.target.copy(t),this.controls.update()}})()),w(this,"componentWillUnmount",()=>{this.scene&&this.scene.traverse(v.a),this.previewRenderer&&(this.previewRenderer.dispose(),this.previewRenderer.context=null),this.snapshotRenderer&&(this.snapshotRenderer.dispose(),this.snapshotRenderer.context=null),this.controls&&(this.controls.dispose(),this.controls.domElement=null),Object.values(this.imageBitmaps).forEach(e=>Object(f.b)(e)),window.removeEventListener("resize",this.resize)}),w(this,"componentDidUpdate",function(){var e=E(function*(e){e.avatarGltfUrl!==t.props.avatarGltfUrl&&(t.avatar&&(t.scene.remove(t.avatar),t.avatar=null),t.props.avatarGltfUrl&&(t.setState({error:null,loading:!0}),yield t.loadPreviewAvatar(t.props.avatarGltfUrl).then(t.setAvatar))),t.applyMaps(e,t.props)});return function(t){return e.apply(this,arguments)}}()),w(this,"loadPreviewAvatar",function(){var e=E(function*(e){let i;try{i=yield Object(g.a)(e,"model/gltf")}catch(e){return void t.setState({loading:!1,error:!0})}t.previewMesh=i.scene.getObjectByName("AvatarMesh")||i.scene.getObjectByName("Avatar")||i.scene.getObjectByName("Bot_Skinned")||i.scene;const a=i.animations&&i.animations.find(({name:e})=>"idle_eyes"===e);if(a){t.mixer=new THREE.AnimationMixer(t.previewMesh);const e=t.mixer.clipAction(a);e.enabled=!0,e.setLoop(THREE.LoopRepeat,1/0).play(),t.idleAnimationAction=e}const{material:n}=t.previewMesh;if(n){const e=e=>delete n[e].onUpdate&&n[e].image;t.originalMaps={base_map:S.base_map.map(e),emissive_map:S.emissive_map.map(e),normal_map:S.normal_map.map(e),orm_map:S.orm_map.map(e)},yield Promise.all([t.applyMaps({},t.props),Object(m.a)().then(e=>{t.previewMesh.material.envMap=e,t.previewMesh.material.needsUpdate=!0})])}else t.originalMaps={};return i.scene});return function(t){return e.apply(this,arguments)}}()),w(this,"applyMapToPreview",(e,t)=>{this.imageBitmaps[e]&&Object(f.b)(this.imageBitmaps[e]),this.imageBitmaps[e]=t,S[e].forEach(e=>{const i=this.previewMesh.material[e];i.image=t,i.needsUpdate=!0})}),w(this,"revertMap",e=>{this.imageBitmaps[e]&&Object(f.b)(this.imageBitmaps[e]),delete this.imageBitmaps[e],this.originalMaps[e].forEach((t,i)=>{const a=this.previewMesh.material[S[e][i]];a.image=t,a.needsUpdate=!0})}),w(this,"snapshot",()=>new Promise(e=>{this.idleAnimationAction&&this.idleAnimationAction.stop(),this.snapshotRenderer.render(this.scene,this.snapshotCamera),this.snapshotCanvas.toBlob(t=>{this.idleAnimationAction&&this.idleAnimationAction.play(),e(t)})})),this.state={loading:!0,error:null},this.avatar=null,this.imageBitmaps={}}applyMaps(e,t){return Promise.all(x.map(i=>{const a=this.applyMapToPreview.bind(this,i);if(e[i]!=t[i])return t[i]instanceof File?Object(f.a)(t[i]).then(a):t[i]?k(t[i]).then(a):this.revertMap(i)}))}render(){return c.a.createElement("div",{className:p()(y.a.preview,this.props.className)},this.state.loading&&!this.state.error&&c.a.createElement("div",{className:"loader"},c.a.createElement("div",{className:"loader-center"})),this.state.error&&!this.state.loading&&c.a.createElement("div",{className:"error"},c.a.createElement("img",{src:n.a,srcSet:o.a+" 2x",className:"error-icon"}),c.a.createElement(h.a,{id:"avatar-preview.loading-failed"})),c.a.createElement("canvas",{ref:e=>this.canvas=e}))}}w(M,"propTypes",{avatarGltfUrl:d.a.string,className:d.a.string}),t.a=Object(h.d)(M,{withRef:!0})},235:function(e,t,i){"use strict";i.d(t,"a",function(){return m});var a=i(0),n=i.n(a),s=i(1),o=i.n(s),r=i(4),c=i(2374),l=i.n(c),d=i(21),h=i(56);function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}function p(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class m extends a.Component{constructor(...e){super(...e),p(this,"state",{email:""}),p(this,"onSubmit",e=>{e.preventDefault(),e.stopPropagation(),this.props.onSignIn(this.state.email)})}render(){let e;return e=this.props.authStarted?n.a.createElement("p",null,n.a.createElement(r.a,{className:"preformatted",id:"sign-in.auth-started"})):this.props.authComplete?n.a.createElement("div",{className:l.a.signInComplete},n.a.createElement("p",null,this.props.message),n.a.createElement("button",{onClick:this.props.onContinue,className:l.a.continueButton},this.props.continueText)):n.a.createElement("form",{onSubmit:this.onSubmit,className:l.a.signInForm},n.a.createElement("span",null,this.props.message),n.a.createElement("input",{name:"email",type:"email",required:!0,placeholder:"Your email address",value:this.state.email,onFocus:e=>Object(h.b)(e.target),onBlur:()=>Object(h.a)(),onChange:e=>this.setState({email:e.target.value}),className:l.a.emailField}),n.a.createElement("p",{className:l.a.terms},"By proceeding, you agree to the"," ",n.a.createElement("a",{rel:"noopener noreferrer",target:"_blank",href:"https://github.com/mozilla/hubs/blob/master/TERMS.md"},"terms of use")," ","and"," ",n.a.createElement("a",{rel:"noopener noreferrer",target:"_blank",href:"https://github.com/mozilla/hubs/blob/master/PRIVACY.md"},"privacy notice"),"."),n.a.createElement("button",{type:"submit",className:l.a.nextButton},"next")),n.a.createElement(d.a,u({title:"Sign In"},this.props),e)}}p(m,"propTypes",{authStarted:o.a.bool,authComplete:o.a.bool,onSignIn:o.a.func,onContinue:o.a.func,message:o.a.string,continueText:o.a.string})},237:function(e,t){},2372:function(e,t){e.exports={"media-browser":"media-browser__media-browser__y0Hsu",mediaBrowser:"media-browser__media-browser__y0Hsu",facets:"media-browser__facets__1Yz65",facet:"media-browser__facet__2uP6U",body:"media-browser__body__j6Tv2",pager:"media-browser__pager__RKx5O","header-center":"media-browser__header-center__2D9CW",headerCenter:"media-browser__header-center__2D9CW",search:"media-browser__search__3gQ84","engine-attribution":"media-browser__engine-attribution__2P2aD",engineAttribution:"media-browser__engine-attribution__2P2aD","engine-attribution-contents":"media-browser__engine-attribution-contents__gCdfr",engineAttributionContents:"media-browser__engine-attribution-contents__gCdfr","favorites-header":"media-browser__favorites-header__1XzZx",favoritesHeader:"media-browser__favorites-header__1XzZx",box:"media-browser__box__1KHYi",header:"media-browser__header__zqZ09","no-search":"media-browser__no-search__3N90H",noSearch:"media-browser__no-search__3N90H",nav:"media-browser__nav__9J5If","nav-right-pad":"media-browser__nav-right-pad__1qH0B",navRightPad:"media-browser__nav-right-pad__1qH0B","nav-source":"media-browser__nav-source__o6NI6",navSource:"media-browser__nav-source__o6NI6","nav-source-selected":"media-browser__nav-source-selected__2osjH",navSourceSelected:"media-browser__nav-source-selected__2osjH","nav-scroll-arrow":"media-browser__nav-scroll-arrow__2Nikk",navScrollArrow:"media-browser__nav-scroll-arrow__2Nikk",tiles:"media-browser__tiles__1BYEY",tile:"media-browser__tile__2lzHU",info:"media-browser__info__2c8Zs",name:"media-browser__name__RFiE4",attribution:"media-browser__attribution__3glgj",creator:"media-browser__creator__3LDPh",publisher:"media-browser__publisher__mTzsX","last-joined":"media-browser__last-joined__2DVWf",lastJoined:"media-browser__last-joined__2DVWf","tile-link":"media-browser__tile-link__IXyUO",tileLink:"media-browser__tile-link__IXyUO","tile-content":"media-browser__tile-content__1QYSP",tileContent:"media-browser__tile-content__1QYSP","avatar-tile":"media-browser__avatar-tile__qNo2r",avatarTile:"media-browser__avatar-tile__qNo2r","edit-avatar":"media-browser__edit-avatar__2HBfV",editAvatar:"media-browser__edit-avatar__2HBfV","create-tile":"media-browser__create-tile__RL9vr",createTile:"media-browser__create-tile__RL9vr","tiles-variable":"media-browser__tiles-variable__1ZNxg",tilesVariable:"media-browser__tiles-variable__1ZNxg","page-number":"media-browser__page-number__OTpSH",pageNumber:"media-browser__page-number__OTpSH","pager-button-disabled":"media-browser__pager-button-disabled__ytlSN",pagerButtonDisabled:"media-browser__pager-button-disabled__ytlSN","header-left":"media-browser__header-left__1ObQh",headerLeft:"media-browser__header-left__1ObQh","header-right":"media-browser__header-right__3k3JZ",headerRight:"media-browser__header-right__3k3JZ","create-button":"media-browser__create-button__30hMV",createButton:"media-browser__create-button__30hMV","create-link":"media-browser__create-link__28Bpj",createLink:"media-browser__create-link__28Bpj","empty-string":"media-browser__empty-string__3r0tc",emptyString:"media-browser__empty-string__3r0tc","media-browser-inline":"media-browser__media-browser-inline__3AgWD",mediaBrowserInline:"media-browser__media-browser-inline__3AgWD"}},2374:function(e,t){e.exports={"email-field":"sign-in-dialog__email-field__g3xRW",emailField:"sign-in-dialog__email-field__g3xRW","next-button":"sign-in-dialog__next-button__2pGtq",nextButton:"sign-in-dialog__next-button__2pGtq","continue-button":"sign-in-dialog__continue-button__kFN6Z",continueButton:"sign-in-dialog__continue-button__kFN6Z","sign-in-form":"sign-in-dialog__sign-in-form__3Muog",signInForm:"sign-in-dialog__sign-in-form__3Muog","sign-in-complete":"sign-in-dialog__sign-in-complete__3JMkv",signInComplete:"sign-in-dialog__sign-in-complete__3JMkv",terms:"sign-in-dialog__terms__3TT6i"}},2376:function(e,t){e.exports={ui:"hub__ui__3UYRO","ui-dialog":"hub__ui-dialog__vlyfc",uiDialog:"hub__ui-dialog__vlyfc","ui-interactive":"hub__ui-interactive__3bdyc",uiInteractive:"hub__ui-interactive__3bdyc","presence-info":"hub__presence-info__dqWyo",presenceInfo:"hub__presence-info__dqWyo","corner-button":"hub__corner-button__2KphD",cornerButton:"hub__corner-button__2KphD","profile-entry":"hub__profile-entry__1RY0R",profileEntry:"hub__profile-entry__1RY0R","form-submit":"hub__form-submit__12yem",formSubmit:"hub__form-submit__12yem","nag-corner-button":"hub__nag-corner-button__lNoyE",nagCornerButton:"hub__nag-corner-button__lNoyE","choose-scene-button":"hub__choose-scene-button__5Y0Q_",chooseSceneButton:"hub__choose-scene-button__5Y0Q_","choose-avatar":"hub__choose-avatar__22JJm",chooseAvatar:"hub__choose-avatar__22JJm","entry-button-secondary":"hub__entry-button-secondary__2ui-g",entryButtonSecondary:"hub__entry-button-secondary__2ui-g","entry-panel":"hub__entry-panel__cCmIv",entryPanel:"hub__entry-panel__cCmIv","button-container":"hub__button-container__38FOc",buttonContainer:"hub__button-container__38FOc","secondary-action-button":"hub__secondary-action-button__2KoCD",secondaryActionButton:"hub__secondary-action-button__2KoCD","leave-button":"hub__leave-button__1YK4o",leaveButton:"hub__leave-button__1YK4o",interstitial:"hub__interstitial__3WXbJ","entry-button":"hub__entry-button__1e9jM",entryButton:"hub__entry-button__1e9jM","action-button":"hub__action-button__3zqlu",actionButton:"hub__action-button__3zqlu","collapse-button":"hub__collapse-button__3N-6b",collapseButton:"hub__collapse-button__3N-6b","favorite-button":"hub__favorite-button__1Qgbp",favoriteButton:"hub__favorite-button__1Qgbp",back:"hub__back__3AZh2","form-field-text":"hub__form-field-text__tR1Lt",formFieldText:"hub__form-field-text__tR1Lt","lobby-label":"hub__lobby-label__2ktmo",lobbyLabel:"hub__lobby-label__2ktmo",label:"hub__label__1kjp1",title:"hub__title__ezGEu",name:"hub__name__2umw1","rename-button":"hub__rename-button__h-4K7",renameButton:"hub__rename-button__h-4K7",center:"hub__center__1Mvfu","wide-button":"hub__wide-button__1yqDc",wideButton:"hub__wide-button__1yqDc","screen-sharing":"hub__screen-sharing__2VF91",screenSharing:"hub__screen-sharing__2VF91",checkbox:"hub__checkbox__32dyv","invite-tip":"hub__invite-tip__9enoe",inviteTip:"hub__invite-tip__9enoe","loading-text":"hub__loading-text__1WDud",loadingText:"hub__loading-text__1WDud","streaming-tip":"hub__streaming-tip__1LnId",streamingTip:"hub__streaming-tip__1LnId","streaming-tip-attach-point":"hub__streaming-tip-attach-point__1oCgh",streamingTipAttachPoint:"hub__streaming-tip-attach-point__1oCgh","streaming-tip-close":"hub__streaming-tip-close__E6fwS",streamingTipClose:"hub__streaming-tip-close__E6fwS","streaming-tip-message":"hub__streaming-tip-message__XcScW",streamingTipMessage:"hub__streaming-tip-message__XcScW","ui-dialog-box-contents":"hub__ui-dialog-box-contents__PZ5qP",uiDialogBoxContents:"hub__ui-dialog-box-contents__PZ5qP",backgrounded:"hub__backgrounded__30IfD","in-room-favorite-button":"hub__in-room-favorite-button__2T-zs",inRoomFavoriteButton:"hub__in-room-favorite-button__2T-zs","occupant-count":"hub__occupant-count__3eAEj",occupantCount:"hub__occupant-count__3eAEj","presence-info-selected":"hub__presence-info-selected__FRBSA",presenceInfoSelected:"hub__presence-info-selected__FRBSA","camera-mode-exit-button":"hub__camera-mode-exit-button__BqKKt",cameraModeExitButton:"hub__camera-mode-exit-button__BqKKt","corner-button-selected":"hub__corner-button-selected__Cqa93",cornerButtonSelected:"hub__corner-button-selected__Cqa93","invite-tip-attach-point":"hub__invite-tip-attach-point__2y_bz",inviteTipAttachPoint:"hub__invite-tip-attach-point__2y_bz","avatar-editor":"hub__avatar-editor__2b8-H",avatarEditor:"hub__avatar-editor__2b8-H",logo:"hub__logo__3kJSj",form:"hub__form__3kQXh",box:"hub__box__2SMbn",links:"hub__links__1C6Ce",darkened:"hub__darkened__1gqMQ","display-name":"hub__display-name__36hFZ",displayName:"hub__display-name__36hFZ",preview:"hub__preview__2UUoU","edit-avatar":"hub__edit-avatar__22A53",editAvatar:"hub__edit-avatar__22A53",close:"hub__close__gWtCN","entry-dialog":"hub__entry-dialog__2Ljux",entryDialog:"hub__entry-dialog__2Ljux",favorited:"hub__favorited__3c3lB",icon:"hub__icon__1pzf7",bolded:"hub__bolded__2MYLZ",subtitle:"hub__subtitle__3kYcd","room-subtitle":"hub__room-subtitle__GhUCG",roomSubtitle:"hub__room-subtitle__GhUCG",lobby:"hub__lobby__2VW6G","profile-icon":"hub__profile-icon__fwSfD",profileIcon:"hub__profile-icon__fwSfD","button-subtitle":"hub__button-subtitle__3kkpo",buttonSubtitle:"hub__button-subtitle__3kkpo","audio-loader":"hub__audio-loader__F5ovU",audioLoader:"hub__audio-loader__F5ovU","webvr-link-container":"hub__webvr-link-container__1Vq5m",webvrLinkContainer:"hub__webvr-link-container__1Vq5m","webvr-link":"hub__webvr-link__xW04U",webvrLink:"hub__webvr-link__xW04U",secondary:"hub__secondary__22yt_"}},238:function(e,t){},2382:function(e,t){e.exports={touchZone:"virtual-gamepad-controls__touchZone__1KF_C",left:"virtual-gamepad-controls__left__1-URB",right:"virtual-gamepad-controls__right__1cgnU",mockJoystickContainer:"virtual-gamepad-controls__mockJoystickContainer__1aH3e",mockJoystick:"virtual-gamepad-controls__mockJoystick__2CuCG",inner:"virtual-gamepad-controls__inner__1Bn3C"}},2384:function(e,t){},2386:function(e,t){e.exports={ui:"ui-root__ui__33CMU","ui-dialog":"ui-root__ui-dialog__2TY9Y",uiDialog:"ui-root__ui-dialog__2TY9Y","ui-interactive":"ui-root__ui-interactive__2mtC4",uiInteractive:"ui-root__ui-interactive__2mtC4","presence-info":"ui-root__presence-info__3cieq",presenceInfo:"ui-root__presence-info__3cieq","corner-button":"ui-root__corner-button__2rfQ5",cornerButton:"ui-root__corner-button__2rfQ5","nag-corner-button":"ui-root__nag-corner-button__3TFW5",nagCornerButton:"ui-root__nag-corner-button__3TFW5","choose-scene-button":"ui-root__choose-scene-button__3VNdD",chooseSceneButton:"ui-root__choose-scene-button__3VNdD","leave-button":"ui-root__leave-button__29u2_",leaveButton:"ui-root__leave-button__29u2_",interstitial:"ui-root__interstitial__1cotl","invite-tip":"ui-root__invite-tip__20NJ6",inviteTip:"ui-root__invite-tip__20NJ6","streaming-tip":"ui-root__streaming-tip__17WYl",streamingTip:"ui-root__streaming-tip__17WYl","streaming-tip-attach-point":"ui-root__streaming-tip-attach-point__3XSH-",streamingTipAttachPoint:"ui-root__streaming-tip-attach-point__3XSH-","streaming-tip-close":"ui-root__streaming-tip-close__1OHPc",streamingTipClose:"ui-root__streaming-tip-close__1OHPc","streaming-tip-message":"ui-root__streaming-tip-message__2XOUD",streamingTipMessage:"ui-root__streaming-tip-message__2XOUD","ui-dialog-box-contents":"ui-root__ui-dialog-box-contents__3XWtl",uiDialogBoxContents:"ui-root__ui-dialog-box-contents__3XWtl",backgrounded:"ui-root__backgrounded__34j0m","in-room-favorite-button":"ui-root__in-room-favorite-button__2I0Kj",inRoomFavoriteButton:"ui-root__in-room-favorite-button__2I0Kj","occupant-count":"ui-root__occupant-count__34rGX",occupantCount:"ui-root__occupant-count__34rGX","presence-info-selected":"ui-root__presence-info-selected__1Jhbw",presenceInfoSelected:"ui-root__presence-info-selected__1Jhbw","camera-mode-exit-button":"ui-root__camera-mode-exit-button__2mpbz",cameraModeExitButton:"ui-root__camera-mode-exit-button__2mpbz","corner-button-selected":"ui-root__corner-button-selected__qRY5R",cornerButtonSelected:"ui-root__corner-button-selected__qRY5R","invite-tip-attach-point":"ui-root__invite-tip-attach-point__3rQJ6",inviteTipAttachPoint:"ui-root__invite-tip-attach-point__3rQJ6","avatar-editor":"ui-root__avatar-editor__2mO8z",avatarEditor:"ui-root__avatar-editor__2mO8z"}},2388:function(e,t){e.exports={"entry-button-secondary":"entry__entry-button-secondary__1Fr_E",entryButtonSecondary:"entry__entry-button-secondary__1Fr_E","entry-panel":"entry__entry-panel__34CD9",entryPanel:"entry__entry-panel__34CD9","button-container":"entry__button-container__3Blog",buttonContainer:"entry__button-container__3Blog","secondary-action-button":"entry__secondary-action-button__3FCMj",secondaryActionButton:"entry__secondary-action-button__3FCMj","entry-button":"entry__entry-button__G7PQF",entryButton:"entry__entry-button__G7PQF","action-button":"entry__action-button__3Vnab",actionButton:"entry__action-button__3Vnab","collapse-button":"entry__collapse-button__3_PLp",collapseButton:"entry__collapse-button__3_PLp","favorite-button":"entry__favorite-button__2CVuk",favoriteButton:"entry__favorite-button__2CVuk",back:"entry__back__J4Sgl","lobby-label":"entry__lobby-label__2Nj9w",lobbyLabel:"entry__lobby-label__2Nj9w",label:"entry__label__fUhpb",title:"entry__title__1GITj",name:"entry__name__sYOeV","rename-button":"entry__rename-button__KFW9R",renameButton:"entry__rename-button__KFW9R",center:"entry__center__1105W","wide-button":"entry__wide-button__2tfMM",wideButton:"entry__wide-button__2tfMM","screen-sharing":"entry__screen-sharing__NBXQu",screenSharing:"entry__screen-sharing__NBXQu",checkbox:"entry__checkbox__3SoPk","entry-dialog":"entry__entry-dialog__30kMs",entryDialog:"entry__entry-dialog__30kMs",favorited:"entry__favorited__2IHpj",icon:"entry__icon__3JiUl",bolded:"entry__bolded__13B4f",subtitle:"entry__subtitle__1BC2y","room-subtitle":"entry__room-subtitle__7MSMo",roomSubtitle:"entry__room-subtitle__7MSMo",lobby:"entry__lobby__3AxfL","profile-icon":"entry__profile-icon__3BAWG",profileIcon:"entry__profile-icon__3BAWG","button-subtitle":"entry__button-subtitle__3zrEo",buttonSubtitle:"entry__button-subtitle__3zrEo","audio-loader":"entry__audio-loader__1YCJd",audioLoader:"entry__audio-loader__1YCJd","webvr-link-container":"entry__webvr-link-container__3scWP",webvrLinkContainer:"entry__webvr-link-container__3scWP","webvr-link":"entry__webvr-link__3eWuZ",webvrLink:"entry__webvr-link__3eWuZ",secondary:"entry__secondary__3uhYE"}},2390:function(e,t){e.exports={"invite-container":"invite-dialog__invite-container__1c0Jw",inviteContainer:"invite-dialog__invite-container__1c0Jw",dialog:"invite-dialog__dialog__1XbxO","link-button":"invite-dialog__link-button__S_o-t",linkButton:"invite-dialog__link-button__S_o-t","enter-vr-button":"invite-dialog__enter-vr-button__3y1BF",enterVrButton:"invite-dialog__enter-vr-button__3y1BF","invite-button":"invite-dialog__invite-button__3cjFw",inviteButton:"invite-dialog__invite-button__3cjFw","enter-button":"invite-dialog__enter-button__2Z5EY",enterButton:"invite-dialog__enter-button__2Z5EY","invite-mini-button":"invite-dialog__invite-mini-button__2zWJj",inviteMiniButton:"invite-dialog__invite-mini-button__2zWJj",domain:"invite-dialog__domain__2Q8Wr","embed-text":"invite-dialog__embed-text__3-Boo",embedText:"invite-dialog__embed-text__3-Boo","invite-container-inverted":"invite-dialog__invite-container-inverted__1E3hR",inviteContainerInverted:"invite-dialog__invite-container-inverted__1E3hR",subscribe:"invite-dialog__subscribe__qlJL4","embed-tip-wrap":"invite-dialog__embed-tip-wrap__2CQRc",embedTipWrap:"invite-dialog__embed-tip-wrap__2CQRc","embed-tip":"invite-dialog__embed-tip__12p0o",embedTip:"invite-dialog__embed-tip__12p0o",modal:"invite-dialog__modal__1hbVP","hide-small-screens":"invite-dialog__hide-small-screens__3UCeH",hideSmallScreens:"invite-dialog__hide-small-screens__3UCeH","invite-container-below-hud":"invite-dialog__invite-container-below-hud__30RHX",inviteContainerBelowHud:"invite-dialog__invite-container-below-hud__30RHX","attach-point":"invite-dialog__attach-point__otyII",attachPoint:"invite-dialog__attach-point__otyII",code:"invite-dialog__code__13AIx","keep-open":"invite-dialog__keep-open__229sO",keepOpen:"invite-dialog__keep-open__229sO",digit:"invite-dialog__digit__2w64P",digit_2:"invite-dialog__digit_2__pQCJ3",digit2:"invite-dialog__digit_2__pQCJ3",digit_3:"invite-dialog__digit_3__1bWtt",digit3:"invite-dialog__digit_3__1bWtt","code-loading-panel":"invite-dialog__code-loading-panel__1gghm",codeLoadingPanel:"invite-dialog__code-loading-panel__1gghm","hub-link-link":"invite-dialog__hub-link-link__2guVF",hubLinkLink:"invite-dialog__hub-link-link__2guVF",buttons:"invite-dialog__buttons__1yN_j",embed:"invite-dialog__embed__2zy_A",close:"invite-dialog__close__3PAxl","embed-tip-attach-point":"invite-dialog__embed-tip-attach-point__2UAZp",embedTipAttachPoint:"invite-dialog__embed-tip-attach-point__2UAZp"}},2392:function(e,t){e.exports={"cancel-button":"promote-client-dialog__cancel-button__3YZLa",cancelButton:"promote-client-dialog__cancel-button__3YZLa","confirm-button":"promote-client-dialog__confirm-button__3LXvQ",confirmButton:"promote-client-dialog__confirm-button__3LXvQ",message:"promote-client-dialog__message__1LA_N"}},2394:function(e,t){e.exports={"client-action-buttons":"client-info-dialog__client-action-buttons__3u-6v",clientActionButtons:"client-info-dialog__client-action-buttons__3u-6v",cancel:"client-info-dialog__cancel__2BguV","client-info-dialog":"client-info-dialog__client-info-dialog__2e1dc",clientInfoDialog:"client-info-dialog__client-info-dialog__2e1dc",title:"client-info-dialog__title__3FGPe","community-identifier":"client-info-dialog__community-identifier__g3lbP",communityIdentifier:"client-info-dialog__community-identifier__g3lbP","client-info":"client-info-dialog__client-info__1MUSa",clientInfo:"client-info-dialog__client-info__1MUSa","client-profile-image":"client-info-dialog__client-profile-image__zt1EA",clientProfileImage:"client-info-dialog__client-profile-image__zt1EA","client-details":"client-info-dialog__client-details__1F5zy",clientDetails:"client-info-dialog__client-details__1F5zy","client-main":"client-info-dialog__client-main__2BC1s",clientMain:"client-info-dialog__client-main__2BC1s","button-icon":"client-info-dialog__button-icon__1vKfx",buttonIcon:"client-info-dialog__button-icon__1vKfx"}},2396:function(e,t){e.exports={"loading-text":"loader__loading-text__QVcF3",loadingText:"loader__loading-text__QVcF3"}},2398:function(e,t){e.exports={"profile-entry":"profile__profile-entry__1pJKZ",profileEntry:"profile__profile-entry__1pJKZ","form-submit":"profile__form-submit__2y7xb",formSubmit:"profile__form-submit__2y7xb","choose-avatar":"profile__choose-avatar__2EV0F",chooseAvatar:"profile__choose-avatar__2EV0F","form-field-text":"profile__form-field-text__1bzeV",formFieldText:"profile__form-field-text__1bzeV",title:"profile__title__Vcynv",logo:"profile__logo__1JZAd",form:"profile__form__1-hBO",box:"profile__box__oJXQD",links:"profile__links__2hukW",darkened:"profile__darkened__1rVba","display-name":"profile__display-name__auABh",displayName:"profile__display-name__auABh",preview:"profile__preview__3QjLq","edit-avatar":"profile__edit-avatar__3386A",editAvatar:"profile__edit-avatar__3386A",close:"profile__close__2Uitz"}},2400:function(e,t){e.exports={preview:"avatar-preview__preview__2I8qx"}},2402:function(e,t){e.exports={"action-button":"create-object-dialog__action-button__3OIJQ",actionButton:"create-object-dialog__action-button__3OIJQ",buttons:"create-object-dialog__buttons__1zA-b","small-button":"create-object-dialog__small-button__7UxXQ",smallButton:"create-object-dialog__small-button__7UxXQ","input-border":"create-object-dialog__input-border__1N9AV",inputBorder:"create-object-dialog__input-border__1N9AV","left-side-of-input":"create-object-dialog__left-side-of-input__zyV06",leftSideOfInput:"create-object-dialog__left-side-of-input__zyV06","add-media-form":"create-object-dialog__add-media-form__10Wh-",addMediaForm:"create-object-dialog__add-media-form__10Wh-","cancel-icon":"create-object-dialog__cancel-icon__yD-8A",cancelIcon:"create-object-dialog__cancel-icon__yD-8A","upload-icon":"create-object-dialog__upload-icon__19g9k",uploadIcon:"create-object-dialog__upload-icon__19g9k","hide-file-input":"create-object-dialog__hide-file-input__2myDe",hideFileInput:"create-object-dialog__hide-file-input__2myDe"}},2404:function(e,t){e.exports={"action-button":"change-scene-dialog__action-button__1xtdK",actionButton:"change-scene-dialog__action-button__1xtdK",buttons:"change-scene-dialog__buttons__2QE34","spoke-launch":"change-scene-dialog__spoke-launch__YObDn",spokeLaunch:"change-scene-dialog__spoke-launch__YObDn","input-border":"change-scene-dialog__input-border__30jd6",inputBorder:"change-scene-dialog__input-border__30jd6","left-side-of-input":"change-scene-dialog__left-side-of-input__14WKu",leftSideOfInput:"change-scene-dialog__left-side-of-input__14WKu","change-scene-button":"change-scene-dialog__change-scene-button__ckfZW",changeSceneButton:"change-scene-dialog__change-scene-button__ckfZW","spoke-create":"change-scene-dialog__spoke-create__2krL-",spokeCreate:"change-scene-dialog__spoke-create__2krL-"}},2406:function(e,t){e.exports={"avatar-url-dialog":"avatar-url-dialog__avatar-url-dialog__17OoD",avatarUrlDialog:"avatar-url-dialog__avatar-url-dialog__17OoD"}},2408:function(e,t){e.exports={"close-button":"link-dialog__close-button__2THTw",closeButton:"link-dialog__close-button__2THTw",domain:"link-dialog__domain__1WbPJ",dialog:"link-dialog__dialog__1zbyG",header:"link-dialog__header__1A06x",contents:"link-dialog__contents__3ODVz",code:"link-dialog__code__259RI",imageHeader:"link-dialog__imageHeader__eaJe6","keep-open":"link-dialog__keep-open__DYcUI",keepOpen:"link-dialog__keep-open__DYcUI",digit:"link-dialog__digit___zoC4","code-loading-panel":"link-dialog__code-loading-panel__WKkNk",codeLoadingPanel:"link-dialog__code-loading-panel__WKkNk",close:"link-dialog__close__2TTmg"}},2410:function(e,t){e.exports={"name-field":"room-settings-dialog__name-field___yGhb",nameField:"room-settings-dialog__name-field___yGhb","next-button":"room-settings-dialog__next-button__2F9Jd",nextButton:"room-settings-dialog__next-button__2F9Jd","continue-button":"room-settings-dialog__continue-button__2Ltsg",continueButton:"room-settings-dialog__continue-button__2Ltsg","room-settings-form":"room-settings-dialog__room-settings-form__yNism",roomSettingsForm:"room-settings-dialog__room-settings-form__yNism",permission:"room-settings-dialog__permission__3W-cW",subtitle:"room-settings-dialog__subtitle__2ddy2",permissions:"room-settings-dialog__permissions__1sHPN","permissions-group":"room-settings-dialog__permissions-group__1oRYA",permissionsGroup:"room-settings-dialog__permissions-group__1oRYA","permission-disabled":"room-settings-dialog__permission-disabled__3NH-j",permissionDisabled:"room-settings-dialog__permission-disabled__3NH-j"}},2412:function(e,t){e.exports={"cancel-button":"close-room-dialog__cancel-button__MmtAo",cancelButton:"close-room-dialog__cancel-button__MmtAo","confirm-button":"close-room-dialog__confirm-button__Bs9y3",confirmButton:"close-room-dialog__confirm-button__Bs9y3",message:"close-room-dialog__message__1Rvh3"}},2414:function(e,t){e.exports={"tip-root":"tip__tip-root__1s7D1",tipRoot:"tip__tip-root__1s7D1","tip-link":"tip__tip-link__3m4Iq",tipLink:"tip__tip-link__3m4Iq","tip-cancel":"tip__tip-cancel__1xPNP",tipCancel:"tip__tip-cancel__1xPNP",tip:"tip__tip__32KOl","split-tip":"tip__split-tip__1xSCE",splitTip:"tip__split-tip__1xSCE","split-tip-icon":"tip__split-tip-icon__1ZXw0",splitTipIcon:"tip__split-tip-icon__1ZXw0","spawn_menu-icon":"tip__spawn_menu-icon__2en_9",spawnMenuIcon:"tip__spawn_menu-icon__2en_9","object_rotate_button-icon":"tip__object_rotate_button-icon__2tgeV",objectRotateButtonIcon:"tip__object_rotate_button-icon__2tgeV","object_scale_button-icon":"tip__object_scale_button-icon__pxKrw",objectScaleButtonIcon:"tip__object_scale_button-icon__pxKrw","object_recenter_button-icon":"tip__object_recenter_button-icon__38tNR",objectRecenterButtonIcon:"tip__object_recenter_button-icon__38tNR"}},2421:function(e,t){e.exports={"form-frame":"feedback-dialog__form-frame__1gfk_",formFrame:"feedback-dialog__form-frame__1gfk_"}},2423:function(e,t){e.exports={"leave-room":"leave-room-dialog__leave-room__31Jf7",leaveRoom:"leave-room-dialog__leave-room__31Jf7"}},2425:function(e,t){e.exports={title:"room-info-dialog__title__3-3CO","room-info":"room-info-dialog__room-info__3XkbS",roomInfo:"room-info-dialog__room-info__3XkbS","scene-screenshot":"room-info-dialog__scene-screenshot__3PWz-",sceneScreenshot:"room-info-dialog__scene-screenshot__3PWz-","scene-details":"room-info-dialog__scene-details__2pYml",sceneDetails:"room-info-dialog__scene-details__2pYml","scene-main":"room-info-dialog__scene-main__2mhXj",sceneMain:"room-info-dialog__scene-main__2mhXj","scene-name":"room-info-dialog__scene-name__1bqGh",sceneName:"room-info-dialog__scene-name__1bqGh","scene-creator":"room-info-dialog__scene-creator__3_za4",sceneCreator:"room-info-dialog__scene-creator__3_za4","scene-attributions":"room-info-dialog__scene-attributions__QpYVd",sceneAttributions:"room-info-dialog__scene-attributions__QpYVd",attribution:"room-info-dialog__attribution__I9_V-","attribution-name":"room-info-dialog__attribution-name__3JTpI",attributionName:"room-info-dialog__attribution-name__3JTpI","attribution-author":"room-info-dialog__attribution-author__BouZB",attributionAuthor:"room-info-dialog__attribution-author__BouZB"}},2427:function(e,t){e.exports={"oauth-discord-button":"oauth-dialog__oauth-discord-button__A_Zra",oauthDiscordButton:"oauth-dialog__oauth-discord-button__A_Zra","oauth-twitter-button":"oauth-dialog__oauth-twitter-button__Vh4oX",oauthTwitterButton:"oauth-dialog__oauth-twitter-button__Vh4oX","oauth-button":"oauth-dialog__oauth-button__25RiO",oauthButton:"oauth-dialog__oauth-button__25RiO","oauth-type-name":"oauth-dialog__oauth-type-name__jPyhW",oauthTypeName:"oauth-dialog__oauth-type-name__jPyhW","oauth-icon":"oauth-dialog__oauth-icon__v1G6W",oauthIcon:"oauth-dialog__oauth-icon__v1G6W","privacy-notice":"oauth-dialog__privacy-notice__2R9ZT",privacyNotice:"oauth-dialog__privacy-notice__2R9ZT","oauth-buttons":"oauth-dialog__oauth-buttons__1U1Ni",oauthButtons:"oauth-dialog__oauth-buttons__1U1Ni","twitter-message":"oauth-dialog__twitter-message__cWCES",twitterMessage:"oauth-dialog__twitter-message__cWCES"}},2429:function(e,t){e.exports={buttons:"tweet-dialog__buttons__1gYv2","tweet-button":"tweet-dialog__tweet-button__3XvNj",tweetButton:"tweet-dialog__tweet-button__3XvNj",tweet:"tweet-dialog__tweet__25N6e",editor:"tweet-dialog__editor__3xJV-","editor-inner":"tweet-dialog__editor-inner__1Zhzc",editorInner:"tweet-dialog__editor-inner__1Zhzc","emoji-button":"tweet-dialog__emoji-button__2L9tR",emojiButton:"tweet-dialog__emoji-button__2L9tR",counter:"tweet-dialog__counter__2OZyX",highlight:"tweet-dialog__highlight__1EXxs",media:"tweet-dialog__media__IeN9e",posted:"tweet-dialog__posted__2t8RC","tweet-loader":"tweet-dialog__tweet-loader__3Q8YL",tweetLoader:"tweet-dialog__tweet-loader__3Q8YL","dialog-background":"tweet-dialog__dialog-background__2vvyQ",dialogBackground:"tweet-dialog__dialog-background__2vvyQ"}},2439:function(e,t){e.exports={"message-entry-in-room":"message-entry__message-entry-in-room__1aN5s",messageEntryInRoom:"message-entry__message-entry-in-room__1aN5s","message-entry-spawn":"message-entry__message-entry-spawn__1_AF5",messageEntrySpawn:"message-entry__message-entry-spawn__1_AF5","message-entry-input":"message-entry__message-entry-input__2AtQE",messageEntryInput:"message-entry__message-entry-input__2AtQE","message-entry":"message-entry__message-entry__x7lQX",messageEntry:"message-entry__message-entry__x7lQX","message-entry-disabled":"message-entry__message-entry-disabled__25LSI",messageEntryDisabled:"message-entry__message-entry-disabled__25LSI","message-entry-button":"message-entry__message-entry-button__3xJhH",messageEntryButton:"message-entry__message-entry-button__3xJhH","message-entry-button-in-room":"message-entry__message-entry-button-in-room__2yMTR",messageEntryButtonInRoom:"message-entry__message-entry-button-in-room__2yMTR","message-entry-upload":"message-entry__message-entry-upload__3F0sX",messageEntryUpload:"message-entry__message-entry-upload__3F0sX","message-entry-input-in-room":"message-entry__message-entry-input-in-room__30ReF",messageEntryInputInRoom:"message-entry__message-entry-input-in-room__30ReF","message-entry-input-no-spawn":"message-entry__message-entry-input-no-spawn__1wF7R",messageEntryInputNoSpawn:"message-entry__message-entry-input-no-spawn__1wF7R","message-entry-on-mobile":"message-entry__message-entry-on-mobile__2pSYF",messageEntryOnMobile:"message-entry__message-entry-on-mobile__2pSYF"}},2443:function(e,t){e.exports={"command-help":"chat-command-help__command-help__q0Wb8",commandHelp:"chat-command-help__command-help__q0Wb8",entry:"chat-command-help__entry__1E1un",command:"chat-command-help__command__2GMyn"}},2445:function(e,t){e.exports={"presence-log":"presence-log__presence-log__10oFj",presenceLog:"presence-log__presence-log__10oFj","presence-log-entry":"presence-log__presence-log-entry__dt0t4",presenceLogEntry:"presence-log__presence-log-entry__dt0t4","message-body":"presence-log__message-body__2L9jA",messageBody:"presence-log__message-body__2L9jA","message-body-multi":"presence-log__message-body-multi__2e-Sx",messageBodyMulti:"presence-log__message-body-multi__2e-Sx","message-body-mono":"presence-log__message-body-mono__3zuQE",messageBodyMono:"presence-log__message-body-mono__3zuQE","message-wrap":"presence-log__message-wrap__2aWCa",messageWrap:"presence-log__message-wrap__2aWCa","message-wrap-multi":"presence-log__message-wrap-multi__1eA6v",messageWrapMulti:"presence-log__message-wrap-multi__1eA6v","message-source":"presence-log__message-source__3CI4d",messageSource:"presence-log__message-source__3CI4d","message-source-link":"presence-log__message-source-link__1evTZ",messageSourceLink:"presence-log__message-source-link__1evTZ","icon-button":"presence-log__icon-button__2Shbm",iconButton:"presence-log__icon-button__2Shbm","spawn-message":"presence-log__spawn-message__14Ne8",spawnMessage:"presence-log__spawn-message__14Ne8",share:"presence-log__share__37U7E",media:"presence-log__media__2qG_d",mediaBody:"presence-log__mediaBody__1rByA",expired:"presence-log__expired__2wMJc","presence-log-entry-with-button":"presence-log__presence-log-entry-with-button__1PxTw",presenceLogEntryWithButton:"presence-log__presence-log-entry-with-button__1PxTw","presence-log-in-room":"presence-log__presence-log-in-room__17h3n",presenceLogInRoom:"presence-log__presence-log-in-room__17h3n","presence-log-spawn":"presence-log__presence-log-spawn__3jlmT",presenceLogSpawn:"presence-log__presence-log-spawn__3jlmT","presence-log-entry-one-line":"presence-log__presence-log-entry-one-line__bRXfp",presenceLogEntryOneLine:"presence-log__presence-log-entry-one-line__bRXfp","presence-log-emoji":"presence-log__presence-log-emoji__1_3Yn",presenceLogEmoji:"presence-log__presence-log-emoji__1_3Yn",emoji:"presence-log__emoji__10b18"}},2448:function(e,t){e.exports={"client-link":"presence-list__client-link__3tkyz",clientLink:"presence-list__client-link__3tkyz","presence-list":"presence-list__presence-list__1KERe",presenceList:"presence-list__presence-list__1KERe","attach-point":"presence-list__attach-point__kIdfx",attachPoint:"presence-list__attach-point__kIdfx",contents:"presence-list__contents__1B7bz",rows:"presence-list__rows__1B6KS",row:"presence-list__row__1D2j2","row-header":"presence-list__row-header__3kl1w",rowHeader:"presence-list__row-header__3kl1w","list-item":"presence-list__list-item__2YARP",listItem:"presence-list__list-item__2YARP","list-item-link":"presence-list__list-item-link__2DLC2",listItemLink:"presence-list__list-item-link__2DLC2",presence:"presence-list__presence__15DJe","sign-in":"presence-list__sign-in__28eVu",signIn:"presence-list__sign-in__28eVu",icon:"presence-list__icon__1t8iB",self:"presence-list__self__1g-bw","moderator-badge":"presence-list__moderator-badge__2njku",moderatorBadge:"presence-list__moderator-badge__2njku"}},2450:function(e,t){e.exports={"avatar-editor":"avatar-editor__avatar-editor__xtJ6P",avatarEditor:"avatar-editor__avatar-editor__xtJ6P"}},2452:function(e,t){e.exports={"bottom-links-main":"settings-menu__bottom-links-main__Vtlje",bottomLinksMain:"settings-menu__bottom-links-main__Vtlje","bottom-links":"settings-menu__bottom-links__b1tDE",bottomLinks:"settings-menu__bottom-links__b1tDE","settings-menu":"settings-menu__settings-menu__3x1Pv",settingsMenu:"settings-menu__settings-menu__3x1Pv","attach-point":"settings-menu__attach-point__2gV3g",attachPoint:"settings-menu__attach-point__2gV3g",contents:"settings-menu__contents__3GQlW",rows:"settings-menu__rows__2OtlS",row:"settings-menu__row__3w7fz","row-header":"settings-menu__row-header__2oCqk",rowHeader:"settings-menu__row-header__2oCqk","list-item":"settings-menu__list-item__1__z6",listItem:"settings-menu__list-item__1__z6","list-item-link":"settings-menu__list-item-link__2ovr3",listItemLink:"settings-menu__list-item-link__2ovr3","settings-row":"settings-menu__settings-row__1sDDk",settingsRow:"settings-menu__settings-row__1sDDk",icon:"settings-menu__icon__3KMMz"}},2454:function(e,t){e.exports={"load-button":"preload-overlay__load-button__ba1d4",loadButton:"preload-overlay__load-button__ba1d4",treatment:"preload-overlay__treatment__1L4r0",screenshot:"preload-overlay__screenshot__3TZYm","hub-name":"preload-overlay__hub-name__2txaT",hubName:"preload-overlay__hub-name__2txaT","main-panel":"preload-overlay__main-panel__2EX4k",mainPanel:"preload-overlay__main-panel__2EX4k",logo:"preload-overlay__logo__1IJJc"}},2456:function(e,t){e.exports={panel:"_2d-hud__panel__2oM_T","tip-cancel-text":"_2d-hud__tip-cancel-text__12KQ2",tipCancelText:"_2d-hud__tip-cancel-text__12KQ2","top-tip":"_2d-hud__top-tip__E5uti",topTip:"_2d-hud__top-tip__E5uti",container:"_2d-hud__container__66GRt",top:"_2d-hud__top__3PiNe",column:"_2d-hud__column__1y7XY",bottom:"_2d-hud__bottom__2jUcT",hide:"_2d-hud__hide__3HJO8","attach-point":"_2d-hud__attach-point__17FSc",attachPoint:"_2d-hud__attach-point__17FSc",attach_video_share_mode:"_2d-hud__attach_video_share_mode__21PhM",attachVideoShareMode:"_2d-hud__attach_video_share_mode__21PhM",attach_video_share_failed:"_2d-hud__attach_video_share_failed__2tfqf",attachVideoShareFailed:"_2d-hud__attach_video_share_failed__2tfqf",attach_pen_mode:"_2d-hud__attach_pen_mode__cI1AW",attachPenMode:"_2d-hud__attach_pen_mode__cI1AW",attach_mute_mode:"_2d-hud__attach_mute_mode__153iB",attachMuteMode:"_2d-hud__attach_mute_mode__153iB",attach_freeze_mode:"_2d-hud__attach_freeze_mode__3UIHP",attachFreezeMode:"_2d-hud__attach_freeze_mode__3UIHP","top-tip-no-hud":"_2d-hud__top-tip-no-hud__16RXh",topTipNoHud:"_2d-hud__top-tip-no-hud__16RXh","tip-cancel":"_2d-hud__tip-cancel__JaFV-",tipCancel:"_2d-hud__tip-cancel__JaFV-","video-share-extra-options":"_2d-hud__video-share-extra-options__31VMr",videoShareExtraOptions:"_2d-hud__video-share-extra-options__31VMr",iconButton:"_2d-hud__iconButton__3faJz",up:"_2d-hud__up__1lyhr",small:"_2d-hud__small__2rqgF",large:"_2d-hud__large__2bHqH",disabled:"_2d-hud__disabled__3ylbZ","video-share":"_2d-hud__video-share__38X7W",videoShare:"_2d-hud__video-share__38X7W",fly:"_2d-hud__fly__kDxPK",active:"_2d-hud__active__1TMB8",mute:"_2d-hud__mute__25kHI",pen:"_2d-hud__pen__3uTC7",camera:"_2d-hud__camera__84ksg",freeze:"_2d-hud__freeze__26rlJ",spawn:"_2d-hud__spawn__1FoBz","mobile-media-picker":"_2d-hud__mobile-media-picker__3ZXHc",mobileMediaPicker:"_2d-hud__mobile-media-picker__3ZXHc",share_camera:"_2d-hud__share_camera__v67Il",shareCamera:"_2d-hud__share_camera__v67Il",share_screen:"_2d-hud__share_screen__1HQ8E",shareScreen:"_2d-hud__share_screen__1HQ8E",share_window:"_2d-hud__share_window__stsD3",shareWindow:"_2d-hud__share_window__stsD3"}},2492:function(e,t){e.exports={label:"spectating-label__label__3JS5A"}},27:function(e,t,i){"use strict";i.d(t,"a",function(){return n});const a=new URLSearchParams(location.search);function n(e){const t=a.get(e);return""===t||/1|on|true|yes/i.test(t)}},273:function(e,t,i){"use strict";function a(e,t){for(;e&&(!e.components||!e.components[t]);)e=e.parentNode;return e}i.d(t,"a",function(){return a})},286:function(e,t,i){"use strict";i.d(t,"a",function(){return s}),i.d(t,"b",function(){return o});const a=function(){const e=new THREE.Box3;return function(t,i){return i.makeEmpty(),t.traverse(t=>{const a=t.geometry;null!=a&&(null==a.boundingBox&&a.computeBoundingBox(),i.union(e.copy(a.boundingBox).applyMatrix4(t.matrixWorld)))}),i}}(),n=new THREE.Euler;function s(e,t){const i=new THREE.Box3;return n.copy(e.object3D.rotation),e.object3D.rotation.set(0,0,0),e.object3D.updateMatrices(!0,!0),t.updateMatrices(!0,!0),t.updateMatrixWorld(!0),a(t,i),i.isEmpty()||(e.object3D.worldToLocal(i.min),e.object3D.worldToLocal(i.max),e.object3D.rotation.copy(n),e.object3D.matrixNeedsUpdate=!0),t.matrixWorldNeedsUpdate=!0,t.updateMatrices(),i}function o(e,t){if(t.isEmpty())return 1;const{max:i,min:a}=t,n=Math.abs(i.x-a.x),s=Math.abs(i.y-a.y),o=Math.abs(i.z-a.z);return e/Math.max(n,s,o)}},33:function(e,t,i){"use strict";var a=i(22);var n={en:{"auth.verified-title":"E-Mail Verified!","auth.verified":"Your email has been verified!\nYou can now close this browser tab and return to Hubs.","auth.spoke-verified":"You email has been verified!\nYou can now close this browser tab and return to Spoke.","sign-in.prompt":"Sign in to pin objects in rooms.","sign-in.auth-started":"Email sent!\n\nTo continue, go click on the link in the email using your phone, tablet, or PC.","sign-in.pin":"You'll need to sign in to pin objects.","sign-in.pin-complete":"You are now signed in.","sign-in.unpin":"You'll need to sign in to un-pin objects.","sign-in.unpin-complete":"You are now signed in.","sign-in.change-scene":"You'll need to sign in to change the scene.","sign-in.change-scene-complete":"You are now signed in.","sign-in.rename-room":"You'll need to sign in to rename axon park.","sign-in.rename-room-complete":"You are now signed in.","sign-in.close-room":"You'll need to sign in to close axon park.","sign-in.close-room-complete":"You are now signed in.","sign-in.mute-user":"You'll need to sign in to mute other users.","sign-in.mute-user-complete":"You are now signed in.","sign-in.kick-user":"You'll need to sign in to kick other users.","sign-in.kick-user-complete":"You are now signed in.","sign-in.create-avatar":"You'll need to sign in to create avatars.","sign-in.create-avatar-complete":"You are now signed in.","sign-in.favorite-room":"You'll need to sign in to add this room to your favorites.","sign-in.favorite-rooms":"You'll need to sign in to add favorite rooms.","sign-in.favorite-room-complete":"You are now signed in.","sign-in.favorite-rooms-complete":"You are now signed in.","sign-in.as":"Signed in as","sign-in.in":"Sign In","sign-in.out":"Sign Out","rename-room.message":"Enter the new name for axon park.","rename-room.rename":"Rename Axon Park","close-room.message":"Closing this room will remove yourself and others from axon park, shutting it down permanently.\n\nAre you sure? This action cannot be undone.","close-room.confirm":"Yes, Close Axon Park","close-room.cancel":"Cancel","entry.room":"Immersive Education","entry.enter-room-title":"Lobby","entry.enter-room":"enter or send to device","entry.leave-room":"Leave Axon Park","entry.change-scene":"Choose a Scene","entry.in-lobby-notice":"You are viewing Axon Park from the lobby.","entry.screen-prefix":"Enter on ","entry.desktop-screen":"Screen","entry.mobile-screen":"Phone","entry.mobile-safari":"Safari","entry.generic-prefix":" ","entry.generic-medium":"Connected VR Headset","entry.generic-subtitle-desktop":"Oculus or SteamVR","entry.gearvr-prefix":"Enter on ","entry.gearvr-medium":"Gear VR","entry.choose-device":"Choose Device","entry.device-medium":"Send to Device","entry.device-subtitle-desktop":"Standalone VR or Phone","entry.device-subtitle-mobile":"Standalone VR or PC","entry.device-subtitle-vr":"Phone or PC","entry.cardboard":"Enter on Google Cardboard","entry.daydream-prefix":"Enter on ","entry.daydream-medium":"Daydream","entry.daydream-via-chrome":"Using Google Chrome","entry.invite-others":"invite others","entry.share-button":"share","entry.desktop.invite-tip":"Nobody is here yet. Share this room to get together.","entry.mobile.invite-tip":"Share to get together.","entry.invite-team-nag":"Invite a hubs team member","entry.enable-screen-sharing":"Share my desktop","entry.return-to-vr":"Return to VR","entry.enter-in-vr":"Enter in VR","entry.open-in-window":"Open in Tab","entry.lobby":"Lobby","entry.back":"Back","entry.notify_me":"Notify me when others arrive","entry.mute-on-entry":"Mute my microphone","profile.save":"Accept","profile.display_name.validation_warning":"Alphanumerics and hyphens. At least 3 characters, no more than 32","profile.header":"Name & Avatar","profile.terms_of_use":"Terms of Use","profile.privacy_notice":"Privacy Notice","profile.choose_avatar":"Browse Avatars","profile.tabs.legacy":"Default","profile.tabs.skinnable":"Custom Skin","profile.tabs.url":"Custom Model","profile.info":"Resources for creating custom avatar models can be found","profile.info-link":"here","avatar-editor.info":"Resources for creating custom avatar skins can be found","avatar-editor.info-link":"here","avatar-preview.loading-failed":"Loading failed\nPlease choose another avatar","media-browser.search-placeholder.scenes":"Search Scenes...","media-browser.search-placeholder.avatars":"Search Avatars...","media-browser.search-placeholder.videos":"Search the web...","media-browser.search-placeholder.images":"Search the web...","media-browser.search-placeholder.youtube":"Search for videos...","media-browser.search-placeholder.gifs":"Search for GIFs...","media-browser.search-placeholder.twitch":"Search for streams...","media-browser.search-placeholder.sketchfab":"Search for models...","media-browser.search-placeholder.poly":"Search for models...","media-browser.search-placeholder.base":"Search...","media-browser.favorites-header":"Favorite Rooms","media-browser.add_custom_object":"Custom URL or File","media-browser.add_custom_scene":"Custom Scene","media-browser.add_custom_avatar":"Avatar GLB URL","media-browser.privacy_policy":"Privacy Policy","media-browser.spoke":"Spoke","media-browser.report_issue":"Report Issue","media-browser.powered_by.images":"Search by Bing | ","media-browser.powered_by.videos":"Search by Bing | ","media-browser.powered_by.youtube":"Search by Google | ","media-browser.powered_by.gifs":"Search by Tenor | ","media-browser.powered_by.sketchfab":"Search by Sketchfab | ","media-browser.powered_by.poly":"Search by Google | ","media-browser.powered_by.twitch":"Search by Twitch | ","media-browser.powered_by.scenes":"Made with ","media-browser.powered_by.avatars":" ","media-browser.empty.images":"No results. Try entering a new search above.","media-browser.empty.videos":"No results. Try entering a new search above.","media-browser.empty.youtube":"No results. Try entering a new search above.","media-browser.empty.gifs":"No result. Try entering a new search above.","media-browser.empty.sketchfab":"No results. Try entering a new search above.","media-browser.empty.poly":"No results. Try entering a new search above.","media-browser.empty.twitch":"No results. Try entering a new search above.","media-browser.empty.favorites":"You don't have any favorites. Click a ⭐ to add to your favorites.","media-browser.nav_title.youtube":"YouTube","media-browser.nav_title.videos":"Videos","media-browser.nav_title.images":"Images","media-browser.nav_title.gifs":"GIFs","media-browser.nav_title.scenes":"Scenes","media-browser.nav_title.avatars":"Avatars","media-browser.nav_title.sketchfab":"Sketchfab","media-browser.nav_title.poly":"Google Poly","media-browser.nav_title.twitch":"Twitch","media-browser.create-avatar":"Create Avatar","media-browser.create-scene":"Create Scene with Spoke","media-browser.hub.joined-prefix":"Joined ","media-browser.hub.joined-prefix":"Visited ","audio.title":"Audio Setup","audio.talk_to_test":"talk","audio.click_to_test":"click","audio.subtitle-desktop":"Confirm HMD speaker output","audio.subtitle-mobile":"Earphones are recommended","audio.enter-now":"Enter Now","audio.hmd-mic-warning":"Your HMD mic is not chosen","audio.grant-title":"Grant mic permissions","audio.grant-subtitle":"Mic access needed to be heard by others","audio.granted-title":"Mic permissions granted","audio.granted-subtitle":"You can still mute yourself in-game","audio.granted-next":"Next","exit.subtitle.exited":"Your session has ended. Refresh your browser to start a new one.","exit.subtitle.closed":"This room is no longer available.","exit.subtitle.denied":"You are not permitted to join this room. Please request permission from the room creator.","exit.subtitle.kicked":"You have been kicked from axon park.","exit.subtitle.left":"You have left axon park.","exit.subtitle.full":"This room is full, please try again later.","exit.subtitle.connect_error":"Unable to connect to this room, please try again later.","exit.subtitle.version_mismatch":"The version you deployed is not available yet. Your browser will refresh in 5 seconds.","autoexit.title":"Auto-ending session in ","autoexit.title_units":" seconds","autoexit.subtitle":"You have started another session.","autoexit.cancel":"CANCEL","presence.entered_room":"entered axon park.","presence.entered_lobby":"entered axon park's lobby.","presence.join_lobby":"joined the axon park lobby.","presence.join_room":"joined axon park.","presence.leave":"left.","presence.name_change":"is now known as","presence.scene_change":"changed the scene to","presence.hub_name_change":"changed the name of the room to","presence.in_lobby":"Axon Park Lobby","presence.in_room":"In Axon Park","home.create_a_room":"Initialize Axon Park","home.desktop.add_pwa":"Install Desktop App","home.mobile.add_pwa":"Add to Home Screen","home.take_a_tour":"Take a Tour","home.room_create_options":"options","home.room_create_button":"Initialize Axon Park","home.create_name.validation_warning":"Invalid name, limited to 4 to 64 characters and limited symbols.","home.join_us":"Join the Conversation","home.have_code":"Have an axon park code?","home.add_to_discord_1":"Add the","home.add_to_discord_2":"Hubs Bot","home.add_to_discord_3":"to Discord","home.create_with_spoke":"Create a Scene","home.report_issue":"Report Issues","home.source_link":"Source","home.whats_new_link":"What's New","home.spoke_link":"Spoke","home.about_link":"About","home.community_link":"Community","home.privacy_notice":"Privacy Notice","home.terms_of_use":"Terms of Use","home.get_updates":"Get Updates","home.hero_title":"A new way to get together","home.hero_blurb":a.c&&a.c.get("Motto")||"Learn together, from anywhere.\nThe future of learning is virtual.\nEqualizing access to premier quality education.","home.made_with_love":"made with 🦆 by ","home.environment_author_by":" by ","dialog.close":"close","mailing_list.privacy_label":"I'm okay with Mozilla handling my info as explained in","mailing_list.privacy_link":"this Privacy Notice","link.link_page_header_entry":"Enter your code:","link.link_page_header_headset":"Enter Send to Device code:","link.linking_a_headset":"Have a letter code?","link.try_again":"We couldn't find that code.\nPlease try again.","help.report_issue":"Report an Issue","scene.logo_tagline":"A new way to get together","scene.create_button":"Create a room with this scene","scene.tweet_button":"Share on Twitter","scene.unavailable":"This scene is no longer available.","link.in_your_browser":"In your device's web browser, go to:","link.enter_code":"Then, enter this one-time letter code:","link.do_not_close":"Your account and avatar will be transferred to the device.\nKeep this page open to use this code.","link.connect_headset":"Send to Device","link.cancel":"cancel","invite.enter_via":"Enter via ","invite.enter_via_modal":"Others may enter via ","invite.tweet":"tweet","invite.and_enter_code":" with code:","invite.or_visit":"or share permalink","invite.or_visit_modal":"or by visiting permalink","invite.embed":"or embed on a page","invite.embed-tip":"Please be mindful of where you embed a Hubs room.\nAnyone who can access the page can enter and create/remove objects.","spoke.primary_tagline":"make your space","spoke.secondary_tagline":"Create 3D social scenes for ","spoke.thank_you":"Thank you for downloading Spoke!","spoke.download_win":"Download for Windows","spoke.download_macos":"Download for Mac","spoke.download_linux":"Download for Linux","spoke.download_unsupported":"View Releases","spoke.browse_all_versions":"Browse All Versions","spoke.beginner_tutorial_button":"Learn Spoke in 5 Minutes","spoke.advanced_tutorial_button":"Advanced Spoke in 10 minutes","spoke.play_button":"Learn Spoke in 5 Minutes","commands.fly":"Toggle fly mode.","commands.grow":"Increase your avatar's size.","commands.shrink":"Decrease your avatar's size.","commands.scene":"Change the scene.","commands.rename":"Rename the room.","commands.help":"Show help.","commands.leave":"Disconnect from axon park.","commands.duck":"The duck tested well. Quack.","commands.capture":"Capture a 15 second video.","commands.debug":"Toggle physics debug rendering.","commands.vrstats":"Toggle stats in VR.","settings.change-avatar":"Set Name & Avatar","settings.change-scene":"Choose a Scene","settings.favorites":"Favorite Rooms","settings.rename-room":"Set Axon Park Name...","settings.close-room":"Close Axon Park...","settings.room-info":"Axon Park Info","settings.create-room":"New Axon Park...","settings.create-scene":"Get Spoke","settings.send-feedback":"Send Feedback","settings.whats-new":"What's New","settings.features":"Help","settings.controls":"Controls","settings.community":"Join Discord","settings.tips":"Show Tips","settings.report":"Report Issue","settings.terms":"Terms of Use","settings.privacy":"Privacy Notice","settings.help":"Help","settings.row-profile":"You","settings.row-room":"Axon Park","tips.mobile.video_share_mode":"Tap to stop sharing video.","tips.mobile.pen_mode":"Tap icon again to end drawing.","tips.mobile.mute_mode":"You are muted. Tap to unmute.","tips.mobile.freeze_mode":"Two-finger tap to hide menus.","tips.mobile.look":"Welcome! 👋 Tap and drag to look around.","tips.mobile.locomotion":"Great! To move, pinch with two fingers.","tips.mobile.spawn_menu-pre":"Use the ","tips.mobile.spawn_menu-post":"at the top to create objects.","tips.mobile.freeze_gesture":"Two-finger tap to show menus.","tips.mobile.object_grab":"Drag an object to move or throw it.","tips.mobile.object_rotate_button-pre":"Tap and drag ","tips.mobile.object_rotate_button-post":" to rotate.","tips.mobile.object_scale_button-pre":"Tap and drag ","tips.mobile.object_scale_button-post":" to scale.","tips.mobile.object_recenter_button-pre":"Tap ","tips.mobile.object_recenter_button-post":" to have the object face you.","tips.mobile.object_pin":"Pin an object to save it to axon park.","tips.mobile.object_pin":"Pin an object to save it to axon park.","tips.mobile.invite":"Use the Invite button to share axon park.","tips.desktop.video_share_mode":"You're streaming. Select again to stop sharing video.","tips.desktop.pen_mode":"Press ESC or right click to drop pen. Ctrl-Z to undo.","tips.desktop.mirror_mode":"Press ESC to end camera mirroring.","tips.desktop.mute_mode":"You are muted. Click or press M to un-mute.","tips.desktop.look":"Welcome to Hubs! 👋 Click and drag to look around.","tips.desktop.locomotion":"Great! Now, use the W A S D keys to move. Hold shift to boost.","tips.desktop.turning":"Perfect. Use the Q and E keys to rotate.","tips.desktop.spawn_menu-pre":"To create objects, click the ","tips.desktop.spawn_menu-post":"button at the top of the screen, or press Ctrl 1 through 7.","tips.desktop.freeze_gesture":"Press and hold spacebar to show object menus.","tips.desktop.menu_hover":"Now, point the cursor at an object to show the menu.","tips.desktop.object_grab":"Click and drag an object to move it. Or, flick to throw it!","tips.desktop.object_pin":"Pin an object to save it to axon park.","tips.desktop.object_zoom":"Scroll to move this object towards and away from you.","tips.desktop.object_rotate_button-pre":"Click and drag ","tips.desktop.object_rotate_button-post":" to rotate the object.","tips.desktop.object_scale_button-pre":"Click and drag ","tips.desktop.object_scale_button-post":" to scale the object.","tips.desktop.object_recenter_button-pre":"Click ","tips.desktop.object_recenter_button-post":" to rotate the object to face you. Helpful if you drop it!","tips.desktop.object_scale":"Hold shift and scroll to scale it bigger and smaller.","tips.desktop.pen_color":"Use Shift-Q and Shift-E to change the pen color.","tips.desktop.pen_size":"Hold Shift and scroll to change the pen size.","tips.desktop.invite":"Nobody else is here. Use the Share button at the top to share this room.","tips.desktop.watching":"You're in the lobby. Others cannot see or hear you.","tips.watching.back":"Enter Room","tips.mobile.watching":"You're in the lobby.","tips.watching-exit":"Back","loader.entering_lobby":"Entering lobby...","loader.loading":"Loading ","loader.object":"object","loader.objects":"objects","change-scene-dialog.change-scene":"Change Scene","change-scene-dialog.create-in-spoke":"Or, create a new scene using Spoke.","change-scene-dialog.new-spoke-project":"Launch Spoke","avatar-url-dialog.apply":"Apply","interstitial.prompt":"Continue","feedback.prompt":"Feedback","hide-ui.prompt":"Hide All","discord.primary_tagline":"Share a virtual room with your community.\nWatch videos, play with 3D objects, or just hang out.","discord.secondary_tagline":"No downloads or sign up. Full VR support too.","discord.contact_us":"Invite Bot to Server","discord.community_link":"Hubs Discord","discord.splash_tag":"Designed for serious businessing.","client-info.kick-button":"Kick","client-info.hide-button":"Hide","client-info.unhide-button":"Un-hide ","client-info.mute-button":"Mute","client-info.cancel":"Cancel","avatar-landing.select":"Select","avatar-landing.selected":"This is your current avatar","leave-room-dialog.join-room.message":"Joining a new room will leave this one. Are you sure?","leave-room-dialog.join-room.confirm":"Join Room","leave-room-dialog.create-room.message":"Creating a new room will leave this one. Are you sure?","leave-room-dialog.create-room.confirm":"Leave Room","embed.load-button":"Load Room","embed.presence-warning":"This room is embedded, so may be visible to visitors on other websites."}};i.d(t,"a",function(){return o}),i.d(t,"b",function(){return r});const s=(navigator.languages&&navigator.languages[0]||navigator.language||navigator.userLanguage).toLowerCase().split(/[_-]+/)[0],o=n[s]&&s||"en",r=n[o]||n.en},341:function(e,t,i){"use strict";var a=i(227),n=i.n(a),s=i(27);const o=new URLSearchParams(location.search),r=Object(s.a)("debug"),c=o.get("log_filter")||r&&"naf-janus-adapter:*";c&&n.a.enable(c)},35:function(e,t,i){"use strict";var a,n,s,o=i(62),r=i(10),c=i(202),l=i.n(c),d=i(41);function h(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}class u{constructor(e=THREE.DefaultLoadingManager){this.manager=e}load(e,t,i,a){const n=new THREE.Texture;return this.loadTextureAsync(n,e,i).then(t).catch(a),n}loadTextureAsync(e,t,i){var a,n=this;return(a=function*(){let a;void 0!==window.createImageBitmap?(a=new THREE.ImageBitmapLoader(n.manager),e.flipY=!1):a=new THREE.ImageLoader(n.manager),a.setCrossOrigin(n.crossOrigin),a.setPath(n.path);const s=n.manager.resolveURL(t);return e.image=yield function(e,t,i){return new Promise((a,n)=>e.load(t,a,i,n))}(a,t,i),THREE.Cache.remove(s),e.needsUpdate=!0,e.onUpdate=function(){e.image.close&&e.image.close(),delete e.image},e},function(){var e=this,t=arguments;return new Promise(function(i,n){var s=a.apply(e,t);function o(e){h(s,i,n,o,r,"next",e)}function r(e){h(s,i,n,o,r,"throw",e)}o(void 0)})})()}setCrossOrigin(e){return this.crossOrigin=e,this}setPath(e){return this.path=e,this}}s="anonymous",(n="crossOrigin")in(a=u)?Object.defineProperty(a,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):a[n]=s;var p=i(187);function m(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}function g(e){return function(){var t=this,i=arguments;return new Promise(function(a,n){var s=e.apply(t,i);function o(e){m(s,a,n,o,r,"next",e)}function r(e){m(s,a,n,o,r,"throw",e)}o(void 0)})}}i.d(t,"f",function(){return b}),i.d(t,"h",function(){return y}),i.d(t,"b",function(){return E}),i.d(t,"e",function(){return w}),i.d(t,"d",function(){return S}),i.d(t,"a",function(){return A}),i.d(t,"g",function(){return k}),i.d(t,"c",function(){return C});const v=Object(r.h)("/api/v1/media"),f=new Map,b=function(){var e=g(function*(e,t){const i=`${e}|${t}`;if(f.has(i))return f.get(i);const a=fetch(v,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({media:{url:e,index:t}})}).then(function(){var t=g(function*(t){if(!t.ok){const i=`Error resolving url "${e}":`;try{const e=yield t.text();throw new Error(i+" "+e)}catch(e){throw new Error(i+" "+t.statusText)}}return t.json()});return function(e){return t.apply(this,arguments)}}());return f.set(i,a),a});return function(t,i){return e.apply(this,arguments)}}(),y=(e,t)=>{const i=new FormData;return i.append("media",e),i.append("promotion_mode","with_token"),t&&i.append("desired_content_type",t),fetch(v,{method:"POST",body:i}).then(e=>e.json())};let _=0;const E=(e,t,i,a=null,n=!1,s=!1,r=!0)=>{const c=AFRAME.scenes[0],l=document.createElement("a-entity");l.id="interactable-media-"+_++,l.setAttribute("networked",{template:t});const d=e instanceof File;l.setAttribute("media-loader",{resize:s,resolve:n,animate:r,src:"string"==typeof e?e:"",contentSubtype:a,fileIsOwned:!d}),l.object3D.matrixNeedsUpdate=!0,c.appendChild(l);const h=setTimeout(()=>{c.emit("media-loading",{src:e})},100);["model-loaded","video-loaded","image-loaded"].forEach(t=>{l.addEventListener(t,g(function*(){clearTimeout(h),c.emit("media-loaded",{src:e})}),{once:!0})});const u=new Promise(function(t){d?function(e,t){const i=new FileReader;i.onload=function(e){const i=new DataView(e.target.result);if(65496!=i.getUint16(0,!1))return t(-2);const a=i.byteLength;let n=2;for(;n<a;){if(i.getUint16(n+2,!1)<=8)return t(-1);const e=i.getUint16(n,!1);if(n+=2,65505==e){if(1165519206!=i.getUint32(n+=2,!1))return t(-1);const e=18761==i.getUint16(n+=6,!1);n+=i.getUint32(n+4,e);const a=i.getUint16(n,e);n+=2;for(let s=0;s<a;s++)if(274==i.getUint16(n+12*s,e))return t(i.getUint16(n+12*s+8,e))}else{if(65280!=(65280&e))break;n+=i.getUint16(n,!1)}}return t(-1)},i.readAsArrayBuffer(e)}(e,e=>{t(e)}):t(1)});if(d){y(e,"video-camera"===a?"video/mp4":null).then(e=>{const t=new URL(e.raw);t.searchParams.set("token",e.meta.access_token),l.setAttribute("media-loader",{resolve:!1,src:t.href,fileId:e.file_id}),window.APP.store.update({uploadPromotionTokens:[{fileId:e.file_id,promotionToken:e.meta.promotion_token}]})}).catch(e=>{console.error("Media upload failed",e),l.setAttribute("media-loader",{src:"error"})})}else e instanceof MediaStream&&l.setAttribute("media-loader",{src:`hubs://clients/${NAF.clientId}/video`});return i&&l.addEventListener("media_resolved",({detail:e})=>{const t=Object(o.c)(i,e.contentType,e.src);c.emit("object_spawned",{objectType:t})}),{entity:l,orientation:u}};function w(e){const t=/\bskinning_vertex\b/,i=/\bgl_FragColor\b/,a=[],n=AFRAME.scenes[0].systems["hubs-systems"].batchManagerSystem;return e.traverse(s=>{s.material&&(s.material=Object(d.b)(s,o=>{if(!p.a.includes(o.type))return o;if(s.el.classList.contains("ui")||s.el.classList.contains("hud")||s.el.getAttribute("text-button"))return o;n.meshToEl.set(s,e.el);const r=o.clone();return r.onBeforeCompile=e=>{if(!t.test(e.vertexShader))return;e.uniforms.hubs_IsFrozen={value:!1},e.uniforms.hubs_EnableSweepingEffect={value:!1},e.uniforms.hubs_SweepParams={value:[0,0]},e.uniforms.hubs_InteractorOnePos={value:[0,0,0]},e.uniforms.hubs_InteractorTwoPos={value:[0,0,0]},e.uniforms.hubs_HighlightInteractorOne={value:!1},e.uniforms.hubs_HighlightInteractorTwo={value:!1},e.uniforms.hubs_Time={value:0};const n=e.vertexShader.split("\n"),s=n.findIndex(e=>t.test(e));n.splice(s+1,0,"\n        if (hubs_HighlightInteractorOne || hubs_HighlightInteractorTwo || hubs_IsFrozen) {\n          vec4 wt = modelMatrix * vec4(transformed, 1);\n\n          // Used in the fragment shader below.\n          hubs_WorldPosition = wt.xyz;\n        }\n      "),n.unshift("varying vec3 hubs_WorldPosition;"),n.unshift("uniform bool hubs_IsFrozen;"),n.unshift("uniform bool hubs_HighlightInteractorOne;"),n.unshift("uniform bool hubs_HighlightInteractorTwo;"),e.vertexShader=n.join("\n");const o=e.fragmentShader.split("\n"),r=o.findIndex(e=>i.test(e));o.splice(r+1,0,l.a),o.unshift("varying vec3 hubs_WorldPosition;"),o.unshift("uniform bool hubs_IsFrozen;"),o.unshift("uniform bool hubs_EnableSweepingEffect;"),o.unshift("uniform vec2 hubs_SweepParams;"),o.unshift("uniform bool hubs_HighlightInteractorOne;"),o.unshift("uniform vec3 hubs_InteractorOnePos;"),o.unshift("uniform bool hubs_HighlightInteractorTwo;"),o.unshift("uniform vec3 hubs_InteractorTwoPos;"),o.unshift("uniform float hubs_Time;"),e.fragmentShader=o.join("\n"),a.push(e.uniforms)},r.needsUpdate=!0,r}))}),a}function S(e){return window.APP.store.state.uploadPromotionTokens.find(t=>t.fileId===e)}const x=new THREE.Vector3;function A(e,t,i,a,n=!1){const{entity:s,orientation:o}=E(t,"#interactable-media",void 0,i,!1),r=e.object3D.position;s.object3D.position.set(r.x,r.y,r.z),s.object3D.rotation.copy(e.object3D.rotation),n&&s.object3D.rotateY(Math.PI);const c=a%6+3;x.set(.75*Math.cos(2*Math.PI*(c/6)),.75*Math.sin(2*Math.PI*(c/6)),.001*c-.05),e.object3D.localToWorld(x),s.object3D.visible=!1;const l=()=>{s.object3D.visible=!0,s.setAttribute("animation__photo_pos",{property:"position",dur:800,from:{x:r.x,y:r.y,z:r.z},to:{x:x.x,y:x.y,z:x.z},easing:"easeOutElastic"})};let d=null;if(i.startsWith("photo"))s.addEventListener("image-loaded",l,{once:!0}),d="photo";else{if(!i.startsWith("video"))return void console.error("invalid type "+i);s.addEventListener("video-loaded",l,{once:!0}),d="video"}return s.object3D.matrixNeedsUpdate=!0,s.addEventListener("media_resolved",()=>{e.emit(`${d}_taken`,s.components["media-loader"].data.src)},{once:!0}),{entity:s,orientation:o}}const k=(new u).setCrossOrigin("anonymous");function C(e){return T.apply(this,arguments)}function T(){return(T=g(function*(e){const t=new THREE.Texture;try{yield k.loadTextureAsync(t,e)}catch(t){throw new Error(`'${e}' could not be fetched (Error code: ${t.status}; Response: ${t.statusText})`)}return t.encoding=THREE.sRGBEncoding,t.anisotropy=4,t})).apply(this,arguments)}},374:function(e,t,i){"use strict";i.d(t,"a",function(){return c});var a=i(590),n=i.n(a);function s(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}function o(e){return function(){var t=this,i=arguments;return new Promise(function(a,n){var o=e.apply(t,i);function r(e){s(o,a,n,r,c,"next",e)}function c(e){s(o,a,n,r,c,"throw",e)}r(void 0)})}}function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class c{constructor(e){var t=this;r(this,"setSocket",e=>{this.socket=e}),r(this,"signOut",function(){var e=o(function*(e){e&&(yield e.signOut()),t.store.update({credentials:{token:null,email:null}}),t.store.resetToRandomLegacyAvatar(),t._signedIn=!1});return function(t){return e.apply(this,arguments)}}()),this.store=e,this.socket=null,this._signedIn=!!this.store.state.credentials.token}get email(){return this.store.state.credentials.email}get signedIn(){return this._signedIn}verifyAuthentication(e,t,i){var a=this;const n=this.socket.channel(e);return new Promise((e,s)=>n.join().receive("ok",()=>{n.on("auth_credentials",function(){var t=o(function*({credentials:t,payload:i}){yield a.handleAuthCredentials(i.email,t),e()});return function(e){return t.apply(this,arguments)}}()),n.push("auth_verified",{token:t,payload:i})}).receive("error",s))}startAuthentication(e,t){var i=this;return o(function*(){const a=i.socket.channel(`auth:${n()()}`);yield new Promise((e,t)=>a.join().receive("ok",e).receive("error",t));const s=new Promise(n=>a.on("auth_credentials",function(){var a=o(function*({credentials:a}){yield i.handleAuthCredentials(e,a,t),n()});return function(e){return a.apply(this,arguments)}}()));return a.push("auth_request",{email:e,origin:"hubs"}),{authComplete:s}})()}handleAuthCredentials(e,t,i){var a=this;return o(function*(){a.store.update({credentials:{email:e,token:t}}),i&&(yield i.signIn(t)),a._signedIn=!0})()}}},375:function(e,t,i){"use strict";function a(e){e.components["animation-mixer"]&&(e.querySelector("[loop-animation]")||e.setAttribute("loop-animation",""))}i.d(t,"a",function(){return a})},40:function(e,t,i){"use strict";i.d(t,"b",function(){return n}),i.d(t,"c",function(){return s}),i.d(t,"a",function(){return r}),i.d(t,"d",function(){return c});const a=new THREE.Vector3;new THREE.Quaternion;function n(e,t){return e.updateMatrices(),t.setFromMatrixPosition(e.matrixWorld),t}function s(e,t){return e.updateMatrices(),e.matrixWorld.decompose(a,t,a),t}function o(e){e.map&&e.map.dispose(),e.lightMap&&e.lightMap.dispose(),e.bumpMap&&e.bumpMap.dispose(),e.normalMap&&e.normalMap.dispose(),e.specularMap&&e.specularMap.dispose(),e.envMap&&e.envMap.dispose(),e.dispose()}function r(e){if(e instanceof THREE.Mesh&&(e.geometry&&e.geometry.dispose(),e.material)){let t;e.material instanceof THREE.MeshFaceMaterial||e.material instanceof THREE.MultiMaterial?t=e.material.materials:e.material instanceof Array&&(t=e.material),t?t.forEach(o):o(e.material)}}function c(e,t){e.matrixWorld.copy(t),e.matrix=e.matrix.getInverse(e.parent.matrixWorld).multiply(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale)}},41:function(e,t,i){"use strict";function a(e,t){e.material&&(Array.isArray(e.material)?e.material.forEach(t):t(e.material))}function n(e,t){if(e.material)return Array.isArray(e.material)?e.material.map(t):t(e.material)}i.d(t,"a",function(){return a}),i.d(t,"b",function(){return n})},512:function(e,t,i){"use strict";function a(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}function n(e){return function(){var t=this,i=arguments;return new Promise(function(n,s){var o=e.apply(t,i);function r(e){a(o,n,s,r,c,"next",e)}function c(e){a(o,n,s,r,c,"throw",e)}r(void 0)})}}i.d(t,"a",function(){return c});const s=(e,t,i)=>{let a=0;for(let t=0;t<e.length;t++){const i=(e[t]-128)/128;a+=i*i}let n=Math.sqrt(a/e.length);return n<.01&&(n=0),t*n+(1-t)*i},o=new THREE.Vector3,r=new THREE.Vector3;function c(e,t,i,a,n){r.setFromMatrixPosition(t.matrixWorld),o.setFromMatrixPosition(e.matrixWorld);const s=o.distanceTo(r)/10;return Math.min(a,i+(a-i)*n*8*s)}AFRAME.registerComponent("networked-audio-analyser",{init(){var e=this;return n(function*(){e.volume=0,e.prevVolume=0,e.smoothing=.3,e._updateAnalysis=e._updateAnalysis.bind(e),e._runScheduledWork=e._runScheduledWork.bind(e),e.el.sceneEl.systems["frame-scheduler"].schedule(e._updateAnalysis,"audio-analyser"),e.el.addEventListener("sound-source-set",t=>{const i=THREE.AudioContext.getContext();e.analyser=i.createAnalyser(),e.analyser.fftSize=32,e.levels=new Uint8Array(e.analyser.frequencyBinCount),t.detail.soundSource.connect(e.analyser)})})()},remove:function(){this.el.sceneEl.systems["frame-scheduler"].unschedule(this._runScheduledWork,"audio-analyser")},tick:function(e){this.avatarIsQuiet||this._updateAnalysis(e)},_runScheduledWork:function(){this.avatarIsQuiet&&this._updateAnalysis()},_updateAnalysis:function(e){this.analyser&&(this.analyser.getByteTimeDomainData(this.levels),this.volume=s(this.levels,this.smoothing,this.prevVolume),this.prevVolume=this.volume,this.volume<1e-5?e&&this.lastSeenVolume&&this.lastSeenVolume<e-1e4&&(this.avatarIsQuiet=!0):(e&&(this.lastSeenVolume=e),this.avatarIsQuiet=!1))}}),AFRAME.registerSystem("local-audio-analyser",{schema:{analyze:{default:!1}},init(){var e=this;return n(function*(){e.volume=0,e.prevVolume=0,e.smoothing=.3})()},update(){var e=this;return n(function*(){if(e.data.analyze){if(!e.stream){if(e.stream=yield NAF.connection.adapter.getMediaStream(NAF.clientId,"audio"),!e.stream||0===e.stream.getAudioTracks().length)return;const t=THREE.AudioContext.getContext(),i=t.createMediaStreamSource(e.stream);e.analyser=t.createAnalyser(),e.analyser.fftSize=32,e.levels=new Uint8Array(e.analyser.frequencyBinCount),i.connect(e.analyser)}}else e.stream=e.analyser=null})()},tick:function(){this.analyser&&this.data.analyze&&this.stream&&(this.analyser.getByteTimeDomainData(this.levels),this.volume=s(this.levels,this.smoothing,this.prevVolume),this.prevVolume=this.volume)}}),AFRAME.registerComponent("scale-audio-feedback",{schema:{minScale:{default:1},maxScale:{default:2}},init(){this._playerCamera=document.getElementById("player-camera").object3D},tick(){if(!this.el.object3D.visible)return;const{minScale:e,maxScale:t}=this.data,i=this.el.components["networked-audio-analyser"];if(!i)return;const{object3D:a}=this.el,n=c(this.el.object3D,this._playerCamera,e,t,i.volume);a.scale.setScalar(n),a.matrixNeedsUpdate=!0}})},514:function(e,t,i){"use strict";function a(e){if(!e)return"";const t=e.split("@"),i=t[0],a=t[1];return`${i.substring(0,Math.min(i.length,3))}...@${a}`}i.d(t,"a",function(){return a})},515:function(e,t,i){"use strict";var a=i(0),n=i.n(a),s=i(1),o=i.n(s),r=i(3),c=i.n(r),l=i(412),d=i.n(l),h=i(591),u=i.n(h),p=i(4),m=i(15),g=i(592),v=i(400),f=i(593),b=i(231),y=i(214),_=i(2372),E=i.n(_),w=i(16),S=i(151);function x(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}d.a.extend(u.a);const A={sketchfab_model:"Sketchfab",poly_model:"Google Poly",twitch_stream:"Twitch"};class k extends a.Component{constructor(...e){super(...e),x(this,"getTileDimensions",(e,t,i)=>{const a=window.innerWidth;let n,s=a<1079?a<768?a<400?85:100:150:200;return t&&(s=Math.floor(1.5*s)),[n=e?Math.floor(Math.max(i*s,.85*s)):t?Math.floor(9/16*s):Math.floor(Math.max(16/9*s,.85*s)),s]}),x(this,"entryToTile",(e,t)=>{const i=e.images.preview.url,a=e.attributions&&e.attributions.creator,s=e.type.endsWith("_image"),o=["avatar","avatar_listing"].includes(e.type),r=["hub"].includes(e.type),l=e.images.preview.width/e.images.preview.height,[h,u]=this.getTileDimensions(s,o,l),g=e.attributions&&e.attributions.publisher&&e.attributions.publisher.name||A[e.type];return n.a.createElement("div",{style:{width:`${h}px`},className:E.a.tile,key:`${e.id}_${t}`},n.a.createElement("a",{href:e.url,rel:"noreferrer noopener",onClick:t=>this.props.handleEntryClicked&&this.props.handleEntryClicked(t,e),className:E.a.tileLink,style:{width:`${h}px`,height:`${u}px`}},n.a.createElement("img",{className:c()(E.a.tileContent,E.a.avatarTile),src:Object(w.h)(i,h,u)})),"avatar"===e.type&&n.a.createElement(S.a,{className:E.a.editAvatar,stateKey:"overlay",stateValue:"avatar-editor",stateDetail:{avatarId:e.id},history:this.props.history},n.a.createElement(m.a,{icon:b.faPencilAlt})),!e.type.endsWith("_image")&&n.a.createElement("div",{className:E.a.info},n.a.createElement("a",{href:e.url,rel:"noreferrer noopener",className:E.a.name,onClick:t=>this.props.handleEntryClicked&&this.props.handleEntryClicked(t,e)},e.name||" "),!o&&!r&&n.a.createElement("div",{className:E.a.attribution},n.a.createElement("div",{className:E.a.creator},a&&void 0===a.name&&n.a.createElement("span",null,a),a&&a.name&&!a.url&&n.a.createElement("span",null,a.name),a&&a.name&&a.url&&n.a.createElement("a",{href:a.url,target:"_blank",rel:"noopener noreferrer"},a.name)),g&&n.a.createElement("div",{className:E.a.publisher},n.a.createElement("i",null,n.a.createElement(m.a,{icon:f.faExternalLinkAlt}))," ",n.a.createElement("a",{href:e.url,target:"_blank",rel:"noopener noreferrer"},g))),r&&n.a.createElement("div",{className:E.a.attribution},n.a.createElement("div",{className:E.a.lastJoined},n.a.createElement(p.a,{id:"media-browser.hub.joined-prefix"}),d()(e.last_activated_at).fromNow()))))})}render(){const{urlSource:e,result:t}=this.props,i=t&&t.entries||[],[a,s]=this.getTileDimensions(!1,"avatars"===e),o=new URLSearchParams((this.props.history?this.props.history.location:location).search),r=!(!t||!t.meta),l=r&&t.meta.source||null,d=t&&["bing_images","tenor"].includes(l),h=!(!r||!t.meta.next_cursor)||!1,u=o.get("cursor");return n.a.createElement("div",{className:E.a.body},n.a.createElement("div",{className:c()({[E.a.tiles]:!0,[E.a.tilesVariable]:d})},("avatars"===e||"scenes"===e)&&n.a.createElement("div",{style:{width:`${a}px`,height:`${s}px`},className:c()(E.a.tile,E.a.createTile)},"scenes"===e?n.a.createElement("a",{href:"/spoke/new",rel:"noopener noreferrer",target:"_blank",className:E.a.tileLink},n.a.createElement("div",{className:E.a.tileContent},n.a.createElement(m.a,{icon:y.faPlus}),n.a.createElement(p.a,{id:"media-browser.create-scene"}))):n.a.createElement("a",{onClick:e=>{e.preventDefault(),window.dispatchEvent(new CustomEvent("action_create_avatar"))},className:E.a.tileLink},n.a.createElement("div",{className:E.a.tileContent},n.a.createElement(m.a,{icon:y.faPlus}),n.a.createElement(p.a,{id:"media-browser.create-avatar"})))),i.map(this.entryToTile)),t&&(h||u)&&this.props.handlePager&&n.a.createElement("div",{className:E.a.pager},n.a.createElement("a",{className:c()({[E.a.previousPage]:!0,[E.a.pagerButtonDisabled]:!u}),onClick:()=>this.props.handlePager(-1)},n.a.createElement(m.a,{icon:g.faAngleLeft})),n.a.createElement("div",{className:E.a.pageNumber},t.meta.page),n.a.createElement("a",{className:c()({[E.a.nextPage]:!0,[E.a.pagerButtonDisabled]:!h}),onClick:()=>this.props.handlePager(1)},n.a.createElement(m.a,{icon:v.faAngleRight}))))}}x(k,"propTypes",{result:o.a.object,history:o.a.object,urlSource:o.a.string,handleEntryClicked:o.a.func,handlePager:o.a.func}),t.a=k},516:function(e,t,i){"use strict";i.d(t,"a",function(){return n});const a=AFRAME.THREE;function n(){if(/Android.+Firefox/.test(navigator.userAgent)){const e=WebGLRenderingContext.prototype.getExtension,t=function(){const e=new a.WebGLRenderer,t=new a.Scene,i=new Float32Array(16),n=new a.DataTexture(i,2,2,a.RGBAFormat,a.FloatType),s=new a.Mesh(new a.PlaneBufferGeometry(1,1),new a.MeshBasicMaterial({map:n}));s.material.map.needsUpdate=!0,t.add(s),e.render(t,new a.Camera);const o=0===e.context.getError();return e.dispose(),o}();WebGLRenderingContext.prototype.getExtension=function(i){return"OES_texture_float"!==i||t?e.call(this,i):null}}}},517:function(e,t,i){e.exports=i.p+"assets/LoadingObject_Atom-7dcc3b81897e68b740c1cf12b6cf4c3f.glb"},518:function(e,t,i){e.exports=i.p+"assets/sfx/teleport-loop-84e2caa4f62e5c6d6ce339b0c715c06d.mp3"},519:function(e,t,i){e.exports=i.p+"assets/sfx/quickTurn-cda89edb1a7a32e4442cac70cd2694be.mp3"},520:function(e,t,i){e.exports=i.p+"assets/sfx/tap_mellow-673398d6e97818ec4b675708d460bd0f.mp3"},521:function(e,t,i){e.exports=i.p+"assets/sfx/PenSpawn-aac1f534773040f0fafa41e9db76017b.mp3"},522:function(e,t,i){e.exports=i.p+"assets/sfx/PenDraw1-ddbdc17a6beefecbca2685c8c9d0d2d5.mp3"},523:function(e,t,i){e.exports=i.p+"assets/sfx/PicSnapHey-0228ddd197e5a6d88f7bcd2ceb340f8e.mp3"},524:function(e,t,i){e.exports=i.p+"assets/sfx/welcome-0083300978d5dd05eaa376f65761da47.mp3"},525:function(e,t,i){e.exports=i.p+"assets/sfx/quack-1f18502834f8f1db43990b769c2ab193.mp3"},526:function(e,t,i){e.exports=i.p+"assets/sfx/specialquack-6d1a192a6092e8dfed5d3de063755ee2.mp3"},527:function(e,t,i){e.exports=i.p+"assets/sfx/pop-5784f3bcfaf98637147737448d6df8df.mp3"},528:function(e,t,i){e.exports=i.p+"assets/sfx/Eb_blip-8d7302990e83d6798400a6027dce3936.mp3"},529:function(e,t,i){e.exports=i.p+"assets/sfx/tack-0d55b064794faaa1733fcf6bc89cad0c.mp3"},530:function(e,t,i){e.exports=i.p+"assets/sfx/A_bendUp-de32e556413bb2a527fb514984738c70.mp3"},531:function(e,t,i){e.exports=i.p+"assets/sfx/suspense-f27c64840e5ede36ec694c22a030615c.mp3"},532:function(e,t,i){e.exports=i.p+"assets/waternormals-4418dde3f6abc21dc32506acf5f5b093.jpg"},54:function(e,t,i){"use strict";var a=i(168),n=i(114),s=i(86),o=i.n(s),r=i(143),c=i.n(r),l=i(82),d=i(72);const h=["Baers-Pochard","Baikal-Teal","Barrows-Goldeneye","Blue-Billed","Blue-Duck","Blue-Winged","Brown-Teal","Bufflehead","Canvasback","Cape-Shoveler","Chestnut-Teal","Chiloe-Wigeon","Cinnamon-Teal","Comb-Duck","Common-Eider","Common-Goldeneye","Common-Merganser","Common-Pochard","Common-Scoter","Common-Shelduck","Cotton-Pygmy","Crested-Duck","Crested-Shelduck","Eatons-Pintail","Falcated","Ferruginous","Freckled-Duck","Gadwall","Garganey","Greater-Scaup","Green-Pygmy","Grey-Teal","Hardhead","Harlequin","Hartlaubs","Hooded-Merganser","Hottentot-Teal","Kelp-Goose","King-Eider","Lake-Duck","Laysan-Duck","Lesser-Scaup","Long-Tailed","Maccoa-Duck","Mallard","Mandarin","Marbled-Teal","Mellers-Duck","Merganser","Northern-Pintail","Orinoco-Goose","Paradise-Shelduck","Plumed-Whistler","Puna-Teal","Pygmy-Goose","Radjah-Shelduck","Red-Billed","Red-Crested","Red-Shoveler","Ring-Necked","Ringed-Teal","Rosy-Billed","Ruddy-Shelduck","Salvadoris-Teal","Scaly-Sided","Shelduck","Shoveler","Silver-Teal","Smew","Spectacled-Eider","Spot-Billed","Spotted-Whistler","Steamerduck","Stellers-Eider","Sunda-Teal","Surf-Scoter","Tufted-Duck","Velvet-Scoter","Wandering-Whistler","Whistling-duck","White-Backed","White-Cheeked","White-Winged","Wigeon","Wood-Duck","Yellow-Billed"];function u(e){return e[Math.floor(Math.random()*e.length)]}const p=d.a.map(e=>e.id);function m(){return{avatarId:u(p)}}function g(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},a=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),a.forEach(function(t){v(e,t,i[t])})}return e}function v(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.d(t,"a",function(){return E}),i.d(t,"b",function(){return w});const f="___hubs_store",b=Symbol(),y="ret-oauth-flow-account-credentials",_=new a.Validator,E={id:"/HubsStore",definitions:{profile:{type:"object",additionalProperties:!1,properties:{displayName:{type:"string",pattern:"^[A-Za-z0-9-]{3,32}$"},avatarId:{type:"string"},personalAvatarId:{type:"string"}}},credentials:{type:"object",additionalProperties:!1,properties:{token:{type:["null","string"]},email:{type:["null","string"]}}},activity:{type:"object",additionalProperties:!1,properties:{hasFoundFreeze:{type:"boolean"},hasChangedName:{type:"boolean"},hasAcceptedProfile:{type:"boolean"},lastEnteredAt:{type:"string"},hasPinned:{type:"boolean"},hasRotated:{type:"boolean"},hasRecentered:{type:"boolean"},hasScaled:{type:"boolean"},hasHoveredInWorldHud:{type:"boolean"},hasOpenedShare:{type:"boolean"},entryCount:{type:"number"}}},settings:{type:"object",additionalProperties:!1,properties:{lastUsedMicDeviceId:{type:"string"}}},confirmedDiscordRooms:{type:"array",items:{type:"string"}},confirmedBroadcastedRooms:{type:"array",items:{type:"string"}},uploadPromotionTokens:{type:"array",items:{type:"object",additionalProperties:!1,properties:{fileId:{type:"string"},promotionToken:{type:"string"}}}},creatorAssignmentTokens:{type:"array",items:{type:"object",additionalProperties:!1,properties:{hubId:{type:"string"},creatorAssignmentToken:{type:"string"}}}},embedTokens:{type:"array",items:{type:"object",additionalProperties:!1,properties:{hubId:{type:"string"},embedToken:{type:"string"}}}},onLoadActions:{type:"array",items:{type:"object",additionalProperties:!1,properties:{action:{type:"string"},args:{type:"object"}}}}},type:"object",properties:{profile:{$ref:"#/definitions/profile"},credentials:{$ref:"#/definitions/credentials"},activity:{$ref:"#/definitions/activity"},settings:{$ref:"#/definitions/settings"},confirmedDiscordRooms:{$ref:"#/definitions/confirmedDiscordRooms"},confirmedBroadcastedRooms:{$ref:"#/definitions/confirmedBroadcastedRooms"},uploadPromotionTokens:{$ref:"#/definitions/uploadPromotionTokens"},creatorAssignmentTokens:{$ref:"#/definitions/creatorAssignmentTokens"},embedTokens:{$ref:"#/definitions/embedTokens"},onLoadActions:{$ref:"#/definitions/onLoadActions"}},additionalProperties:!1};class w extends l.a{constructor(){super(),v(this,"init",()=>{this.update({profile:g({},m(),this.state.profile||{})}),this.state.activity.hasChangedName||this.update({profile:{displayName:`${u(h)}-${Math.floor(1e4+1e4*Math.random())}`}})}),v(this,"resetToRandomLegacyAvatar",()=>{this.update({profile:g({},this.state.profile||{},m())})}),null===localStorage.getItem(f)&&localStorage.setItem(f,JSON.stringify({})),window.addEventListener("storage",e=>{e.key===f&&(delete this[b],this.dispatchEvent(new CustomEvent("statechanged")))}),this.update({activity:{},settings:{},credentials:{},profile:{},confirmedDiscordRooms:[],confirmedBroadcastedRooms:[],uploadPromotionTokens:[],creatorAssignmentTokens:[],embedTokens:[],onLoadActions:[]});const e=o.a.getJSON(y);e&&(this.update({credentials:e}),this.resetToRandomLegacyAvatar(),o.a.remove(y))}get state(){return this.hasOwnProperty(b)||(this[b]=JSON.parse(localStorage.getItem(f))),this[b]}get credentialsAccountId(){return this.state.credentials.token?c()(this.state.credentials.token).sub:null}resetConfirmedBroadcastedRooms(){this.clearStoredArray("confirmedBroadcastedRooms")}resetTipActivityFlags(){this.update({activity:{hasRotated:!1,hasPinned:!1,hasRecentered:!1,hasScaled:!1,entryCount:0}})}bumpEntryCount(){const e=this.state.activity.entryCount||0;this.update({activity:{entryCount:e+1}})}enqueueOnLoadAction(e,t){this.update({onLoadActions:[{action:e,args:t}]})}executeOnLoadActions(e){for(let t=0;t<this.state.onLoadActions.length;t++){const{action:i,args:a}=this.state.onLoadActions[t];"emit_scene_event"===i&&e.emit(a.event,a.detail)}this.clearOnLoadActions()}clearOnLoadActions(){this.clearStoredArray("onLoadActions")}clearStoredArray(e){const t={};t[e]=[],this.update(t,{arrayMerge:(e,t)=>t})}update(e,t){const i=Object(n.default)(this.state,e,t),{valid:a}=_.validate(i,E);if(!a)throw new Error("Write to store failed schema validation.");return localStorage.setItem(f,JSON.stringify(i)),delete this[b],void 0!==e.profile&&this.dispatchEvent(new CustomEvent("profilechanged")),this.dispatchEvent(new CustomEvent("statechanged")),i}}},549:function(e,t,i){"use strict";function a(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}function n(e){return function(){var t=this,i=arguments;return new Promise(function(n,s){var o=e.apply(t,i);function r(e){a(o,n,s,r,c,"next",e)}function c(e){a(o,n,s,r,c,"throw",e)}r(void 0)})}}function s(e,t){return o.apply(this,arguments)}function o(){return(o=n(function*(e,t){return crypto.subtle.deriveKey({name:"ECDH",public:t},e,{name:"AES-CBC",length:256},!0,["encrypt","decrypt"])})).apply(this,arguments)}function r(e){return c.apply(this,arguments)}function c(){return(c=n(function*(e){return JSON.stringify(yield crypto.subtle.exportKey("jwk",e))})).apply(this,arguments)}function l(e){return d.apply(this,arguments)}function d(){return(d=n(function*(e){return yield crypto.subtle.importKey("jwk",JSON.parse(e),{name:"ECDH",namedCurve:"P-256"},!0,[])})).apply(this,arguments)}function h(e){const t=new Uint8Array(e.length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}function u(e){const t=new Uint8Array(e);let i="";for(let e=0;e<t.byteLength;e++)i+=String.fromCharCode(t[e]);return i}function p(){return(p=n(function*(){const e=yield crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]);return{publicKeyString:yield r(e.publicKey),privateKey:e.privateKey}})).apply(this,arguments)}function m(){return(m=n(function*(e,t){const i=new Uint8Array(16),a=yield l(e),n=yield crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]),o=yield r(n.publicKey),c=yield s(n.privateKey,a);return{publicKeyString:o,encryptedData:btoa(u(yield crypto.subtle.encrypt({name:"AES-CBC",iv:i},c,h(JSON.stringify(t)))))}})).apply(this,arguments)}function g(){return(g=n(function*(e,t,i){const a=new Uint8Array(16),n=yield l(e),o=yield s(t,n),r=h(atob(i)),c=yield crypto.subtle.decrypt({name:"AES-CBC",iv:a},o,r);return JSON.parse(u(c))})).apply(this,arguments)}function v(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},a=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),a.forEach(function(t){f(e,t,i[t])})}return e}function f(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.d(t,"a",function(){return y});const b=1e4;class y{constructor(e){f(this,"setSocket",e=>{this.socket=e}),f(this,"generateCode",()=>new Promise(e=>{const t=new Promise(i=>{const a=()=>{const n=()=>"ABCDEFGHI"[Math.floor(9*Math.random())],s=`${n()}${n()}${n()}${n()}`;let o=!1,r=!1;const c=this.socket.channel(`link:${s}`,{timeout:b}),l=()=>{r||c.leave(),r=!0},d=()=>l();c.on("link_expired",()=>i("expired")),c.on("presence_state",i=>{o||(Object.keys(i).length>0?a():(o=!0,e({code:s,cancel:d,onFinished:t})))}),c.on("link_request",e=>{if(o){const t={path:location.pathname};this.store.state.activity.hasChangedName&&(t.profile=v({},this.store.state.profile)),t.credentials=v({},this.store.state.credentials),function(e,t){return m.apply(this,arguments)}(e.public_key,t).then(({publicKeyString:t,encryptedData:a})=>{const n={target_session_id:e.reply_to_session_id,public_key:t,data:a};r||c.push("link_response",n),l(),i("used"),o=!1})}}),c.join().receive("error",e=>console.error(e))};a()})})),f(this,"attemptLink",e=>new Promise((t,i)=>{const a=this.socket.channel(`link:${e}`,{timeout:b});let n=!1;(function(){return p.apply(this,arguments)})().then(({publicKeyString:e,privateKey:s})=>{a.on("presence_state",t=>{const s=Object.keys(t).length;1===s?(a.push("link_request",{reply_to_session_id:this.socket.params().session_id,public_key:e}),setTimeout(()=>{n||(a.leave(),i(new Error("no_response")))},b)):0===s?(a.leave(),i(new Error("failed"))):(console.warn("link code channel already has 2 or more occupants, something fishy is going on."),a.leave(),i(new Error("in_use")))}),a.on("link_response",e=>{n=!0,a.leave(),function(e,t,i){return g.apply(this,arguments)}(e.public_key,s,e.data).then(t)}),a.join().receive("ok",e=>this.socket.params().session_id=e.session_id).receive("error",e=>console.error(e))})})),this.store=e}}},56:function(e,t,i){"use strict";i.d(t,"b",function(){return l}),i.d(t,"a",function(){return d});var a=i(83),n=i.n(a),s=i(120);const{detect:o}=i(140),r=o();let c=!1;function l(e){if(!window.AFRAME)return;const t=AFRAME.utils.device.isMobile();n.a.isFullscreen&&!AFRAME.utils.device.isMobileVR()&&"firefox"===r.name&&(c=!0,n.a.exit().then(()=>{e.focus()})),t||e.select()}function d(){c?c=!1:Object(s.b)()}},594:function(e,t,i){e.exports=i.p+"assets/images/mic_denied-5ce12e4dc9b5eb42ce69b753c46c2174.png"},595:function(e,t,i){e.exports=i.p+"assets/images/mic_denied@2x-127a94ff73b93a0b4ac89682ce836b91.png"},62:function(e,t,i){"use strict";i.d(t,"a",function(){return a}),i.d(t,"b",function(){return n}),i.d(t,"c",function(){return c});const a={URL:1,FILE:2,CLIPBOARD:3,SPAWNER:4},n={URL_IMAGE:0,URL_VIDEO:1,URL_MODEL:2,URL_PDF:3,URL_AUDIO:4,FILE_IMAGE:8,FILE_VIDEO:9,FILE_MODEL:10,FILE_PDF:11,FILE_AUDIO:12,CLIPBOARD_IMAGE:16,CLIPBOARD_VIDEO:17,CLIPBOARD_MODEL:18,CLIPBOARD_PDF:19,CLIPBOARD_AUDIO:20,SPAWNER_IMAGE:24,SPAWNER_VIDEO:25,SPAWNER_MODEL:26,SPAWNER_PDF:27,SPAWNER_AUDIO:28,CAMERA:30,UNKNOWN:31};function s(e,t,i,n,s){return e===a.URL?t:e===a.FILE?i:e===a.CLIPBOARD?n:s}const o={"image/":[n.URL_IMAGE,n.FILE_IMAGE,n.CLIPBOARD_IMAGE,n.SPAWNER_IMAGE],"model/":[n.URL_MODEL,n.FILE_MODEL,n.CLIPBOARD_MODEL,n.SPAWNER_MODEL],"application/x-zip-compressed":[n.URL_MODEL,n.FILE_MODEL,n.CLIPBOARD_MODEL,n.SPAWNER_MODEL],"video/":[n.URL_VIDEO,n.FILE_VIDEO,n.CLIPBOARD_VIDEO,n.SPAWNER_VIDEO],"application/vnd.apple.mpegurl":[n.URL_VIDEO,n.FILE_VIDEO,n.CLIPBOARD_VIDEO,n.SPAWNER_VIDEO],"application/x-mpegurl":[n.URL_VIDEO,n.FILE_VIDEO,n.CLIPBOARD_VIDEO,n.SPAWNER_VIDEO],"audio/":[n.URL_AUDIO,n.FILE_AUDIO,n.CLIPBOARD_AUDIO,n.SPAWNER_AUDIO],"application/pdf":[n.URL_PDF,n.FILE_PDF,n.CLIPBOARD_PDF,n.SPAWNER_PDF]},r={".m3u8":[n.URL_VIDEO,n.FILE_VIDEO,n.CLIPBOARD_VIDEO,n.SPAWNER_VIDEO]};function c(e,t,i){for(const i in o)if(t.toLowerCase().startsWith(i)){return s(e,...o[i])}if(i)for(const t in r)if(i.toLowerCase().endsWith(t)){return s(e,...r[t])}return n.UNKNOWN}},72:function(e,t,i){"use strict";i.d(t,"a",function(){return a});const a=[{id:"botdefault",model:"https://asset-bundles-prod.reticulum.io/bots/BotDefault_Avatar-9f71f8ff22.gltf",thumbnail:"https://asset-bundles-prod.reticulum.io/bots/botdefault-thumb-42C4C7D3C01D085EAFDAC8BACE591CE6.png"},{id:"botbobo",model:"https://asset-bundles-prod.reticulum.io/bots/BotBobo_Avatar-f9740a010b.gltf",thumbnail:"https://asset-bundles-prod.reticulum.io/bots/botbobo-thumb-261278FD5831E9CD89610D15948F23E4.png"},{id:"botdom",model:"https://asset-bundles-prod.reticulum.io/bots/BotDom_Avatar-0c48bf15a5.gltf",thumbnail:"https://asset-bundles-prod.reticulum.io/bots/botdom-thumb-1160EB5E81D24F12CE643C520CE1E99E.png"},{id:"botgreg",model:"https://asset-bundles-prod.reticulum.io/bots/BotGreg_Avatar-98d39797bb.gltf",thumbnail:"https://asset-bundles-prod.reticulum.io/bots/botgreg-thumb-F2A37F14F9C342EE44DDE9B24DD9B9FC.png"},{id:"botguest",model:"https://asset-bundles-prod.reticulum.io/bots/BotGuest_Avatar-78cd857332.gltf",thumbnail:"https://asset-bundles-prod.reticulum.io/bots/botguest-thumb-F7A471250E2C10C2709325C3B02A8BBB.png"},{id:"botjim",model:"https://asset-bundles-prod.reticulum.io/bots/BotJim_Avatar-d28005a687.gltf",thumbnail:"https://asset-bundles-prod.reticulum.io/bots/botjim-thumb-A2D195C1A51A082BCED58BD172481B39.png"},{id:"botkev",model:"https://asset-bundles-prod.reticulum.io/bots/BotKev_Avatar-a95787bb51.gltf",thumbnail:"https://asset-bundles-prod.reticulum.io/bots/botkev-thumb-90746A7349E3F964C913EA612EE9A53F.png"},{id:"botpinky",model:"https://asset-bundles-prod.reticulum.io/bots/BotPinky_Avatar-b0b93f8675.gltf",thumbnail:"https://asset-bundles-prod.reticulum.io/bots/botpinky-thumb-C2E69D4479077766B988DC3EE4F30BE5.png"},{id:"botrobert",model:"https://asset-bundles-prod.reticulum.io/bots/BotRobert_Avatar-e9554880f3.gltf",thumbnail:"https://asset-bundles-prod.reticulum.io/bots/botrobert-thumb-9C33F2C752326E2CF4321EAA7BDB4E47.png"},{id:"botwoody",model:"https://asset-bundles-prod.reticulum.io/bots/BotWoody_Avatar-0140485a23.gltf",thumbnail:"https://asset-bundles-prod.reticulum.io/bots/botwoody-thumb-F1F1FA7E21301B5AC1D8872B4ED0CC56.png"}]},78:function(e,t,i){"use strict";i.d(t,"a",function(){return o});var a=i(115),n=i.n(a);const s=window.ga;function o(e,t){const i={NODE_ENV:"production",DEFAULT_SCENE_SID:"JGLt8DP",RETICULUM_SERVER:"dev.reticulum.io",FARSPARK_SERVER:"farspark-dev.reticulum.io",NON_CORS_PROXY_DOMAINS:"hubs.local,dev.reticulum.io",ASSET_BUNDLE_SERVER:"https://asset-bundles-prod.reticulum.io",EXTRA_ENVIRONMENTS:"",POSTGREST_SERVER:"hubs.local:3000"}.SENTRY_DSN,a={NODE_ENV:"production",DEFAULT_SCENE_SID:"JGLt8DP",RETICULUM_SERVER:"dev.reticulum.io",FARSPARK_SERVER:"farspark-dev.reticulum.io",NON_CORS_PROXY_DOMAINS:"hubs.local,dev.reticulum.io",ASSET_BUNDLE_SERVER:"https://asset-bundles-prod.reticulum.io",EXTRA_ENVIRONMENTS:"",POSTGREST_SERVER:"hubs.local:3000"}.GA_TRACKING_ID;i&&(console.log("Tracking: Sentry DSN: "+i),n.a.config(i).install()),s&&a&&(console.log("Tracking: Google Analytics ID: "+a),s("create",a,"auto"),e&&s("set","page",e),t&&s("set","title",t),s("send","pageview"))}},829:function(module,__webpack_exports__,__webpack_require__){"use strict";var _qs_truthy__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(27);const showLog=Object(_qs_truthy__WEBPACK_IMPORTED_MODULE_0__.a)("debug_log");if(showLog){const template=document.createElement("template");template.innerHTML='\n    <style>\n      #debug-log {\n        position: absolute;\n        top: 13em;\n        background: white;\n        opacity: 0.7;\n        z-index: 1000;\n      }\n      #debug-log, #debug-log-input {\n        font-family: monospace;\n        font-size: 11px;\n        width: 100%;\n      }\n\n      #debug-log-controls {\n        display: flex;\n        padding: 0.2em;\n      }\n\n      #debug-log-eval {\n        display: flex;\n        flex: 1;\n      }\n\n      #debug-log-log {\n        overflow: auto;\n        height: 30vh;\n      }\n      #debug-log-log.minimized {\n        height: auto;\n      }\n      #debug-log-log.minimized .entry {\n        display: none;\n      }\n      #debug-log-log.minimized .entry:last-child {\n        display: block;\n      }\n      #debug-log-log .entry {\n        border: 1px solid grey;\n        margin: 0.2em;\n        padding: 0.2em;\n      }\n      #debug-log-log .entry.error { background-color: pink; }\n      #debug-log-log .entry.warn { background-color: orange; }\n    </style>\n    <div id="debug-log">\n        <div id="debug-log-controls">\n          <form id="debug-log-eval">\n            <input id="debug-log-input" placeholder="&gt;&gt;" autocorrect="off" autocapitalize="none" />\n            <button>&gt;</button>\n          </form>\n          <button id="debug-log-minimize">_</button>\n        </div>\n        <div id="debug-log-log"></div>\n    </div>\n  ',document.addEventListener("DOMContentLoaded",()=>{document.body.appendChild(template.content)});const debugLog=template.content.querySelector("#debug-log-log");debugLog.addEventListener("wheel",e=>e.stopPropagation());const debugLogInput=template.content.querySelector("#debug-log-input"),debugLogEval=template.content.querySelector("#debug-log-eval");debugLogEval.onsubmit=e=>{e.preventDefault(),console.log(eval(`(${debugLogInput.value})`))};let minimized=!1;const debugLogMinimize=template.content.querySelector("#debug-log-minimize");debugLogMinimize.onclick=()=>{minimized=!minimized,debugLog.className=minimized?"minimized":"",debugLog.scrollTop=debugLog.scrollHeight-debugLog.clientHeight};const origConsoleLog=console.log,origConsoleError=console.error,origConsoleWarn=console.warn,log=function(e,t){let i;debugLog.childNodes.length>1e3?i=debugLog.firstChild:(i=document.createElement("div")).classList.add("entry"),i.classList.remove("warn","error"),i.classList.add(e);const a=Array.from(t),n=a[0];let s;s="string"==typeof n&&n.includes("%c")?n.replace(/%c/g,""):n instanceof Error?`${n.message}\n${n.stack}`:a.map(e=>"string"==typeof e?e:JSON.stringify(e)).join(" ");const o=(new Date).toISOString().substring(11,23);i.textContent=`[${o}] ${s}`;const r=debugLog.scrollTop===debugLog.scrollHeight-debugLog.clientHeight;debugLog.append(i),r&&(debugLog.scrollTop=debugLog.scrollHeight-debugLog.clientHeight)};console.warn=function(){origConsoleWarn.apply(null,arguments),log("warn",arguments)},console.error=function(){origConsoleError.apply(null,arguments),log("error",arguments)},console.log=function(){origConsoleLog.apply(null,arguments),log("log",arguments)},window.onunhandledrejection=e=>log("error",[e.reason.message,e.reason.code,e.reason.name]),window.onerror=e=>log("error",[e])}},837:function(e,t){const i=new THREE.Vector3(0,0,0),a=new THREE.Quaternion,n=new THREE.Vector3(1,1,1),s=new THREE.Matrix4;s.identity();const o=THREE.PropertyBinding.prototype.SetterByBindingTypeAndVersioning,r=THREE.PropertyBinding.prototype.Versioning;for(let e=0;e<o.length;e++){const t=o[e][r.MatrixWorldNeedsUpdate];t&&(o[e][r.MatrixWorldNeedsUpdate]=function(){const e=t.apply(this,arguments);return this.targetObject.matrixNeedsUpdate=!0,e})}THREE.Object3D.prototype.getWorldPosition=function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new THREE.Vector3),this.updateMatrices(),e.setFromMatrixPosition(this.matrixWorld)},THREE.Object3D.prototype.getWorldQuaternion=function(){const e=new THREE.Vector3,t=new THREE.Vector3;return function(i){return void 0===i&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),i=new THREE.Quaternion),this.updateMatrices(),this.matrixWorld.decompose(e,i,t),i}}(),THREE.Object3D.getWorldScale=function(){const e=new THREE.Vector3,t=new THREE.Quaternion;return function(i){return void 0===i&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),i=new THREE.Vector3),this.updateMatrices(),this.matrixWorld.decompose(e,t,i),i}}();const c=e=>{e.matrixIsModified||(e.matrixIsModified=!0,e.cachedMatrixWorld&&(e.cachedMatrixWorld.copy(e.matrixWorld),e.matrixWorld=e.cachedMatrixWorld))},l=THREE.Object3D.prototype.updateMatrix;THREE.Object3D.prototype.updateMatrix=function(){l.apply(this,arguments),c(this)};const d=THREE.Object3D.prototype.applyMatrix;THREE.Object3D.prototype.applyMatrix=function(){d.apply(this,arguments),c(this)},THREE.Object3D.prototype.updateMatrices=function(e,t,o){this.hasHadFirstMatrixUpdate?(this.matrixNeedsUpdate||this.matrixAutoUpdate||e)&&(this.updateMatrix(),this.matrixNeedsUpdate&&(this.matrixNeedsUpdate=!1)):(this.position.equals(i)&&this.quaternion.equals(a)&&this.scale.equals(n)&&this.matrix.equals(s)||this.updateMatrix(),this.hasHadFirstMatrixUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.cachedMatrixWorld=this.matrixWorld),!o&&this.parent&&(this.parent.updateMatrices(!1,t,!1),this.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate||this.parent.childrenNeedMatrixWorldUpdate),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixIsModified?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld=this.parent.matrixWorld,this.childrenNeedMatrixWorldUpdate=!0,this.matrixWorldNeedsUpdate=!1)},THREE.Object3D.prototype.updateMatrixWorld=function(e,t){if(!this.visible&&!t)return;this.updateMatrices(!1,e,!0);const i=this.children,a=this.childrenNeedMatrixWorldUpdate||e;for(let e=0,n=i.length;e<n;e++)i[e].updateMatrixWorld(a,t);this.childrenNeedMatrixWorldUpdate&&(this.childrenNeedMatrixWorldUpdate=!1)},THREE.Object3D.prototype.lookAt=function(){const e=new THREE.Quaternion,t=new THREE.Matrix4,i=new THREE.Vector3,a=new THREE.Vector3;return function(n,s,o){n.isVector3?i.copy(n):i.set(n,s,o);const r=this.parent;this.updateMatrices(),a.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?t.lookAt(a,i,this.up):t.lookAt(i,a,this.up),this.quaternion.setFromRotationMatrix(t),r&&(t.extractRotation(r.matrixWorld),e.setFromRotationMatrix(t),this.quaternion.premultiply(e.inverse()))}}()},838:function(e,t,i){var a=i(300).default,n=AFRAME.components,s=AFRAME.registerComponent,o=AFRAME.utils;delete AFRAME.components.animation;var r=new THREE.Color,c=new THREE.Color,l=o.entity.getComponentProperty,d=o.entity.setComponentProperty,h={},u="color",p="components",m="object3D";function g(e){e.x=THREE.Math.degToRad(e.x),e.y=THREE.Math.degToRad(e.y),e.z=THREE.Math.degToRad(e.z)}function v(e,t,i){var a;for(a=0;a<t.length;a++)e.addEventListener(t[a],i)}function f(e,t,i){var a;for(a=0;a<t.length;a++)e.removeEventListener(t[a],i)}function b(e,t){var i,a,n;for(a=_(t),n=e,i=0;i<a.length;i++)n=n[a[i]];return n}function y(e,t,i,a){var n,s,o,r;for(t.startsWith("object3D.rotation")&&(i=THREE.Math.degToRad(i)),s=_(t),r=e,n=0;n<s.length-1;n++)r=r[s[n]];o=s[s.length-1],a!==u?r[o]=i:"r"in r[o]?(r[o].r=i.r,r[o].g=i.g,r[o].b=i.b):(r[o].x=i.r,r[o].y=i.g,r[o].z=i.b)}function _(e){return e in h?h[e]:(h[e]=e.split("."),h[e])}function E(e){return e.isRawProperty||e.property.startsWith(p)||e.property.startsWith(m)}e.exports.Component=s("animation",{schema:{autoplay:{default:!0},delay:{default:0},dir:{default:""},dur:{default:1e3},easing:{default:"easeInQuad"},elasticity:{default:400},enabled:{default:!0},from:{default:""},loop:{default:0,parse:function(e){return!0===e||"true"===e||!1!==e&&"false"!==e&&parseInt(e,10)}},property:{default:""},startEvents:{type:"array"},pauseEvents:{type:"array"},resumeEvents:{type:"array"},round:{default:!1},to:{default:""},type:{default:""},isRawProperty:{default:!1}},multiple:!0,init:function(){var e=this;this.eventDetail={name:this.attrName},this.time=0,this.animation=null,this.animationIsPlaying=!1,this.onStartEvent=this.onStartEvent.bind(this),this.beginAnimation=this.beginAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.resumeAnimation=this.resumeAnimation.bind(this),this.fromColor={},this.toColor={},this.targets={},this.targetsArray=[],this.updateConfigForDefault=this.updateConfigForDefault.bind(this),this.updateConfigForRawColor=this.updateConfigForRawColor.bind(this),this.config={complete:function(){e.animationIsPlaying=!1,e.el.emit("animationcomplete",e.eventDetail,!1),e.id&&e.el.emit("animationcomplete__"+e.id,e.eventDetail,!1)}}},update:function(e){var t=this.config,i=this.data;this.animationIsPlaying=!1,this.data.enabled&&i.property&&(t.autoplay=!1,t.direction=i.dir,t.duration=i.dur,t.easing=i.easing,t.elasticity=i.elasticity,t.loop=i.loop,t.round=i.round,this.createAndStartAnimation())},tick:function(e,t){this.animationIsPlaying&&(this.time+=t,this.animation.tick(this.time))},remove:function(){this.pauseAnimation(),this.removeEventListeners(),this.cancelDelayedStart()},pause:function(){this.paused=!0,this.pausedWasPlaying=this.animationIsPlaying,this.pauseAnimation(),this.removeEventListeners(),this.cancelDelayedStart()},play:function(){this.paused&&(this.paused=!1,this.addEventListeners(),this.pausedWasPlaying&&(this.resumeAnimation(),this.pausedWasPlaying=!1))},createAndStartAnimation:function(){var e=this.data;this.updateConfig(),this.animationIsPlaying=!1,this.animation=a(this.config),this.removeEventListeners(),this.cancelDelayedStart(),this.addEventListeners(),!e.autoplay||e.startEvents&&e.startEvents.length||(e.delay?this.delayTimeout=setTimeout(this.beginAnimation,e.delay):this.beginAnimation())},beginAnimation:function(){this.updateConfig(),this.time=0,this.animationIsPlaying=!0,this.stopRelatedAnimations(),this.el.emit("animationbegin",this.eventDetail,!1)},pauseAnimation:function(){this.animationIsPlaying=!1},resumeAnimation:function(){this.animationIsPlaying=!0},onStartEvent:function(){this.data.enabled&&(this.updateConfig(),this.animation&&this.animation.pause(),this.animation=a(this.config),this.data.delay?setTimeout(this.beginAnimation,this.data.delay):this.beginAnimation())},updateConfigForRawColor:function(){var e,t,i,a=this.config,n=this.data,s=this.el;if(!this.waitComponentInitRawProperty(this.updateConfigForRawColor)){for(t in e=""===n.from?b(s,n.property):n.from,i=n.to,this.setColorConfig(e,i),e=this.fromColor,i=this.toColor,this.targetsArray.length=0,this.targetsArray.push(e),a.targets=this.targetsArray,i)a[t]=i[t];var o;a.update=(o={},function(e){var t;(t=e.animatables[0].target).r===o.r&&t.g===o.g&&t.b===o.b||y(s,n.property,t,n.type)})}},updateConfigForDefault:function(){var e,t,i,a,n=this.config,s=this.data,o=this.el;this.waitComponentInitRawProperty(this.updateConfigForDefault)||(e=""===s.from?E(s)?b(o,s.property):l(o,s.property):s.from,i=s.to,!isNaN(e||i)?(e=parseFloat(e),i=parseFloat(i)):(e=e?e.toString():e,i=i?i.toString():i),(t="true"===s.to||"false"===s.to||!0===s.to||!1===s.to)&&(e="true"===s.from||!0===s.from?1:0,i="true"===s.to||!0===s.to?1:0),this.targets.aframeProperty=e,n.targets=this.targets,n.aframeProperty=i,n.update=function(e){var i;(i=e.animatables[0].target.aframeProperty)!==a&&(a=i,t&&(i=i>=1),E(s)?y(o,s.property,i,s.type):d(o,s.property,i))})},updateConfigForVector:function(){var e,t,i,a,n=this.config,s=this.data,r=this.el;for(e in t=""!==s.from?o.coordinates.parse(s.from):l(r,s.property),i=o.coordinates.parse(s.to),"rotation"===s.property&&(g(t),g(i)),this.targetsArray.length=0,this.targetsArray.push(t),n.targets=this.targetsArray,i)n[e]=i[e];"position"!==s.property&&"rotation"!==s.property&&"scale"!==s.property?n.update=function(){var e={};return function(t){var i=t.animations[0].target;i.x===e.x&&i.y===e.y&&i.z===e.z||(e.x=i.x,e.y=i.y,e.z=i.z,d(r,s.property,i))}}():n.update=(a={},function(e){var t=e.animatables[0].target;"scale"===s.property&&(t.x=Math.max(1e-4,t.x),t.y=Math.max(1e-4,t.y),t.z=Math.max(1e-4,t.z)),t.x===a.x&&t.y===a.y&&t.z===a.z||(a.x=t.x,a.y=t.y,a.z=t.z,r.object3D[s.property].set(t.x,t.y,t.z),r.object3D.matrixNeedsUpdate=!0)})},updateConfig:function(){var e;e=function(e,t){var i,a,s,o;if(s=t.split("."),a=s[0],o=s[1],!(i=e.components[a]||n[a]))return null;if(o&&!i.schema[o])return null;if(o)return i.schema[o].type;return i.schema.type}(this.el,this.data.property),E(this.data)&&this.data.type===u?this.updateConfigForRawColor():"vec2"===e||"vec3"===e||"vec4"===e?this.updateConfigForVector():this.updateConfigForDefault()},waitComponentInitRawProperty:function(e){var t,i=this.data,n=this.el,s=this;return""===i.from&&(!!i.property.startsWith(p)&&(t=_(i.property)[1],!n.components[t]&&(n.addEventListener("componentinitialized",function i(o){o.detail.name===t&&(e(),s.animation=a(s.config),n.removeEventListener("componentinitialized",i))}),!0)))},stopRelatedAnimations:function(){var e,t;for(t in this.el.components)e=this.el.components[t],t!==this.attrName&&"animation"===e.name&&e.animationIsPlaying&&e.data.property===this.data.property&&(e.animationIsPlaying=!1)},addEventListeners:function(){var e=this.data,t=this.el;v(t,e.startEvents,this.onStartEvent),v(t,e.pauseEvents,this.pauseAnimation),v(t,e.resumeEvents,this.resumeAnimation)},removeEventListeners:function(){var e=this.data,t=this.el;f(t,e.startEvents,this.onStartEvent),f(t,e.pauseEvents,this.pauseAnimation),f(t,e.resumeEvents,this.resumeAnimation)},cancelDelayedStart:function(){this.delayTimeout&&(clearTimeout(this.delayTimeout),this.delayTimeout=null)},setColorConfig:function(e,t){r.set(e),c.set(t),e=this.fromColor,t=this.toColor,e.r=r.r,e.g=r.g,e.b=r.b,t.r=c.r,t.g=c.g,t.b=c.b}})},839:function(e,t){AFRAME.registerComponent("ambient-light",{schema:{color:{type:"color"},intensity:{default:1}},init(){const e=this.el;this.light=new THREE.AmbientLight,this.el.setObject3D("ambient-light",this.light),this.el.sceneEl.systems.light.registerLight(e),this.rendererSystem=this.el.sceneEl.systems.renderer},update(e){this.data.color!==e.color&&(this.light.color.set(this.data.color),this.rendererSystem.applyColorCorrection(this.light.color)),this.data.intensity!==e.intensity&&(this.light.intensity=this.data.intensity)},remove:function(){this.el.removeObject3D("ambient-light")}})},840:function(e,t){AFRAME.registerComponent("animation-mixer",{initMixer(e){this.mixer=new THREE.AnimationMixer(this.el.object3D),this.el.object3D.animations=e,this.animations=e},tick:function(e,t){this.mixer&&this.mixer.update(t/1e3)}})},841:function(e,t){AFRAME.registerComponent("css-class",{schema:{type:"string"},multiple:!0,init(){this.el.classList.add(this.data)},update(e){this.data!==e&&(this.el.classList.remove(e),this.el.classList.add(this.data))},remove(){this.el.classList.remove(this.data)}})},842:function(e,t){AFRAME.registerComponent("duck",{schema:{initialForce:{default:0},maxForce:{default:6.5},maxScale:{default:5}},init:function(){this.physicsSystem=this.el.sceneEl.systems.physics,this.hasBody=!1,this.position=new CANNON.Vec3,this.force=new CANNON.Vec3(0,this.data.initialForce,0),this.initialScale=this.el.object3D.scale.x,this.maxScale=this.data.maxScale*this.initialScale},play:function(){this.physicsSystem.addComponent(this)},pause:function(){this.physicsSystem.removeComponent(this)},beforeStep:function(){if(this.el.body&&NAF.utils.isMine(this.el)){const e=this.el.object3D.scale.x,t=Math.min(1,(e-this.initialScale)/(this.maxScale-this.initialScale))*this.data.maxForce;if(t>0){const e=Math.random()*Math.PI*2,i=Math.cos(e),a=Math.sin(e);this.force.set(i,t,a),this.position.set(.01*i,0,.01*a),this.el.object3D.matrixNeedsUpdate=!0,this.el.body.applyForce(this.force,this.position)}}}})},844:function(e,t){AFRAME.registerComponent("heightfield",{init(){this.el.addEventListener("componentinitialized",e=>{"static-body"===e.detail.name&&this.generateAndAddHeightfield(this.el.components["static-body"])}),this.el.setAttribute("static-body",{shape:"none",mass:0})},generateAndAddHeightfield(e){const{offset:t,distance:i,data:a}=this.data,n=new CANNON.Quaternion;n.setFromAxisAngle(new CANNON.Vec3(1,0,0),-Math.PI/2);const s=new CANNON.Quaternion;s.setFromAxisAngle(new CANNON.Vec3(0,1,0),-Math.PI/2),s.mult(n,n);const o=new CANNON.Vec3(t.x,t.y,t.z),r=new CANNON.Heightfield(a,{elementSize:i});e.addShape(r,o,n)}})},845:function(e,t){AFRAME.registerComponent("hemisphere-light",{schema:{skyColor:{type:"color"},groundColor:{type:"color"},intensity:{default:1}},init(){const e=this.el;this.light=new THREE.HemisphereLight,this.light.position.set(0,0,0),this.light.matrixNeedsUpdate=!0,this.el.setObject3D("hemisphere-light",this.light),this.el.sceneEl.systems.light.registerLight(e)},update(e){this.data.skyColor!==e.skyColor&&this.light.color.set(this.data.skyColor),this.data.groundColor!==e.groundColor&&this.light.groundColor.set(this.data.groundColor),this.data.intensity!==e.intensity&&(this.light.intensity=this.data.intensity)},remove:function(){this.el.removeObject3D("hemisphere-light")}})},846:function(e,t){AFRAME.registerComponent("hide-when-quality",{schema:{type:"string",default:"low"},init(){this.onQualityChanged=this.onQualityChanged.bind(this),this.el.sceneEl.addEventListener("quality-changed",this.onQualityChanged)},onQualityChanged(e){this.updateComponentState(e.detail)},update(e){this.data!==e&&this.updateComponentState(window.APP.quality)},updateComponentState(e){this.el.setAttribute("visible",e!==this.data)}})},847:function(e,t){AFRAME.registerComponent("point-light",{schema:{color:{type:"color"},intensity:{default:1},range:{default:0},decay:{default:2},castShadow:{default:!0},shadowMapResolution:{default:[512,512]},shadowBias:{default:0},shadowRadius:{default:1}},init(){const e=this.el;this.light=new THREE.PointLight,this.light.shadow.camera.matrixAutoUpdate=!0,this.el.setObject3D("point-light",this.light),this.el.sceneEl.systems.light.registerLight(e),this.rendererSystem=this.el.sceneEl.systems.renderer},update(e){const t=this.light;if(this.data.color!==e.color){const e=new THREE.Color(this.data.color);this.rendererSystem.applyColorCorrection(e),t.color.copy(e)}this.data.intensity!==e.intensity&&(t.intensity=this.data.intensity),this.data.range!==e.range&&(t.distance=this.data.range),this.data.decay!==e.decay&&(t.decay=this.data.decay),this.data.castShadow!==e.castShadow&&(t.castShadow=this.data.castShadow),this.data.shadowBias!==e.shadowBias&&(t.shadow.bias=this.data.shadowBias),this.data.shadowRadius!==e.shadowRadius&&(t.shadow.radius=this.data.shadowRadius);const[i,a]=this.data.shadowMapResolution,[n,s]=e.shadowMapResolution?e.shadowMapResolution:[512,512];i===n&&a===s||(t.shadow.mapSize.set(i,a),t.shadow.map&&(t.shadow.map.dispose(),t.shadow.map=null))},remove:function(){this.el.removeObject3D("point-light")}})},848:function(e,t){AFRAME.registerComponent("spot-light",{schema:{color:{type:"color"},intensity:{default:1},range:{default:0},decay:{default:2},innerConeAngle:{default:0},outerConeAngle:{default:Math.PI/4},castShadow:{default:!0},shadowMapResolution:{default:[512,512]},shadowBias:{default:0},shadowRadius:{default:1}},init(){const e=this.el;this.light=new THREE.SpotLight,this.light.position.set(0,0,0),this.light.target.position.set(0,0,1),this.light.add(this.light.target),this.light.matrixNeedsUpdate=!0,this.light.target.matrixNeedsUpdate=!0,this.el.setObject3D("spot-light",this.light),this.el.sceneEl.systems.light.registerLight(e)},update(e){const t=this.light;this.data.color!==e.color&&t.color.set(this.data.color),this.data.intensity!==e.intensity&&(t.intensity=this.data.intensity),this.data.range!==e.range&&(t.distance=this.data.range),this.data.decay!==e.decay&&(t.decay=this.data.decay),this.data.innerConeAngle===e.innerConeAngle&&this.data.outerConeAngle===e.outerConeAngle||(t.angle=this.data.outerConeAngle,t.penumbra=1-this.data.innerConeAngle/this.data.outerConeAngle),this.data.castShadow!==e.castShadow&&(t.castShadow=this.data.castShadow),this.data.shadowBias!==e.shadowBias&&(t.shadow.bias=this.data.shadowBias),this.data.shadowRadius!==e.shadowRadius&&(t.shadow.radius=this.data.shadowRadius);const[i,a]=this.data.shadowMapResolution,[n,s]=e.shadowMapResolution?e.shadowMapResolution:[512,512];i===n&&a===s||(t.shadow.mapSize.set(i,a),t.shadow.map&&(t.shadow.map.dispose(),t.shadow.map=null))},remove:function(){this.el.removeObject3D("spot-light")}})},849:function(e,t,i){const a=i(195).COLLISION_LAYERS;AFRAME.registerComponent("floaty-object",{schema:{autoLockOnLoad:{default:!1},autoLockOnRelease:{default:!1},modifyGravityOnRelease:{default:!1},releaseGravity:{default:-2},reduceAngularFloat:{default:!1},gravitySpeedLimit:{default:1.85}},init(){this.onGrab=this.onGrab.bind(this),this.onRelease=this.onRelease.bind(this)},tick(){this.ammoBody||(this.ammoBody=this.el.components["ammo-body"]);const e=AFRAME.scenes[0].systems.interaction.isHeld(this.el);if(e&&!this.wasHeld&&this.onGrab(),this.wasHeld&&!e&&this.onRelease(),!e&&this._makeStaticWhenAtRest){const e=this.el.components.networked&&NAF.utils.isMine(this.el),t=this.ammoBody.data.linearSleepingThreshold,i=this.ammoBody.data.angularSleepingThreshold,a=this.ammoBody.body.getLinearVelocity().length2()<t*t&&this.ammoBody.body.getAngularVelocity().length2()<i*i;a&&e&&this.el.setAttribute("ammo-body",{type:"static"}),!a&&e||(this._makeStaticWhenAtRest=!1)}this.wasHeld=e},play(){this.hasBeenHereBefore||(this.hasBeenHereBefore=!0,this.el.body?this._onBodyLoaded():(this._onBodyLoaded=this._onBodyLoaded.bind(this),this.el.addEventListener("body-loaded",this._onBodyLoaded,{once:!0})))},setLocked(e){this.el.components.networked&&!NAF.utils.isMine(this.el)||(this.locked=e,this.el.setAttribute("ammo-body",{type:e?"kinematic":"dynamic"}))},_onBodyLoaded(){this.data.autoLockOnLoad&&this.setLocked(!0)},onRelease(){this.data.modifyGravityOnRelease?0===this.data.gravitySpeedLimit||this.ammoBody.getVelocity().length2()<this.data.gravitySpeedLimit*this.data.gravitySpeedLimit?(this.el.setAttribute("ammo-body",{gravity:{x:0,y:0,z:0},angularDamping:this.data.reduceAngularFloat?.98:.5,linearDamping:.95,linearSleepingThreshold:.1,angularSleepingThreshold:.1,collisionFilterMask:a.HANDS}),this._makeStaticWhenAtRest=!0):this.el.setAttribute("ammo-body",{gravity:{x:0,y:this.data.releaseGravity,z:0},angularDamping:.01,linearDamping:.01,linearSleepingThreshold:1.6,angularSleepingThreshold:2.5,collisionFilterMask:a.DEFAULT_INTERACTABLE}):this.el.setAttribute("ammo-body",{collisionFilterMask:a.DEFAULT_INTERACTABLE}),this.data.autoLockOnRelease&&this.setLocked(!0)},onGrab(){this.el.setAttribute("ammo-body",{collisionFilterMask:a.HANDS}),this.setLocked(!1)},remove(){if(this.el.removeEventListener("body-loaded",this._onBodyLoaded),this.stuckTo){const e=this.stuckTo;delete this.stuckTo,e._unstickObject()}}})},850:function(e,t){const i=new THREE.Vector3,a=new THREE.Vector3,n=new THREE.Vector3;AFRAME.registerComponent("trigger-volume",{schema:{colliders:{type:"selectorAll"},size:{type:"vec3",default:{x:1,y:1,z:1}},target:{type:"selector"},enterComponent:{type:"string"},enterProperty:{type:"string"},enterValue:{default:"",parse:e=>"object"==typeof e?e:JSON.parse(e),stringify:JSON.stringify},leaveComponent:{type:"string"},leaveProperty:{type:"string"},leaveValue:{default:"",parse:e=>"object"==typeof e?e:JSON.parse(e),stringify:JSON.stringify}},init(){this.boundingBox=new THREE.Box3,this.collidingLastFrame={}},update(){this.el.object3D.getWorldPosition(a),i.copy(this.data.size),this.boundingBox.setFromCenterAndSize(a,i)},tick(){const e=this.data.colliders;for(let t=0;t<e.length;t++){const i=e[t].object3D;i.getWorldPosition(n);const a=this.boundingBox.containsPoint(n),s=this.collidingLastFrame[i.id];a&&!s?this.data.target.setAttribute(this.data.enterComponent,this.data.enterProperty,this.data.enterValue):!a&&s&&this.data.target.setAttribute(this.data.leaveComponent,this.data.leaveProperty,this.data.leaveValue),this.collidingLastFrame[i.id]=a}}})},851:function(e,t){AFRAME.registerComponent("video-pause-state",{schema:{paused:{default:!1}},init(){this.onPauseStateChange=this.onPauseStateChange.bind(this),this.videoComponent=this.el.components["media-video"],this.videoComponent?this.onVideoLoaded():(this.onVideoLoaded=this.onVideoLoaded.bind(this),this.el.addEventListener("video-loaded",this.onVideoLoaded))},onVideoLoaded(){this.videoComponent=this.el.components["media-video"],this.video=this.videoComponent.video,this.video.addEventListener("pause",this.onPauseStateChange)},onPauseStateChange(){this.el.setAttribute("paused",this.video.paused)},update(){this.video&&this.data.paused!==this.video.paused&&this.videoComponent.togglePlaying()},remove(){this.video.removeEventListener("pause",this.onPauseStateChange),this.el.removeEventListener("video-loaded",this.onVideoLoaded)}})},852:function(e,t){AFRAME.registerComponent("log-events",{init:function(){const e=this.el,t=this.log.bind(this),i=this.el.dispatchEvent;this.el.dispatchEvent=function(){return t(Array.from(arguments)),i.apply(e,arguments)}},log:function([e]){if(["componentchanged"].includes(e.type))return;let t=!0;console.info(`log-events: ${this.el.id} ${e.type} ${JSON.stringify(e.detail,(e,i)=>i&&"object"==typeof i&&void 0===i.length?t?(t=!1,i):"[object]":i)}`)}}),AFRAME.registerComponent("lifecycle-checker",{schema:{name:{type:"string"},tick:{default:!1}},init:function(){this.log("init")},update:function(){this.log("update")},tick:function(){this.data.tick&&this.log("tick")},remove:function(){this.log("remove")},pause:function(){this.log("pause")},play:function(){this.log("play")},log:function(e){console.info(`lifecycle-checker:${this.data.name} ${e}`)}})},87:function(e,t,i){"use strict";function a(e,t,i,a,n,s,o){try{var r=e[s](o),c=r.value}catch(e){return void i(e)}r.done?t(c):Promise.resolve(c).then(a,n)}i.d(t,"a",function(){return n}),i.d(t,"b",function(){return s});const n=window.createImageBitmap||function(){var e,t=(e=function*(e){return new Promise(t=>{let i;if(e instanceof Blob)i=URL.createObjectURL(e);else{const t=document.createElement("canvas"),a=t.getContext("2d");t.width=e.width,t.height=e.height,a.putImageData(e,0,0),i=t.toDataURL()}const a=document.createElement("img");a.addEventListener("load",()=>t(a)),a.src=i})},function(){var t=this,i=arguments;return new Promise(function(n,s){var o=e.apply(t,i);function r(e){a(o,n,s,r,c,"next",e)}function c(e){a(o,n,s,r,c,"throw",e)}r(void 0)})});return function(e){return t.apply(this,arguments)}}();function s(e){e instanceof HTMLImageElement&&e.src.startsWith("blob:")?URL.revokeObjectURL(e.src):e.close&&e.close()}},870:function(e,t,i){const{Pathfinding:a}=i(1172);AFRAME.registerSystem("nav",{init:function(){this.pathfinder=new a},loadMesh:function(e,t){this.el.object3D.updateMatrixWorld(),this.mesh&&this.mesh.geometry&&this.mesh.geometry.dispose&&this.mesh.geometry.dispose(),this.mesh=e;const i=(new THREE.Geometry).fromBufferGeometry(e.geometry);i.applyMatrix(e.matrixWorld),this.pathfinder.setZoneData(t,a.createZone(i)),this.el.sceneEl.emit("nav-mesh-loaded")}})},875:function(e,t){AFRAME.registerComponent("event-repeater",{schema:{eventSource:{type:"selector"},events:{type:"array"}},play:function(){this.data.eventListeners=[];const e=this.data.events;for(let t=0;t<e.length;t++){const i=e[t];this.data.eventListeners[i]=this._handleEvent.bind(this,i),this.data.eventSource.addEventListener(i,this.data.eventListeners[i])}},pause:function(){const e=this.data.events;for(let t=0;t<e.length;t++){const i=e[t];this.data.eventSource.removeEventListener(i,this.data.eventListeners[i])}this.data.eventListeners=[]},_handleEvent:function(e,t){this.el.emit(e,t.detail)}})},9:function(e,t,i){"use strict";i.d(t,"a",function(){return r}),i.d(t,"b",function(){return c});var a=i(0),n=i.n(a),s=i(1),o=i.n(s);const r=n.a.createContext({}),c=({sound:e,children:t})=>n.a.createElement(r.Consumer,null,i=>n.a.cloneElement(t,{onMouseEnter:a=>{i&&i.playSound&&i.playSound(e||"play_sound-hud_hover_start"),t.props.onMouseEnter&&t.props.onMouseEnter(a)}}));c.propTypes={children:o.a.object,sound:o.a.string}},94:function(e,t,i){"use strict";function a(){return new Promise(e=>{setTimeout(e,0)})}i.d(t,"a",function(){return a})},98:function(e,t,i){"use strict";function a(e){const t=e.sceneEl.is("frozen"),i=e.components.pinnable&&e.components.pinnable.data.pinned,a=!!e.components["super-spawner"],n=window.APP.hubChannel.can("spawn_and_move_media")&&(!i||window.APP.hubChannel.can("pin_objects"));return(a||!i||t)&&n}function n(e){const t=e.components.pinnable&&e.components.pinnable.data.pinned,i=e&&e.components.networked&&e.components.networked.data.template,a="#interactable-camera"===i,n="#interactable-pen"===i;return window.APP.hubChannel.can("spawn_and_move_media")&&(!t||window.APP.hubChannel.can("pin_objects"))&&(!a||window.APP.hubChannel.can("spawn_camera"))&&(!n||window.APP.hubChannel.can("spawn_drawing"))}i.d(t,"b",function(){return a}),i.d(t,"a",function(){return n})}});
//# sourceMappingURL=hub-664c5989447bc773b816.js.map