{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/utils/next-tick.js","webpack:///./src/utils/phoenix-utils.js","webpack:///./src/utils/media-url-utils.js","webpack:///./src/utils/history.js","webpack:///./src/utils/avatar-utils.js","webpack:///./src/materials/MobileStandardMaterial.js","webpack:///./src/storage/media-search-store.js","webpack:///./src/components/gltf-model-plus.js","webpack:///./src/utils/promisify-worker.js","webpack:///./src/assets/stylesheets/avatar.scss?bb8d","webpack:///./src/avatar.js","webpack:///./src/components/hoverable-visuals.js","webpack:///./src/components/environment-map.js","webpack:///./src/utils/media-highlight-frag.glsl","webpack:///./src/assets/images/cubemap/posx.jpg","webpack:///./src/assets/images/cubemap/negx.jpg","webpack:///./src/assets/images/cubemap/posy.jpg","webpack:///./src/assets/images/cubemap/negy.jpg","webpack:///./src/assets/images/cubemap/posz.jpg","webpack:///./src/assets/images/cubemap/negz.jpg","webpack:///./src/utils/disable-ios-zoom.js","webpack:///./src/App.js","webpack:///./src/loaders/HubsTextureLoader.js","webpack:///./src/utils/media-utils.js","webpack:///./src/assets/images/warning_icon.png","webpack:///./src/assets/images/warning_icon@2x.png","webpack:///./src/react-components/avatar-preview.js","webpack:///./src/utils/qs_truthy.js","webpack:///./src/everyspace/helmet.js","webpack:///./src/assets/stylesheets/avatar-preview.scss?c714","webpack:///./src/everyspace/airtable.js","webpack:///./src/everyspace/messages.js","webpack:///./src/everyspace/customization.js","webpack:///./src/utils/i18n.js","webpack:///./src/utils/logging.js","webpack:///./src/utils/three-utils.js","webpack:///./src/utils/material-utils.js","webpack:///./src/utils/identity.js","webpack:///./src/storage/store.js","webpack:///./src/assets/images/hub-preview-white.png","webpack:///./src/object-types.js","webpack:///./src/assets/avatars/avatars.js","webpack:///./src/utils/permissions-utils.js","webpack:///./src/utils/image-bitmap-utils.js"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","4","exports","module","l","e","Promise","resolve","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","nextTick","setTimeout","__webpack_exports__","document","createElement","getReticulumFetchUrl","path","absolute","reticulumMeta","invalidatedReticulumMetaThisSession","invalidateReticulumMeta","_invalidateReticulumMeta","this","arguments","getReticulumMeta","_getReticulumMeta","querySelector","version","getAttribute","pool","phx_host","fetch","then","_ref2","_asyncToGenerator","res","json","_x6","phxHostOverride","URLSearchParams","location","search","connectToReticulum","_connectToReticulum","debug","params","qs","getNewSocketUrl","_ref3","socketProtocol","protocol","socketHost","socketPort","process","RETICULUM_SOCKET_SERVER","URL","port","socketUrl","console","log","socketSettings","logger","kind","msg","socket","Socket","connect","onError","endPointPath","endPoint","pathname","newEndPoint","getLandingPageForPhoto","photoUrl","parsedUrl","replace","fetchReticulumAuthenticated","url","method","payload","token","APP","store","state","credentials","retUrl","headers","content-type","authorization","body","JSON","stringify","_ref","text","parse","_x","createAndRedirectToNewHub","_x2","_x3","_x4","_x5","_createAndRedirectToNewHub","sceneId","sceneUrl","createUrl","assets","Name","SceneUrl","hub","getAirtableAssets","default_environment_gltf_bundle_url","Store","error","update","email","creatorAssignmentToken","creator_assignment_token","creatorAssignmentTokens","hubId","hub_id","embedToken","embed_token","embedTokens","host","getPresenceEntryForSession","presences","sessionId","presence","entries","find","k","metas","getPresenceContextForSession","context","getPresenceProfileForSession","profile","migrateChannelToSocket","oldChannel","channel","topic","bindings","item","on","event","callback","pushBuffer","timeout","oldJoinPush","joinPush","join","recHooks","receive","status","discordBridgesForPresences","channels","values","discordBridges","Array","map","b","scaledThumbnailUrlFor","proxiedUrlFor","getCustomGLTFParserURLResolver","guessContentType","isHubsSceneUrl","isHubsRoomUrl","isHubsDestinationUrl","isHubsAvatarUrl","nonCorsProxyDomains","split","CORS_PROXY_SERVER","commonKnownContentTypes","gltf","glb","png","jpg","jpeg","pdf","mp4","mp3","farsparkEncodeUrl","str","btoa","encodeURIComponent","_","p1","String","fromCharCode","b64EncodeUnicode","width","height","farsparkUrl","urlHostname","hostname","startsWith","domain","endsWith","gltfUrl","test","corsProxyPrefix","originalUrlParts","decodeURIComponent","substring","dataUrlRegex","matches","match","extension","pop","hubsSceneRegex","hubsAvatarRegex","hubsRoomRegex","pushOrUpdateHistory","history","v","detail","newPathname","newSearch","newLength","__historyLength","_objectSpread","__duplicate","undefined","isDuplicate","pushHistoryState","replaceHistoryState","pushHistoryPath","clearHistoryState","popToBeginningOfHubHistory","navigateToPriorPage","len","unsubscribe","listen","go","sluglessPath","withSlug","AVATAR_TYPES","LEGACY","SKINNABLE","legacyAvatarIds","avatars","a","id","getAvatarType","avatarId","indexOf","resp","fetchAvatar","_fetchAvatar","avatar_id","gltf_url","avatar","model","fetchSkinnableAvatar","getAvatarSrc","fetchAvatarGltfUrl","getAvatarThumbnailUrl","_getAvatarThumbnailUrl","thumbnail","files","VERTEX_SHADER","FRAGMENT_SHADER","MobileStandardMaterial","THREE","ShaderMaterial","[object Object]","args","super","_defineProperty","material","parameters","vertexShader","fragmentShader","uniforms","uvTransform","Matrix3","diffuse","color","opacity","aoMapIntensity","aoMap","emissive","emissiveMap","fog","lights","transparent","alphaTest","skinning","morphTargets","vertexColors","mobileMaterial","clone","fromStandardMaterial","SOURCES","EMPTY_RESULT","meta","URL_SOURCE_TO_TO_API_SOURCE","scenes","images","videos","youtube","gifs","sketchfab","poly","twitch","favorites","MEDIA_SOURCE_DEFAULT_FILTERS","SEARCH_CONTEXT_PARAMS","MediaSearchStore","EventTarget","constructor","_this","dispatchEvent","CustomEvent","urlSource","getUrlMediaSource","previousSource","urlParams","requestIndex","currentRequestIndex","searchParams","locationSearchParams","isMy","param","set","source","navigator","languages","singular","credentialsAccountId","toString","lastSavedUrl","isFetching","nextCursor","next_cursor","lastFetchedUrl","legacyAvatar","type","preview","gltfs","delta","goBack","filter","query","delete","keepSource","keepNav","_stashedParams","_stashedSource","q","_sourceNavigate","hideNav","useLastStashedParams","currentQuery","getSearchClearedSearchParams","useValue","hasAccountWithAvatars","_hasAccountWithAvatars","stashLastSearchParams","_stashLastSearchParams","hasMediaPath","setHistory","_update","Mesh","raycast","acceleratedRaycast","gltfCache","Map","src","cache","count","retain","has","cacheItem","release","scene","traverse","disposeNode","inflightGltfs","extractZipFile","promisifyWorker","SketchfabZipWorker","defaultInflator","el","componentName","componentData","AFRAME","components","Error","multiple","isArray","setAttribute","cloneSkinnedMesh","cloneLookup","parallelTraverse","children","sourceNode","clonedNode","isMesh","geometry","boundsTree","sourceMesh","isSkinnedMesh","sourceBones","skeleton","bones","clonedMesh","sourceBone","bindMatrix","cloneGltf","animations","getHubsComponents","node","hubsComponents","userData","gltfExtensions","MOZ_hubs_components","HUBS_components","legacyComponents","GLTFModelPlus","registerComponent","componentKey","inflator","inflateEntities","indexToEntityMap","templates","isRoot","modelToWorldScale","childEntities","child","entityComponents","append","className","uuid","classList","add","rotation","order","setFromQuaternion","quaternion","object3D","position","copy","scale","multiplyScalar","matrixNeedsUpdate","matrixAutoUpdate","matrix","identity","decompose","setObject3D","toLowerCase","parent","gltfIndex","attachTemplate","root","templateRoot","targetEls","querySelectorAll","cloneNode","attributes","appendChild","loadGLTF","_loadGLTF","contentType","preferredTechnique","onProgress","jsonPreprocessor","fileMap","includes","loadingManager","LoadingManager","setURLModifier","gltfLoader","GLTFLoader","parser","reject","createParser","textureLoader","extensions","oldHeightfieldNode","nodes","heightfield","runMigration","materials","MOZ_alt_materials","altMaterialIndex","extras","Object3D","DefaultMatrixAutoUpdate","mapMaterials","isMeshStandardMaterial","keys","forEach","revokeObjectURL","schema","useCache","default","inflate","batch","init","quality","loadTemplates","applySrc","remove","sceneEl","systems","batchManagerSystem","removeObject","object3DMap","mesh","templateEl","importNode","firstElementChild","content","loadModel","technique","promise","_this2","charAt","assetEl","getElementById","lastSrc","inflatedEl","warn","disposeLastInflatedEl","emit","addObject","initMixer","obj","hasBufferGeometry","isBufferGeometry","hasBoundsTree","geo","triCount","index","MeshBVH","strategy","maxDepth","object3DToSet","inflatedEntity","prop","inflateComponents","rewires","environmentMapComponent","applyEnvironmentMap","f","format","parentNode","removeChild","x","dispose","removeAttribute","worker","nextItemId","outstanding","onmessage","err","handlers","transfer","postMessage","avatar-landing","avatarLanding","form-submit","formSubmit","title","attributions","logo","box","selected-message","selectedMessage","BUILD_VERSION","addLocaleData","en","disableiOSZoom","App","AvatarUI","React","Component","props","airtableAssets","setState","forceUpdate","preventDefault","airtableAssetsInitialState","componentDidMount","addEventListener","storeUpdated","refetchAvatar","fetchAirtableAssets","componentWillUnmount","removeEventListener","render","react__WEBPACK_IMPORTED_MODULE_5___default","styles","classNames","darkened","selectedAvatarId","isSelected","onSubmit","setAvatar","_everyspace_helmet__WEBPACK_IMPORTED_MODULE_3__","page","creator","_react_components_avatar_preview__WEBPACK_IMPORTED_MODULE_13__","avatarGltfUrl","react_intl__WEBPACK_IMPORTED_MODULE_8__","disabled","DarkLogo","PropTypes","string","intl","ReactDOM","locale","lang","messages","validMaterials","_utils_material_utils__WEBPACK_IMPORTED_MODULE_0__","_utils_permissions_utils__WEBPACK_IMPORTED_MODULE_1__","interactorOneTransform","interactorTwoTransform","enableSweepingEffect","boundingSphere","Sphere","sweepParams","boundingBox","forEachMaterial","contains","meshToEl","tick","time","isFrozen","is","showEffect","showHoverEffect","interactorOne","interactorTwo","interaction","leftHand","hovered","held","options","entity","rightRemote","rightHand","matrixWorld","toArray","worldY","elements","scaledRadius","y","radius","uniform","hubs_EnableSweepingEffect","hubs_IsFrozen","hubs_SweepParams","hubs_HighlightInteractorOne","hubs_InteractorOnePos","hubs_HighlightInteractorTwo","hubs_InteractorTwoPos","hubs_Time","createDefaultEnvironmentMap","_createDefaultEnvironmentMap","urls","cubeMapPosX","cubeMapNegX","cubeMapPosY","cubeMapNegY","cubeMapPosZ","cubeMapNegZ","texture","CubeTextureLoader","load","RGBFormat","environmentMap","updateEnvironmentMap","envMap","needsUpdate","detect_browser__WEBPACK_IMPORTED_MODULE_0__","detectOS","userAgent","lastTouchAtMs","ev","now","Date","getTime","isDoubleTouch","_storage_store__WEBPACK_IMPORTED_MODULE_0__","_storage_media_search_store__WEBPACK_IMPORTED_MODULE_1__","mediaSearchStore","setQuality","HubsTextureLoader","manager","DefaultLoadingManager","onLoad","Texture","loadTextureAsync","catch","imageLoader","createImageBitmap","ImageBitmapLoader","flipY","ImageLoader","setCrossOrigin","crossOrigin","setPath","cacheKey","resolveURL","image","loader","loadAsync","Cache","onUpdate","close","mediaAPIEndpoint","resolveUrlCache","resolveUrl","media_utils_asyncToGenerator","resultPromise","Content-Type","media","response","ok","message","statusText","upload","file","desiredContentType","formData","FormData","interactableId","addMedia","template","contentOrigin","contentSubtype","resize","animate","needsToBeUploaded","File","fileIsOwned","fireLoadingTimeout","eventName","clearTimeout","once","orientation","reader","FileReader","onload","view","DataView","target","getUint16","byteLength","offset","marker","getUint32","little","tags","readAsArrayBuffer","getOrientation","srcUrl","origin","access_token","href","fileId","file_id","uploadPromotionTokens","promotionToken","promotion_token","MediaStream","NAF","clientId","objectType","objectTypeForOriginAndContentType","injectCustomShaderChunks","vertexRegex","fragRegex","shaderUniforms","newMaterial","onBeforeCompile","shader","vlines","vindex","findIndex","line","unshift","flines","findex","mediaHighlightFrag","getPromotionTokenForFile","mediaPos","Vector3","addAndArrangeMedia","snapCount","mirrorOrientation","pos","z","rotateY","Math","PI","idx","cos","sin","localToWorld","visible","handler","dur","from","to","easing","eventType","createImageTexture","_createImageTexture","encoding","sRGBEncoding","anisotropy","TEXTURE_PROPS","base_map","emissive_map","normal_map","orm_map","ALL_MAPS","createRenderer","canvas","alpha","useDevicePixelRatio","getContext","depth","antialias","premultipliedAlpha","preserveDrawingBuffer","powerPreference","renderer","WebGLRenderer","gammaOutput","gammaFactor","physicallyCorrectLights","setPixelRatio","devicePixelRatio","createImageBitmapFromURL","blob","ORBIT_ANGLE","Euler","DEG2RAD","DEFAULT_MARGIN","fitBoxInFrustum","camera","center","margin","halfYExtents","max","min","halfVertFOV","degToRad","fov","tan","applyEuler","lookAt","AvatarPreview","Scene","PerspectiveCamera","clientWidth","clientHeight","controls","OrbitControls","enablePan","light","DirectionalLight","HemisphereLight","loadPreviewAvatar","clock","Clock","snapshotCanvas","snapshotCamera","snapshotRenderer","setClearAlpha","previewRenderer","setClearColor","setAnimationLoop","dt","getDelta","mixer","parentElement","offsetWidth","offsetHeight","setSize","aspect","updateProjectionMatrix","resetCamera","loading","Box3","setFromObject","getCenter","domElement","imageBitmaps","img","disposeImageBitmap","oldProps","applyMaps","previewMesh","getObjectByName","idleAnimation","AnimationMixer","action","clipAction","enabled","setLoop","LoopRepeat","Infinity","play","idleAnimationAction","getImage","originalMaps","all","bm","stop","toBlob","newProps","mapName","applyMap","applyMapToPreview","revertMap","react__WEBPACK_IMPORTED_MODULE_2___default","_assets_images_warning_icon_png__WEBPACK_IMPORTED_MODULE_0___default","srcSet","_assets_images_warning_icon_2x_png__WEBPACK_IMPORTED_MODULE_1___default","react_intl__WEBPACK_IMPORTED_MODULE_4__","ref","injectIntl","withRef","qsTruthy","val","HelmetComponent","react_helmet__WEBPACK_IMPORTED_MODULE_0__","react__WEBPACK_IMPORTED_MODULE_1__","react__WEBPACK_IMPORTED_MODULE_1___default","pageTitle","titleRoot","Page_Title_Root","rel","sizes","Favicon","Social_Description","Social_Image","Twitter_Handle","Airtable","configure","endpointUrl","apiKey","base","Icon","select","firstPage","fields","records","modifiedTranslations","i18n_messages","navigatorLang","language","userLanguage","localeData","debug__WEBPACK_IMPORTED_MODULE_0__","debug__WEBPACK_IMPORTED_MODULE_0___default","_qs_truthy__WEBPACK_IMPORTED_MODULE_1__","isDebug","logFilter","enable","getLastWorldPosition","getLastWorldQuaternion","setMatrixWorld","tempVector3","Quaternion","updateMatrices","setFromMatrixPosition","disposeMaterial","mtrl","lightMap","bumpMap","normalMap","specularMap","materialArray","MeshFaceMaterial","MultiMaterial","getInverse","multiply","fn","names","selectRandom","arr","floor","random","avatarIds","av","generateDefaultProfile","LOCAL_STORE_KEY","STORE_STATE_CACHE_KEY","OAUTH_FLOW_CREDENTIALS_KEY","validator","Validator","SCHEMA","definitions","additionalProperties","properties","displayName","pattern","personalAvatarId","activity","hasFoundFreeze","hasChangedName","hasAcceptedProfile","lastEnteredAt","hasPinned","hasRotated","hasRecentered","hasScaled","hasHoveredInWorldHud","hasOpenedShare","entryCount","settings","lastUsedMicDeviceId","confirmedDiscordRooms","items","confirmedBroadcastedRooms","onLoadActions","$ref","localStorage","getItem","setItem","oauthFlowCredentials","Cookies","getJSON","resetToRandomLegacyAvatar","jwtDecode","sub","resetConfirmedBroadcastedRooms","clearStoredArray","resetTipActivityFlags","bumpEntryCount","currentEntryCount","enqueueOnLoadAction","executeOnLoadActions","clearOnLoadActions","arrayMerge","destinationArray","sourceArray","newState","mergeOpts","finalState","merge","valid","validate","ObjectContentOrigins","ObjectTypes","FILE","CLIPBOARD","SPAWNER","URL_IMAGE","URL_VIDEO","URL_MODEL","URL_PDF","URL_AUDIO","FILE_IMAGE","FILE_VIDEO","FILE_MODEL","FILE_PDF","FILE_AUDIO","CLIPBOARD_IMAGE","CLIPBOARD_VIDEO","CLIPBOARD_MODEL","CLIPBOARD_PDF","CLIPBOARD_AUDIO","SPAWNER_IMAGE","SPAWNER_VIDEO","SPAWNER_MODEL","SPAWNER_PDF","SPAWNER_AUDIO","CAMERA","UNKNOWN","objectTypeForOrigin","urlType","fileType","clipboardType","spawnerType","objectTypeMimePrefixLookupMap","image/","model/","application/x-zip-compressed","video/","application/vnd.apple.mpegurl","application/x-mpegurl","audio/","application/pdf","srcSuffixLookupMap",".m3u8","prefix","suffix","isPinned","pinnable","pinned","isSpawner","canMove","hubChannel","can","networkedTemplate","networked","isCamera","isPen","indexForNonAuthorizedComponent","nonAuthorizedComponent","fullComponent","component","schemaComponent","authorizeOrSanitizeMessage","nonAuthorizedSchemas","sanitizeMessageData","schemaDict","schemas","nonAuthorizedComponents","initializeNonAuthorizedSchemas","nonAuthorizedIndices","authorizeEntityManipulation","sender","senderPermissions","isCreator","pin_objects","spawn_and_move_media","spawn_camera","spawn_pen","authorizeOrSanitizeMessageData","entities","getEntity","networkId","emptyObject","dataType","from_session_id","isFirstSync","persistent","permissions","Blob","createObjectURL","ctx","putImageData","toDataURL","imageBitmap","HTMLImageElement"],"mappings":"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","file":"assets/js/avatar-a4c4a5e0ec5120353908.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t4: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n \t// The chunk loading function for additional chunks\n \t// Since all referenced chunks are already included\n \t// in this file, this function is empty here.\n \t__webpack_require__.e = function requireEnsure() {\n \t\treturn Promise.resolve();\n \t};\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([2037,1,0]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export default function nextTick() {\n  return new Promise(resolve => {\n    setTimeout(resolve, 0);\n  });\n}\n","import { Socket } from \"phoenix\";\nimport { generateHubName } from \"../utils/name-generation\";\nimport { getAirtableAssets, airtableAssetsInitialState } from '../everyspace/airtable'\n\nimport Store from \"../storage/store\";\n\nconst resolverLink = document.createElement(\"a\");\nexport function getReticulumFetchUrl(path, absolute = false) {\n  if (process.env.RETICULUM_SERVER) {\n    return `https://${process.env.RETICULUM_SERVER}${path}`;\n  } else if (absolute) {\n    resolverLink.href = path;\n    return resolverLink.href;\n  } else {\n    return path;\n  }\n}\n\nlet reticulumMeta = null;\nlet invalidatedReticulumMetaThisSession = false;\n\nexport async function invalidateReticulumMeta() {\n  invalidatedReticulumMetaThisSession = true;\n  reticulumMeta = null;\n}\n\nexport async function getReticulumMeta() {\n  if (!reticulumMeta) {\n    // Initially look up version based upon page, avoiding round-trip, otherwise fetch.\n    if (!invalidatedReticulumMetaThisSession && document.querySelector(\"meta[name='ret:version']\")) {\n      reticulumMeta = {\n        version: document.querySelector(\"meta[name='ret:version']\").getAttribute(\"value\"),\n        pool: document.querySelector(\"meta[name='ret:pool']\").getAttribute(\"value\"),\n        phx_host: document.querySelector(\"meta[name='ret:phx_host']\").getAttribute(\"value\")\n      };\n    } else {\n      await fetch(getReticulumFetchUrl(\"/api/v1/meta\")).then(async res => {\n        reticulumMeta = await res.json();\n      });\n    }\n  }\n\n  const qs = new URLSearchParams(location.search);\n  const phxHostOverride = qs.get(\"phx_host\");\n\n  if (phxHostOverride) {\n    reticulumMeta.phx_host = phxHostOverride;\n  }\n\n  return reticulumMeta;\n}\n\nexport async function connectToReticulum(debug = false, params = null) {\n  const qs = new URLSearchParams(location.search);\n\n  const getNewSocketUrl = async () => {\n    const socketProtocol = qs.get(\"phx_protocol\") || (document.location.protocol === \"https:\" ? \"wss:\" : \"ws:\");\n    let socketHost = qs.get(\"phx_host\");\n    let socketPort = qs.get(\"phx_port\");\n\n    const reticulumMeta = await getReticulumMeta();\n    socketHost = socketHost || process.env.RETICULUM_SOCKET_SERVER || reticulumMeta.phx_host;\n    socketPort =\n      socketPort ||\n      (process.env.RETICULUM_SERVER ? new URL(`${socketProtocol}//${process.env.RETICULUM_SERVER}`).port : \"443\");\n    return `${socketProtocol}//${socketHost}${socketPort ? `:${socketPort}` : \"\"}`;\n  };\n\n  const socketUrl = await getNewSocketUrl();\n  console.log(`Phoenix Socket URL: ${socketUrl}`);\n\n  const socketSettings = {};\n\n  if (debug) {\n    socketSettings.logger = (kind, msg, data) => {\n      console.log(`${kind}: ${msg}`, data);\n    };\n  }\n\n  if (params) {\n    socketSettings.params = params;\n  }\n\n  const socket = new Socket(`${socketUrl}/socket`, socketSettings);\n  socket.connect();\n  socket.onError(async () => {\n    // On error, underlying reticulum node may have died, so rebalance by\n    // fetching a new healthy node to connect to.\n    invalidateReticulumMeta();\n\n    const endPointPath = new URL(socket.endPoint).pathname;\n    const newSocketUrl = await getNewSocketUrl();\n    const newEndPoint = `${newSocketUrl}${endPointPath}`;\n    console.log(`Socket error, changed endpoint to ${newEndPoint}`);\n    socket.endPoint = newEndPoint;\n  });\n\n  return socket;\n}\n\nexport function getLandingPageForPhoto(photoUrl) {\n  const parsedUrl = new URL(photoUrl);\n  return getReticulumFetchUrl(parsedUrl.pathname.replace(\".png\", \".html\") + parsedUrl.search, true);\n}\n\nexport function fetchReticulumAuthenticated(url, method = \"GET\", payload) {\n  const { token } = window.APP.store.state.credentials;\n  const retUrl = getReticulumFetchUrl(url);\n  const params = {\n    headers: { \"content-type\": \"application/json\" },\n    method\n  };\n  if (token) {\n    params.headers.authorization = `bearer ${token}`;\n  }\n  if (payload) {\n    params.body = JSON.stringify(payload);\n  }\n  return fetch(retUrl, params).then(async r => {\n    const result = await r.text();\n    try {\n      return JSON.parse(result);\n    } catch (e) {\n      // Some reticulum responses, particularly DELETE requests, don't return json.\n      return result;\n    }\n  });\n}\n\nexport async function createAndRedirectToNewHub(name, sceneId, sceneUrl, replace) {\n  const createUrl = getReticulumFetchUrl(\"/api/v1/hubs\");\n\n  let assets = {Name: \"Test\", SceneUrl: null};\n    \n  assets = await getAirtableAssets();\n  \n  // const record = await airtableAssets.find('recHqITRS7cBMwn9i')\n\n  // if (record) assets = record.fields;\n  \n  // const payload = { hub: { name: name || generateHubName() } };\n  const payload = { hub: { name: assets.Name } };\n  \n\n  // if (sceneId) {\n    // payload.hub.scene_id = sceneId;\n  // } else {\n    // payload.hub.default_environment_gltf_bundle_url = sceneUrl;\n  // }\n    \n  payload.hub.default_environment_gltf_bundle_url = assets.SceneUrl;\n    \n\n  const headers = { \"content-type\": \"application/json\" };\n  const store = new Store();\n  if (store.state && store.state.credentials.token) {\n    headers.authorization = `bearer ${store.state.credentials.token}`;\n  }\n\n  let res = await fetch(createUrl, {\n    body: JSON.stringify(payload),\n    headers,\n    method: \"POST\"\n  }).then(r => r.json());\n\n  if (res.error === \"invalid_token\") {\n    // Clear the invalid token from store.\n    store.update({ credentials: { token: null, email: null } });\n\n    // Create hub anonymously\n    delete headers.authorization;\n    res = await fetch(createUrl, {\n      body: JSON.stringify(payload),\n      headers,\n      method: \"POST\"\n    }).then(r => r.json());\n  }\n\n  const hub = res;\n  let url = hub.url;\n\n  const creatorAssignmentToken = hub.creator_assignment_token;\n  if (creatorAssignmentToken) {\n    store.update({ creatorAssignmentTokens: [{ hubId: hub.hub_id, creatorAssignmentToken: creatorAssignmentToken }] });\n\n    // Don't need to store the embed token if there's no creator assignment token, since that means\n    // we are the owner and will get the embed token on page load.\n    const embedToken = hub.embed_token;\n\n    if (embedToken) {\n      store.update({ embedTokens: [{ hubId: hub.hub_id, embedToken: embedToken }] });\n    }\n  }\n\n  if (process.env.RETICULUM_SERVER && document.location.host !== process.env.RETICULUM_SERVER) {\n    url = `/hub.html?hub_id=${hub.hub_id}`;\n  }\n\n  if (replace) {\n    document.location.replace(url);\n  } else {\n    document.location = url;\n  }\n}\n\nexport function getPresenceEntryForSession(presences, sessionId) {\n  const entry = Object.entries(presences || {}).find(([k]) => k === sessionId) || [];\n  const presence = entry[1];\n  return (presence && presence.metas && presence.metas[0]) || {};\n}\n\nexport function getPresenceContextForSession(presences, sessionId) {\n  return (getPresenceEntryForSession(presences, sessionId) || {}).context || {};\n}\n\nexport function getPresenceProfileForSession(presences, sessionId) {\n  return (getPresenceEntryForSession(presences, sessionId) || {}).profile || {};\n}\n\n// Takes the given channel, and creates a new channel with the same bindings\n// with the given socket, joins it, and leaves the old channel after joining.\n//\n// NOTE: This function relies upon phoenix channel object internals, so this\n// function will need to be reviewed if/when we ever update phoenix.js\nexport function migrateChannelToSocket(oldChannel, socket, params) {\n  const channel = socket.channel(oldChannel.topic, params || oldChannel.params);\n\n  for (let i = 0, l = oldChannel.bindings.length; i < l; i++) {\n    const item = oldChannel.bindings[i];\n    channel.on(item.event, item.callback);\n  }\n\n  for (let i = 0, l = oldChannel.pushBuffer.length; i < l; i++) {\n    const item = oldChannel.pushBuffer[i];\n    channel.push(item.event, item.payload, item.timeout);\n  }\n\n  const oldJoinPush = oldChannel.joinPush;\n  const joinPush = channel.join();\n\n  for (let i = 0, l = oldJoinPush.recHooks.length; i < l; i++) {\n    const item = oldJoinPush.recHooks[i];\n    joinPush.receive(item.status, item.callback);\n  }\n\n  return new Promise(resolve => {\n    joinPush.receive(\"ok\", () => {\n      // Clear all event handlers first so no duplicate messages come in.\n      oldChannel.bindings = [];\n      resolve(channel);\n    });\n  });\n}\n\nexport function discordBridgesForPresences(presences) {\n  const channels = [];\n  for (const p of Object.values(presences)) {\n    for (const m of p.metas) {\n      if (m.profile && m.profile.discordBridges) {\n        Array.prototype.push.apply(channels, m.profile.discordBridges.map(b => b.channel.name));\n      }\n    }\n  }\n  return channels;\n}\n","const nonCorsProxyDomains = (process.env.NON_CORS_PROXY_DOMAINS || \"\").split(\",\");\nif (process.env.CORS_PROXY_SERVER) {\n  nonCorsProxyDomains.push(process.env.CORS_PROXY_SERVER);\n}\n\nconst commonKnownContentTypes = {\n  gltf: \"model/gltf\",\n  glb: \"model/gltf-binary\",\n  png: \"image/png\",\n  jpg: \"image/jpeg\",\n  jpeg: \"image/jpeg\",\n  pdf: \"application/pdf\",\n  mp4: \"video/mp4\",\n  mp3: \"audio/mpeg\"\n};\n\n// thanks to https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding\nfunction b64EncodeUnicode(str) {\n  // first we use encodeURIComponent to get percent-encoded UTF-8, then we convert the percent-encodings\n  // into raw bytes which can be fed into btoa.\n  const CHAR_RE = /%([0-9A-F]{2})/g;\n  return btoa(encodeURIComponent(str).replace(CHAR_RE, (_, p1) => String.fromCharCode(\"0x\" + p1)));\n}\n\nconst farsparkEncodeUrl = url => {\n  // farspark doesn't know how to read '=' base64 padding characters\n  // translate base64 + to - and / to _ for URL safety\n  return b64EncodeUnicode(url)\n    .replace(/=+$/g, \"\")\n    .replace(/\\+/g, \"-\")\n    .replace(/\\//g, \"_\");\n};\n\nexport const scaledThumbnailUrlFor = (url, width, height) => {\n  const farsparkUrl = `https://${process.env.FARSPARK_SERVER}/thumbnail/${farsparkEncodeUrl(\n    url\n  )}?w=${width}&h=${height}`;\n\n  try {\n    const urlHostname = new URL(url).hostname;\n\n    if (process.env.RETICULUM_SERVER) {\n      const retHostname = new URL(`https://${process.env.RETICULUM_SERVER}`).hostname;\n      if (retHostname === urlHostname) return url;\n    }\n  } catch (e) {\n    return farsparkUrl;\n  }\n\n  return farsparkUrl;\n};\n\nexport const proxiedUrlFor = url => {\n  if (!(url.startsWith(\"http:\") || url.startsWith(\"https:\"))) return url;\n\n  // Skip known domains that do not require CORS proxying.\n  try {\n    const parsedUrl = new URL(url);\n    if (nonCorsProxyDomains.find(domain => parsedUrl.hostname.endsWith(domain))) return url;\n  } catch (e) {\n    // Ignore\n  }\n\n  if (!process.env.CORS_PROXY_SERVER) {\n    return `https://${process.env.FARSPARK_SERVER}/0/raw/0/0/0/0/${farsparkEncodeUrl(url)}`;\n  } else {\n    return `https://${process.env.CORS_PROXY_SERVER}/${url}`;\n  }\n};\n\nexport const getCustomGLTFParserURLResolver = gltfUrl => url => {\n  if (typeof url !== \"string\" || url === \"\") return \"\";\n  if (/^(https?:)?\\/\\//i.test(url)) return url;\n  if (/^data:.*,.*$/i.test(url)) return url;\n  if (/^blob:.*$/i.test(url)) return url;\n\n  if (process.env.CORS_PROXY_SERVER) {\n    // For absolute paths with a CORS proxied gltf URL, re-write the url properly to be proxied\n    const corsProxyPrefix = `https://${process.env.CORS_PROXY_SERVER}/`;\n\n    if (gltfUrl.startsWith(corsProxyPrefix)) {\n      const originalUrl = decodeURIComponent(gltfUrl.substring(corsProxyPrefix.length));\n      const originalUrlParts = originalUrl.split(\"/\");\n\n      // Drop the .gltf filename\n      const path = new URL(url).pathname;\n      const assetUrl = originalUrlParts.slice(0, originalUrlParts.length - 1).join(\"/\") + \"/\" + path;\n      return corsProxyPrefix + assetUrl;\n    }\n  }\n\n  return url;\n};\n\nconst dataUrlRegex = /data:([a-zA-Z0-9]+\\/[a-zA-Z0-9-.+]+).*,.*/;\n\nexport const guessContentType = url => {\n  if (url.startsWith(\"hubs://\") && url.endsWith(\"/video\")) return \"video/vnd.hubs-webrtc\";\n  if (url.startsWith(\"data:\")) {\n    const matches = dataUrlRegex.match(url);\n    if (matches.length > 0) {\n      matches[1];\n    }\n  }\n  const extension = new URL(url, window.location).pathname.split(\".\").pop();\n  return commonKnownContentTypes[extension];\n};\nconst hubsSceneRegex = /https?:\\/\\/(hubs.local(:\\d+)?|(smoke-)?hubs.mozilla.com|(dev\\.)?reticulum.io)\\/scenes\\/(\\w+)\\/?\\S*/;\nconst hubsAvatarRegex = /https?:\\/\\/(hubs.local(:\\d+)?|(smoke-)?hubs.mozilla.com|(dev\\.)?reticulum.io)\\/avatars\\/(\\w+)\\/?\\S*/;\nconst hubsRoomRegex = /https?:\\/\\/(hubs.local(:\\d+)?|(smoke-)?hubs.mozilla.com|(dev\\.)?reticulum.io)\\/(\\w+)\\/?\\S*/;\nexport const isHubsSceneUrl = hubsSceneRegex.test.bind(hubsSceneRegex);\nexport const isHubsRoomUrl = url => !isHubsSceneUrl(url) && hubsRoomRegex.test(url);\nexport const isHubsDestinationUrl = url => isHubsSceneUrl(url) || isHubsRoomUrl(url);\nexport const isHubsAvatarUrl = hubsAvatarRegex.test.bind(hubsAvatarRegex);\n","// Utilities for manipulating state history. This provides a number of functions which\n// need to be used to manipulate history state so we can deal with edge cases around\n// entry back button and refreshes once entered.\n//\n// These functions also transparently deal with the room slug, so incoming calls can ignore\n// dealing with it, and provides APIs for getting the non-slug part of the path.\n//\n// The slug cannot be part of the basename for history, because the slug changes intra-session\n// if the room is renamed.\n\n// This pushes/replaces a new k, v pair into the history, while maintaining all the other\n// keys, or clears state if k if null.\n//\n// Also maintains a length key that can be used to find the length of the history chain\n// (across refreshes) for the current room.\nfunction pushOrUpdateHistory(history, replace, k, v, detail, newPathname, newSearch) {\n  let state = {};\n  const newLength = ((history.location.state && history.location.state.__historyLength) || 0) + (replace ? 0 : 1);\n\n  if (k || newPathname || newSearch) {\n    state = history.location.state ? { ...history.location.state } : {};\n    delete state.__duplicate;\n\n    if (k) {\n      state[k] = v;\n      state.key = k;\n      state.value = v;\n      state.detail = detail;\n    }\n  }\n\n  const pathname =\n    newPathname !== undefined ? newPathname : history.location.pathname === \"/\" ? \"\" : history.location.pathname;\n\n  const search = newSearch !== undefined ? newSearch : history.location.search;\n\n  // If popToBeginningOfHubHistory was previously used, there is a duplicate entry\n  // at the top of the history stack (which was needed to wipe out forward history)\n  // so we use this opportunity to replace it.\n  const isDuplicate = history.location.state && history.location.state.__duplicate;\n  const method = replace || isDuplicate ? history.replace : history.push;\n  state.__historyLength = newLength;\n\n  method({ pathname, search, state });\n}\n\nexport function pushHistoryState(history, k, v, detail) {\n  pushOrUpdateHistory(history, false, k, v, detail);\n}\n\nexport function replaceHistoryState(history, k, v, detail) {\n  pushOrUpdateHistory(history, true, k, v, detail);\n}\n\nexport function pushHistoryPath(history, path, search) {\n  pushOrUpdateHistory(history, false, null, null, null, path, search);\n}\n\nexport function clearHistoryState(history) {\n  pushOrUpdateHistory(history, false);\n}\n\n// This will pop the browser history to the first entry that was for this hubs room,\n// and then push a duplicate entry onto the history stack in order to wipe out forward\n// history.\nexport function popToBeginningOfHubHistory(history, navigateToPriorPage) {\n  if (!history.location.state || history.location.state.__historyLength === undefined) return;\n\n  const len = history.location.state.__historyLength;\n  if (len === 0) return;\n\n  return new Promise(resolve => {\n    // After the go() completes, we push a duplicate history entry onto the stack\n    // in order to wipe out forward history. We also optionally go back -2 if we wanted\n    // to go back to the prior page.\n    const unsubscribe = history.listen(() => {\n      unsubscribe();\n      history.push({\n        pathname: history.location.pathname,\n        search: history.location.search,\n        state: { __historyLength: 0, __duplicate: true }\n      });\n      if (navigateToPriorPage) history.go(-2); // Go back to history entry before beginning.\n      resolve();\n    });\n\n    history.go(-len);\n  });\n}\n\n// This will pop the browser history to the entry before the first entry for this hubs room.\nexport function navigateToPriorPage(history) {\n  popToBeginningOfHubHistory(history, true);\n}\n\n// Returns the part of the pathname that does not include the slug\nexport function sluglessPath(location) {\n  const parts = location.pathname.split(\"/\");\n  return `/${parts.slice(2).join(\"/\")}`;\n}\n\n// Returns a new path that includes the current slug as a prefix to the\n// provided path.\nexport function withSlug(location, path) {\n  const parts = location.pathname.split(\"/\");\n  return `/${parts[1]}${path}`;\n}\n","import { fetchReticulumAuthenticated } from \"./phoenix-utils\";\nimport { proxiedUrlFor } from \"./media-url-utils\";\nimport { avatars } from \"../assets/avatars/avatars\";\n\nexport const AVATAR_TYPES = {\n  LEGACY: \"legacy\",\n  SKINNABLE: \"skinnable\",\n  URL: \"url\"\n};\n\nconst legacyAvatarIds = avatars.map(a => a.id);\nexport function getAvatarType(avatarId) {\n  if (!avatarId || legacyAvatarIds.indexOf(avatarId) !== -1) return AVATAR_TYPES.LEGACY;\n  if (avatarId.startsWith(\"http\")) return AVATAR_TYPES.URL;\n  return AVATAR_TYPES.SKINNABLE;\n}\n\nasync function fetchSkinnableAvatar(avatarId) {\n  const resp = await fetchReticulumAuthenticated(`/api/v1/avatars/${avatarId}`);\n  return resp && resp.avatars && resp.avatars[0];\n}\n\nexport async function fetchAvatar(avatarId) {\n  switch (getAvatarType(avatarId)) {\n    case AVATAR_TYPES.LEGACY:\n      return {\n        avatar_id: avatarId,\n        gltf_url: avatars.find(avatar => avatar.id === avatarId).model\n      };\n    case AVATAR_TYPES.SKINNABLE:\n      return fetchSkinnableAvatar(avatarId);\n    case AVATAR_TYPES.URL:\n      return {\n        avatar_id: avatarId,\n        gltf_url: proxiedUrlFor(avatarId)\n      };\n  }\n}\n\nasync function fetchAvatarGltfUrl(avatarId) {\n  return fetchAvatar(avatarId).then(avatar => avatar && avatar.gltf_url);\n}\n\nexport function getAvatarSrc(avatarId) {\n  switch (getAvatarType(avatarId)) {\n    case AVATAR_TYPES.LEGACY:\n      return `#${avatarId}`;\n    case AVATAR_TYPES.SKINNABLE:\n      return fetchAvatarGltfUrl(avatarId);\n    case AVATAR_TYPES.URL:\n      return proxiedUrlFor(avatarId);\n    default:\n      return avatarId;\n  }\n}\n\nexport async function getAvatarThumbnailUrl(avatarId) {\n  switch (getAvatarType(avatarId)) {\n    case AVATAR_TYPES.LEGACY:\n      return avatars.find(avatar => avatar.id === avatarId).thumbnail;\n    case AVATAR_TYPES.SKINNABLE:\n      return fetchAvatar(avatarId).then(avatar => avatar.files.thumbnail);\n    default:\n      return \"https://asset-bundles-prod.reticulum.io/bots/avatar_unavailable.png\";\n  }\n}\n","const VERTEX_SHADER = `\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n  #include <uv_vertex>\n  #include <uv2_vertex>\n  #include <color_vertex>\n  #include <skinbase_vertex>\n\n  #include <begin_vertex>\n  #include <morphtarget_vertex>\n  #include <skinning_vertex>\n  #include <project_vertex>\n  #include <logdepthbuf_vertex>\n\n  #include <worldpos_vertex>\n  #include <clipping_planes_vertex>\n  #include <fog_vertex>\n}\n`;\n\nconst FRAGMENT_SHADER = `\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <aomap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n  #include <clipping_planes_fragment>\n\n  vec4 diffuseColor = vec4(diffuse, opacity);\n  ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n  vec3 totalEmissiveRadiance = emissive;\n\n  #include <logdepthbuf_fragment>\n  #include <map_fragment>\n  #include <color_fragment>\n  #include <alphatest_fragment>\n  #include <emissivemap_fragment>\n\n  reflectedLight.indirectDiffuse += vec3(1.0);\n\n  #include <aomap_fragment>\n\n  reflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n  vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n  gl_FragColor = vec4(outgoingLight, diffuseColor.a);\n\n  #include <premultiplied_alpha_fragment>\n  #include <tonemapping_fragment>\n  #include <encodings_fragment>\n  #include <fog_fragment>\n}\n`;\n\nexport default class MobileStandardMaterial extends THREE.ShaderMaterial {\n  type = \"MobileStandardMaterial\";\n  isMobileStandardMaterial = true;\n  static fromStandardMaterial(material) {\n    const parameters = {\n      vertexShader: VERTEX_SHADER,\n      fragmentShader: FRAGMENT_SHADER,\n      uniforms: {\n        uvTransform: { value: new THREE.Matrix3() },\n        diffuse: { value: material.color },\n        opacity: { value: material.opacity },\n        map: { value: material.map },\n        aoMapIntensity: { value: material.aoMapIntensity },\n        aoMap: { value: material.aoMap },\n        emissive: { value: material.emissive },\n        emissiveMap: { value: material.emissiveMap }\n      },\n      fog: true,\n      lights: false,\n      opacity: material.opacity,\n      transparent: material.transparent,\n      alphaTest: material.alphaTest,\n      skinning: material.skinning,\n      morphTargets: material.morphTargets,\n      vertexColors: material.vertexColors\n    };\n\n    const mobileMaterial = new MobileStandardMaterial(parameters);\n\n    mobileMaterial.color = material.color;\n    mobileMaterial.map = material.map;\n    mobileMaterial.aoMap = material.aoMap;\n    mobileMaterial.aoMapIntensity = material.aoMapIntensity;\n    mobileMaterial.emissive = material.emissive;\n    mobileMaterial.emissiveMap = material.emissiveMap;\n\n    return mobileMaterial;\n  }\n  clone() {\n    return MobileStandardMaterial.fromStandardMaterial(this);\n  }\n}\n","import { EventTarget } from \"event-target-shim\";\nimport { getReticulumFetchUrl, fetchReticulumAuthenticated } from \"../utils/phoenix-utils\";\nimport { pushHistoryPath, sluglessPath, withSlug } from \"../utils/history\";\n\nexport const SOURCES = [\"poly\", \"sketchfab\", \"videos\", \"scenes\", \"gifs\", \"images\", \"twitch\"];\n\nconst EMPTY_RESULT = { entries: [], meta: {} };\n\nconst URL_SOURCE_TO_TO_API_SOURCE = {\n  scenes: \"scene_listings\",\n  images: \"bing_images\",\n  videos: \"bing_videos\",\n  youtube: \"youtube_videos\",\n  gifs: \"tenor\",\n  sketchfab: \"sketchfab\",\n  poly: \"poly\",\n  twitch: \"twitch\",\n  favorites: \"favorites\"\n};\n\nexport const MEDIA_SOURCE_DEFAULT_FILTERS = {\n  gifs: \"trending\",\n  sketchfab: \"featured\",\n  scenes: \"featured\",\n  favorites: \"my-favorites\"\n};\n\nconst SEARCH_CONTEXT_PARAMS = [\"q\", \"filter\", \"cursor\"];\n\n// This class is responsible for fetching and storing media search results and provides a\n// convenience API for performing history updates relevant to search navigation.\nexport default class MediaSearchStore extends EventTarget {\n  constructor() {\n    super();\n\n    this.requestIndex = 0;\n  }\n\n  setHistory(history) {\n    this.history = history;\n\n    this._update(this.history.location);\n\n    this.history.listen(location => {\n      this._update(location);\n    });\n  }\n\n  _update = async location => {\n    this.result = null;\n    this.dispatchEvent(new CustomEvent(\"statechanged\"));\n\n    const urlSource = this.getUrlMediaSource(location);\n    if (!urlSource) return;\n\n    if (!this.previousSource || this.previousSource !== urlSource) {\n      this.dispatchEvent(new CustomEvent(\"sourcechanged\"));\n      this.previousSource = urlSource;\n    }\n\n    const urlParams = new URLSearchParams(location.search);\n\n    this.requestIndex++;\n    const currentRequestIndex = this.requestIndex;\n    const searchParams = new URLSearchParams();\n    const locationSearchParams = new URLSearchParams(location.search);\n    const isMy = locationSearchParams.get(\"filter\") && locationSearchParams.get(\"filter\").startsWith(\"my-\");\n\n    for (const param of SEARCH_CONTEXT_PARAMS) {\n      if (!urlParams.get(param)) continue;\n      searchParams.set(param, urlParams.get(param));\n    }\n\n    searchParams.get(\"locale\", navigator.languages[0]);\n\n    let source;\n    if (urlSource === \"avatars\" || urlSource === \"scenes\") {\n      // Avatars + scenes are special since we request them from a different source based on the facet.\n      const singular = urlSource === \"avatars\" ? \"avatar\" : \"scene\";\n      source = isMy ? `${singular}s` : `${singular}_listings`;\n    } else {\n      source = URL_SOURCE_TO_TO_API_SOURCE[urlSource];\n    }\n    searchParams.set(\"source\", source);\n\n    let fetch = true;\n\n    if (source === \"avatars\" || source === \"scenes\" || source === \"favorites\") {\n      if (isMy) {\n        if (window.APP.store.credentialsAccountId) {\n          searchParams.set(\"user\", window.APP.store.credentialsAccountId);\n        } else {\n          fetch = false; // Don't fetch my-* if not signed in\n        }\n      }\n    }\n\n    const path = `/api/v1/media/search?${searchParams.toString()}`;\n    const url = getReticulumFetchUrl(path);\n    if (this.lastSavedUrl === url) return;\n\n    this.isFetching = true;\n    this.dispatchEvent(new CustomEvent(\"statechanged\"));\n    const result = fetch ? await fetchReticulumAuthenticated(path) : EMPTY_RESULT;\n\n    if (this.requestIndex != currentRequestIndex) return;\n\n    this.result = result;\n    this.nextCursor = this.result && this.result.meta && this.result.meta.next_cursor;\n    this.lastFetchedUrl = url;\n    this.isFetching = false;\n    this.dispatchEvent(new CustomEvent(\"statechanged\"));\n  };\n\n  _legacyAvatarToSearchEntry = legacyAvatar => {\n    return {\n      id: legacyAvatar.id,\n      type: \"avatar_listing\",\n      url: legacyAvatar.url,\n      images: { preview: { url: legacyAvatar.thumbnail, width: 720, height: 1280 } },\n      gltfs: { avatar: legacyAvatar.model }\n    };\n  };\n\n  pageNavigate = delta => {\n    if (delta === -1) {\n      this.history.goBack();\n    } else {\n      const location = this.history.location;\n      const searchParams = new URLSearchParams(location.search);\n      searchParams.set(\"cursor\", this.nextCursor);\n      pushHistoryPath(this.history, location.pathname, searchParams.toString());\n    }\n  };\n\n  filterQueryNavigate = (filter, query) => {\n    const location = this.history.location;\n    const searchParams = new URLSearchParams(location.search);\n\n    if (query) {\n      searchParams.set(\"q\", query);\n    } else {\n      searchParams.delete(\"q\");\n    }\n\n    if (filter) {\n      searchParams.set(\"filter\", filter);\n    } else {\n      searchParams.delete(\"filter\");\n    }\n\n    if (filter) {\n      searchParams.set(\"cursor\", filter);\n    } else {\n      searchParams.delete(\"cursor\");\n    }\n\n    pushHistoryPath(this.history, location.pathname, searchParams.toString());\n  };\n\n  getSearchClearedSearchParams = (location, keepSource, keepNav) => {\n    const searchParams = new URLSearchParams(location.search);\n\n    // Strip browsing query params\n    searchParams.delete(\"q\");\n    searchParams.delete(\"filter\");\n    searchParams.delete(\"cursor\");\n\n    if (!keepNav) {\n      searchParams.delete(\"media_nav\");\n    }\n\n    if (!keepSource) {\n      searchParams.delete(\"media_source\");\n    }\n\n    return searchParams;\n  };\n\n  _stashLastSearchParams = location => {\n    const searchParams = new URLSearchParams(location.search);\n\n    this._stashedParams = {};\n    this._stashedSource = null;\n\n    const source = this.getUrlMediaSource(location);\n\n    // HACK for now do not stash favorite search, since that ends up being a source\n    // we do not reveal in the media browser UX. Revisit the rules here when we have a\n    // proper favorites browser. Then, we should have two separate stashes.\n    if (source === \"favorites\") return;\n    this._stashedSource = source;\n\n    for (const param of SEARCH_CONTEXT_PARAMS) {\n      const value = searchParams.get(param);\n\n      if (value) {\n        this._stashedParams[param] = value;\n      }\n    }\n  };\n\n  clearStashedQuery = () => {\n    if (!this._stashedParams) return;\n    delete this._stashedParams.q;\n  };\n\n  sourceNavigate = source => {\n    this._sourceNavigate(source, false, true);\n  };\n\n  sourceNavigateToDefaultSource = () => {\n    this._sourceNavigate(this._stashedSource ? this._stashedSource : SOURCES[0], false, true);\n  };\n\n  sourceNavigateWithNoNav = source => {\n    this._sourceNavigate(source, true, false);\n  };\n\n  _sourceNavigate = async (source, hideNav, useLastStashedParams) => {\n    const currentQuery = new URLSearchParams(this.history.location.search).get(\"q\");\n    const searchParams = this.getSearchClearedSearchParams(this.history.location);\n\n    if (currentQuery) {\n      searchParams.set(\"q\", currentQuery);\n    } else {\n      if (useLastStashedParams && this._stashedParams) {\n        for (const param of SEARCH_CONTEXT_PARAMS) {\n          const value = this._stashedParams[param];\n\n          // Only q param is compatible across sources, so keep it if is stashed.\n          const useValue = param === \"q\" || this._stashedSource === source;\n\n          if (value && useValue) {\n            searchParams.set(param, value);\n          }\n        }\n      } else {\n        if (source === \"avatars\") {\n          const hasAccountWithAvatars = await this._hasAccountWithAvatars();\n          searchParams.set(\"filter\", hasAccountWithAvatars ? \"my-avatars\" : \"featured\");\n        } else if (MEDIA_SOURCE_DEFAULT_FILTERS[source]) {\n          searchParams.set(\"filter\", MEDIA_SOURCE_DEFAULT_FILTERS[source]);\n        }\n      }\n    }\n\n    this._stashedParams = null;\n    this._stashedSource = null;\n\n    if (hideNav) {\n      searchParams.set(\"media_nav\", \"false\");\n    }\n\n    if (process.env.RETICULUM_SERVER && document.location.host !== process.env.RETICULUM_SERVER) {\n      searchParams.set(\"media_source\", source);\n      pushHistoryPath(this.history, this.history.location.pathname, searchParams.toString());\n    } else {\n      pushHistoryPath(this.history, withSlug(this.history.location, `/media/${source}`), searchParams.toString());\n    }\n  };\n\n  _hasAccountWithAvatars = async () => {\n    const { credentialsAccountId } = window.APP.store;\n    if (!credentialsAccountId) return false;\n\n    const searchParams = new URLSearchParams();\n    const source = \"avatars\";\n    searchParams.set(\"source\", source);\n    searchParams.set(\"user\", credentialsAccountId);\n    const result = await fetchReticulumAuthenticated(`/api/v1/media/search?${searchParams.toString()}`);\n    return !!(result && result.entries) && result.entries.length > 0;\n  };\n\n  getUrlMediaSource = location => {\n    const { search } = location;\n    const urlParams = new URLSearchParams(search);\n    const pathname = sluglessPath(location);\n\n    if (!pathname.startsWith(\"/media\") && !urlParams.get(\"media_source\")) return null;\n    return urlParams.get(\"media_source\") || pathname.substring(7);\n  };\n\n  pushExitMediaBrowserHistory = (history, stashLastSearchParams = true) => {\n    if (!history) history = this.history;\n\n    if (stashLastSearchParams) this._stashLastSearchParams(history.location);\n\n    const { pathname } = history.location;\n    const hasMediaPath = sluglessPath(history.location).startsWith(\"/media\");\n    pushHistoryPath(\n      history,\n      hasMediaPath ? withSlug(history.location, \"/\") : pathname,\n      this.getSearchClearedSearchParams(history.location).toString()\n    );\n    this.dispatchEvent(new CustomEvent(\"media-exit\"));\n  };\n}\n","import nextTick from \"../utils/next-tick\";\nimport { mapMaterials } from \"../utils/material-utils\";\nimport SketchfabZipWorker from \"../workers/sketchfab-zip.worker.js\";\nimport MobileStandardMaterial from \"../materials/MobileStandardMaterial\";\nimport { textureLoader } from \"../utils/media-utils\";\nimport { getCustomGLTFParserURLResolver } from \"../utils/media-url-utils\";\nimport { promisifyWorker } from \"../utils/promisify-worker.js\";\nimport { MeshBVH, acceleratedRaycast } from \"three-mesh-bvh\";\nimport { disposeNode } from \"../utils/three-utils\";\n\nTHREE.Mesh.prototype.raycast = acceleratedRaycast;\n\nclass GLTFCache {\n  cache = new Map();\n\n  set(src, gltf) {\n    this.cache.set(src, {\n      gltf,\n      count: 0\n    });\n    return this.retain(src);\n  }\n\n  has(src) {\n    return this.cache.has(src);\n  }\n\n  get(src) {\n    return this.cache.get(src);\n  }\n\n  retain(src) {\n    const cacheItem = this.cache.get(src);\n    cacheItem.count++;\n    return cacheItem;\n  }\n\n  release(src) {\n    const cacheItem = this.cache.get(src);\n\n    if (!cacheItem) {\n      console.error(`Releasing uncached gltf ${src}`);\n      return;\n    }\n\n    cacheItem.count--;\n    if (cacheItem.count <= 0) {\n      cacheItem.gltf.scene.traverse(disposeNode);\n      this.cache.delete(src);\n    }\n  }\n}\nconst gltfCache = new GLTFCache();\nconst inflightGltfs = new Map();\n\nconst extractZipFile = promisifyWorker(new SketchfabZipWorker());\n\nfunction defaultInflator(el, componentName, componentData) {\n  if (!AFRAME.components[componentName]) {\n    throw new Error(`Inflator failed. \"${componentName}\" component does not exist.`);\n  }\n  if (AFRAME.components[componentName].multiple && Array.isArray(componentData)) {\n    for (let i = 0; i < componentData.length; i++) {\n      el.setAttribute(componentName + \"__\" + i, componentData[i]);\n    }\n  } else {\n    el.setAttribute(componentName, componentData);\n  }\n}\n\nAFRAME.GLTFModelPlus = {\n  // eslint-disable-next-line no-unused-vars\n  components: {},\n  registerComponent(componentKey, componentName, inflator) {\n    inflator = inflator || defaultInflator;\n    AFRAME.GLTFModelPlus.components[componentKey] = { inflator, componentName };\n  }\n};\n\nfunction parallelTraverse(a, b, callback) {\n  callback(a, b);\n\n  for (let i = 0; i < a.children.length; i++) {\n    parallelTraverse(a.children[i], b.children[i], callback);\n  }\n}\n\nfunction generateMeshBVH(object3D) {\n  object3D.traverse(obj => {\n    // note that we might already have a bounds tree if this was a clone of an object with one\n    const hasBufferGeometry = obj.isMesh && obj.geometry.isBufferGeometry;\n    const hasBoundsTree = hasBufferGeometry && obj.geometry.boundsTree;\n    if (hasBufferGeometry && !hasBoundsTree && obj.geometry.attributes.position) {\n      const geo = obj.geometry;\n      const triCount = geo.index ? geo.index.count / 3 : geo.attributes.position.count / 3;\n      // only bother using memory and time making a BVH if there are a reasonable number of tris,\n      // and if there are too many it's too painful and large to tolerate doing it (at least until\n      // we put this in a web worker)\n      if (triCount > 1000 && triCount < 1000000) {\n        // note that bounds tree construction creates an index as a side effect if one doesn't already exist\n        geo.boundsTree = new MeshBVH(obj.geometry, { strategy: 0, maxDepth: 30 });\n      }\n    }\n  });\n}\n\n// Modified version of Don McCurdy's AnimationUtils.clone\n// https://github.com/mrdoob/three.js/pull/14494\nfunction cloneSkinnedMesh(source) {\n  const cloneLookup = new Map();\n\n  const clone = source.clone();\n\n  parallelTraverse(source, clone, function(sourceNode, clonedNode) {\n    cloneLookup.set(sourceNode, clonedNode);\n    if (sourceNode.isMesh && sourceNode.geometry.boundsTree) {\n      clonedNode.geometry.boundsTree = sourceNode.geometry.boundsTree;\n    }\n  });\n\n  source.traverse(function(sourceMesh) {\n    if (!sourceMesh.isSkinnedMesh) return;\n\n    const sourceBones = sourceMesh.skeleton.bones;\n    const clonedMesh = cloneLookup.get(sourceMesh);\n\n    clonedMesh.skeleton = sourceMesh.skeleton.clone();\n\n    clonedMesh.skeleton.bones = sourceBones.map(function(sourceBone) {\n      if (!cloneLookup.has(sourceBone)) {\n        throw new Error(\"Required bones are not descendants of the given object.\");\n      }\n\n      return cloneLookup.get(sourceBone);\n    });\n\n    clonedMesh.bind(clonedMesh.skeleton, sourceMesh.bindMatrix);\n  });\n\n  return clone;\n}\n\nfunction cloneGltf(gltf) {\n  return {\n    animations: gltf.animations,\n    scene: cloneSkinnedMesh(gltf.scene)\n  };\n}\n\nfunction getHubsComponents(node) {\n  const hubsComponents =\n    node.userData.gltfExtensions &&\n    (node.userData.gltfExtensions.MOZ_hubs_components || node.userData.gltfExtensions.HUBS_components);\n\n  // We can remove support for legacy components when our environment, avatar and interactable models are\n  // updated to match Spoke output.\n  const legacyComponents = node.userData.components;\n\n  return hubsComponents || legacyComponents;\n}\n\n/// Walks the tree of three.js objects starting at the given node, using the GLTF data\n/// and template data to construct A-Frame entities and components when necessary.\n/// (It's unnecessary to construct entities for subtrees that have no component data\n/// or templates associated with any of their nodes.)\n///\n/// Returns the A-Frame entity associated with the given node, if one was constructed.\nconst inflateEntities = function(indexToEntityMap, node, templates, isRoot, modelToWorldScale = 1) {\n  // TODO: Remove this once we update the legacy avatars to the new node names\n  if (node.name === \"Chest\") {\n    node.name = \"Spine\";\n  } else if (node.name === \"Root Scene\") {\n    node.name = \"AvatarRoot\";\n  } else if (node.name === \"Bot_Skinned\") {\n    node.name = \"AvatarMesh\";\n  }\n\n  // inflate subtrees first so that we can determine whether or not this node needs to be inflated\n  const childEntities = [];\n  const children = node.children.slice(0); // setObject3D mutates the node's parent, so we have to copy\n  for (const child of children) {\n    const el = inflateEntities(indexToEntityMap, child, templates);\n    if (el) {\n      childEntities.push(el);\n    }\n  }\n\n  const entityComponents = getHubsComponents(node);\n\n  const nodeHasBehavior = !!entityComponents || node.name in templates;\n  if (!nodeHasBehavior && !childEntities.length && !isRoot) {\n    return null; // we don't need an entity for this node\n  }\n\n  const el = document.createElement(\"a-entity\");\n  el.append.apply(el, childEntities);\n\n  // Remove invalid CSS class name characters.\n  const className = (node.name || node.uuid).replace(/[^\\w-]/g, \"\");\n  el.classList.add(className);\n\n  // AFRAME rotation component expects rotations in YXZ, convert it\n  if (node.rotation.order !== \"YXZ\") {\n    node.rotation.setFromQuaternion(node.quaternion, \"YXZ\");\n  }\n\n  // Copy over the object's transform to the THREE.Group and reset the actual transform of the Object3D\n  // all updates to the object should be done through the THREE.Group wrapper\n  el.object3D.position.copy(node.position);\n  el.object3D.rotation.copy(node.rotation);\n  el.object3D.scale.copy(node.scale).multiplyScalar(modelToWorldScale);\n  el.object3D.matrixNeedsUpdate = true;\n\n  node.matrixAutoUpdate = false;\n  node.matrix.identity();\n  node.matrix.decompose(node.position, node.rotation, node.scale);\n\n  el.setObject3D(node.type.toLowerCase(), node);\n  if (entityComponents && \"nav-mesh\" in entityComponents) {\n    el.setObject3D(\"mesh\", node);\n  }\n\n  // Set the name of the `THREE.Group` to match the name of the node,\n  // so that `THREE.PropertyBinding` will find (and later animate)\n  // the group. See `PropertyBinding.findNode`:\n  // https://github.com/mrdoob/three.js/blob/dev/src/animation/PropertyBinding.js#L211\n  el.object3D.name = node.name;\n  if (node.animations) {\n    // Pass animations up to the group object so that when we can pass the group as\n    // the optional root in `THREE.AnimationMixer.clipAction` and use the hierarchy\n    // preserved under the group (but not the node). Otherwise `clipArray` will be\n    // `null` in `THREE.AnimationClip.findByName`.\n    node.parent.animations = node.animations;\n  }\n\n  const gltfIndex = node.userData.gltfIndex;\n  if (gltfIndex !== undefined) {\n    indexToEntityMap[gltfIndex] = el;\n  }\n\n  return el;\n};\n\nfunction inflateComponents(inflatedEntity, indexToEntityMap) {\n  inflatedEntity.object3D.traverse(object3D => {\n    const entityComponents = getHubsComponents(object3D);\n    const el = object3D.el;\n\n    if (entityComponents && el) {\n      for (const prop in entityComponents) {\n        if (entityComponents.hasOwnProperty(prop) && AFRAME.GLTFModelPlus.components.hasOwnProperty(prop)) {\n          const { componentName, inflator } = AFRAME.GLTFModelPlus.components[prop];\n          inflator(el, componentName, entityComponents[prop], entityComponents, indexToEntityMap);\n        }\n      }\n    }\n  });\n}\n\nfunction attachTemplate(root, name, templateRoot) {\n  const targetEls = root.querySelectorAll(\".\" + name);\n  for (const el of targetEls) {\n    const root = templateRoot.cloneNode(true);\n    // Merge root element attributes with the target element\n    for (const { name, value } of root.attributes) {\n      el.setAttribute(name, value);\n    }\n\n    // Append all child elements\n    while (root.children.length > 0) {\n      el.appendChild(root.children[0]);\n    }\n  }\n}\n\nfunction runMigration(version, json) {\n  if (version < 2) {\n    //old heightfields will be on the same node as the nav-mesh, delete those\n    const oldHeightfieldNode = json.nodes.find(node => {\n      let components = null;\n      if (node.extensions && node.extensions.MOZ_hubs_components) {\n        components = node.extensions.MOZ_hubs_components;\n      } else if (node.extensions && node.extensions.HUBS_components) {\n        components = node.extensions.HUBS_components;\n      }\n      return components && components.heightfield && components[\"nav-mesh\"];\n    });\n    if (oldHeightfieldNode) {\n      if (oldHeightfieldNode.extensions.MOZ_hubs_components) {\n        delete oldHeightfieldNode.extensions.MOZ_hubs_components.heightfield;\n      } else if (oldHeightfieldNode.extensions.HUBS_components) {\n        delete oldHeightfieldNode.extensions.HUBS_components.heightfield;\n      }\n    }\n  }\n}\n\nexport async function loadGLTF(src, contentType, preferredTechnique, onProgress, jsonPreprocessor) {\n  let gltfUrl = src;\n  let fileMap;\n\n  if (contentType.includes(\"model/gltf+zip\") || contentType.includes(\"application/x-zip-compressed\")) {\n    fileMap = await extractZipFile(gltfUrl);\n    gltfUrl = fileMap[\"scene.gtlf\"];\n  }\n\n  const loadingManager = new THREE.LoadingManager();\n  loadingManager.setURLModifier(getCustomGLTFParserURLResolver(gltfUrl));\n  const gltfLoader = new THREE.GLTFLoader(loadingManager);\n\n  const parser = await new Promise((resolve, reject) => gltfLoader.createParser(gltfUrl, resolve, onProgress, reject));\n\n  parser.textureLoader = textureLoader;\n\n  if (jsonPreprocessor) {\n    parser.json = jsonPreprocessor(parser.json);\n  }\n\n  let version = 0;\n  if (\n    parser.json.extensions &&\n    parser.json.extensions.MOZ_hubs_components &&\n    parser.json.extensions.MOZ_hubs_components.hasOwnProperty(\"version\")\n  ) {\n    version = parser.json.extensions.MOZ_hubs_components.version;\n  }\n  runMigration(version, parser.json);\n\n  const materials = parser.json.materials;\n  if (materials) {\n    for (let i = 0; i < materials.length; i++) {\n      const material = materials[i];\n\n      if (\n        material.extensions &&\n        material.extensions.MOZ_alt_materials &&\n        material.extensions.MOZ_alt_materials[preferredTechnique] !== undefined\n      ) {\n        const altMaterialIndex = material.extensions.MOZ_alt_materials[preferredTechnique];\n        materials[i] = materials[altMaterialIndex];\n      }\n    }\n  }\n\n  const nodes = parser.json.nodes;\n\n  if (nodes) {\n    for (let i = 0; i < nodes.length; i++) {\n      const node = nodes[i];\n\n      if (!node.extras) {\n        node.extras = {};\n      }\n\n      node.extras.gltfIndex = i;\n    }\n  }\n\n  const gltf = await new Promise(parser.parse.bind(parser));\n\n  gltf.scene.traverse(object => {\n    // GLTFLoader sets matrixAutoUpdate on animated objects, we want to keep the defaults\n    object.matrixAutoUpdate = THREE.Object3D.DefaultMatrixAutoUpdate;\n\n    object.material = mapMaterials(object, material => {\n      if (material.isMeshStandardMaterial && preferredTechnique === \"KHR_materials_unlit\") {\n        return MobileStandardMaterial.fromStandardMaterial(material);\n      }\n\n      return material;\n    });\n  });\n\n  if (fileMap) {\n    // The GLTF is now cached as a THREE object, we can get rid of the original blobs\n    Object.keys(fileMap).forEach(URL.revokeObjectURL);\n  }\n\n  return gltf;\n}\n\n/**\n * Loads a GLTF model, optionally recursively \"inflates\" the child nodes of a model into a-entities and sets\n * whitelisted components on them if defined in the node's extras.\n * @namespace gltf\n * @component gltf-model-plus\n */\nAFRAME.registerComponent(\"gltf-model-plus\", {\n  schema: {\n    src: { type: \"string\" },\n    contentType: { type: \"string\" },\n    useCache: { default: true },\n    inflate: { default: false },\n    batch: { default: false },\n    modelToWorldScale: { type: \"number\", default: 1 }\n  },\n\n  init() {\n    this.preferredTechnique =\n      window.APP && window.APP.quality === \"low\" ? \"KHR_materials_unlit\" : \"pbrMetallicRoughness\";\n\n    // This can be set externally if a consumer wants to do some node preprocssing.\n    this.jsonPreprocessor = null;\n\n    this.loadTemplates();\n  },\n\n  update() {\n    this.applySrc(this.data.src, this.data.contentType);\n  },\n\n  remove() {\n    if (this.data.batch && this.model) {\n      this.el.sceneEl.systems[\"hubs-systems\"].batchManagerSystem.removeObject(this.el.object3DMap.mesh);\n    }\n    if (this.data.src) {\n      gltfCache.release(this.data.src);\n    }\n  },\n\n  loadTemplates() {\n    this.templates = {};\n    this.el.querySelectorAll(\":scope > template\").forEach(templateEl => {\n      const root = document.importNode(templateEl.firstElementChild || templateEl.content.firstElementChild, true);\n      this.templates[templateEl.getAttribute(\"data-name\")] = root;\n    });\n  },\n\n  async loadModel(src, contentType, technique, useCache) {\n    if (useCache) {\n      if (gltfCache.has(src)) {\n        gltfCache.retain(src);\n        return cloneGltf(gltfCache.get(src).gltf);\n      } else {\n        if (inflightGltfs.has(src)) {\n          const gltf = await inflightGltfs.get(src);\n          gltfCache.retain(src);\n          return cloneGltf(gltf);\n        } else {\n          const promise = loadGLTF(src, contentType, technique, null, this.jsonPreprocessor);\n          inflightGltfs.set(src, promise);\n          const gltf = await promise;\n          inflightGltfs.delete(src);\n          gltfCache.set(src, gltf);\n          return cloneGltf(gltf);\n        }\n      }\n    } else {\n      return loadGLTF(src, contentType, technique, null, this.jsonPreprocessor);\n    }\n  },\n\n  async applySrc(src, contentType) {\n    try {\n      // If the src attribute is a selector, get the url from the asset item.\n      if (src && src.charAt(0) === \"#\") {\n        const assetEl = document.getElementById(src.substring(1));\n        src = assetEl.getAttribute(\"src\");\n      }\n\n      if (src === this.lastSrc) return;\n\n      const lastSrc = this.lastSrc;\n      this.lastSrc = src;\n\n      if (!src) {\n        if (this.inflatedEl) {\n          console.warn(\"gltf-model-plus set to an empty source, unloading inflated model.\");\n          this.disposeLastInflatedEl();\n        }\n        return;\n      }\n\n      this.el.emit(\"model-loading\");\n      const gltf = await this.loadModel(src, contentType, this.preferredTechnique, this.data.useCache);\n\n      // If we started loading something else already\n      // TODO: there should be a way to cancel loading instead\n      if (src != this.lastSrc) return;\n\n      // If we had inflated something already before, clean that up\n      this.disposeLastInflatedEl();\n\n      this.model = gltf.scene || gltf.scenes[0];\n      this.model.animations = gltf.animations;\n\n      if (this.data.batch) {\n        this.el.sceneEl.systems[\"hubs-systems\"].batchManagerSystem.addObject(this.model);\n      }\n\n      if (gltf.animations.length > 0) {\n        this.el.setAttribute(\"animation-mixer\", {});\n        this.el.components[\"animation-mixer\"].initMixer(gltf.animations);\n      } else {\n        generateMeshBVH(this.model);\n      }\n\n      const indexToEntityMap = {};\n\n      let object3DToSet = this.model;\n      if (\n        this.data.inflate &&\n        (this.inflatedEl = inflateEntities(\n          indexToEntityMap,\n          this.model,\n          this.templates,\n          true,\n          this.data.modelToWorldScale\n        ))\n      ) {\n        this.el.appendChild(this.inflatedEl);\n\n        object3DToSet = this.inflatedEl.object3D;\n        // TODO: Still don't fully understand the lifecycle here and how it differs between browsers, we should dig in more\n        // Wait one tick for the appended custom elements to be connected before attaching templates\n        await nextTick();\n        if (src != this.lastSrc) return; // TODO: there must be a nicer pattern for this\n\n        inflateComponents(this.inflatedEl, indexToEntityMap);\n\n        for (const name in this.templates) {\n          attachTemplate(this.el, name, this.templates[name]);\n        }\n      }\n\n      // The call to setObject3D below recursively clobbers any `el` backreferences to entities\n      // in the entire inflated entity graph to point to `object3DToSet`.\n      //\n      // We don't want those overwritten, since lots of code assumes `object3d.el` points to the relevant\n      // A-Frame entity for that three.js object, so we back them up and re-wire them here. If we didn't do\n      // this, all the `el` properties on these object3ds would point to the `object3DToSet` which is either\n      // the model or the root GLTF inflated entity.\n      const rewires = [];\n\n      object3DToSet.traverse(o => {\n        const el = o.el;\n        if (el) rewires.push(() => (o.el = el));\n      });\n\n      const environmentMapComponent = this.el.sceneEl.components[\"environment-map\"];\n\n      if (environmentMapComponent) {\n        environmentMapComponent.applyEnvironmentMap(object3DToSet);\n      }\n\n      if (lastSrc) {\n        gltfCache.release(lastSrc);\n      }\n      this.el.setObject3D(\"mesh\", object3DToSet);\n\n      rewires.forEach(f => f());\n\n      this.el.emit(\"model-loaded\", { format: \"gltf\", model: this.model });\n    } catch (e) {\n      gltfCache.release(src);\n      console.error(\"Failed to load glTF model\", e, this);\n      this.el.emit(\"model-error\", { format: \"gltf\", src });\n    }\n  },\n\n  disposeLastInflatedEl() {\n    if (this.inflatedEl) {\n      this.inflatedEl.parentNode.removeChild(this.inflatedEl);\n\n      this.inflatedEl.object3D.traverse(x => {\n        if (x.material && x.material.dispose) {\n          x.material.dispose();\n        }\n\n        if (x.geometry) {\n          if (x.geometry.dispose) {\n            x.geometry.dispose();\n          }\n\n          x.geometry.boundsTree = null;\n        }\n      });\n\n      delete this.inflatedEl;\n\n      this.el.removeAttribute(\"animation-mixer\");\n    }\n  }\n});\n","// Wrapper for a worker which accepts work items and responds with results.\n//\n// The worker must receive messages with data of the shape { id, payload }, and then respond\n// with messages containing matching IDs of the shape { id, result, err }.\n//\n// Returns a function that accepts a work item, sends it to the worker, and returns a promise that\n// will resolve with the result or reject with the error.\n//\nexport function promisifyWorker(worker) {\n  let nextItemId = 0;\n  const outstanding = {}; // item ID: { resolve, reject }\n\n  worker.onmessage = msg => {\n    const { id, result, err } = msg.data;\n    const handlers = outstanding[id];\n    if (handlers == null) {\n      console.error(`Unknown message with ID ${id} received from ${worker}.`);\n    } else {\n      delete outstanding[id];\n      if (err != null) {\n        handlers.reject(new Error(err));\n      } else {\n        handlers.resolve(result);\n      }\n    }\n  };\n\n  return function(data, transfer) {\n    const id = nextItemId++;\n    const promise = new Promise((resolve, reject) => {\n      outstanding[id] = { resolve, reject };\n    });\n    worker.postMessage({ id, payload: data }, transfer);\n    return promise;\n  };\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"avatar-landing\":\"avatar__avatar-landing__3bdoO\",\"avatarLanding\":\"avatar__avatar-landing__3bdoO\",\"form-submit\":\"avatar__form-submit__3OEBN\",\"formSubmit\":\"avatar__form-submit__3OEBN\",\"title\":\"avatar__title__PP1dU\",\"attributions\":\"avatar__attributions__1Ej7c\",\"logo\":\"avatar__logo__35vmn\",\"box\":\"avatar__box__vyKNY\",\"selected-message\":\"avatar__selected-message__25S2j\",\"selectedMessage\":\"avatar__selected-message__25S2j\",\"preview\":\"avatar__preview__3T2SV\"};","console.log(`Hubs version: ${process.env.BUILD_VERSION || \"?\"}`);\n\n// We should technically be able to just include three here, but our dependancies are tangled such that not having aframe is a bit difficult\nimport \"aframe\";\nimport \"./utils/logging\";\n\nimport { getAirtableAssets, airtableAssetsInitialState } from './everyspace/airtable';\nimport { HelmetComponent } from './everyspace/helmet';\n\nimport ReactDOM from \"react-dom\";\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport classNames from \"classnames\";\n\nimport { IntlProvider, FormattedMessage, addLocaleData } from \"react-intl\";\nimport en from \"react-intl/locale-data/en\";\nimport { lang, messages } from \"./utils/i18n\";\naddLocaleData([...en]);\n\nimport { disableiOSZoom } from \"./utils/disable-ios-zoom\";\ndisableiOSZoom();\n\nimport { App } from \"./App\";\n\nimport AvatarPreview from \"./react-components/avatar-preview\";\n\nimport { fetchAvatar } from \"./utils/avatar-utils\";\n\nimport styles from \"./assets/stylesheets/avatar.scss\";\nimport hubLogo from \"./assets/images/hub-preview-white.png\";\n\nconst qs = new URLSearchParams(location.search);\nwindow.APP = new App();\n\nclass AvatarUI extends React.Component {\n  static propTypes = {\n    avatarId: PropTypes.string,\n    store: PropTypes.object,\n    intl: PropTypes.object\n  };\n\n  constructor(props) {\n    super(props);\n    this.state = {airtableAssets: airtableAssetsInitialState};\n  }\n\n  componentDidMount() {\n    this.props.store.addEventListener(\"statechanged\", this.storeUpdated);\n    this.refetchAvatar();\n\n    this.fetchAirtableAssets()\n  }\n\n  fetchAirtableAssets = async () => {\n    const airtableAssets = await getAirtableAssets()\n    if (airtableAssets) this.setState({ airtableAssets })\n  }\n\n  componentWillUnmount() {\n    this.props.store.removeEventListener(\"statechanged\", this.storeUpdated);\n  }\n\n  storeUpdated = () => this.forceUpdate();\n\n  refetchAvatar = async () => {\n    const avatar = await fetchAvatar(this.props.avatarId);\n    this.setState({ avatar });\n  };\n\n  setAvatar = e => {\n    e && e.preventDefault();\n    this.props.store.update({\n      profile: { avatarId: this.state.avatar.avatar_id }\n    });\n  };\n\n  render() {\n    const { avatar } = this.state;\n    if (!avatar) {\n      return (\n        <div className={styles.avatarLanding}>\n          <div className={classNames([styles.box, styles.darkened])}>Loading</div>\n        </div>\n      );\n    }\n\n    const selectedAvatarId = this.props.store.state.profile.avatarId;\n    const isSelected = avatar.avatar_id === selectedAvatarId;\n\n    return (\n      <form onSubmit={this.setAvatar} className={styles.avatarLanding}>\n        <div className={classNames([styles.box, styles.darkened])}>\n          <HelmetComponent assets={this.state.airtableAssets} page=\"Avatar\" />\n          <label className={styles.title}>\n            <span>{avatar.name}</span>\n          </label>\n          <div className={styles.attributions}>\n            {avatar.attributions && avatar.attributions.creator && <span>{`by ${avatar.attributions.creator}`}</span>}\n          </div>\n          <div className={styles.preview}>{avatar && <AvatarPreview avatarGltfUrl={avatar.gltf_url} />}</div>\n          {isSelected ? (\n            <span className={styles.selectedMessage}>\n              <FormattedMessage id=\"avatar-landing.selected\" />\n            </span>\n          ) : (\n            <button disabled={isSelected} className={styles.formSubmit} type=\"submit\">\n              <FormattedMessage id=\"avatar-landing.select\" />\n            </button>\n          )}\n        </div>\n        <img className={styles.logo} src={this.state.airtableAssets.DarkLogo} />\n      </form>\n    );\n  }\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  const avatarId = qs.get(\"avatar_id\") || document.location.pathname.substring(1).split(\"/\")[1];\n  console.log(`Avatar ID: ${avatarId}`);\n  ReactDOM.render(\n    <IntlProvider locale={lang} messages={messages}>\n      <AvatarUI avatarId={avatarId} store={window.APP.store} />\n    </IntlProvider>,\n    document.getElementById(\"ui-root\")\n  );\n});\n","import { forEachMaterial } from \"../utils/material-utils\";\nimport { showHoverEffect } from \"../utils/permissions-utils\";\n\nconst interactorOneTransform = [];\nconst interactorTwoTransform = [];\n\nexport const validMaterials = [\"MeshStandardMaterial\", \"MeshBasicMaterial\", \"MobileStandardMaterial\"];\n/**\n * Applies effects to a hoverable based on hover state.\n * @namespace interactables\n * @component hoverable-visuals\n */\nAFRAME.registerComponent(\"hoverable-visuals\", {\n  schema: {\n    enableSweepingEffect: { type: \"boolean\", default: true }\n  },\n  init() {\n    // uniforms and boundingSphere are set from the component responsible for loading the mesh.\n    this.uniforms = null;\n    this.boundingSphere = new THREE.Sphere();\n\n    this.sweepParams = [0, 0];\n  },\n  remove() {\n    this.uniforms = null;\n    this.boundingBox = null;\n\n    // Used when the object is batched\n    const batchManagerSystem = AFRAME.scenes[0].systems[\"hubs-systems\"].batchManagerSystem;\n    this.el.object3D.traverse(object => {\n      if (!object.material) return;\n      forEachMaterial(object, material => {\n        if (\n          !validMaterials.includes(material.type) ||\n          object.el.classList.contains(\"ui\") ||\n          object.el.classList.contains(\"hud\") ||\n          object.el.getAttribute(\"text-button\")\n        )\n          return;\n\n        batchManagerSystem.meshToEl.delete(object);\n      });\n    });\n  },\n  tick(time) {\n    if (!this.uniforms || !this.uniforms.length) return;\n\n    const isFrozen = this.el.sceneEl.is(\"frozen\");\n    const showEffect = showHoverEffect(this.el);\n\n    let interactorOne, interactorTwo;\n    const interaction = AFRAME.scenes[0].systems.interaction;\n    if (interaction.state.leftHand.hovered === this.el && !interaction.state.leftHand.held) {\n      interactorOne = interaction.options.leftHand.entity.object3D;\n    }\n    if (interaction.state.rightRemote.hovered === this.el && !interaction.state.rightRemote.held) {\n      interactorTwo = interaction.options.rightRemote.entity.object3D;\n    }\n    if (interaction.state.rightHand.hovered === this.el && !interaction.state.rightHand.held) {\n      interactorTwo = interaction.options.rightHand.entity.object3D;\n    }\n\n    if (interactorOne) {\n      interactorOne.matrixWorld.toArray(interactorOneTransform);\n    }\n    if (interactorTwo) {\n      interactorTwo.matrixWorld.toArray(interactorTwoTransform);\n    }\n\n    if (interactorOne || interactorTwo || isFrozen) {\n      const worldY = this.el.object3D.matrixWorld.elements[13];\n      const scaledRadius = this.el.object3D.scale.y * this.boundingSphere.radius;\n      this.sweepParams[0] = worldY - scaledRadius;\n      this.sweepParams[1] = worldY + scaledRadius;\n    }\n\n    for (let i = 0, l = this.uniforms.length; i < l; i++) {\n      const uniform = this.uniforms[i];\n      uniform.hubs_EnableSweepingEffect.value = this.data.enableSweepingEffect && showEffect;\n      uniform.hubs_IsFrozen.value = isFrozen;\n      uniform.hubs_SweepParams.value = this.sweepParams;\n\n      uniform.hubs_HighlightInteractorOne.value = !!interactorOne && showEffect;\n      uniform.hubs_InteractorOnePos.value[0] = interactorOneTransform[12];\n      uniform.hubs_InteractorOnePos.value[1] = interactorOneTransform[13];\n      uniform.hubs_InteractorOnePos.value[2] = interactorOneTransform[14];\n\n      uniform.hubs_HighlightInteractorTwo.value = !!interactorTwo && showEffect;\n      uniform.hubs_InteractorTwoPos.value[0] = interactorTwoTransform[12];\n      uniform.hubs_InteractorTwoPos.value[1] = interactorTwoTransform[13];\n      uniform.hubs_InteractorTwoPos.value[2] = interactorTwoTransform[14];\n\n      if (interactorOne || interactorTwo || isFrozen) {\n        uniform.hubs_Time.value = time;\n      }\n    }\n  }\n});\n","import { forEachMaterial } from \"../utils/material-utils\";\nimport cubeMapPosX from \"../assets/images/cubemap/posx.jpg\";\nimport cubeMapNegX from \"../assets/images/cubemap/negx.jpg\";\nimport cubeMapPosY from \"../assets/images/cubemap/posy.jpg\";\nimport cubeMapNegY from \"../assets/images/cubemap/negy.jpg\";\nimport cubeMapPosZ from \"../assets/images/cubemap/posz.jpg\";\nimport cubeMapNegZ from \"../assets/images/cubemap/negz.jpg\";\n\nexport async function createDefaultEnvironmentMap() {\n  const urls = [cubeMapPosX, cubeMapNegX, cubeMapPosY, cubeMapNegY, cubeMapPosZ, cubeMapNegZ];\n  const texture = await new Promise((resolve, reject) =>\n    new THREE.CubeTextureLoader().load(urls, resolve, undefined, reject)\n  );\n  texture.format = THREE.RGBFormat;\n  return texture;\n}\n\nAFRAME.registerComponent(\"environment-map\", {\n  init() {\n    this.environmentMap = null;\n\n    this.updateEnvironmentMap = this.updateEnvironmentMap.bind(this);\n  },\n\n  updateEnvironmentMap(environmentMap) {\n    this.environmentMap = environmentMap;\n    this.applyEnvironmentMap(this.el.object3D);\n  },\n\n  applyEnvironmentMap(object3D) {\n    object3D.traverse(object => {\n      forEachMaterial(object, material => {\n        if (material.isMeshStandardMaterial) {\n          material.envMap = this.environmentMap;\n          material.needsUpdate = true;\n        }\n      });\n    });\n  }\n});\n","module.exports = \"if (hubs_HighlightInteractorOne || hubs_HighlightInteractorTwo || hubs_IsFrozen) {\\n  float ratio = 0.0;\\n\\n  if (hubs_EnableSweepingEffect) {\\n    float size = hubs_SweepParams.t - hubs_SweepParams.s;\\n    float line = mod(hubs_Time / 500.0 * size, size * 3.0) + hubs_SweepParams.s - size / 3.0;\\n\\n    if (hubs_WorldPosition.y < line) {\\n      // Highlight with a sweeping gradient.\\n      ratio = max(0.0, 1.0 - (line - hubs_WorldPosition.y) / (size * 1.5));\\n    }\\n  }\\n\\n  // Highlight with a gradient falling off with distance.\\n  float pulse = 9.0 + 3.0 * (sin(hubs_Time / 1000.0) + 1.0);\\n\\n  if (hubs_HighlightInteractorOne) {\\n    float dist1 = distance(hubs_WorldPosition, hubs_InteractorOnePos);\\n    ratio += -min(1.0, pow(dist1 * pulse, 3.0)) + 1.0;\\n  } \\n\\n  if (hubs_HighlightInteractorTwo) {\\n    float dist2 = distance(hubs_WorldPosition, hubs_InteractorTwoPos);\\n    ratio += -min(1.0, pow(dist2 * pulse, 3.0)) + 1.0;\\n  }\\n\\n  ratio = min(1.0, ratio);\\n\\n  // Gamma corrected highlight color\\n  vec3 highlightColor = vec3(0.184, 0.499, 0.933);\\n\\n  gl_FragColor.rgb = (gl_FragColor.rgb * (1.0 - ratio)) + (highlightColor * ratio);\\n}\\n\"","module.exports = __webpack_public_path__ + \"assets/images/cubemap/posx-d235fb97df77b607be04b84125f40e7c.jpg\";","module.exports = __webpack_public_path__ + \"assets/images/cubemap/negx-35034574e114423babdea92b6a2eb97a.jpg\";","module.exports = __webpack_public_path__ + \"assets/images/cubemap/posy-d0c4e1e7979d75923d4d8b49c191bc6e.jpg\";","module.exports = __webpack_public_path__ + \"assets/images/cubemap/negy-35808d21d1d17ac1b84d3184e365093b.jpg\";","module.exports = __webpack_public_path__ + \"assets/images/cubemap/posz-de29aa8396196e4b040cd5305e351dbe.jpg\";","module.exports = __webpack_public_path__ + \"assets/images/cubemap/negz-d73d18a8b7994524dc39a6ea3fcf43fc.jpg\";","import { detectOS } from \"detect-browser\";\n\nexport function disableiOSZoom() {\n  if (detectOS(navigator.userAgent) !== \"iOS\") return;\n\n  let lastTouchAtMs = 0;\n\n  document.addEventListener(\"touchmove\", ev => {\n    if (ev.scale === 1) return;\n\n    ev.preventDefault();\n  });\n\n  document.addEventListener(\"touchend\", ev => {\n    const now = new Date().getTime();\n    const isDoubleTouch = now - lastTouchAtMs <= 300;\n    lastTouchAtMs = now;\n\n    if (isDoubleTouch) {\n      ev.preventDefault();\n    }\n  });\n}\n","import Store from \"./storage/store\";\nimport MediaSearchStore from \"./storage/media-search-store\";\n\nexport class App {\n  constructor() {\n    this.scene = null;\n    this.quality = \"low\";\n    this.store = new Store();\n    this.mediaSearchStore = new MediaSearchStore();\n  }\n\n  setQuality(quality) {\n    if (this.quality === quality) {\n      return false;\n    }\n\n    this.quality = quality;\n\n    if (this.scene) {\n      this.scene.dispatchEvent(new CustomEvent(\"quality-changed\", { detail: quality }));\n    }\n\n    return true;\n  }\n}\n","function loadAsync(loader, url, onProgress) {\n  return new Promise((resolve, reject) => loader.load(url, resolve, onProgress, reject));\n}\n\nexport default class HubsTextureLoader {\n  static crossOrigin = \"anonymous\";\n\n  constructor(manager = THREE.DefaultLoadingManager) {\n    this.manager = manager;\n  }\n\n  load(url, onLoad, onProgress, onError) {\n    const texture = new THREE.Texture();\n\n    this.loadTextureAsync(texture, url, onProgress)\n      .then(onLoad)\n      .catch(onError);\n\n    return texture;\n  }\n\n  async loadTextureAsync(texture, src, onProgress) {\n    let imageLoader;\n\n    if (window.createImageBitmap !== undefined) {\n      imageLoader = new THREE.ImageBitmapLoader(this.manager);\n      texture.flipY = false;\n    } else {\n      imageLoader = new THREE.ImageLoader(this.manager);\n    }\n\n    imageLoader.setCrossOrigin(this.crossOrigin);\n    imageLoader.setPath(this.path);\n\n    const cacheKey = this.manager.resolveURL(src);\n\n    texture.image = await loadAsync(imageLoader, src, onProgress);\n\n    // Image was just added to cache before this function gets called, disable caching by immediatly removing it\n    THREE.Cache.remove(cacheKey);\n\n    texture.needsUpdate = true;\n\n    texture.onUpdate = function() {\n      // Delete texture data once it has been uploaded to the GPU\n      texture.image.close && texture.image.close();\n      delete texture.image;\n    };\n\n    return texture;\n  }\n\n  setCrossOrigin(value) {\n    this.crossOrigin = value;\n    return this;\n  }\n\n  setPath(value) {\n    this.path = value;\n    return this;\n  }\n}\n","import { objectTypeForOriginAndContentType } from \"../object-types\";\nimport { getReticulumFetchUrl } from \"./phoenix-utils\";\nimport mediaHighlightFrag from \"./media-highlight-frag.glsl\";\nimport { mapMaterials } from \"./material-utils\";\nimport HubsTextureLoader from \"../loaders/HubsTextureLoader\";\nimport { validMaterials } from \"../components/hoverable-visuals\";\nimport { proxiedUrlFor } from \"../utils/media-url-utils\";\n\nconst mediaAPIEndpoint = getReticulumFetchUrl(\"/api/v1/media\");\n\n// Map<String, Promise<Object>\nconst resolveUrlCache = new Map();\nexport const resolveUrl = async (url, index) => {\n  const cacheKey = `${url}|${index}`;\n  if (resolveUrlCache.has(cacheKey)) return resolveUrlCache.get(cacheKey);\n\n  const resultPromise = fetch(mediaAPIEndpoint, {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ media: { url, index } })\n  }).then(async response => {\n    if (!response.ok) {\n      const message = `Error resolving url \"${url}\":`;\n      try {\n        const body = await response.text();\n        throw new Error(message + \" \" + body);\n      } catch (e) {\n        throw new Error(message + \" \" + response.statusText);\n      }\n    }\n    return response.json();\n  });\n\n  resolveUrlCache.set(cacheKey, resultPromise);\n  return resultPromise;\n};\n\nexport const upload = (file, desiredContentType) => {\n  const formData = new FormData();\n  formData.append(\"media\", file);\n  formData.append(\"promotion_mode\", \"with_token\");\n\n  if (desiredContentType) {\n    formData.append(\"desired_content_type\", desiredContentType);\n  }\n\n  return fetch(mediaAPIEndpoint, {\n    method: \"POST\",\n    body: formData\n  }).then(r => r.json());\n};\n\n// https://stackoverflow.com/questions/7584794/accessing-jpeg-exif-rotation-data-in-javascript-on-the-client-side/32490603#32490603\nfunction getOrientation(file, callback) {\n  const reader = new FileReader();\n  reader.onload = function(e) {\n    const view = new DataView(e.target.result);\n    if (view.getUint16(0, false) != 0xffd8) {\n      return callback(-2);\n    }\n    const length = view.byteLength;\n    let offset = 2;\n    while (offset < length) {\n      if (view.getUint16(offset + 2, false) <= 8) return callback(-1);\n      const marker = view.getUint16(offset, false);\n      offset += 2;\n      if (marker == 0xffe1) {\n        if (view.getUint32((offset += 2), false) != 0x45786966) {\n          return callback(-1);\n        }\n\n        const little = view.getUint16((offset += 6), false) == 0x4949;\n        offset += view.getUint32(offset + 4, little);\n        const tags = view.getUint16(offset, little);\n        offset += 2;\n        for (let i = 0; i < tags; i++) {\n          if (view.getUint16(offset + i * 12, little) == 0x0112) {\n            return callback(view.getUint16(offset + i * 12 + 8, little));\n          }\n        }\n      } else if ((marker & 0xff00) != 0xff00) {\n        break;\n      } else {\n        offset += view.getUint16(offset, false);\n      }\n    }\n    return callback(-1);\n  };\n  reader.readAsArrayBuffer(file);\n}\n\nlet interactableId = 0;\nexport const addMedia = (\n  src,\n  template,\n  contentOrigin,\n  contentSubtype = null,\n  resolve = false,\n  resize = false,\n  animate = true\n) => {\n  const scene = AFRAME.scenes[0];\n\n  const entity = document.createElement(\"a-entity\");\n  entity.id = \"interactable-media-\" + interactableId++;\n  entity.setAttribute(\"networked\", { template: template });\n  const needsToBeUploaded = src instanceof File;\n  entity.setAttribute(\"media-loader\", {\n    resize,\n    resolve,\n    animate,\n    src: typeof src === \"string\" ? src : \"\",\n    contentSubtype,\n    fileIsOwned: !needsToBeUploaded\n  });\n\n  entity.object3D.matrixNeedsUpdate = true;\n\n  scene.appendChild(entity);\n\n  const fireLoadingTimeout = setTimeout(() => {\n    scene.emit(\"media-loading\", { src: src });\n  }, 100);\n\n  [\"model-loaded\", \"video-loaded\", \"image-loaded\", \"pdf-loaded\"].forEach(eventName => {\n    entity.addEventListener(\n      eventName,\n      async () => {\n        clearTimeout(fireLoadingTimeout);\n        scene.emit(\"media-loaded\", { src: src });\n      },\n      { once: true }\n    );\n  });\n\n  const orientation = new Promise(function(resolve) {\n    if (needsToBeUploaded) {\n      getOrientation(src, x => {\n        resolve(x);\n      });\n    } else {\n      resolve(1);\n    }\n  });\n  if (needsToBeUploaded) {\n    // Video camera videos are converted to mp4 for compatibility\n    const desiredContentType = contentSubtype === \"video-camera\" ? \"video/mp4\" : null;\n\n    upload(src, desiredContentType)\n      .then(response => {\n        const srcUrl = new URL(proxiedUrlFor(response.origin));\n        srcUrl.searchParams.set(\"token\", response.meta.access_token);\n        entity.setAttribute(\"media-loader\", { resolve: false, src: srcUrl.href, fileId: response.file_id });\n        window.APP.store.update({\n          uploadPromotionTokens: [{ fileId: response.file_id, promotionToken: response.meta.promotion_token }]\n        });\n      })\n      .catch(e => {\n        console.error(\"Media upload failed\", e);\n        entity.setAttribute(\"media-loader\", { src: \"error\" });\n      });\n  } else if (src instanceof MediaStream) {\n    entity.setAttribute(\"media-loader\", { src: `hubs://clients/${NAF.clientId}/video` });\n  }\n\n  if (contentOrigin) {\n    entity.addEventListener(\"media_resolved\", ({ detail }) => {\n      const objectType = objectTypeForOriginAndContentType(contentOrigin, detail.contentType, detail.src);\n      scene.emit(\"object_spawned\", { objectType });\n    });\n  }\n\n  return { entity, orientation };\n};\n\nexport function injectCustomShaderChunks(obj) {\n  const vertexRegex = /\\bskinning_vertex\\b/;\n  const fragRegex = /\\bgl_FragColor\\b/;\n\n  const shaderUniforms = [];\n  const batchManagerSystem = AFRAME.scenes[0].systems[\"hubs-systems\"].batchManagerSystem;\n\n  obj.traverse(object => {\n    if (!object.material) return;\n\n    object.material = mapMaterials(object, material => {\n      if (!validMaterials.includes(material.type)) {\n        return material;\n      }\n\n      // HACK, this routine inadvertently leaves the A-Frame shaders wired to the old, dark\n      // material, so maps cannot be updated at runtime. This breaks UI elements who have\n      // hover/toggle state, so for now just skip these while we figure out a more correct\n      // solution.\n      if (\n        object.el.classList.contains(\"ui\") ||\n        object.el.classList.contains(\"hud\") ||\n        object.el.getAttribute(\"text-button\")\n      )\n        return material;\n\n      // Used when the object is batched\n      batchManagerSystem.meshToEl.set(object, obj.el);\n\n      const newMaterial = material.clone();\n      // This will not run if the object is never rendered unbatched, since its unbatched shader will never be compiled\n      newMaterial.onBeforeCompile = shader => {\n        if (!vertexRegex.test(shader.vertexShader)) return;\n\n        shader.uniforms.hubs_IsFrozen = { value: false };\n        shader.uniforms.hubs_EnableSweepingEffect = { value: false };\n        shader.uniforms.hubs_SweepParams = { value: [0, 0] };\n        shader.uniforms.hubs_InteractorOnePos = { value: [0, 0, 0] };\n        shader.uniforms.hubs_InteractorTwoPos = { value: [0, 0, 0] };\n        shader.uniforms.hubs_HighlightInteractorOne = { value: false };\n        shader.uniforms.hubs_HighlightInteractorTwo = { value: false };\n        shader.uniforms.hubs_Time = { value: 0 };\n\n        const vchunk = `\n        if (hubs_HighlightInteractorOne || hubs_HighlightInteractorTwo || hubs_IsFrozen) {\n          vec4 wt = modelMatrix * vec4(transformed, 1);\n\n          // Used in the fragment shader below.\n          hubs_WorldPosition = wt.xyz;\n        }\n      `;\n\n        const vlines = shader.vertexShader.split(\"\\n\");\n        const vindex = vlines.findIndex(line => vertexRegex.test(line));\n        vlines.splice(vindex + 1, 0, vchunk);\n        vlines.unshift(\"varying vec3 hubs_WorldPosition;\");\n        vlines.unshift(\"uniform bool hubs_IsFrozen;\");\n        vlines.unshift(\"uniform bool hubs_HighlightInteractorOne;\");\n        vlines.unshift(\"uniform bool hubs_HighlightInteractorTwo;\");\n        shader.vertexShader = vlines.join(\"\\n\");\n\n        const flines = shader.fragmentShader.split(\"\\n\");\n        const findex = flines.findIndex(line => fragRegex.test(line));\n        flines.splice(findex + 1, 0, mediaHighlightFrag);\n        flines.unshift(\"varying vec3 hubs_WorldPosition;\");\n        flines.unshift(\"uniform bool hubs_IsFrozen;\");\n        flines.unshift(\"uniform bool hubs_EnableSweepingEffect;\");\n        flines.unshift(\"uniform vec2 hubs_SweepParams;\");\n        flines.unshift(\"uniform bool hubs_HighlightInteractorOne;\");\n        flines.unshift(\"uniform vec3 hubs_InteractorOnePos;\");\n        flines.unshift(\"uniform bool hubs_HighlightInteractorTwo;\");\n        flines.unshift(\"uniform vec3 hubs_InteractorTwoPos;\");\n        flines.unshift(\"uniform float hubs_Time;\");\n        shader.fragmentShader = flines.join(\"\\n\");\n\n        shaderUniforms.push(shader.uniforms);\n      };\n      newMaterial.needsUpdate = true;\n      return newMaterial;\n    });\n  });\n\n  return shaderUniforms;\n}\n\nexport function getPromotionTokenForFile(fileId) {\n  return window.APP.store.state.uploadPromotionTokens.find(upload => upload.fileId === fileId);\n}\n\nconst mediaPos = new THREE.Vector3();\n\nexport function addAndArrangeMedia(el, media, contentSubtype, snapCount, mirrorOrientation = false) {\n  const { entity, orientation } = addMedia(media, \"#interactable-media\", undefined, contentSubtype, false);\n\n  const pos = el.object3D.position;\n\n  entity.object3D.position.set(pos.x, pos.y, pos.z);\n  entity.object3D.rotation.copy(el.object3D.rotation);\n\n  if (mirrorOrientation) {\n    entity.object3D.rotateY(Math.PI);\n  }\n\n  // Generate photos in a circle around camera, starting from the bottom.\n  // Prevent z-fighting but place behind viewfinder\n  const idx = (snapCount % 6) + 3;\n\n  mediaPos.set(\n    Math.cos(Math.PI * 2 * (idx / 6.0)) * 0.75,\n    Math.sin(Math.PI * 2 * (idx / 6.0)) * 0.75,\n    -0.05 + idx * 0.001\n  );\n\n  el.object3D.localToWorld(mediaPos);\n  entity.object3D.visible = false;\n\n  const handler = () => {\n    entity.object3D.visible = true;\n    entity.setAttribute(\"animation__photo_pos\", {\n      property: \"position\",\n      dur: 800,\n      from: { x: pos.x, y: pos.y, z: pos.z },\n      to: { x: mediaPos.x, y: mediaPos.y, z: mediaPos.z },\n      easing: \"easeOutElastic\"\n    });\n  };\n\n  let eventType = null;\n\n  if (contentSubtype.startsWith(\"photo\")) {\n    entity.addEventListener(\"image-loaded\", handler, { once: true });\n    eventType = \"photo\";\n  } else if (contentSubtype.startsWith(\"video\")) {\n    entity.addEventListener(\"video-loaded\", handler, { once: true });\n    eventType = \"video\";\n  } else {\n    console.error(\"invalid type \" + contentSubtype);\n    return;\n  }\n\n  entity.object3D.matrixNeedsUpdate = true;\n\n  entity.addEventListener(\n    \"media_resolved\",\n    () => {\n      el.emit(`${eventType}_taken`, entity.components[\"media-loader\"].data.src);\n    },\n    { once: true }\n  );\n\n  return { entity, orientation };\n}\n\nexport const textureLoader = new HubsTextureLoader().setCrossOrigin(\"anonymous\");\n\nexport async function createImageTexture(url) {\n  const texture = new THREE.Texture();\n\n  try {\n    await textureLoader.loadTextureAsync(texture, url);\n  } catch (e) {\n    throw new Error(`'${url}' could not be fetched (Error code: ${e.status}; Response: ${e.statusText})`);\n  }\n\n  texture.encoding = THREE.sRGBEncoding;\n  texture.anisotropy = 4;\n\n  return texture;\n}\n","module.exports = __webpack_public_path__ + \"assets/images/warning_icon-739d2a2ea906737505bcbc2cb51123a8.png\";","module.exports = __webpack_public_path__ + \"assets/images/warning_icon@2x-706e4a4db33f9456bac320e956b4120d.png\";","import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { injectIntl, FormattedMessage } from \"react-intl\";\nimport classNames from \"classnames\";\nimport \"three/examples/js/controls/OrbitControls\";\n\nimport { createDefaultEnvironmentMap } from \"../components/environment-map\";\nimport { loadGLTF } from \"../components/gltf-model-plus\";\nimport { disposeNode } from \"../utils/three-utils\";\nimport { createImageBitmap, disposeImageBitmap } from \"../utils/image-bitmap-utils\";\nimport styles from \"../assets/stylesheets/avatar-preview.scss\";\n\nconst TEXTURE_PROPS = {\n  base_map: [\"map\"],\n  emissive_map: [\"emissiveMap\"],\n  normal_map: [\"normalMap\"],\n  orm_map: [\"aoMap\", \"roughnessMap\", \"metalnessMap\"]\n};\n\nconst ALL_MAPS = Object.keys(TEXTURE_PROPS);\n\n// This should match our aframe renderer=\"antialias: true; colorManagement: true; sortObjects: true;\n// physicallyCorrectLights: true; webgl2: true; multiview: false;\"\nfunction createRenderer(canvas, alpha = false, useDevicePixelRatio = true) {\n  const context = canvas.getContext(\"webgl2\", {\n    alpha,\n    depth: true,\n    antialias: true,\n    premultipliedAlpha: true,\n    preserveDrawingBuffer: false,\n    powerPreference: \"default\"\n  });\n\n  const renderer = new THREE.WebGLRenderer({ alpha, canvas, context });\n  renderer.gammaOutput = true;\n  renderer.gammaFactor = 2.2;\n  renderer.physicallyCorrectLights = true;\n  if (useDevicePixelRatio) {\n    renderer.setPixelRatio(window.devicePixelRatio);\n  }\n  return renderer;\n}\n\nconst createImageBitmapFromURL = url =>\n  fetch(url)\n    .then(r => r.blob())\n    .then(createImageBitmap);\n\nconst ORBIT_ANGLE = new THREE.Euler(-30 * THREE.Math.DEG2RAD, 30 * THREE.Math.DEG2RAD, 0);\nconst DEFAULT_MARGIN = 1;\n\nfunction fitBoxInFrustum(camera, box, center, margin = DEFAULT_MARGIN) {\n  const halfYExtents = Math.max(box.max.y - center.y, center.y - box.min.y);\n  const halfVertFOV = THREE.Math.degToRad(camera.fov / 2);\n  camera.position.set(0, 0, (halfYExtents / Math.tan(halfVertFOV) + box.max.z) * margin);\n  camera.position.applyEuler(ORBIT_ANGLE);\n  camera.position.add(center);\n  camera.lookAt(center);\n}\n\nclass AvatarPreview extends Component {\n  static propTypes = {\n    avatarGltfUrl: PropTypes.string,\n    className: PropTypes.string\n  };\n  constructor(props) {\n    super(props);\n    this.state = { loading: true, error: null };\n    this.avatar = null;\n    this.imageBitmaps = {};\n  }\n\n  componentDidMount = () => {\n    this.scene = new THREE.Scene();\n\n    this.camera = new THREE.PerspectiveCamera(55, this.canvas.clientWidth / this.canvas.clientHeight, 0.1, 1000);\n    this.controls = new THREE.OrbitControls(this.camera, this.canvas);\n    this.controls.enablePan = false;\n\n    const light = new THREE.DirectionalLight(0xf7f6ef, 1);\n    light.position.set(0, 10, 10);\n    this.scene.add(light);\n    this.scene.add(new THREE.HemisphereLight(0xb1e3ff, 0xb1e3ff, 2.5));\n\n    this.camera.position.set(-0.2, 0.5, 0.5);\n    this.camera.matrixAutoUpdate = true;\n\n    this.controls.target.set(0, 0.45, 0);\n    this.controls.update();\n\n    if (this.props.avatarGltfUrl) {\n      this.loadPreviewAvatar(this.props.avatarGltfUrl).then(this.setAvatar);\n    }\n\n    const clock = new THREE.Clock();\n\n    this.snapshotCanvas = document.createElement(\"canvas\");\n    this.snapshotCanvas.width = 720;\n    this.snapshotCanvas.height = 1280;\n    this.snapshotCamera = new THREE.PerspectiveCamera(55, 720 / 1280, 0.1, 1000);\n    this.snapshotCamera.matrixAutoUpdate = true;\n    this.snapshotRenderer = createRenderer(this.snapshotCanvas, true, false);\n    this.snapshotRenderer.setClearAlpha(0);\n\n    this.previewRenderer = createRenderer(this.canvas);\n    this.previewRenderer.setClearColor(0xeaeaea);\n    this.previewRenderer.setAnimationLoop(() => {\n      const dt = clock.getDelta();\n      this.mixer && this.mixer.update(dt);\n      this.previewRenderer.render(this.scene, this.camera);\n    });\n    window.addEventListener(\"resize\", this.resize);\n    this.resize();\n  };\n\n  resize = () => {\n    const width = this.canvas.parentElement.offsetWidth;\n    const height = this.canvas.parentElement.offsetHeight;\n    this.previewRenderer.setSize(width, height);\n    this.camera.aspect = width / height;\n    this.camera.updateProjectionMatrix();\n  };\n\n  setAvatar = avatar => {\n    if (!avatar) return;\n    this.avatar = avatar;\n    this.scene.add(avatar);\n    this.resetCamera();\n    this.setState({ error: null, loading: false });\n  };\n\n  resetCamera = (() => {\n    const box = new THREE.Box3();\n    const center = new THREE.Vector3();\n    return () => {\n      box.setFromObject(this.avatar);\n      box.getCenter(center);\n\n      // Shift the center vertically in order to frame the avatar nicely.\n      center.y = (box.max.y - box.min.y) * 0.6 + box.min.y;\n\n      fitBoxInFrustum(this.camera, box, center);\n      fitBoxInFrustum(this.snapshotCamera, box, center, 0.7);\n\n      this.controls.target.copy(center);\n      this.controls.update();\n    };\n  })();\n\n  componentWillUnmount = () => {\n    // Gotta be particularly careful about disposing things here since we will likely create many avatar\n    // previews during a session and Chrome will eventually discard the oldest webgl context if we leak\n    // contexts by holding on to them directly or indirectly.\n\n    this.scene && this.scene.traverse(disposeNode);\n    if (this.previewRenderer) {\n      this.previewRenderer.dispose();\n      this.previewRenderer.context = null;\n    }\n    if (this.snapshotRenderer) {\n      this.snapshotRenderer.dispose();\n      this.snapshotRenderer.context = null;\n    }\n    if (this.controls) {\n      this.controls.dispose();\n      this.controls.domElement = null;\n    }\n\n    Object.values(this.imageBitmaps).forEach(img => disposeImageBitmap(img));\n    window.removeEventListener(\"resize\", this.resize);\n  };\n\n  componentDidUpdate = async oldProps => {\n    if (oldProps.avatarGltfUrl !== this.props.avatarGltfUrl) {\n      if (this.avatar) {\n        this.scene.remove(this.avatar);\n        this.avatar = null;\n      }\n      if (this.props.avatarGltfUrl) {\n        this.setState({ error: null, loading: true });\n        await this.loadPreviewAvatar(this.props.avatarGltfUrl).then(this.setAvatar);\n      }\n    }\n    this.applyMaps(oldProps, this.props);\n  };\n\n  applyMaps(oldProps, newProps) {\n    return Promise.all(\n      ALL_MAPS.map(mapName => {\n        const applyMap = this.applyMapToPreview.bind(this, mapName);\n        if (oldProps[mapName] != newProps[mapName]) {\n          if (newProps[mapName] instanceof File) {\n            return createImageBitmap(newProps[mapName]).then(applyMap);\n          } else if (newProps[mapName]) {\n            return createImageBitmapFromURL(newProps[mapName]).then(applyMap);\n          } else {\n            return this.revertMap(mapName);\n          }\n        }\n      })\n    );\n  }\n\n  loadPreviewAvatar = async avatarGltfUrl => {\n    let gltf;\n    try {\n      gltf = await loadGLTF(avatarGltfUrl, \"model/gltf\");\n    } catch (e) {\n      this.setState({ loading: false, error: true });\n      return;\n    }\n\n    // On the backend we look for a material called Bot_PBS, here we are looking for a mesh called Avatar.\n    // When we \"officially\" support uploading custom GLTFs we need to decide what we are going to key things on\n    this.previewMesh =\n      gltf.scene.getObjectByName(\"AvatarMesh\") ||\n      gltf.scene.getObjectByName(\"Avatar\") ||\n      gltf.scene.getObjectByName(\"Bot_Skinned\") ||\n      gltf.scene;\n\n    const idleAnimation = gltf.animations && gltf.animations.find(({ name }) => name === \"idle_eyes\");\n    if (idleAnimation) {\n      this.mixer = new THREE.AnimationMixer(this.previewMesh);\n      const action = this.mixer.clipAction(idleAnimation);\n      action.enabled = true;\n      action.setLoop(THREE.LoopRepeat, Infinity).play();\n      this.idleAnimationAction = action;\n    }\n\n    const { material } = this.previewMesh;\n    if (material) {\n      // We delete onUpdate here to opt out of the auto texture cleanup after GPU upload.\n      const getImage = p => delete material[p].onUpdate && material[p].image;\n      this.originalMaps = {\n        base_map: TEXTURE_PROPS[\"base_map\"].map(getImage),\n        emissive_map: TEXTURE_PROPS[\"emissive_map\"].map(getImage),\n        normal_map: TEXTURE_PROPS[\"normal_map\"].map(getImage),\n        orm_map: TEXTURE_PROPS[\"orm_map\"].map(getImage)\n      };\n\n      await Promise.all([\n        this.applyMaps({}, this.props), // Apply initial maps\n        createDefaultEnvironmentMap().then(t => {\n          this.previewMesh.material.envMap = t;\n          this.previewMesh.material.needsUpdate = true;\n        })\n      ]);\n    } else {\n      this.originalMaps = {};\n    }\n\n    return gltf.scene;\n  };\n\n  applyMapToPreview = (name, image) => {\n    if (this.imageBitmaps[name]) {\n      disposeImageBitmap(this.imageBitmaps[name]);\n    }\n    this.imageBitmaps[name] = image;\n    TEXTURE_PROPS[name].forEach(prop => {\n      const texture = this.previewMesh.material[prop];\n      texture.image = image;\n      texture.needsUpdate = true;\n    });\n  };\n\n  revertMap = name => {\n    if (this.imageBitmaps[name]) {\n      disposeImageBitmap(this.imageBitmaps[name]);\n    }\n    delete this.imageBitmaps[name];\n    this.originalMaps[name].forEach((bm, i) => {\n      const texture = this.previewMesh.material[TEXTURE_PROPS[name][i]];\n      texture.image = bm;\n      texture.needsUpdate = true;\n    });\n  };\n\n  snapshot = () => {\n    return new Promise(resolve => {\n      if (this.idleAnimationAction) this.idleAnimationAction.stop();\n      this.snapshotRenderer.render(this.scene, this.snapshotCamera);\n      this.snapshotCanvas.toBlob(blob => {\n        if (this.idleAnimationAction) this.idleAnimationAction.play();\n        resolve(blob);\n      });\n    });\n  };\n\n  render() {\n    return (\n      <div className={classNames(styles.preview, this.props.className)}>\n        {this.state.loading &&\n          !this.state.error && (\n            <div className=\"loader\">\n              <div className=\"loader-center\" />\n            </div>\n          )}\n        {this.state.error &&\n          !this.state.loading && (\n            <div className=\"error\">\n              <img\n                src=\"../assets/images/warning_icon.png\"\n                srcSet=\"../assets/images/warning_icon@2x.png 2x\"\n                className=\"error-icon\"\n              />\n              <FormattedMessage id=\"avatar-preview.loading-failed\" />\n            </div>\n          )}\n        <canvas ref={c => (this.canvas = c)} />\n      </div>\n    );\n  }\n}\n\nexport default injectIntl(AvatarPreview, { withRef: true });\n","const qs = new URLSearchParams(location.search);\n\nexport default function qsTruthy(param) {\n  const val = qs.get(param);\n  // if the param exists but is not set (e.g. \"?foo&bar\"), its value is the empty string.\n  return val === \"\" || /1|on|true|yes/i.test(val);\n}\n","import {Helmet} from 'react-helmet'\nimport React from \"react\";\n\nexport const HelmetComponent = ({assets, page}) => {\n\tlet pageTitle = page;\n\tconst titleRoot = assets.Page_Title_Root;\n\tif (titleRoot) pageTitle = `${titleRoot} | ${page}`;\n\treturn <Helmet>\n        <title>{pageTitle}</title>\n        <link rel=\"icon\" sizes=\"16x16 24x24 32x32 48x48 64x64\" href={assets.Favicon} />\n\t    <meta property=\"og:title\" content={assets.Name} />\n\t    <meta property=\"og:description\" content={assets.Social_Description} />\n\t    <meta property=\"og:image\" content={assets.Social_Image} />\n\t    <meta name=\"twitter:site\" content={assets.Twitter_Handle} />\n\t    <meta name=\"twitter:title\" content={assets.Name} />\n\t    <meta name=\"twitter:image\" content={assets.Social_Image} />\n\t    <meta name=\"twitter:description\" content={assets.Social_Description} />\n\t    <meta name=\"application-name\" content={assets.Name} />\n    </Helmet>\n}","// extracted by mini-css-extract-plugin\nmodule.exports = {\"preview\":\"avatar-preview__preview__2I8qx\"};","import Airtable from 'airtable';\nAirtable.configure({\n    endpointUrl: 'https://api.airtable.com',\n    apiKey: 'keyOHSVeLr3ryLrL5'\n});\nconst base = Airtable.base('appIR0AlHDFG5WR8z');\n\nexport const airtableAssetsInitialState = { DarkLogo: null, Name: null, Icon: null }\n\nlet assets;\n\nconst airtableAssets = base('Assets');\n// export const getAirtableAssets = () => airtableAssets.find('recHqITRS7cBMwn9i');\nexport const getAirtableAssets = async () => {\n    if (assets) return assets;\n    const result = await airtableAssets.select({\n        view: 'Grid view'\n    }).firstPage()\n    assets = result[0].fields;\n    return result[0].fields\n}\n\nexport const airtableMessages = base('Messages').select({\n    view: 'Grid view'\n}).firstPage(async (err, records) => {\n    if (err) { console.error(err); return; }\n    const record = records[0];\n    return record;\n});;","import { airtableMessages } from './airtable'\nimport { Name, Hero_Blurb } from './customization'\nimport translations from '../assets/translations.data.json';\nlet modifiedTranslations = translations;\nconst name = Name;\n// const name = airtableMessages && airtableMessages.get('Name') || \"Axon Park\";\n\n// modifiedTranslations.en[\"home.hero_blurb\"] = airtableMessages && airtableMessages.get('Motto') || 'Learn together, from anywhere.\\nThe future of learning is virtual.\\nEqualizing access to premier quality education.';\nmodifiedTranslations.en[\"home.hero_blurb\"] = Hero_Blurb;\nmodifiedTranslations.en[\"sign-in.rename-room\"] = `You'll need to sign in to rename ${name}.`;\nmodifiedTranslations.en[\"sign-in.close-room\"] = `You'll need to sign in to close ${name}.`;\nmodifiedTranslations.en[\"rename-room.message\"] = `Enter the new name for ${name}.`;\nmodifiedTranslations.en[\"rename-room.rename\"] = `Rename ${name}`;\nmodifiedTranslations.en[\"close-room.message\"] =\n  `Closing this room will remove yourself and others from ${name}, shutting it down permanently.\\n\\nAre you sure? This action cannot be undone.`;\nmodifiedTranslations.en[\"close-room.confirm\"] = `Yes, Close ${name}`;\nmodifiedTranslations.en[\"entry.enter-room\"] = `Enter ${name}`;\nmodifiedTranslations.en[\"entry.leave-room\"] = `Leave ${name}`;\nmodifiedTranslations.en[\"entry.in-lobby-notice\"] = `You are viewing ${name} from the lobby.`;\nmodifiedTranslations.en[\"exit.subtitle.kicked\"] = `You have been kicked from ${name}.`;\nmodifiedTranslations.en[\"exit.subtitle.left\"] = `You have left ${name}.`;\nmodifiedTranslations.en[\"exit.subtitle.disconnected\"] = `You have disconnected from ${name}. Refresh the page to try to reconnect.`;\nmodifiedTranslations.en[\"presence.entered_room\"] = `entered ${name}.`;\nmodifiedTranslations.en[\"presence.entered_lobby\"] = `entered ${name}'s lobby.`;\nmodifiedTranslations.en[\"presence.join_lobby\"] = `joined the ${name} lobby.`;\nmodifiedTranslations.en[\"presence.join_room\"] = `joined ${name}.`;\nmodifiedTranslations.en[\"presence.in_lobby\"] = `${name} Lobby`;\nmodifiedTranslations.en[\"presence.in_room\"] = `In ${name}`;\nmodifiedTranslations.en[\"home.create_a_room\"] = `Initialize ${name}`;\nmodifiedTranslations.en[\"home.room_create_button\"] = `Initialize ${name}`;\nmodifiedTranslations.en[\"home.have_code\"] = `Have an ${name} code?`;\nmodifiedTranslations.en[\"commands.leave\"] = `Disconnect from ${name}.`;\nmodifiedTranslations.en[\"settings.rename-room\"] = `Set ${name} Name...`;\nmodifiedTranslations.en[\"settings.close-room\"] = `Close ${name}...`;\nmodifiedTranslations.en[\"settings.leave-room\"] = `Leave ${name}`;\nmodifiedTranslations.en[\"settings.room-info\"] = `${name} Info`;\nmodifiedTranslations.en[\"settings.create-room\"] = `New ${name}...`;\nmodifiedTranslations.en[\"settings.row-room\"] = `${name}`;\nmodifiedTranslations.en[\"settings.room-settings\"] = `${name} Settings`;\nmodifiedTranslations.en[\"tips.mobile.object_pin\"] = `Pin an object to save it to ${name}.`;\nmodifiedTranslations.en[\"tips.mobile.object_pin\"] = `Pin an object to save it to ${name}.`;\nmodifiedTranslations.en[\"tips.mobile.invite\"] = `Use the Invite button to share ${name}.`;\nmodifiedTranslations.en[\"tips.desktop.object_pin\"] = `Pin an object to save it to ${name}.`;\nmodifiedTranslations.en[\"tips.watching.back\"] = `Enter ${name}`;\nmodifiedTranslations.en[\"leave-room-dialog.create-room.confirm\"] = `Leave ${name}.`;\n\nexport default modifiedTranslations;","export const Name = \"Axon Park\";\nexport const Hero_Blurb = 'Learn together, from anywhere.\\nThe future of learning is virtual.\\nEqualizing access to premier quality education.';","import localeData from \"../everyspace/messages.js\";\n// import localeData from \"../assets/translations.data.json\";\nconst navigatorLang = ((navigator.languages && navigator.languages[0]) || navigator.language || navigator.userLanguage)\n  .toLowerCase()\n  .split(/[_-]+/)[0];\nexport const lang = (localeData[navigatorLang] && navigatorLang) || \"en\";\nexport const messages = localeData[lang] || localeData.en;\n","// A-Frame blows away any npm debug log filters so this allow the user to set the log filter\n// via the query string.\nimport debug from \"debug\";\nimport qsTruthy from \"./qs_truthy\";\n\nconst qs = new URLSearchParams(location.search);\nconst isDebug = qsTruthy(\"debug\");\nconst logFilter = qs.get(\"log_filter\") || (isDebug && \"naf-janus-adapter:*\");\n\nif (logFilter) {\n  debug.enable(logFilter);\n}\n","const tempVector3 = new THREE.Vector3();\nconst tempQuaternion = new THREE.Quaternion();\n\nexport function getLastWorldPosition(src, target) {\n  src.updateMatrices();\n  target.setFromMatrixPosition(src.matrixWorld);\n  return target;\n}\n\nexport function getLastWorldQuaternion(src, target) {\n  src.updateMatrices();\n  src.matrixWorld.decompose(tempVector3, target, tempVector3);\n  return target;\n}\n\nexport function getLastWorldScale(src, target) {\n  src.updateMatrices();\n  src.matrixWorld.decompose(tempVector3, tempQuaternion, target);\n  return target;\n}\n\nexport function disposeMaterial(mtrl) {\n  if (mtrl.map) mtrl.map.dispose();\n  if (mtrl.lightMap) mtrl.lightMap.dispose();\n  if (mtrl.bumpMap) mtrl.bumpMap.dispose();\n  if (mtrl.normalMap) mtrl.normalMap.dispose();\n  if (mtrl.specularMap) mtrl.specularMap.dispose();\n  if (mtrl.envMap) mtrl.envMap.dispose();\n  mtrl.dispose();\n}\n\nexport function disposeNode(node) {\n  if (!(node instanceof THREE.Mesh)) return;\n\n  if (node.geometry) {\n    node.geometry.dispose();\n  }\n\n  if (node.material) {\n    let materialArray;\n    if (node.material instanceof THREE.MeshFaceMaterial || node.material instanceof THREE.MultiMaterial) {\n      materialArray = node.material.materials;\n    } else if (node.material instanceof Array) {\n      materialArray = node.material;\n    }\n    if (materialArray) {\n      materialArray.forEach(disposeMaterial);\n    } else {\n      disposeMaterial(node.material);\n    }\n  }\n}\n\nexport function setMatrixWorld(object3D, m) {\n  object3D.matrixWorld.copy(m);\n  object3D.matrix = object3D.matrix.getInverse(object3D.parent.matrixWorld).multiply(object3D.matrixWorld);\n  object3D.matrix.decompose(object3D.position, object3D.quaternion, object3D.scale);\n}\n","export function forEachMaterial(object3D, fn) {\n  if (!object3D.material) return;\n\n  if (Array.isArray(object3D.material)) {\n    object3D.material.forEach(fn);\n  } else {\n    fn(object3D.material);\n  }\n}\n\nexport function mapMaterials(object3D, fn) {\n  if (!object3D.material) return;\n\n  if (Array.isArray(object3D.material)) {\n    return object3D.material.map(fn);\n  } else {\n    return fn(object3D.material);\n  }\n}\n","import { avatars } from \"../assets/avatars/avatars.js\";\n\nconst names = [\n  \"Baers-Pochard\",\n  \"Baikal-Teal\",\n  \"Barrows-Goldeneye\",\n  \"Blue-Billed\",\n  \"Blue-Duck\",\n  \"Blue-Winged\",\n  \"Brown-Teal\",\n  \"Bufflehead\",\n  \"Canvasback\",\n  \"Cape-Shoveler\",\n  \"Chestnut-Teal\",\n  \"Chiloe-Wigeon\",\n  \"Cinnamon-Teal\",\n  \"Comb-Duck\",\n  \"Common-Eider\",\n  \"Common-Goldeneye\",\n  \"Common-Merganser\",\n  \"Common-Pochard\",\n  \"Common-Scoter\",\n  \"Common-Shelduck\",\n  \"Cotton-Pygmy\",\n  \"Crested-Duck\",\n  \"Crested-Shelduck\",\n  \"Eatons-Pintail\",\n  \"Falcated\",\n  \"Ferruginous\",\n  \"Freckled-Duck\",\n  \"Gadwall\",\n  \"Garganey\",\n  \"Greater-Scaup\",\n  \"Green-Pygmy\",\n  \"Grey-Teal\",\n  \"Hardhead\",\n  \"Harlequin\",\n  \"Hartlaubs\",\n  \"Hooded-Merganser\",\n  \"Hottentot-Teal\",\n  \"Kelp-Goose\",\n  \"King-Eider\",\n  \"Lake-Duck\",\n  \"Laysan-Duck\",\n  \"Lesser-Scaup\",\n  \"Long-Tailed\",\n  \"Maccoa-Duck\",\n  \"Mallard\",\n  \"Mandarin\",\n  \"Marbled-Teal\",\n  \"Mellers-Duck\",\n  \"Merganser\",\n  \"Northern-Pintail\",\n  \"Orinoco-Goose\",\n  \"Paradise-Shelduck\",\n  \"Plumed-Whistler\",\n  \"Puna-Teal\",\n  \"Pygmy-Goose\",\n  \"Radjah-Shelduck\",\n  \"Red-Billed\",\n  \"Red-Crested\",\n  \"Red-Shoveler\",\n  \"Ring-Necked\",\n  \"Ringed-Teal\",\n  \"Rosy-Billed\",\n  \"Ruddy-Shelduck\",\n  \"Salvadoris-Teal\",\n  \"Scaly-Sided\",\n  \"Shelduck\",\n  \"Shoveler\",\n  \"Silver-Teal\",\n  \"Smew\",\n  \"Spectacled-Eider\",\n  \"Spot-Billed\",\n  \"Spotted-Whistler\",\n  \"Steamerduck\",\n  \"Stellers-Eider\",\n  \"Sunda-Teal\",\n  \"Surf-Scoter\",\n  \"Tufted-Duck\",\n  \"Velvet-Scoter\",\n  \"Wandering-Whistler\",\n  \"Whistling-duck\",\n  \"White-Backed\",\n  \"White-Cheeked\",\n  \"White-Winged\",\n  \"Wigeon\",\n  \"Wood-Duck\",\n  \"Yellow-Billed\"\n];\n\nfunction selectRandom(arr) {\n  return arr[Math.floor(Math.random() * arr.length)];\n}\n\nexport function generateRandomName() {\n  return `${selectRandom(names)}-${Math.floor(10000 + Math.random() * 10000)}`;\n}\n\nexport const avatarIds = avatars.map(av => av.id);\n\nexport function generateDefaultProfile() {\n  return {\n    avatarId: selectRandom(avatarIds)\n  };\n}\n","import { Validator } from \"jsonschema\";\nimport merge from \"deepmerge\";\nimport Cookies from \"js-cookie\";\nimport jwtDecode from \"jwt-decode\";\n\nconst LOCAL_STORE_KEY = \"___hubs_store\";\nconst STORE_STATE_CACHE_KEY = Symbol();\nconst OAUTH_FLOW_CREDENTIALS_KEY = \"ret-oauth-flow-account-credentials\";\nconst validator = new Validator();\nimport { EventTarget } from \"event-target-shim\";\nimport { generateDefaultProfile, generateRandomName } from \"../utils/identity.js\";\n\n// Durable (via local-storage) schema-enforced state that is meant to be consumed via forward data flow.\n// (Think flux but with way less incidental complexity, at least for now :))\nexport const SCHEMA = {\n  id: \"/HubsStore\",\n\n  definitions: {\n    profile: {\n      type: \"object\",\n      additionalProperties: false,\n      properties: {\n        displayName: { type: \"string\", pattern: \"^[A-Za-z0-9-]{3,32}$\" },\n        avatarId: { type: \"string\" },\n        personalAvatarId: { type: \"string\" }\n      }\n    },\n\n    credentials: {\n      type: \"object\",\n      additionalProperties: false,\n      properties: {\n        token: { type: [\"null\", \"string\"] },\n        email: { type: [\"null\", \"string\"] }\n      }\n    },\n\n    activity: {\n      type: \"object\",\n      additionalProperties: false,\n      properties: {\n        hasFoundFreeze: { type: \"boolean\" },\n        hasChangedName: { type: \"boolean\" },\n        hasAcceptedProfile: { type: \"boolean\" },\n        lastEnteredAt: { type: \"string\" },\n        hasPinned: { type: \"boolean\" },\n        hasRotated: { type: \"boolean\" },\n        hasRecentered: { type: \"boolean\" },\n        hasScaled: { type: \"boolean\" },\n        hasHoveredInWorldHud: { type: \"boolean\" },\n        hasOpenedShare: { type: \"boolean\" },\n        entryCount: { type: \"number\" }\n      }\n    },\n\n    settings: {\n      type: \"object\",\n      additionalProperties: false,\n      properties: {\n        lastUsedMicDeviceId: { type: \"string\" }\n      }\n    },\n\n    // Legacy\n    confirmedDiscordRooms: {\n      type: \"array\",\n      items: { type: \"string\" }\n    },\n\n    confirmedBroadcastedRooms: {\n      type: \"array\",\n      items: { type: \"string\" }\n    },\n\n    uploadPromotionTokens: {\n      type: \"array\",\n      items: {\n        type: \"object\",\n        additionalProperties: false,\n        properties: {\n          fileId: { type: \"string\" },\n          promotionToken: { type: \"string\" }\n        }\n      }\n    },\n\n    creatorAssignmentTokens: {\n      type: \"array\",\n      items: {\n        type: \"object\",\n        additionalProperties: false,\n        properties: {\n          hubId: { type: \"string\" },\n          creatorAssignmentToken: { type: \"string\" }\n        }\n      }\n    },\n\n    embedTokens: {\n      type: \"array\",\n      items: {\n        type: \"object\",\n        additionalProperties: false,\n        properties: {\n          hubId: { type: \"string\" },\n          embedToken: { type: \"string\" }\n        }\n      }\n    },\n\n    onLoadActions: {\n      type: \"array\",\n      items: {\n        type: \"object\",\n        additionalProperties: false,\n        properties: {\n          action: { type: \"string\" },\n          args: { type: \"object\" }\n        }\n      }\n    }\n  },\n\n  type: \"object\",\n\n  properties: {\n    profile: { $ref: \"#/definitions/profile\" },\n    credentials: { $ref: \"#/definitions/credentials\" },\n    activity: { $ref: \"#/definitions/activity\" },\n    settings: { $ref: \"#/definitions/settings\" },\n    confirmedDiscordRooms: { $ref: \"#/definitions/confirmedDiscordRooms\" }, // Legacy\n    confirmedBroadcastedRooms: { $ref: \"#/definitions/confirmedBroadcastedRooms\" },\n    uploadPromotionTokens: { $ref: \"#/definitions/uploadPromotionTokens\" },\n    creatorAssignmentTokens: { $ref: \"#/definitions/creatorAssignmentTokens\" },\n    embedTokens: { $ref: \"#/definitions/embedTokens\" },\n    onLoadActions: { $ref: \"#/definitions/onLoadActions\" }\n  },\n\n  additionalProperties: false\n};\n\nexport default class Store extends EventTarget {\n  constructor() {\n    super();\n\n    if (localStorage.getItem(LOCAL_STORE_KEY) === null) {\n      localStorage.setItem(LOCAL_STORE_KEY, JSON.stringify({}));\n    }\n\n    // When storage is updated in another window\n    window.addEventListener(\"storage\", e => {\n      if (e.key !== LOCAL_STORE_KEY) return;\n      delete this[STORE_STATE_CACHE_KEY];\n      this.dispatchEvent(new CustomEvent(\"statechanged\"));\n    });\n\n    this.update({\n      activity: {},\n      settings: {},\n      credentials: {},\n      profile: {},\n      confirmedDiscordRooms: [],\n      confirmedBroadcastedRooms: [],\n      uploadPromotionTokens: [],\n      creatorAssignmentTokens: [],\n      embedTokens: [],\n      onLoadActions: []\n    });\n\n    const oauthFlowCredentials = Cookies.getJSON(OAUTH_FLOW_CREDENTIALS_KEY);\n    if (oauthFlowCredentials) {\n      this.update({ credentials: oauthFlowCredentials });\n      this.resetToRandomLegacyAvatar();\n      Cookies.remove(OAUTH_FLOW_CREDENTIALS_KEY);\n    }\n  }\n\n  // Initializes store with any default bits\n  init = () => {\n    this.update({\n      profile: { ...generateDefaultProfile(), ...(this.state.profile || {}) }\n    });\n\n    // Regenerate name to encourage users to change it.\n    if (!this.state.activity.hasChangedName) {\n      this.update({ profile: { displayName: generateRandomName() } });\n    }\n  };\n\n  resetToRandomLegacyAvatar = () => {\n    this.update({\n      profile: { ...(this.state.profile || {}), ...generateDefaultProfile() }\n    });\n  };\n\n  get state() {\n    if (!this.hasOwnProperty(STORE_STATE_CACHE_KEY)) {\n      this[STORE_STATE_CACHE_KEY] = JSON.parse(localStorage.getItem(LOCAL_STORE_KEY));\n    }\n\n    return this[STORE_STATE_CACHE_KEY];\n  }\n\n  get credentialsAccountId() {\n    if (this.state.credentials.token) {\n      return jwtDecode(this.state.credentials.token).sub;\n    } else {\n      return null;\n    }\n  }\n\n  resetConfirmedBroadcastedRooms() {\n    this.clearStoredArray(\"confirmedBroadcastedRooms\");\n  }\n\n  resetTipActivityFlags() {\n    this.update({\n      activity: { hasRotated: false, hasPinned: false, hasRecentered: false, hasScaled: false, entryCount: 0 }\n    });\n  }\n\n  bumpEntryCount() {\n    const currentEntryCount = this.state.activity.entryCount || 0;\n    this.update({ activity: { entryCount: currentEntryCount + 1 } });\n  }\n\n  // Sets a one-time action to perform the next time the page loads\n  enqueueOnLoadAction(action, args) {\n    this.update({ onLoadActions: [{ action, args }] });\n  }\n\n  executeOnLoadActions(sceneEl) {\n    for (let i = 0; i < this.state.onLoadActions.length; i++) {\n      const { action, args } = this.state.onLoadActions[i];\n\n      if (action === \"emit_scene_event\") {\n        sceneEl.emit(args.event, args.detail);\n      }\n    }\n\n    this.clearOnLoadActions();\n  }\n\n  clearOnLoadActions() {\n    this.clearStoredArray(\"onLoadActions\");\n  }\n\n  clearStoredArray(key) {\n    const overwriteMerge = (destinationArray, sourceArray) => sourceArray;\n    const update = {};\n    update[key] = [];\n\n    this.update(update, { arrayMerge: overwriteMerge });\n  }\n\n  update(newState, mergeOpts) {\n    const finalState = merge(this.state, newState, mergeOpts);\n    const { valid } = validator.validate(finalState, SCHEMA);\n\n    if (!valid) {\n      // Intentionally not including details about the state or validation result here, since we don't want to leak\n      // sensitive data in the error message.\n      throw new Error(`Write to store failed schema validation.`);\n    }\n\n    localStorage.setItem(LOCAL_STORE_KEY, JSON.stringify(finalState));\n    delete this[STORE_STATE_CACHE_KEY];\n\n    if (newState.profile !== undefined) {\n      this.dispatchEvent(new CustomEvent(\"profilechanged\"));\n    }\n    this.dispatchEvent(new CustomEvent(\"statechanged\"));\n\n    return finalState;\n  }\n}\n","module.exports = __webpack_public_path__ + \"assets/images/hub-preview-white-ccefba3b70ae589a0ca5ae3230c39299.png\";","// Enumeration of spawned object content origins. URL means the content is\n// fetched from a URL, FILE means it was an uploaded/dropped file, and\n// CLIPBOARD means it was raw data pasted in from the clipboard, SPAWNER means\n// it was copied over from a spawner.\nexport const ObjectContentOrigins = {\n  URL: 1,\n  FILE: 2,\n  CLIPBOARD: 3,\n  SPAWNER: 4\n};\n\n// Enumeration of spawnable object types, used for telemetry, which encapsulates\n// both the origin of the content for the object and also the type of content\n// contained in the object.\nexport const ObjectTypes = {\n  URL_IMAGE: 0,\n  URL_VIDEO: 1,\n  URL_MODEL: 2,\n  URL_PDF: 3,\n  URL_AUDIO: 4,\n  //URL_TEXT: 5,\n  //URL_TELEPORTER: 6,\n  FILE_IMAGE: 8,\n  FILE_VIDEO: 9,\n  FILE_MODEL: 10,\n  FILE_PDF: 11,\n  FILE_AUDIO: 12,\n  //FILE_TEXT: 13,\n  CLIPBOARD_IMAGE: 16,\n  CLIPBOARD_VIDEO: 17,\n  CLIPBOARD_MODEL: 18,\n  CLIPBOARD_PDF: 19,\n  CLIPBOARD_AUDIO: 20,\n  //CLIPBOARD_TEXT: 21,\n  SPAWNER_IMAGE: 24,\n  SPAWNER_VIDEO: 25,\n  SPAWNER_MODEL: 26,\n  SPAWNER_PDF: 27,\n  SPAWNER_AUDIO: 28,\n  //SPAWNER_TEXT: 29,\n  CAMERA: 30,\n  UNKNOWN: 31\n};\n\n// Given an origin and three object type values for URL, FILE, and CLIPBOARD\n// origins respectively, return the appropriate one\nfunction objectTypeForOrigin(contentOrigin, urlType, fileType, clipboardType, spawnerType) {\n  if (contentOrigin === ObjectContentOrigins.URL) {\n    return urlType;\n  } else if (contentOrigin === ObjectContentOrigins.FILE) {\n    return fileType;\n  } else if (contentOrigin === ObjectContentOrigins.CLIPBOARD) {\n    return clipboardType;\n  } else {\n    return spawnerType;\n  }\n}\n\n// Lookup table of mime-type prefixes to the set of object types that we should use\n// for objects spawned matching their underlying Content-Type.\nconst objectTypeMimePrefixLookupMap = {\n  \"image/\": [ObjectTypes.URL_IMAGE, ObjectTypes.FILE_IMAGE, ObjectTypes.CLIPBOARD_IMAGE, ObjectTypes.SPAWNER_IMAGE],\n  \"model/\": [ObjectTypes.URL_MODEL, ObjectTypes.FILE_MODEL, ObjectTypes.CLIPBOARD_MODEL, ObjectTypes.SPAWNER_MODEL],\n  \"application/x-zip-compressed\": [\n    ObjectTypes.URL_MODEL,\n    ObjectTypes.FILE_MODEL,\n    ObjectTypes.CLIPBOARD_MODEL,\n    ObjectTypes.SPAWNER_MODEL\n  ],\n  \"video/\": [ObjectTypes.URL_VIDEO, ObjectTypes.FILE_VIDEO, ObjectTypes.CLIPBOARD_VIDEO, ObjectTypes.SPAWNER_VIDEO],\n  \"application/vnd.apple.mpegurl\": [\n    ObjectTypes.URL_VIDEO,\n    ObjectTypes.FILE_VIDEO,\n    ObjectTypes.CLIPBOARD_VIDEO,\n    ObjectTypes.SPAWNER_VIDEO\n  ],\n  \"application/x-mpegurl\": [\n    ObjectTypes.URL_VIDEO,\n    ObjectTypes.FILE_VIDEO,\n    ObjectTypes.CLIPBOARD_VIDEO,\n    ObjectTypes.SPAWNER_VIDEO\n  ],\n  \"audio/\": [ObjectTypes.URL_AUDIO, ObjectTypes.FILE_AUDIO, ObjectTypes.CLIPBOARD_AUDIO, ObjectTypes.SPAWNER_AUDIO],\n  \"application/pdf\": [ObjectTypes.URL_PDF, ObjectTypes.FILE_PDF, ObjectTypes.CLIPBOARD_PDF, ObjectTypes.SPAWNER_PDF]\n};\n\nconst srcSuffixLookupMap = {\n  \".m3u8\": [ObjectTypes.URL_VIDEO, ObjectTypes.FILE_VIDEO, ObjectTypes.CLIPBOARD_VIDEO, ObjectTypes.SPAWNER_VIDEO]\n};\n\n// Given an content origin and the resolved mime type of a piece of content, return\n// the ObjectType, if any, for that content.\nexport function objectTypeForOriginAndContentType(contentOrigin, contentType, src) {\n  for (const prefix in objectTypeMimePrefixLookupMap) {\n    if (contentType.toLowerCase().startsWith(prefix)) {\n      const types = objectTypeMimePrefixLookupMap[prefix];\n      return objectTypeForOrigin(contentOrigin, ...types);\n    }\n  }\n\n  if (src) {\n    for (const suffix in srcSuffixLookupMap) {\n      if (src.toLowerCase().endsWith(suffix)) {\n        const types = srcSuffixLookupMap[suffix];\n        return objectTypeForOrigin(contentOrigin, ...types);\n      }\n    }\n  }\n\n  return ObjectTypes.UNKNOWN;\n}\n","export const avatars = [\n  {\n    id: \"botdefault\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotDefault_Avatar-9f71f8ff22.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botdefault-thumb-42C4C7D3C01D085EAFDAC8BACE591CE6.png\"\n  },\n  {\n    id: \"botbobo\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotBobo_Avatar-f9740a010b.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botbobo-thumb-261278FD5831E9CD89610D15948F23E4.png\"\n  },\n  {\n    id: \"botdom\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotDom_Avatar-0c48bf15a5.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botdom-thumb-1160EB5E81D24F12CE643C520CE1E99E.png\"\n  },\n  {\n    id: \"botgreg\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotGreg_Avatar-98d39797bb.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botgreg-thumb-F2A37F14F9C342EE44DDE9B24DD9B9FC.png\"\n  },\n  {\n    id: \"botguest\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotGuest_Avatar-78cd857332.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botguest-thumb-F7A471250E2C10C2709325C3B02A8BBB.png\"\n  },\n  {\n    id: \"botjim\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotJim_Avatar-d28005a687.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botjim-thumb-A2D195C1A51A082BCED58BD172481B39.png\"\n  },\n  {\n    id: \"botkev\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotKev_Avatar-a95787bb51.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botkev-thumb-90746A7349E3F964C913EA612EE9A53F.png\"\n  },\n  {\n    id: \"botpinky\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotPinky_Avatar-b0b93f8675.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botpinky-thumb-C2E69D4479077766B988DC3EE4F30BE5.png\"\n  },\n  {\n    id: \"botrobert\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotRobert_Avatar-e9554880f3.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botrobert-thumb-9C33F2C752326E2CF4321EAA7BDB4E47.png\"\n  },\n  {\n    id: \"botwoody\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotWoody_Avatar-0140485a23.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botwoody-thumb-F1F1FA7E21301B5AC1D8872B4ED0CC56.png\"\n  }\n];\n","export function showHoverEffect(el) {\n  const isFrozen = el.sceneEl.is(\"frozen\");\n  const isPinned = el.components.pinnable && el.components.pinnable.data.pinned;\n  const isSpawner = !!el.components[\"super-spawner\"];\n  const canMove =\n    window.APP.hubChannel.can(\"spawn_and_move_media\") && (!isPinned || window.APP.hubChannel.can(\"pin_objects\"));\n  return (isSpawner || !isPinned || isFrozen) && canMove;\n}\n\nexport function canMove(entity) {\n  const isPinned = entity.components.pinnable && entity.components.pinnable.data.pinned;\n  const networkedTemplate = entity && entity.components.networked && entity.components.networked.data.template;\n  const isCamera = networkedTemplate === \"#interactable-camera\";\n  const isPen = networkedTemplate === \"#interactable-pen\";\n  return (\n    window.APP.hubChannel.can(\"spawn_and_move_media\") &&\n    (!isPinned || window.APP.hubChannel.can(\"pin_objects\")) &&\n    (!isCamera || window.APP.hubChannel.can(\"spawn_camera\")) &&\n    (!isPen || window.APP.hubChannel.can(\"spawn_drawing\"))\n  );\n}\n\nfunction indexForNonAuthorizedComponent(nonAuthorizedComponent, schema) {\n  const fullComponent = typeof nonAuthorizedComponent === \"string\";\n  const componentName = fullComponent ? nonAuthorizedComponent : nonAuthorizedComponent.component;\n\n  if (fullComponent) {\n    return schema.components.findIndex(schemaComponent => schemaComponent === componentName);\n  } else {\n    return schema.components.findIndex(\n      schemaComponent =>\n        schemaComponent.component === componentName && schemaComponent.property === nonAuthorizedComponent.property\n    );\n  }\n}\n\nlet nonAuthorizedSchemas = null;\nfunction initializeNonAuthorizedSchemas() {\n  /*\n  Takes the NAF schemas defined in network-schemas.js and produces a data structure of template name to non-authorized\n  component indices:\n  {\n    \"#interactable-media\": [\"4\", \"5\", \"6\"]\n  }\n  */\n  nonAuthorizedSchemas = {};\n  const { schemaDict } = NAF.schemas;\n  for (const template in schemaDict) {\n    if (!schemaDict.hasOwnProperty(template)) continue;\n    const schema = schemaDict[template];\n    nonAuthorizedSchemas[template] = (schema.nonAuthorizedComponents || [])\n      .map(nonAuthorizedComponent => indexForNonAuthorizedComponent(nonAuthorizedComponent, schema))\n      .map(index => index.toString());\n  }\n}\n\nfunction sanitizeMessageData(template, data) {\n  if (nonAuthorizedSchemas === null) {\n    initializeNonAuthorizedSchemas();\n  }\n  const nonAuthorizedIndices = nonAuthorizedSchemas[template];\n  for (const index in data.components) {\n    if (!data.components.hasOwnProperty(index)) continue;\n    if (!nonAuthorizedIndices.includes(index)) {\n      data.components[index] = null;\n    }\n  }\n  return data;\n}\n\nfunction authorizeEntityManipulation(entity, sender, senderPermissions) {\n  const { template, creator } = entity.components.networked.data;\n  const isPinned = entity.components.pinnable && entity.components.pinnable.data.pinned;\n  const isCreator = sender === creator;\n\n  if (template.endsWith(\"-avatar\")) {\n    return isCreator;\n  } else if (template.endsWith(\"-media\")) {\n    return (!isPinned || senderPermissions.pin_objects) && (isCreator || senderPermissions.spawn_and_move_media);\n  } else if (template.endsWith(\"-camera\")) {\n    return isCreator || senderPermissions.spawn_camera;\n  } else if (template.endsWith(\"-pen\")) {\n    return isCreator || senderPermissions.spawn_pen;\n  } else {\n    return false;\n  }\n}\n\nfunction authorizeOrSanitizeMessageData(data, sender, senderPermissions) {\n  const entity = NAF.entities.getEntity(data.networkId);\n  if (!entity) return false;\n\n  if (authorizeEntityManipulation(entity, sender, senderPermissions)) {\n    return true;\n  } else {\n    const { template } = entity.components.networked.data;\n    sanitizeMessageData(template, data);\n    return true;\n  }\n}\n\nconst emptyObject = {};\nexport function authorizeOrSanitizeMessage(message) {\n  const { dataType, from_session_id } = message;\n\n  if (dataType === \"u\" && message.data.isFirstSync && !message.data.persistent) {\n    // The server has already authorized first sync messages that result in an instantiation.\n    return message;\n  }\n\n  const senderPermissions = from_session_id\n    ? window.APP.hubChannel.presence.state[from_session_id].metas[0].permissions\n    : null;\n\n  if (dataType === \"um\") {\n    for (const index in message.data.d) {\n      if (!message.data.d.hasOwnProperty(index)) continue;\n      const authorizedOrSanitized = authorizeOrSanitizeMessageData(\n        message.data.d[index],\n        from_session_id,\n        senderPermissions\n      );\n      if (!authorizedOrSanitized) {\n        message.data.d[index] = emptyObject;\n      }\n    }\n    return message;\n  } else if (dataType === \"u\") {\n    const authorizedOrSanitized = authorizeOrSanitizeMessageData(message.data, from_session_id, senderPermissions);\n    if (authorizedOrSanitized) {\n      return message;\n    } else {\n      return emptyObject;\n    }\n  } else if (dataType === \"r\") {\n    const entity = NAF.entities.getEntity(message.data.networkId);\n    if (!entity) return emptyObject;\n    if (authorizeEntityManipulation(entity, from_session_id, senderPermissions)) {\n      return message;\n    } else {\n      return emptyObject;\n    }\n  } else {\n    // Fall through for other data types. Namely, \"drawing-<networkId>\" messages at the moment.\n    return message;\n  }\n}\n","export const createImageBitmap =\n  window.createImageBitmap ||\n  async function(data) {\n    return new Promise(resolve => {\n      // https://dev.to/nektro/createimagebitmap-polyfill-for-safari-and-edge-228\n      // https://gist.github.com/MonsieurV/fb640c29084c171b4444184858a91bc7\n\n      let srcUrl;\n      if (data instanceof Blob) {\n        srcUrl = URL.createObjectURL(data);\n      } else {\n        const canvas = document.createElement(\"canvas\");\n        const ctx = canvas.getContext(\"2d\");\n        canvas.width = data.width;\n        canvas.height = data.height;\n        ctx.putImageData(data, 0, 0);\n        srcUrl = canvas.toDataURL();\n      }\n      const img = document.createElement(\"img\");\n\n      img.addEventListener(\"load\", () => resolve(img));\n\n      img.src = srcUrl;\n    });\n  };\n\nexport function disposeImageBitmap(imageBitmap) {\n  if (imageBitmap instanceof HTMLImageElement && imageBitmap.src.startsWith(\"blob:\")) {\n    URL.revokeObjectURL(imageBitmap.src);\n  } else {\n    imageBitmap.close && imageBitmap.close();\n  }\n}\n"],"sourceRoot":""}