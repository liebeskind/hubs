{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/utils/history.js","webpack:///./src/utils/avatar-utils.js","webpack:///./src/materials/MobileStandardMaterial.js","webpack:///./src/storage/media-search-store.js","webpack:///./src/utils/phoenix-utils.js","webpack:///./src/components/gltf-model-plus.js","webpack:///./src/utils/promisify-worker.js","webpack:///./src/avatar.js","webpack:///./src/utils/media-url-utils.js","webpack:///./src/components/environment-map.js","webpack:///./src/assets/images/cubemap/posx.jpg","webpack:///./src/assets/images/cubemap/negx.jpg","webpack:///./src/assets/images/cubemap/posy.jpg","webpack:///./src/assets/images/cubemap/negy.jpg","webpack:///./src/assets/images/cubemap/posz.jpg","webpack:///./src/assets/images/cubemap/negz.jpg","webpack:///./src/utils/disable-ios-zoom.js","webpack:///./src/App.js","webpack:///./src/airtable.js","webpack:///./src/assets/stylesheets/avatar-preview.scss","webpack:///./src/assets/stylesheets/avatar.scss","webpack:///./src/assets/images/warning_icon.png","webpack:///./src/assets/images/warning_icon@2x.png","webpack:///./src/react-components/avatar-preview.js","webpack:///./src/utils/logging.js","webpack:///./src/utils/qs_truthy.js","webpack:///./src/everyspace/messages.js","webpack:///./src/utils/i18n.js","webpack:///./src/utils/identity.js","webpack:///./src/storage/store.js","webpack:///./src/assets/images/hub-preview-white.png","webpack:///./src/utils/three-utils.js","webpack:///./src/utils/material-utils.js","webpack:///./src/assets/avatars/avatars.js","webpack:///./src/utils/image-bitmap-utils.js","webpack:///./src/utils/next-tick.js"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","4","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","pushOrUpdateHistory","history","replace","k","v","detail","newPathname","newSearch","state","newLength","location","__historyLength","_objectSpread","__duplicate","pathname","undefined","search","isDuplicate","method","pushHistoryState","replaceHistoryState","pushHistoryPath","path","clearHistoryState","popToBeginningOfHubHistory","navigateToPriorPage","len","Promise","resolve","unsubscribe","listen","go","sluglessPath","split","join","withSlug","AVATAR_TYPES","LEGACY","SKINNABLE","URL","legacyAvatarIds","avatars","map","a","id","getAvatarType","avatarId","indexOf","startsWith","resp","fetchReticulumAuthenticated","fetchAvatar","_x2","_fetchAvatar","this","arguments","avatar_id","gltf_url","find","avatar","model","fetchSkinnableAvatar","proxiedUrlFor","then","getAvatarSrc","fetchAvatarGltfUrl","getAvatarThumbnailUrl","_x4","_getAvatarThumbnailUrl","thumbnail","files","VERTEX_SHADER","FRAGMENT_SHADER","MobileStandardMaterial","THREE","ShaderMaterial","[object Object]","args","super","_defineProperty","material","parameters","vertexShader","fragmentShader","uniforms","uvTransform","Matrix3","diffuse","color","opacity","aoMapIntensity","aoMap","emissive","emissiveMap","fog","lights","transparent","alphaTest","skinning","morphTargets","vertexColors","mobileMaterial","clone","fromStandardMaterial","SOURCES","EMPTY_RESULT","entries","meta","URL_SOURCE_TO_TO_API_SOURCE","scenes","images","videos","youtube","gifs","sketchfab","poly","twitch","favorites","MEDIA_SOURCE_DEFAULT_FILTERS","SEARCH_CONTEXT_PARAMS","MediaSearchStore","EventTarget","constructor","_this","_ref","_asyncToGenerator","dispatchEvent","CustomEvent","urlSource","getUrlMediaSource","previousSource","urlParams","URLSearchParams","requestIndex","currentRequestIndex","searchParams","locationSearchParams","isMy","param","set","source","navigator","languages","singular","fetch","APP","store","credentialsAccountId","toString","url","getReticulumFetchUrl","lastSavedUrl","isFetching","fetchReticulum","nextCursor","next_cursor","lastFetchedUrl","_x","legacyAvatar","type","preview","width","height","gltfs","delta","goBack","filter","query","delete","keepSource","keepNav","_stashedParams","_stashedSource","q","_sourceNavigate","_ref2","hideNav","useLastStashedParams","currentQuery","getSearchClearedSearchParams","useValue","hasAccountWithAvatars","_hasAccountWithAvatars","process","document","host","_x3","substring","stashLastSearchParams","_stashLastSearchParams","hasMediaPath","setHistory","_update","createElement","absolute","_fetchReticulum","headers","Content-Type","credentialsToken","credentials","token","authorization","res","status","console","warn","body","text","JSON","parse","e","reticulumMeta","invalidatedReticulumMetaThisSession","invalidateReticulumMeta","_invalidateReticulumMeta","getReticulumMeta","_getReticulumMeta","querySelector","version","getAttribute","pool","phx_host","json","_x7","phxHostOverride","connectToReticulum","_connectToReticulum","debug","params","qs","getNewSocketUrl","_ref3","socketProtocol","protocol","socketHost","socketPort","RETICULUM_SOCKET_SERVER","port","socketUrl","log","socketSettings","logger","kind","msg","socket","Socket","connect","onError","endPointPath","endPoint","newEndPoint","getLandingPageForPhoto","photoUrl","parsedUrl","payload","retUrl","content-type","stringify","createAndRedirectToNewHub","_x5","_x6","_createAndRedirectToNewHub","sceneId","sceneUrl","createUrl","assets","Name","SceneUrl","record","airtableAssets","fields","hub","default_environment_gltf_bundle_url","Store","error","update","email","creatorAssignmentToken","creator_assignment_token","creatorAssignmentTokens","hubId","hub_id","embedToken","embed_token","embedTokens","getPresenceProfileForSession","presences","sessionId","presence","metas","profile","migrateChannelToSocket","oldChannel","channel","topic","bindings","item","on","event","callback","pushBuffer","timeout","oldJoinPush","joinPush","recHooks","receive","Mesh","raycast","acceleratedRaycast","GLTFCache","extractZipFile","promisifyWorker","SketchfabZipWorker","defaultInflator","el","componentName","componentData","AFRAME","components","Error","multiple","Array","isArray","setAttribute","cloneSkinnedMesh","cloneLookup","Map","parallelTraverse","b","children","sourceNode","clonedNode","isMesh","geometry","boundsTree","traverse","sourceMesh","isSkinnedMesh","sourceBones","skeleton","bones","clonedMesh","sourceBone","has","bindMatrix","getHubsComponents","node","hubsComponents","userData","gltfExtensions","MOZ_hubs_components","HUBS_components","legacyComponents","GLTFModelPlus","registerComponent","componentKey","inflator","inflateEntities","indexToEntityMap","templates","isRoot","modelToWorldScale","childEntities","child","entityComponents","append","className","uuid","classList","add","rotation","order","setFromQuaternion","quaternion","object3D","position","copy","scale","multiplyScalar","matrixNeedsUpdate","matrixAutoUpdate","matrix","identity","decompose","setObject3D","toLowerCase","animations","parent","gltfIndex","attachTemplate","root","templateRoot","targetEls","querySelectorAll","cloneNode","attributes","appendChild","loadGLTF","_loadGLTF","src","contentType","preferredTechnique","onProgress","jsonPreprocessor","fileMap","gltfUrl","includes","loadingManager","LoadingManager","setURLModifier","getCustomGLTFParserURLResolver","gltfLoader","GLTFLoader","parser","reject","createParser","extensions","oldHeightfieldNode","nodes","heightfield","runMigration","materials","MOZ_alt_materials","altMaterialIndex","extras","gltf","scene","Object3D","DefaultMatrixAutoUpdate","mapMaterials","isMeshStandardMaterial","keys","forEach","revokeObjectURL","schema","useCache","default","inflate","init","quality","loadTemplates","applySrc","templateEl","importNode","firstElementChild","content","loadModel","technique","_this2","charAt","assetEl","getElementById","lastSrc","inflatedEl","disposeLastInflatedEl","emit","initMixer","obj","hasBufferGeometry","isBufferGeometry","hasBoundsTree","geo","triCount","index","count","MeshBVH","strategy","maxDepth","object3DToSet","nextTick","inflatedEntity","prop","inflateComponents","rewires","environmentMapComponent","sceneEl","applyEnvironmentMap","f","format","parentNode","removeChild","x","dispose","removeAttribute","worker","nextItemId","outstanding","onmessage","err","handlers","transfer","promise","postMessage","__webpack_exports__","BUILD_VERSION","addLocaleData","en","disableiOSZoom","App","AvatarUI","React","Component","props","forceUpdate","setState","preventDefault","airtableAssetsInitialState","componentDidMount","addEventListener","storeUpdated","refetchAvatar","componentWillUnmount","removeEventListener","render","react__WEBPACK_IMPORTED_MODULE_4___default","styles","avatarLanding","classNames","box","darkened","selectedAvatarId","isSelected","onSubmit","setAvatar","title","attributions","creator","_react_components_avatar_preview__WEBPACK_IMPORTED_MODULE_12__","avatarGltfUrl","selectedMessage","react_intl__WEBPACK_IMPORTED_MODULE_7__","disabled","formSubmit","logo","DarkLogo","PropTypes","string","intl","ReactDOM","locale","lang","messages","scaledThumbnailUrlFor","guessContentType","isHubsSceneUrl","isHubsRoomUrl","isHubsDestinationUrl","isHubsAvatarUrl","nonCorsProxyDomains","CORS_PROXY_SERVER","commonKnownContentTypes","glb","png","jpg","jpeg","pdf","mp4","mp3","farsparkEncodeUrl","str","btoa","encodeURIComponent","_","p1","String","fromCharCode","b64EncodeUnicode","urlHostname","hostname","hasIndex","domain","endsWith","test","corsProxyPrefix","originalUrlParts","decodeURIComponent","extension","pop","hubsSceneRegex","hubsAvatarRegex","hubsRoomRegex","createDefaultEnvironmentMap","_createDefaultEnvironmentMap","urls","cubeMapPosX","cubeMapNegX","cubeMapPosY","cubeMapNegY","cubeMapPosZ","cubeMapNegZ","texture","CubeTextureLoader","load","RGBFormat","environmentMap","updateEnvironmentMap","forEachMaterial","envMap","needsUpdate","detect_browser__WEBPACK_IMPORTED_MODULE_0__","detectOS","userAgent","lastTouchAtMs","ev","now","Date","getTime","isDoubleTouch","_storage_store__WEBPACK_IMPORTED_MODULE_0__","_storage_media_search_store__WEBPACK_IMPORTED_MODULE_1__","mediaSearchStore","setQuality","Airtable","configure","endpointUrl","apiKey","base","Icon","airtableMessages","select","view","firstPage","records","avatar-landing","form-submit","selected-message","TEXTURE_PROPS","base_map","emissive_map","normal_map","orm_map","ALL_MAPS","createRenderer","canvas","alpha","useDevicePixelRatio","context","getContext","depth","antialias","premultipliedAlpha","preserveDrawingBuffer","powerPreference","renderer","WebGLRenderer","gammaOutput","gammaFactor","physicallyCorrectLights","setPixelRatio","devicePixelRatio","createImageBitmapFromURL","blob","createImageBitmap","ORBIT_ANGLE","Euler","Math","DEG2RAD","DEFAULT_MARGIN","fitBoxInFrustum","camera","center","margin","halfYExtents","max","y","min","halfVertFOV","degToRad","fov","tan","z","applyEuler","lookAt","AvatarPreview","Scene","PerspectiveCamera","clientWidth","clientHeight","controls","OrbitControls","enablePan","light","DirectionalLight","HemisphereLight","target","loadPreviewAvatar","clock","Clock","snapshotCanvas","snapshotCamera","snapshotRenderer","setClearAlpha","previewRenderer","setClearColor","setAnimationLoop","dt","getDelta","mixer","resize","parentElement","offsetWidth","offsetHeight","setSize","aspect","updateProjectionMatrix","resetCamera","loading","Box3","Vector3","setFromObject","getCenter","disposeNode","domElement","values","imageBitmaps","img","disposeImageBitmap","oldProps","remove","applyMaps","previewMesh","getObjectByName","idleAnimation","AnimationMixer","action","clipAction","enabled","setLoop","LoopRepeat","Infinity","play","idleAnimationAction","getImage","onUpdate","image","originalMaps","all","bm","stop","toBlob","newProps","mapName","applyMap","applyMapToPreview","File","revertMap","react__WEBPACK_IMPORTED_MODULE_2___default","_assets_images_warning_icon_png__WEBPACK_IMPORTED_MODULE_0___default","srcSet","_assets_images_warning_icon_2x_png__WEBPACK_IMPORTED_MODULE_1___default","react_intl__WEBPACK_IMPORTED_MODULE_4__","ref","injectIntl","withRef","debug__WEBPACK_IMPORTED_MODULE_0__","debug__WEBPACK_IMPORTED_MODULE_0___default","_qs_truthy__WEBPACK_IMPORTED_MODULE_1__","isDebug","qsTruthy","logFilter","enable","val","auth.verified-title","auth.verified","auth.spoke-verified","sign-in.prompt","sign-in.auth-started","sign-in.pin","sign-in.pin-complete","sign-in.unpin","sign-in.unpin-complete","sign-in.change-scene","sign-in.change-scene-complete","sign-in.rename-room","sign-in.rename-room-complete","sign-in.close-room","sign-in.close-room-complete","sign-in.mute-user","sign-in.mute-user-complete","sign-in.kick-user","sign-in.kick-user-complete","sign-in.create-avatar","sign-in.create-avatar-complete","sign-in.favorite-room","sign-in.favorite-rooms","sign-in.favorite-room-complete","sign-in.favorite-rooms-complete","sign-in.as","sign-in.in","sign-in.out","rename-room.message","rename-room.rename","close-room.message","close-room.confirm","close-room.cancel","entry.room","entry.enter-room-title","entry.enter-room","entry.leave-room","entry.change-scene","entry.in-lobby-notice","entry.screen-prefix","entry.desktop-screen","entry.mobile-screen","entry.mobile-safari","entry.generic-prefix","entry.generic-medium","entry.generic-subtitle-desktop","entry.gearvr-prefix","entry.gearvr-medium","entry.choose-device","entry.device-medium","entry.device-subtitle-desktop","entry.device-subtitle-mobile","entry.device-subtitle-vr","entry.cardboard","entry.daydream-prefix","entry.daydream-medium","entry.daydream-via-chrome","entry.invite-others","entry.share-button","entry.desktop.invite-tip","entry.mobile.invite-tip","entry.invite-team-nag","entry.enable-screen-sharing","entry.return-to-vr","entry.enter-in-vr","entry.open-in-window","entry.lobby","entry.back","entry.notify_me","entry.mute-on-entry","profile.save","profile.display_name.validation_warning","profile.header","profile.terms_of_use","profile.privacy_notice","profile.choose_avatar","profile.tabs.legacy","profile.tabs.skinnable","profile.tabs.url","profile.info","profile.info-link","avatar-editor.info","avatar-editor.info-link","avatar-preview.loading-failed","media-browser.search-placeholder.scenes","media-browser.search-placeholder.avatars","media-browser.search-placeholder.videos","media-browser.search-placeholder.images","media-browser.search-placeholder.youtube","media-browser.search-placeholder.gifs","media-browser.search-placeholder.twitch","media-browser.search-placeholder.sketchfab","media-browser.search-placeholder.poly","media-browser.search-placeholder.base","media-browser.favorites-header","media-browser.add_custom_object","media-browser.add_custom_scene","media-browser.add_custom_avatar","media-browser.privacy_policy","media-browser.spoke","media-browser.report_issue","media-browser.powered_by.images","media-browser.powered_by.videos","media-browser.powered_by.youtube","media-browser.powered_by.gifs","media-browser.powered_by.sketchfab","media-browser.powered_by.poly","media-browser.powered_by.twitch","media-browser.powered_by.scenes","media-browser.powered_by.avatars","media-browser.empty.images","media-browser.empty.videos","media-browser.empty.youtube","media-browser.empty.gifs","media-browser.empty.sketchfab","media-browser.empty.poly","media-browser.empty.twitch","media-browser.empty.favorites","media-browser.nav_title.youtube","media-browser.nav_title.videos","media-browser.nav_title.images","media-browser.nav_title.gifs","media-browser.nav_title.scenes","media-browser.nav_title.avatars","media-browser.nav_title.sketchfab","media-browser.nav_title.poly","media-browser.nav_title.twitch","media-browser.create-avatar","media-browser.create-scene","media-browser.hub.joined-prefix","audio.title","audio.talk_to_test","audio.click_to_test","audio.subtitle-desktop","audio.subtitle-mobile","audio.enter-now","audio.hmd-mic-warning","audio.grant-title","audio.grant-subtitle","audio.granted-title","audio.granted-subtitle","audio.granted-next","exit.subtitle.exited","exit.subtitle.closed","exit.subtitle.denied","exit.subtitle.kicked","exit.subtitle.left","exit.subtitle.full","exit.subtitle.connect_error","exit.subtitle.version_mismatch","autoexit.title","autoexit.title_units","autoexit.subtitle","autoexit.cancel","presence.entered_room","presence.entered_lobby","presence.join_lobby","presence.join_room","presence.leave","presence.name_change","presence.scene_change","presence.hub_name_change","presence.in_lobby","presence.in_room","home.create_a_room","home.desktop.add_pwa","home.mobile.add_pwa","home.take_a_tour","home.room_create_options","home.room_create_button","home.create_name.validation_warning","home.join_us","home.have_code","home.add_to_discord_1","home.add_to_discord_2","home.add_to_discord_3","home.create_with_spoke","home.report_issue","home.source_link","home.whats_new_link","home.spoke_link","home.about_link","home.community_link","home.privacy_notice","home.terms_of_use","home.get_updates","home.hero_title","home.hero_blurb","home.made_with_love","home.environment_author_by","dialog.close","mailing_list.privacy_label","mailing_list.privacy_link","link.link_page_header_entry","link.link_page_header_headset","link.linking_a_headset","link.try_again","help.report_issue","scene.logo_tagline","scene.create_button","scene.tweet_button","scene.unavailable","link.in_your_browser","link.enter_code","link.do_not_close","link.connect_headset","link.cancel","invite.enter_via","invite.enter_via_modal","invite.tweet","invite.and_enter_code","invite.or_visit","invite.or_visit_modal","invite.embed","invite.embed-tip","spoke.primary_tagline","spoke.secondary_tagline","spoke.thank_you","spoke.download_win","spoke.download_macos","spoke.download_linux","spoke.download_unsupported","spoke.browse_all_versions","spoke.beginner_tutorial_button","spoke.advanced_tutorial_button","spoke.play_button","commands.fly","commands.grow","commands.shrink","commands.scene","commands.rename","commands.help","commands.leave","commands.duck","commands.capture","commands.debug","commands.vrstats","settings.change-avatar","settings.change-scene","settings.favorites","settings.rename-room","settings.close-room","settings.room-info","settings.create-room","settings.create-scene","settings.send-feedback","settings.whats-new","settings.features","settings.controls","settings.community","settings.tips","settings.report","settings.terms","settings.privacy","settings.help","settings.row-profile","settings.row-room","tips.mobile.video_share_mode","tips.mobile.pen_mode","tips.mobile.mute_mode","tips.mobile.freeze_mode","tips.mobile.look","tips.mobile.locomotion","tips.mobile.spawn_menu-pre","tips.mobile.spawn_menu-post","tips.mobile.freeze_gesture","tips.mobile.object_grab","tips.mobile.object_rotate_button-pre","tips.mobile.object_rotate_button-post","tips.mobile.object_scale_button-pre","tips.mobile.object_scale_button-post","tips.mobile.object_recenter_button-pre","tips.mobile.object_recenter_button-post","tips.mobile.object_pin","tips.mobile.invite","tips.desktop.video_share_mode","tips.desktop.pen_mode","tips.desktop.mirror_mode","tips.desktop.mute_mode","tips.desktop.look","tips.desktop.locomotion","tips.desktop.turning","tips.desktop.spawn_menu-pre","tips.desktop.spawn_menu-post","tips.desktop.freeze_gesture","tips.desktop.menu_hover","tips.desktop.object_grab","tips.desktop.object_pin","tips.desktop.object_zoom","tips.desktop.object_rotate_button-pre","tips.desktop.object_rotate_button-post","tips.desktop.object_scale_button-pre","tips.desktop.object_scale_button-post","tips.desktop.object_recenter_button-pre","tips.desktop.object_recenter_button-post","tips.desktop.object_scale","tips.desktop.pen_color","tips.desktop.pen_size","tips.desktop.invite","tips.desktop.watching","tips.watching.back","tips.mobile.watching","tips.watching-exit","loader.entering_lobby","loader.loading","loader.object","loader.objects","change-scene-dialog.change-scene","change-scene-dialog.create-in-spoke","change-scene-dialog.new-spoke-project","avatar-url-dialog.apply","interstitial.prompt","feedback.prompt","hide-ui.prompt","discord.primary_tagline","discord.secondary_tagline","discord.contact_us","discord.community_link","discord.splash_tag","client-info.kick-button","client-info.hide-button","client-info.unhide-button","client-info.mute-button","client-info.cancel","avatar-landing.select","avatar-landing.selected","leave-room-dialog.join-room.message","leave-room-dialog.join-room.confirm","leave-room-dialog.create-room.message","leave-room-dialog.create-room.confirm","embed.load-button","embed.presence-warning","i18n_messages","navigatorLang","language","userLanguage","localeData","names","selectRandom","arr","floor","random","avatarIds","av","generateDefaultProfile","LOCAL_STORE_KEY","STORE_STATE_CACHE_KEY","OAUTH_FLOW_CREDENTIALS_KEY","validator","Validator","SCHEMA","definitions","additionalProperties","properties","displayName","pattern","personalAvatarId","activity","hasFoundFreeze","hasChangedName","hasAcceptedProfile","lastEnteredAt","hasPinned","hasRotated","hasRecentered","hasScaled","hasHoveredInWorldHud","hasOpenedShare","settings","lastUsedMicDeviceId","confirmedDiscordRooms","items","confirmedBroadcastedRooms","uploadPromotionTokens","fileId","promotionToken","$ref","localStorage","getItem","setItem","oauthFlowCredentials","Cookies","getJSON","resetToRandomLegacyAvatar","jwtDecode","sub","resetConfirmedBroadcastedRooms","arrayMerge","destinationArray","sourceArray","resetTipActivityFlags","newState","mergeOpts","finalState","merge","valid","validate","getLastWorldPosition","getLastWorldQuaternion","setMatrixWorld","tempVector3","Quaternion","updateMatrices","setFromMatrixPosition","matrixWorld","disposeMaterial","mtrl","lightMap","bumpMap","normalMap","specularMap","materialArray","MeshFaceMaterial","MultiMaterial","getInverse","multiply","fn","srcUrl","Blob","createObjectURL","ctx","putImageData","toDataURL","imageBitmap","HTMLImageElement","close","setTimeout"],"mappings":"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,MAAM,SAAS,GACL2f,EAAQ8iB,EAAWH,IAAkBA,GAAkB,KACvD1iB,EAAW6iB,EAAW9iB,IAAS8iB,EAAW1lB,6GCJvD,MAAM2lB,EAAQ,CACZ,gBACA,cACA,oBACA,cACA,YACA,cACA,aACA,aACA,aACA,gBACA,gBACA,gBACA,gBACA,YACA,eACA,mBACA,mBACA,iBACA,gBACA,kBACA,eACA,eACA,mBACA,iBACA,WACA,cACA,gBACA,UACA,WACA,gBACA,cACA,YACA,WACA,YACA,YACA,mBACA,iBACA,aACA,aACA,YACA,cACA,eACA,cACA,cACA,UACA,WACA,eACA,eACA,YACA,mBACA,gBACA,oBACA,kBACA,YACA,cACA,kBACA,aACA,cACA,eACA,cACA,cACA,cACA,iBACA,kBACA,cACA,WACA,WACA,cACA,OACA,mBACA,cACA,mBACA,cACA,iBACA,aACA,cACA,cACA,gBACA,qBACA,iBACA,eACA,gBACA,eACA,SACA,YACA,iBAGF,SAASC,EAAaC,GACpB,OAAOA,EAAI9b,KAAK+b,MAAM/b,KAAKgc,SAAWF,EAAInoC,SAOrC,MAAMsoC,EAAYviC,IAAQC,IAAIuiC,GAAMA,EAAGriC,IAEvC,SAASsiC,IACd,MAAO,CACLpiC,SAAU8hC,EAAaI,ggBClG3B,MAAMG,EAAkB,gBAClBC,EAAwBtmC,SACxBumC,EAA6B,qCAC7BC,EAAY,IAAIC,YAMTC,EAAS,CACpB5iC,GAAI,aAEJ6iC,YAAa,CACXvzB,QAAS,CACPnI,KAAM,SACN27B,sBAAsB,EACtBC,WAAY,CACVC,YAAa,CAAE77B,KAAM,SAAU87B,QAAS,wBACxC/iC,SAAU,CAAEiH,KAAM,UAClB+7B,iBAAkB,CAAE/7B,KAAM,YAI9BwC,YAAa,CACXxC,KAAM,SACN27B,sBAAsB,EACtBC,WAAY,CACVn5B,MAAO,CAAEzC,KAAM,CAAC,OAAQ,WACxBqH,MAAO,CAAErH,KAAM,CAAC,OAAQ,aAI5Bg8B,SAAU,CACRh8B,KAAM,SACN27B,sBAAsB,EACtBC,WAAY,CACVK,eAAgB,CAAEj8B,KAAM,WACxBk8B,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","file":"assets/js/avatar-4599356928b4a37dd786.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t4: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([1580,1,0]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","// Utilities for manipulating state history. This provides a number of functions which\n// need to be used to manipulate history state so we can deal with edge cases around\n// entry back button and refreshes once entered.\n//\n// These functions also transparently deal with the room slug, so incoming calls can ignore\n// dealing with it, and provides APIs for getting the non-slug part of the path.\n//\n// The slug cannot be part of the basename for history, because the slug changes intra-session\n// if the room is renamed.\n\n// This pushes/replaces a new k, v pair into the history, while maintaining all the other\n// keys, or clears state if k if null.\n//\n// Also maintains a length key that can be used to find the length of the history chain\n// (across refreshes) for the current room.\nfunction pushOrUpdateHistory(history, replace, k, v, detail, newPathname, newSearch) {\n  let state = {};\n  const newLength = ((history.location.state && history.location.state.__historyLength) || 0) + (replace ? 0 : 1);\n\n  if (k || newPathname || newSearch) {\n    state = history.location.state ? { ...history.location.state } : {};\n    delete state.__duplicate;\n\n    if (k) {\n      state[k] = v;\n      state.key = k;\n      state.value = v;\n      state.detail = detail;\n    }\n  }\n\n  const pathname =\n    newPathname !== undefined ? newPathname : history.location.pathname === \"/\" ? \"\" : history.location.pathname;\n\n  const search = newSearch !== undefined ? newSearch : history.location.search;\n\n  // If popToBeginningOfHubHistory was previously used, there is a duplicate entry\n  // at the top of the history stack (which was needed to wipe out forward history)\n  // so we use this opportunity to replace it.\n  const isDuplicate = history.location.state && history.location.state.__duplicate;\n  const method = replace || isDuplicate ? history.replace : history.push;\n  state.__historyLength = newLength;\n\n  method({ pathname, search, state });\n}\n\nexport function pushHistoryState(history, k, v, detail) {\n  pushOrUpdateHistory(history, false, k, v, detail);\n}\n\nexport function replaceHistoryState(history, k, v, detail) {\n  pushOrUpdateHistory(history, true, k, v, detail);\n}\n\nexport function pushHistoryPath(history, path, search) {\n  pushOrUpdateHistory(history, false, null, null, null, path, search);\n}\n\nexport function clearHistoryState(history) {\n  pushOrUpdateHistory(history, false);\n}\n\n// This will pop the browser history to the first entry that was for this hubs room,\n// and then push a duplicate entry onto the history stack in order to wipe out forward\n// history.\nexport function popToBeginningOfHubHistory(history, navigateToPriorPage) {\n  if (!history.location.state || history.location.state.__historyLength === undefined) return;\n\n  const len = history.location.state.__historyLength;\n  if (len === 0) return;\n\n  return new Promise(resolve => {\n    // After the go() completes, we push a duplicate history entry onto the stack\n    // in order to wipe out forward history. We also optionally go back -2 if we wanted\n    // to go back to the prior page.\n    const unsubscribe = history.listen(() => {\n      unsubscribe();\n      history.push({\n        pathname: history.location.pathname,\n        search: history.location.search,\n        state: { __historyLength: 0, __duplicate: true }\n      });\n      if (navigateToPriorPage) history.go(-2); // Go back to history entry before beginning.\n      resolve();\n    });\n\n    history.go(-len);\n  });\n}\n\n// This will pop the browser history to the entry before the first entry for this hubs room.\nexport function navigateToPriorPage(history) {\n  popToBeginningOfHubHistory(history, true);\n}\n\n// Returns the part of the pathname that does not include the slug\nexport function sluglessPath(location) {\n  const parts = location.pathname.split(\"/\");\n  return `/${parts.slice(2).join(\"/\")}`;\n}\n\n// Returns a new path that includes the current slug as a prefix to the\n// provided path.\nexport function withSlug(location, path) {\n  const parts = location.pathname.split(\"/\");\n  return `/${parts[1]}${path}`;\n}\n","import { fetchReticulumAuthenticated } from \"./phoenix-utils\";\nimport { proxiedUrlFor } from \"./media-url-utils\";\nimport { avatars } from \"../assets/avatars/avatars\";\n\nexport const AVATAR_TYPES = {\n  LEGACY: \"legacy\",\n  SKINNABLE: \"skinnable\",\n  URL: \"url\"\n};\n\nconst legacyAvatarIds = avatars.map(a => a.id);\nexport function getAvatarType(avatarId) {\n  if (!avatarId || legacyAvatarIds.indexOf(avatarId) !== -1) return AVATAR_TYPES.LEGACY;\n  if (avatarId.startsWith(\"http\")) return AVATAR_TYPES.URL;\n  return AVATAR_TYPES.SKINNABLE;\n}\n\nasync function fetchSkinnableAvatar(avatarId) {\n  const resp = await fetchReticulumAuthenticated(`/api/v1/avatars/${avatarId}`);\n  return resp && resp.avatars && resp.avatars[0];\n}\n\nexport async function fetchAvatar(avatarId) {\n  switch (getAvatarType(avatarId)) {\n    case AVATAR_TYPES.LEGACY:\n      return {\n        avatar_id: avatarId,\n        gltf_url: avatars.find(avatar => avatar.id === avatarId).model\n      };\n    case AVATAR_TYPES.SKINNABLE:\n      return fetchSkinnableAvatar(avatarId);\n    case AVATAR_TYPES.URL:\n      return {\n        avatar_id: avatarId,\n        gltf_url: proxiedUrlFor(avatarId)\n      };\n  }\n}\n\nasync function fetchAvatarGltfUrl(avatarId) {\n  return fetchAvatar(avatarId).then(avatar => avatar && avatar.gltf_url);\n}\n\nexport function getAvatarSrc(avatarId) {\n  switch (getAvatarType(avatarId)) {\n    case AVATAR_TYPES.LEGACY:\n      return `#${avatarId}`;\n    case AVATAR_TYPES.SKINNABLE:\n      return fetchAvatarGltfUrl(avatarId);\n    case AVATAR_TYPES.URL:\n      return proxiedUrlFor(avatarId);\n    default:\n      return avatarId;\n  }\n}\n\nexport async function getAvatarThumbnailUrl(avatarId) {\n  switch (getAvatarType(avatarId)) {\n    case AVATAR_TYPES.LEGACY:\n      return avatars.find(avatar => avatar.id === avatarId).thumbnail;\n    case AVATAR_TYPES.SKINNABLE:\n      return fetchAvatar(avatarId).then(avatar => avatar.files.thumbnail);\n    default:\n      return \"https://asset-bundles-prod.reticulum.io/bots/avatar_unavailable.png\";\n  }\n}\n","const VERTEX_SHADER = `\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n  #include <uv_vertex>\n  #include <uv2_vertex>\n  #include <color_vertex>\n  #include <skinbase_vertex>\n\n  #include <begin_vertex>\n  #include <morphtarget_vertex>\n  #include <skinning_vertex>\n  #include <project_vertex>\n  #include <logdepthbuf_vertex>\n\n  #include <worldpos_vertex>\n  #include <clipping_planes_vertex>\n  #include <fog_vertex>\n}\n`;\n\nconst FRAGMENT_SHADER = `\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <aomap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n  #include <clipping_planes_fragment>\n\n  vec4 diffuseColor = vec4(diffuse, opacity);\n  ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n  vec3 totalEmissiveRadiance = emissive;\n\n  #include <logdepthbuf_fragment>\n  #include <map_fragment>\n  #include <color_fragment>\n  #include <alphatest_fragment>\n  #include <emissivemap_fragment>\n\n  reflectedLight.indirectDiffuse += vec3(1.0);\n\n  #include <aomap_fragment>\n\n  reflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n  vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n  gl_FragColor = vec4(outgoingLight, diffuseColor.a);\n\n  #include <premultiplied_alpha_fragment>\n  #include <tonemapping_fragment>\n  #include <encodings_fragment>\n  #include <fog_fragment>\n}\n`;\n\nexport default class MobileStandardMaterial extends THREE.ShaderMaterial {\n  type = \"MobileStandardMaterial\";\n  isMobileStandardMaterial = true;\n  static fromStandardMaterial(material) {\n    const parameters = {\n      vertexShader: VERTEX_SHADER,\n      fragmentShader: FRAGMENT_SHADER,\n      uniforms: {\n        uvTransform: { value: new THREE.Matrix3() },\n        diffuse: { value: material.color },\n        opacity: { value: material.opacity },\n        map: { value: material.map },\n        aoMapIntensity: { value: material.aoMapIntensity },\n        aoMap: { value: material.aoMap },\n        emissive: { value: material.emissive },\n        emissiveMap: { value: material.emissiveMap }\n      },\n      fog: true,\n      lights: false,\n      opacity: material.opacity,\n      transparent: material.transparent,\n      alphaTest: material.alphaTest,\n      skinning: material.skinning,\n      morphTargets: material.morphTargets,\n      vertexColors: material.vertexColors\n    };\n\n    const mobileMaterial = new MobileStandardMaterial(parameters);\n\n    mobileMaterial.color = material.color;\n    mobileMaterial.map = material.map;\n    mobileMaterial.aoMap = material.aoMap;\n    mobileMaterial.aoMapIntensity = material.aoMapIntensity;\n    mobileMaterial.emissive = material.emissive;\n    mobileMaterial.emissiveMap = material.emissiveMap;\n\n    return mobileMaterial;\n  }\n  clone() {\n    return MobileStandardMaterial.fromStandardMaterial(this);\n  }\n}\n","import { EventTarget } from \"event-target-shim\";\nimport { getReticulumFetchUrl, fetchReticulum } from \"../utils/phoenix-utils\";\nimport { pushHistoryPath, sluglessPath, withSlug } from \"../utils/history\";\n\nexport const SOURCES = [\"poly\", \"sketchfab\", \"videos\", \"scenes\", \"gifs\", \"images\", \"twitch\"];\n\nconst EMPTY_RESULT = { entries: [], meta: {} };\n\nconst URL_SOURCE_TO_TO_API_SOURCE = {\n  scenes: \"scene_listings\",\n  images: \"bing_images\",\n  videos: \"bing_videos\",\n  youtube: \"youtube_videos\",\n  gifs: \"tenor\",\n  sketchfab: \"sketchfab\",\n  poly: \"poly\",\n  twitch: \"twitch\",\n  favorites: \"favorites\"\n};\n\nexport const MEDIA_SOURCE_DEFAULT_FILTERS = {\n  gifs: \"trending\",\n  sketchfab: \"featured\",\n  scenes: \"featured\",\n  favorites: \"my-favorites\"\n};\n\nconst SEARCH_CONTEXT_PARAMS = [\"q\", \"filter\", \"cursor\"];\n\n// This class is responsible for fetching and storing media search results and provides a\n// convenience API for performing history updates relevant to search navigation.\nexport default class MediaSearchStore extends EventTarget {\n  constructor() {\n    super();\n\n    this.requestIndex = 0;\n  }\n\n  setHistory(history) {\n    this.history = history;\n\n    this._update(this.history.location);\n\n    this.history.listen(location => {\n      this._update(location);\n    });\n  }\n\n  _update = async location => {\n    this.result = null;\n    this.dispatchEvent(new CustomEvent(\"statechanged\"));\n\n    const urlSource = this.getUrlMediaSource(location);\n    if (!urlSource) return;\n\n    if (!this.previousSource || this.previousSource !== urlSource) {\n      this.dispatchEvent(new CustomEvent(\"sourcechanged\"));\n      this.previousSource = urlSource;\n    }\n\n    const urlParams = new URLSearchParams(location.search);\n\n    this.requestIndex++;\n    const currentRequestIndex = this.requestIndex;\n    const searchParams = new URLSearchParams();\n    const locationSearchParams = new URLSearchParams(location.search);\n    const isMy = locationSearchParams.get(\"filter\") && locationSearchParams.get(\"filter\").startsWith(\"my-\");\n\n    for (const param of SEARCH_CONTEXT_PARAMS) {\n      if (!urlParams.get(param)) continue;\n      searchParams.set(param, urlParams.get(param));\n    }\n\n    searchParams.get(\"locale\", navigator.languages[0]);\n\n    let source;\n    if (urlSource === \"avatars\" || urlSource === \"scenes\") {\n      // Avatars + scenes are special since we request them from a different source based on the facet.\n      const singular = urlSource === \"avatars\" ? \"avatar\" : \"scene\";\n      source = isMy ? `${singular}s` : `${singular}_listings`;\n    } else {\n      source = URL_SOURCE_TO_TO_API_SOURCE[urlSource];\n    }\n    searchParams.set(\"source\", source);\n\n    let fetch = true;\n\n    if (source === \"avatars\" || source === \"scenes\" || source === \"favorites\") {\n      if (isMy) {\n        if (window.APP.store.credentialsAccountId) {\n          searchParams.set(\"user\", window.APP.store.credentialsAccountId);\n        } else {\n          fetch = false; // Don't fetch my-* if not signed in\n        }\n      }\n    }\n\n    const path = `/api/v1/media/search?${searchParams.toString()}`;\n    const url = getReticulumFetchUrl(path);\n    if (this.lastSavedUrl === url) return;\n\n    this.isFetching = true;\n    this.dispatchEvent(new CustomEvent(\"statechanged\"));\n    const result = fetch ? await fetchReticulum(path) : EMPTY_RESULT;\n\n    if (this.requestIndex != currentRequestIndex) return;\n\n    this.result = result;\n    this.nextCursor = this.result && this.result.meta && this.result.meta.next_cursor;\n    this.lastFetchedUrl = url;\n    this.isFetching = false;\n    this.dispatchEvent(new CustomEvent(\"statechanged\"));\n  };\n\n  _legacyAvatarToSearchEntry = legacyAvatar => {\n    return {\n      id: legacyAvatar.id,\n      type: \"avatar_listing\",\n      url: legacyAvatar.url,\n      images: { preview: { url: legacyAvatar.thumbnail, width: 720, height: 1280 } },\n      gltfs: { avatar: legacyAvatar.model }\n    };\n  };\n\n  pageNavigate = delta => {\n    if (delta === -1) {\n      this.history.goBack();\n    } else {\n      const location = this.history.location;\n      const searchParams = new URLSearchParams(location.search);\n      searchParams.set(\"cursor\", this.nextCursor);\n      pushHistoryPath(this.history, location.pathname, searchParams.toString());\n    }\n  };\n\n  filterQueryNavigate = (filter, query) => {\n    const location = this.history.location;\n    const searchParams = new URLSearchParams(location.search);\n\n    if (query) {\n      searchParams.set(\"q\", query);\n    } else {\n      searchParams.delete(\"q\");\n    }\n\n    if (filter) {\n      searchParams.set(\"filter\", filter);\n    } else {\n      searchParams.delete(\"filter\");\n    }\n\n    if (filter) {\n      searchParams.set(\"cursor\", filter);\n    } else {\n      searchParams.delete(\"cursor\");\n    }\n\n    pushHistoryPath(this.history, location.pathname, searchParams.toString());\n  };\n\n  getSearchClearedSearchParams = (location, keepSource, keepNav) => {\n    const searchParams = new URLSearchParams(location.search);\n\n    // Strip browsing query params\n    searchParams.delete(\"q\");\n    searchParams.delete(\"filter\");\n    searchParams.delete(\"cursor\");\n\n    if (!keepNav) {\n      searchParams.delete(\"media_nav\");\n    }\n\n    if (!keepSource) {\n      searchParams.delete(\"media_source\");\n    }\n\n    return searchParams;\n  };\n\n  _stashLastSearchParams = location => {\n    const searchParams = new URLSearchParams(location.search);\n\n    this._stashedParams = {};\n    this._stashedSource = null;\n\n    const source = this.getUrlMediaSource(location);\n\n    // HACK for now do not stash favorite search, since that ends up being a source\n    // we do not reveal in the media browser UX. Revisit the rules here when we have a\n    // proper favorites browser. Then, we should have two separate stashes.\n    if (source === \"favorites\") return;\n    this._stashedSource = source;\n\n    for (const param of SEARCH_CONTEXT_PARAMS) {\n      const value = searchParams.get(param);\n\n      if (value) {\n        this._stashedParams[param] = value;\n      }\n    }\n  };\n\n  clearStashedQuery = () => {\n    if (!this._stashedParams) return;\n    delete this._stashedParams.q;\n  };\n\n  sourceNavigate = source => {\n    this._sourceNavigate(source, false, true);\n  };\n\n  sourceNavigateToDefaultSource = () => {\n    this._sourceNavigate(this._stashedSource ? this._stashedSource : SOURCES[0], false, true);\n  };\n\n  sourceNavigateWithNoNav = source => {\n    this._sourceNavigate(source, true, false);\n  };\n\n  _sourceNavigate = async (source, hideNav, useLastStashedParams) => {\n    const currentQuery = new URLSearchParams(this.history.location.search).get(\"q\");\n    const searchParams = this.getSearchClearedSearchParams(this.history.location);\n\n    if (currentQuery) {\n      searchParams.set(\"q\", currentQuery);\n    } else {\n      if (useLastStashedParams && this._stashedParams) {\n        for (const param of SEARCH_CONTEXT_PARAMS) {\n          const value = this._stashedParams[param];\n\n          // Only q param is compatible across sources, so keep it if is stashed.\n          const useValue = param === \"q\" || this._stashedSource === source;\n\n          if (value && useValue) {\n            searchParams.set(param, value);\n          }\n        }\n      } else {\n        if (source === \"avatars\") {\n          const hasAccountWithAvatars = await this._hasAccountWithAvatars();\n          searchParams.set(\"filter\", hasAccountWithAvatars ? \"my-avatars\" : \"featured\");\n        } else if (MEDIA_SOURCE_DEFAULT_FILTERS[source]) {\n          searchParams.set(\"filter\", MEDIA_SOURCE_DEFAULT_FILTERS[source]);\n        }\n      }\n    }\n\n    this._stashedParams = null;\n    this._stashedSource = null;\n\n    if (hideNav) {\n      searchParams.set(\"media_nav\", \"false\");\n    }\n\n    if (process.env.RETICULUM_SERVER && document.location.host !== process.env.RETICULUM_SERVER) {\n      searchParams.set(\"media_source\", source);\n      pushHistoryPath(this.history, this.history.location.pathname, searchParams.toString());\n    } else {\n      pushHistoryPath(this.history, withSlug(this.history.location, `/media/${source}`), searchParams.toString());\n    }\n  };\n\n  _hasAccountWithAvatars = async () => {\n    const { credentialsAccountId } = window.APP.store;\n    if (!credentialsAccountId) return false;\n\n    const searchParams = new URLSearchParams();\n    const source = \"avatars\";\n    searchParams.set(\"source\", source);\n    searchParams.set(\"user\", credentialsAccountId);\n    const result = await fetchReticulum(`/api/v1/media/search?${searchParams.toString()}`);\n    return !!(result && result.entries) && result.entries.length > 0;\n  };\n\n  getUrlMediaSource = location => {\n    const { search } = location;\n    const urlParams = new URLSearchParams(search);\n    const pathname = sluglessPath(location);\n\n    if (!pathname.startsWith(\"/media\") && !urlParams.get(\"media_source\")) return null;\n    return urlParams.get(\"media_source\") || pathname.substring(7);\n  };\n\n  pushExitMediaBrowserHistory = (history, stashLastSearchParams = true) => {\n    if (!history) history = this.history;\n\n    if (stashLastSearchParams) this._stashLastSearchParams(history.location);\n\n    const { pathname } = history.location;\n    const hasMediaPath = sluglessPath(history.location).startsWith(\"/media\");\n    pushHistoryPath(\n      history,\n      hasMediaPath ? withSlug(history.location, \"/\") : pathname,\n      this.getSearchClearedSearchParams(history.location).toString()\n    );\n    this.dispatchEvent(new CustomEvent(\"media-exit\"));\n  };\n}\n","import { Socket } from \"phoenix\";\nimport { generateHubName } from \"../utils/name-generation\";\nimport { airtableAssets, airtableAssetsInitialState } from '../airtable'\n\nimport Store from \"../storage/store\";\n\nconst resolverLink = document.createElement(\"a\");\nexport function getReticulumFetchUrl(path, absolute = false) {\n  if (process.env.RETICULUM_SERVER) {\n    return `https://${process.env.RETICULUM_SERVER}${path}`;\n  } else if (absolute) {\n    resolverLink.href = path;\n    return resolverLink.href;\n  } else {\n    return path;\n  }\n}\n\nexport async function fetchReticulum(path, absolute = false) {\n  const headers = { \"Content-Type\": \"application/json\" };\n  const credentialsToken = window.APP.store.state.credentials.token;\n  if (credentialsToken) headers.authorization = `bearer ${credentialsToken}`;\n\n  const res = await fetch(getReticulumFetchUrl(path, absolute), { method: \"GET\", headers });\n\n  if (res.status !== 200) {\n    console.warn(\"Reticulum fetch failed \" + path);\n    return null;\n  }\n\n  const body = await res.text();\n\n  let result;\n  try {\n    result = JSON.parse(body);\n  } catch (e) {\n    result = body; // TODO better error handling\n  }\n\n  return result;\n}\n\nlet reticulumMeta = null;\nlet invalidatedReticulumMetaThisSession = false;\n\nexport async function invalidateReticulumMeta() {\n  invalidatedReticulumMetaThisSession = true;\n  reticulumMeta = null;\n}\n\nexport async function getReticulumMeta() {\n  if (!reticulumMeta) {\n    // Initially look up version based upon page, avoiding round-trip, otherwise fetch.\n    if (!invalidatedReticulumMetaThisSession && document.querySelector(\"meta[name='ret:version']\")) {\n      reticulumMeta = {\n        version: document.querySelector(\"meta[name='ret:version']\").getAttribute(\"value\"),\n        pool: document.querySelector(\"meta[name='ret:pool']\").getAttribute(\"value\"),\n        phx_host: document.querySelector(\"meta[name='ret:phx_host']\").getAttribute(\"value\")\n      };\n    } else {\n      await fetch(getReticulumFetchUrl(\"/api/v1/meta\")).then(async res => {\n        reticulumMeta = await res.json();\n      });\n    }\n  }\n\n  const qs = new URLSearchParams(location.search);\n  const phxHostOverride = qs.get(\"phx_host\");\n\n  if (phxHostOverride) {\n    reticulumMeta.phx_host = phxHostOverride;\n  }\n\n  return reticulumMeta;\n}\n\nexport async function connectToReticulum(debug = false, params = null) {\n  const qs = new URLSearchParams(location.search);\n\n  const getNewSocketUrl = async () => {\n    const socketProtocol = qs.get(\"phx_protocol\") || (document.location.protocol === \"https:\" ? \"wss:\" : \"ws:\");\n    let socketHost = qs.get(\"phx_host\");\n    let socketPort = qs.get(\"phx_port\");\n\n    const reticulumMeta = await getReticulumMeta();\n    socketHost = socketHost || process.env.RETICULUM_SOCKET_SERVER || reticulumMeta.phx_host;\n    socketPort =\n      socketPort ||\n      (process.env.RETICULUM_SERVER ? new URL(`${socketProtocol}//${process.env.RETICULUM_SERVER}`).port : \"443\");\n    return `${socketProtocol}//${socketHost}${socketPort ? `:${socketPort}` : \"\"}`;\n  };\n\n  const socketUrl = await getNewSocketUrl();\n  console.log(`Phoenix Socket URL: ${socketUrl}`);\n\n  const socketSettings = {};\n\n  if (debug) {\n    socketSettings.logger = (kind, msg, data) => {\n      console.log(`${kind}: ${msg}`, data);\n    };\n  }\n\n  if (params) {\n    socketSettings.params = params;\n  }\n\n  const socket = new Socket(`${socketUrl}/socket`, socketSettings);\n  socket.connect();\n  socket.onError(async () => {\n    // On error, underlying reticulum node may have died, so rebalance by\n    // fetching a new healthy node to connect to.\n    invalidateReticulumMeta();\n\n    const endPointPath = new URL(socket.endPoint).pathname;\n    const newSocketUrl = await getNewSocketUrl();\n    const newEndPoint = `${newSocketUrl}${endPointPath}`;\n    console.log(`Socket error, changed endpoint to ${newEndPoint}`);\n    socket.endPoint = newEndPoint;\n  });\n\n  return socket;\n}\n\nexport function getLandingPageForPhoto(photoUrl) {\n  const parsedUrl = new URL(photoUrl);\n  return getReticulumFetchUrl(parsedUrl.pathname.replace(\".png\", \".html\") + parsedUrl.search, true);\n}\n\nexport function fetchReticulumAuthenticated(url, method = \"GET\", payload) {\n  const { token } = window.APP.store.state.credentials;\n  const retUrl = getReticulumFetchUrl(url);\n  const params = {\n    headers: { \"content-type\": \"application/json\" },\n    method\n  };\n  if (token) {\n    params.headers.authorization = `bearer ${token}`;\n  }\n  if (payload) {\n    params.body = JSON.stringify(payload);\n  }\n  return fetch(retUrl, params).then(async r => {\n    const result = await r.text();\n    try {\n      return JSON.parse(result);\n    } catch (e) {\n      // Some reticulum responses, particularly DELETE requests, don't return json.\n      return result;\n    }\n  });\n}\n\nexport async function createAndRedirectToNewHub(name, sceneId, sceneUrl, replace) {\n  const createUrl = getReticulumFetchUrl(\"/api/v1/hubs\");\n\n  let assets = {Name: \"Test\", SceneUrl: null};\n\n  const record = await airtableAssets.find('recHqITRS7cBMwn9i')\n\n  if (record) assets = record.fields;\n  \n  // const payload = { hub: { name: name || generateHubName() } };\n  const payload = { hub: { name: assets.Name } };\n  \n\n  // if (sceneId) {\n  //   payload.hub.scene_id = sceneId;\n  // } else {\n    // payload.hub.default_environment_gltf_bundle_url = sceneUrl;\n    \n    // payload.hub.default_environment_gltf_bundle_url = 'https://www.dropbox.com/s/ayl3t33p2ymnxux/Axon%20Park_Cliffside.glb';\n    // payload.hub.default_environment_gltf_bundle_url = 'https://s3-us-west-1.amazonaws.com/axonpark/Axon_Park_Cliffside.glb';\n    payload.hub.default_environment_gltf_bundle_url = assets.SceneUrl;\n    // payload.hub.default_environment_gltf_bundle_url = '/assets/Axon_Park_Cliffside.glb';\n  // }\n\n  const headers = { \"content-type\": \"application/json\" };\n  const store = new Store();\n  if (store.state && store.state.credentials.token) {\n    headers.authorization = `bearer ${store.state.credentials.token}`;\n  }\n\n  let res = await fetch(createUrl, {\n    body: JSON.stringify(payload),\n    headers,\n    method: \"POST\"\n  }).then(r => r.json());\n\n  if (res.error === \"invalid_token\") {\n    // Clear the invalid token from store.\n    store.update({ credentials: { token: null, email: null } });\n\n    // Create hub anonymously\n    delete headers.authorization;\n    res = await fetch(createUrl, {\n      body: JSON.stringify(payload),\n      headers,\n      method: \"POST\"\n    }).then(r => r.json());\n  }\n\n  const hub = res;\n  let url = hub.url;\n\n  const creatorAssignmentToken = hub.creator_assignment_token;\n  if (creatorAssignmentToken) {\n    store.update({ creatorAssignmentTokens: [{ hubId: hub.hub_id, creatorAssignmentToken: creatorAssignmentToken }] });\n\n    // Don't need to store the embed token if there's no creator assignment token, since that means\n    // we are the owner and will get the embed token on page load.\n    const embedToken = hub.embed_token;\n\n    if (embedToken) {\n      store.update({ embedTokens: [{ hubId: hub.hub_id, embedToken: embedToken }] });\n    }\n  }\n\n  if (process.env.RETICULUM_SERVER && document.location.host !== process.env.RETICULUM_SERVER) {\n    url = `/hub.html?hub_id=${hub.hub_id}`;\n  }\n\n  if (replace) {\n    document.location.replace(url);\n  } else {\n    document.location = url;\n  }\n}\n\nexport function getPresenceProfileForSession(presences, sessionId) {\n  const entry = Object.entries(presences || {}).find(([k]) => k === sessionId) || [];\n  const presence = entry[1];\n  return (presence && presence.metas && presence.metas[0].profile) || {};\n}\n\n// Takes the given channel, and creates a new channel with the same bindings\n// with the given socket, joins it, and leaves the old channel after joining.\n//\n// NOTE: This function relies upon phoenix channel object internals, so this\n// function will need to be reviewed if/when we ever update phoenix.js\nexport function migrateChannelToSocket(oldChannel, socket, params) {\n  const channel = socket.channel(oldChannel.topic, params || oldChannel.params);\n\n  for (let i = 0, l = oldChannel.bindings.length; i < l; i++) {\n    const item = oldChannel.bindings[i];\n    channel.on(item.event, item.callback);\n  }\n\n  for (let i = 0, l = oldChannel.pushBuffer.length; i < l; i++) {\n    const item = oldChannel.pushBuffer[i];\n    channel.push(item.event, item.payload, item.timeout);\n  }\n\n  const oldJoinPush = oldChannel.joinPush;\n  const joinPush = channel.join();\n\n  for (let i = 0, l = oldJoinPush.recHooks.length; i < l; i++) {\n    const item = oldJoinPush.recHooks[i];\n    joinPush.receive(item.status, item.callback);\n  }\n\n  return new Promise(resolve => {\n    joinPush.receive(\"ok\", () => {\n      // Clear all event handlers first so no duplicate messages come in.\n      oldChannel.bindings = [];\n      resolve(channel);\n    });\n  });\n}\n","import nextTick from \"../utils/next-tick\";\nimport { mapMaterials } from \"../utils/material-utils\";\nimport SketchfabZipWorker from \"../workers/sketchfab-zip.worker.js\";\nimport MobileStandardMaterial from \"../materials/MobileStandardMaterial\";\nimport { getCustomGLTFParserURLResolver } from \"../utils/media-url-utils\";\nimport { promisifyWorker } from \"../utils/promisify-worker.js\";\nimport { MeshBVH, acceleratedRaycast } from \"three-mesh-bvh\";\nTHREE.Mesh.prototype.raycast = acceleratedRaycast;\n\nconst GLTFCache = {};\nconst extractZipFile = promisifyWorker(new SketchfabZipWorker());\n\nfunction defaultInflator(el, componentName, componentData) {\n  if (!AFRAME.components[componentName]) {\n    throw new Error(`Inflator failed. \"${componentName}\" component does not exist.`);\n  }\n  if (AFRAME.components[componentName].multiple && Array.isArray(componentData)) {\n    for (let i = 0; i < componentData.length; i++) {\n      el.setAttribute(componentName + \"__\" + i, componentData[i]);\n    }\n  } else {\n    el.setAttribute(componentName, componentData);\n  }\n}\n\nAFRAME.GLTFModelPlus = {\n  // eslint-disable-next-line no-unused-vars\n  components: {},\n  registerComponent(componentKey, componentName, inflator) {\n    inflator = inflator || defaultInflator;\n    AFRAME.GLTFModelPlus.components[componentKey] = { inflator, componentName };\n  }\n};\n\nfunction parallelTraverse(a, b, callback) {\n  callback(a, b);\n\n  for (let i = 0; i < a.children.length; i++) {\n    parallelTraverse(a.children[i], b.children[i], callback);\n  }\n}\n\nfunction generateMeshBVH(object3D) {\n  object3D.traverse(obj => {\n    // note that we might already have a bounds tree if this was a clone of an object with one\n    const hasBufferGeometry = obj.isMesh && obj.geometry.isBufferGeometry;\n    const hasBoundsTree = hasBufferGeometry && obj.geometry.boundsTree;\n    if (hasBufferGeometry && !hasBoundsTree && obj.geometry.attributes.position) {\n      const geo = obj.geometry;\n      const triCount = geo.index ? geo.index.count / 3 : geo.attributes.position.count / 3;\n      // only bother using memory and time making a BVH if there are a reasonable number of tris,\n      // and if there are too many it's too painful and large to tolerate doing it (at least until\n      // we put this in a web worker)\n      if (triCount > 1000 && triCount < 1000000) {\n        // note that bounds tree construction creates an index as a side effect if one doesn't already exist\n        geo.boundsTree = new MeshBVH(obj.geometry, { strategy: 0, maxDepth: 30 });\n      }\n    }\n  });\n}\n\n// Modified version of Don McCurdy's AnimationUtils.clone\n// https://github.com/mrdoob/three.js/pull/14494\nfunction cloneSkinnedMesh(source) {\n  const cloneLookup = new Map();\n\n  const clone = source.clone();\n\n  parallelTraverse(source, clone, function(sourceNode, clonedNode) {\n    cloneLookup.set(sourceNode, clonedNode);\n    if (sourceNode.isMesh && sourceNode.geometry.boundsTree) {\n      clonedNode.geometry.boundsTree = sourceNode.geometry.boundsTree;\n    }\n  });\n\n  source.traverse(function(sourceMesh) {\n    if (!sourceMesh.isSkinnedMesh) return;\n\n    const sourceBones = sourceMesh.skeleton.bones;\n    const clonedMesh = cloneLookup.get(sourceMesh);\n\n    clonedMesh.skeleton = sourceMesh.skeleton.clone();\n\n    clonedMesh.skeleton.bones = sourceBones.map(function(sourceBone) {\n      if (!cloneLookup.has(sourceBone)) {\n        throw new Error(\"Required bones are not descendants of the given object.\");\n      }\n\n      return cloneLookup.get(sourceBone);\n    });\n\n    clonedMesh.bind(clonedMesh.skeleton, sourceMesh.bindMatrix);\n  });\n\n  return clone;\n}\n\nfunction cloneGltf(gltf) {\n  return {\n    animations: gltf.animations,\n    scene: cloneSkinnedMesh(gltf.scene)\n  };\n}\n\nfunction getHubsComponents(node) {\n  const hubsComponents =\n    node.userData.gltfExtensions &&\n    (node.userData.gltfExtensions.MOZ_hubs_components || node.userData.gltfExtensions.HUBS_components);\n\n  // We can remove support for legacy components when our environment, avatar and interactable models are\n  // updated to match Spoke output.\n  const legacyComponents = node.userData.components;\n\n  return hubsComponents || legacyComponents;\n}\n\n/// Walks the tree of three.js objects starting at the given node, using the GLTF data\n/// and template data to construct A-Frame entities and components when necessary.\n/// (It's unnecessary to construct entities for subtrees that have no component data\n/// or templates associated with any of their nodes.)\n///\n/// Returns the A-Frame entity associated with the given node, if one was constructed.\nconst inflateEntities = function(indexToEntityMap, node, templates, isRoot, modelToWorldScale = 1) {\n  // TODO: Remove this once we update the legacy avatars to the new node names\n  if (node.name === \"Chest\") {\n    node.name = \"Spine\";\n  } else if (node.name === \"Root Scene\") {\n    node.name = \"AvatarRoot\";\n  } else if (node.name === \"Bot_Skinned\") {\n    node.name = \"AvatarMesh\";\n  }\n\n  // inflate subtrees first so that we can determine whether or not this node needs to be inflated\n  const childEntities = [];\n  const children = node.children.slice(0); // setObject3D mutates the node's parent, so we have to copy\n  for (const child of children) {\n    const el = inflateEntities(indexToEntityMap, child, templates);\n    if (el) {\n      childEntities.push(el);\n    }\n  }\n\n  const entityComponents = getHubsComponents(node);\n\n  const nodeHasBehavior = !!entityComponents || node.name in templates;\n  if (!nodeHasBehavior && !childEntities.length && !isRoot) {\n    return null; // we don't need an entity for this node\n  }\n\n  const el = document.createElement(\"a-entity\");\n  el.append.apply(el, childEntities);\n\n  // Remove invalid CSS class name characters.\n  const className = (node.name || node.uuid).replace(/[^\\w-]/g, \"\");\n  el.classList.add(className);\n\n  // AFRAME rotation component expects rotations in YXZ, convert it\n  if (node.rotation.order !== \"YXZ\") {\n    node.rotation.setFromQuaternion(node.quaternion, \"YXZ\");\n  }\n\n  // Copy over the object's transform to the THREE.Group and reset the actual transform of the Object3D\n  // all updates to the object should be done through the THREE.Group wrapper\n  el.object3D.position.copy(node.position);\n  el.object3D.rotation.copy(node.rotation);\n  el.object3D.scale.copy(node.scale).multiplyScalar(modelToWorldScale);\n  el.object3D.matrixNeedsUpdate = true;\n\n  node.matrixAutoUpdate = false;\n  node.matrix.identity();\n  node.matrix.decompose(node.position, node.rotation, node.scale);\n\n  el.setObject3D(node.type.toLowerCase(), node);\n  if (entityComponents && \"nav-mesh\" in entityComponents) {\n    el.setObject3D(\"mesh\", node);\n  }\n\n  // Set the name of the `THREE.Group` to match the name of the node,\n  // so that `THREE.PropertyBinding` will find (and later animate)\n  // the group. See `PropertyBinding.findNode`:\n  // https://github.com/mrdoob/three.js/blob/dev/src/animation/PropertyBinding.js#L211\n  el.object3D.name = node.name;\n  if (node.animations) {\n    // Pass animations up to the group object so that when we can pass the group as\n    // the optional root in `THREE.AnimationMixer.clipAction` and use the hierarchy\n    // preserved under the group (but not the node). Otherwise `clipArray` will be\n    // `null` in `THREE.AnimationClip.findByName`.\n    node.parent.animations = node.animations;\n  }\n\n  const gltfIndex = node.userData.gltfIndex;\n  if (gltfIndex !== undefined) {\n    indexToEntityMap[gltfIndex] = el;\n  }\n\n  return el;\n};\n\nfunction inflateComponents(inflatedEntity, indexToEntityMap) {\n  inflatedEntity.object3D.traverse(object3D => {\n    const entityComponents = getHubsComponents(object3D);\n    const el = object3D.el;\n\n    if (entityComponents && el) {\n      for (const prop in entityComponents) {\n        if (entityComponents.hasOwnProperty(prop) && AFRAME.GLTFModelPlus.components.hasOwnProperty(prop)) {\n          const { componentName, inflator } = AFRAME.GLTFModelPlus.components[prop];\n          inflator(el, componentName, entityComponents[prop], entityComponents, indexToEntityMap);\n        }\n      }\n    }\n  });\n}\n\nfunction attachTemplate(root, name, templateRoot) {\n  const targetEls = root.querySelectorAll(\".\" + name);\n  for (const el of targetEls) {\n    const root = templateRoot.cloneNode(true);\n    // Merge root element attributes with the target element\n    for (const { name, value } of root.attributes) {\n      el.setAttribute(name, value);\n    }\n\n    // Append all child elements\n    while (root.children.length > 0) {\n      el.appendChild(root.children[0]);\n    }\n  }\n}\n\nfunction runMigration(version, json) {\n  if (version < 2) {\n    //old heightfields will be on the same node as the nav-mesh, delete those\n    const oldHeightfieldNode = json.nodes.find(node => {\n      let components = null;\n      if (node.extensions && node.extensions.MOZ_hubs_components) {\n        components = node.extensions.MOZ_hubs_components;\n      } else if (node.extensions && node.extensions.HUBS_components) {\n        components = node.extensions.HUBS_components;\n      }\n      return components && components.heightfield && components[\"nav-mesh\"];\n    });\n    if (oldHeightfieldNode) {\n      if (oldHeightfieldNode.extensions.MOZ_hubs_components) {\n        delete oldHeightfieldNode.extensions.MOZ_hubs_components.heightfield;\n      } else if (oldHeightfieldNode.extensions.HUBS_components) {\n        delete oldHeightfieldNode.extensions.HUBS_components.heightfield;\n      }\n    }\n  }\n}\n\nexport async function loadGLTF(src, contentType, preferredTechnique, onProgress, jsonPreprocessor) {\n  let gltfUrl = src;\n  let fileMap;\n\n  if (contentType.includes(\"model/gltf+zip\") || contentType.includes(\"application/x-zip-compressed\")) {\n    fileMap = await extractZipFile(gltfUrl);\n    gltfUrl = fileMap[\"scene.gtlf\"];\n  }\n\n  const loadingManager = new THREE.LoadingManager();\n  loadingManager.setURLModifier(getCustomGLTFParserURLResolver(gltfUrl));\n  const gltfLoader = new THREE.GLTFLoader(loadingManager);\n\n  const parser = await new Promise((resolve, reject) => gltfLoader.createParser(gltfUrl, resolve, onProgress, reject));\n\n  if (jsonPreprocessor) {\n    parser.json = jsonPreprocessor(parser.json);\n  }\n\n  let version = 0;\n  if (\n    parser.json.extensions &&\n    parser.json.extensions.MOZ_hubs_components &&\n    parser.json.extensions.MOZ_hubs_components.hasOwnProperty(\"version\")\n  ) {\n    version = parser.json.extensions.MOZ_hubs_components.version;\n  }\n  runMigration(version, parser.json);\n\n  const materials = parser.json.materials;\n  if (materials) {\n    for (let i = 0; i < materials.length; i++) {\n      const material = materials[i];\n\n      if (\n        material.extensions &&\n        material.extensions.MOZ_alt_materials &&\n        material.extensions.MOZ_alt_materials[preferredTechnique] !== undefined\n      ) {\n        const altMaterialIndex = material.extensions.MOZ_alt_materials[preferredTechnique];\n        materials[i] = materials[altMaterialIndex];\n      }\n    }\n  }\n\n  const nodes = parser.json.nodes;\n\n  if (nodes) {\n    for (let i = 0; i < nodes.length; i++) {\n      const node = nodes[i];\n\n      if (!node.extras) {\n        node.extras = {};\n      }\n\n      node.extras.gltfIndex = i;\n    }\n  }\n\n  const gltf = await new Promise(parser.parse.bind(parser));\n\n  gltf.scene.traverse(object => {\n    // GLTFLoader sets matrixAutoUpdate on animated objects, we want to keep the defaults\n    object.matrixAutoUpdate = THREE.Object3D.DefaultMatrixAutoUpdate;\n\n    object.material = mapMaterials(object, material => {\n      if (material.isMeshStandardMaterial && preferredTechnique === \"KHR_materials_unlit\") {\n        return MobileStandardMaterial.fromStandardMaterial(material);\n      }\n\n      return material;\n    });\n  });\n\n  if (fileMap) {\n    // The GLTF is now cached as a THREE object, we can get rid of the original blobs\n    Object.keys(fileMap).forEach(URL.revokeObjectURL);\n  }\n\n  return gltf;\n}\n\n/**\n * Loads a GLTF model, optionally recursively \"inflates\" the child nodes of a model into a-entities and sets\n * whitelisted components on them if defined in the node's extras.\n * @namespace gltf\n * @component gltf-model-plus\n */\nAFRAME.registerComponent(\"gltf-model-plus\", {\n  schema: {\n    src: { type: \"string\" },\n    contentType: { type: \"string\" },\n    useCache: { default: true },\n    inflate: { default: false },\n    modelToWorldScale: { type: \"number\", default: 1 }\n  },\n\n  init() {\n    this.preferredTechnique =\n      window.APP && window.APP.quality === \"low\" ? \"KHR_materials_unlit\" : \"pbrMetallicRoughness\";\n\n    // This can be set externally if a consumer wants to do some node preprocssing.\n    this.jsonPreprocessor = null;\n\n    this.loadTemplates();\n  },\n\n  update() {\n    this.applySrc(this.data.src, this.data.contentType);\n  },\n\n  loadTemplates() {\n    this.templates = {};\n    this.el.querySelectorAll(\":scope > template\").forEach(templateEl => {\n      const root = document.importNode(templateEl.firstElementChild || templateEl.content.firstElementChild, true);\n      this.templates[templateEl.getAttribute(\"data-name\")] = root;\n    });\n  },\n\n  async loadModel(src, contentType, technique, useCache) {\n    if (useCache) {\n      if (!GLTFCache[src]) {\n        GLTFCache[src] = await loadGLTF(src, contentType, technique, null, this.jsonPreprocessor);\n      }\n\n      return cloneGltf(GLTFCache[src]);\n    } else {\n      return await loadGLTF(src, contentType, technique, null, this.jsonPreprocessor);\n    }\n  },\n\n  async applySrc(src, contentType) {\n    try {\n      // If the src attribute is a selector, get the url from the asset item.\n      if (src && src.charAt(0) === \"#\") {\n        const assetEl = document.getElementById(src.substring(1));\n        src = assetEl.getAttribute(\"src\");\n      }\n\n      if (src === this.lastSrc) return;\n      this.lastSrc = src;\n\n      if (!src) {\n        if (this.inflatedEl) {\n          console.warn(\"gltf-model-plus set to an empty source, unloading inflated model.\");\n          this.disposeLastInflatedEl();\n        }\n        return;\n      }\n\n      this.el.emit(\"model-loading\");\n      const gltf = await this.loadModel(src, contentType, this.preferredTechnique, this.data.useCache);\n\n      // If we started loading something else already\n      // TODO: there should be a way to cancel loading instead\n      if (src != this.lastSrc) return;\n\n      // If we had inflated something already before, clean that up\n      this.disposeLastInflatedEl();\n\n      this.model = gltf.scene || gltf.scenes[0];\n      this.model.animations = gltf.animations;\n\n      if (gltf.animations.length > 0) {\n        this.el.setAttribute(\"animation-mixer\", {});\n        this.el.components[\"animation-mixer\"].initMixer(gltf.animations);\n      } else {\n        generateMeshBVH(this.model);\n      }\n\n      const indexToEntityMap = {};\n\n      let object3DToSet = this.model;\n      if (\n        this.data.inflate &&\n        (this.inflatedEl = inflateEntities(\n          indexToEntityMap,\n          this.model,\n          this.templates,\n          true,\n          this.data.modelToWorldScale\n        ))\n      ) {\n        this.el.appendChild(this.inflatedEl);\n\n        object3DToSet = this.inflatedEl.object3D;\n        // TODO: Still don't fully understand the lifecycle here and how it differs between browsers, we should dig in more\n        // Wait one tick for the appended custom elements to be connected before attaching templates\n        await nextTick();\n        if (src != this.lastSrc) return; // TODO: there must be a nicer pattern for this\n\n        inflateComponents(this.inflatedEl, indexToEntityMap);\n\n        for (const name in this.templates) {\n          attachTemplate(this.el, name, this.templates[name]);\n        }\n      }\n\n      // The call to setObject3D below recursively clobbers any `el` backreferences to entities\n      // in the entire inflated entity graph to point to `object3DToSet`.\n      //\n      // We don't want those overwritten, since lots of code assumes `object3d.el` points to the relevant\n      // A-Frame entity for that three.js object, so we back them up and re-wire them here. If we didn't do\n      // this, all the `el` properties on these object3ds would point to the `object3DToSet` which is either\n      // the model or the root GLTF inflated entity.\n      const rewires = [];\n\n      object3DToSet.traverse(o => {\n        const el = o.el;\n        if (el) rewires.push(() => (o.el = el));\n      });\n\n      const environmentMapComponent = this.el.sceneEl.components[\"environment-map\"];\n\n      if (environmentMapComponent) {\n        environmentMapComponent.applyEnvironmentMap(object3DToSet);\n      }\n\n      this.el.setObject3D(\"mesh\", object3DToSet);\n\n      rewires.forEach(f => f());\n\n      this.el.emit(\"model-loaded\", { format: \"gltf\", model: this.model });\n    } catch (e) {\n      delete GLTFCache[src];\n      console.error(\"Failed to load glTF model\", e, this);\n      this.el.emit(\"model-error\", { format: \"gltf\", src });\n    }\n  },\n\n  disposeLastInflatedEl() {\n    if (this.inflatedEl) {\n      this.inflatedEl.parentNode.removeChild(this.inflatedEl);\n\n      this.inflatedEl.object3D.traverse(x => {\n        if (x.material && x.material.dispose) {\n          x.material.dispose();\n        }\n\n        if (x.geometry) {\n          if (x.geometry.dispose) {\n            x.geometry.dispose();\n          }\n\n          x.geometry.boundsTree = null;\n        }\n      });\n\n      delete this.inflatedEl;\n\n      this.el.removeAttribute(\"animation-mixer\");\n    }\n  }\n});\n","// Wrapper for a worker which accepts work items and responds with results.\n//\n// The worker must receive messages with data of the shape { id, payload }, and then respond\n// with messages containing matching IDs of the shape { id, result, err }.\n//\n// Returns a function that accepts a work item, sends it to the worker, and returns a promise that\n// will resolve with the result or reject with the error.\n//\nexport function promisifyWorker(worker) {\n  let nextItemId = 0;\n  const outstanding = {}; // item ID: { resolve, reject }\n\n  worker.onmessage = msg => {\n    const { id, result, err } = msg.data;\n    const handlers = outstanding[id];\n    if (handlers == null) {\n      console.error(`Unknown message with ID ${id} received from ${worker}.`);\n    } else {\n      delete outstanding[id];\n      if (err != null) {\n        handlers.reject(new Error(err));\n      } else {\n        handlers.resolve(result);\n      }\n    }\n  };\n\n  return function(data, transfer) {\n    const id = nextItemId++;\n    const promise = new Promise((resolve, reject) => {\n      outstanding[id] = { resolve, reject };\n    });\n    worker.postMessage({ id, payload: data }, transfer);\n    return promise;\n  };\n}\n","console.log(`Hubs version: ${process.env.BUILD_VERSION || \"?\"}`);\n\n// We should technically be able to just include three here, but our dependancies are tangled such that not having aframe is a bit difficult\nimport \"aframe\";\nimport \"./utils/logging\";\n\nimport { airtableAssets, airtableAssetsInitialState } from './airtable'\n\nimport ReactDOM from \"react-dom\";\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport classNames from \"classnames\";\n\nimport { IntlProvider, FormattedMessage, addLocaleData } from \"react-intl\";\nimport en from \"react-intl/locale-data/en\";\nimport { lang, messages } from \"./utils/i18n\";\naddLocaleData([...en]);\n\nimport { disableiOSZoom } from \"./utils/disable-ios-zoom\";\ndisableiOSZoom();\n\nimport { App } from \"./App\";\n\nimport AvatarPreview from \"./react-components/avatar-preview\";\n\nimport { fetchAvatar } from \"./utils/avatar-utils\";\n\nimport styles from \"./assets/stylesheets/avatar.scss\";\nimport hubLogo from \"./assets/images/hub-preview-white.png\";\n\nconst qs = new URLSearchParams(location.search);\nwindow.APP = new App();\n\nclass AvatarUI extends React.Component {\n  static propTypes = {\n    avatarId: PropTypes.string,\n    store: PropTypes.object,\n    intl: PropTypes.object\n  };\n\n  constructor(props) {\n    super(props);\n    this.state = {airtableAssets: airtableAssetsInitialState};\n  }\n\n  componentDidMount() {\n    this.props.store.addEventListener(\"statechanged\", this.storeUpdated);\n    this.refetchAvatar();\n\n    airtableAssets.find('recHqITRS7cBMwn9i', (err, record) => \n       this.setState({airtableAssets: record.fields})\n    )\n  }\n\n  componentWillUnmount() {\n    this.props.store.removeEventListener(\"statechanged\", this.storeUpdated);\n  }\n\n  storeUpdated = () => this.forceUpdate();\n\n  refetchAvatar = async () => {\n    const avatar = await fetchAvatar(this.props.avatarId);\n    this.setState({ avatar });\n  };\n\n  setAvatar = e => {\n    e && e.preventDefault();\n    this.props.store.update({\n      profile: { avatarId: this.state.avatar.avatar_id }\n    });\n  };\n\n  render() {\n    const { avatar } = this.state;\n    if (!avatar) {\n      return (\n        <div className={styles.avatarLanding}>\n          <div className={classNames([styles.box, styles.darkened])}>Loading</div>\n        </div>\n      );\n    }\n\n    const selectedAvatarId = this.props.store.state.profile.avatarId;\n    const isSelected = avatar.avatar_id === selectedAvatarId;\n\n    return (\n      <form onSubmit={this.setAvatar} className={styles.avatarLanding}>\n        <div className={classNames([styles.box, styles.darkened])}>\n          <label className={styles.title}>\n            <span>{avatar.name}</span>\n          </label>\n          <div className={styles.attributions}>\n            {avatar.attributions && avatar.attributions.creator && <span>{`by ${avatar.attributions.creator}`}</span>}\n          </div>\n          <div className={styles.preview}>{avatar && <AvatarPreview avatarGltfUrl={avatar.gltf_url} />}</div>\n          {isSelected ? (\n            <span className={styles.selectedMessage}>\n              <FormattedMessage id=\"avatar-landing.selected\" />\n            </span>\n          ) : (\n            <button disabled={isSelected} className={styles.formSubmit} type=\"submit\">\n              <FormattedMessage id=\"avatar-landing.select\" />\n            </button>\n          )}\n        </div>\n        <img className={styles.logo} src={this.state.airtableAssets.DarkLogo} />\n      </form>\n    );\n  }\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  const avatarId = qs.get(\"avatar_id\") || document.location.pathname.substring(1).split(\"/\")[1];\n  console.log(`Avatar ID: ${avatarId}`);\n  ReactDOM.render(\n    <IntlProvider locale={lang} messages={messages}>\n      <AvatarUI avatarId={avatarId} store={window.APP.store} />\n    </IntlProvider>,\n    document.getElementById(\"ui-root\")\n  );\n});\n","const nonCorsProxyDomains = (process.env.NON_CORS_PROXY_DOMAINS || \"\").split(\",\");\nif (process.env.CORS_PROXY_SERVER) {\n  nonCorsProxyDomains.push(process.env.CORS_PROXY_SERVER);\n}\n\nconst commonKnownContentTypes = {\n  gltf: \"model/gltf\",\n  glb: \"model/gltf-binary\",\n  png: \"image/png\",\n  jpg: \"image/jpeg\",\n  jpeg: \"image/jpeg\",\n  pdf: \"application/pdf\",\n  mp4: \"video/mp4\",\n  mp3: \"audio/mpeg\"\n};\n\n// thanks to https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding\nfunction b64EncodeUnicode(str) {\n  // first we use encodeURIComponent to get percent-encoded UTF-8, then we convert the percent-encodings\n  // into raw bytes which can be fed into btoa.\n  const CHAR_RE = /%([0-9A-F]{2})/g;\n  return btoa(encodeURIComponent(str).replace(CHAR_RE, (_, p1) => String.fromCharCode(\"0x\" + p1)));\n}\n\nconst farsparkEncodeUrl = url => {\n  // farspark doesn't know how to read '=' base64 padding characters\n  // translate base64 + to - and / to _ for URL safety\n  return b64EncodeUnicode(url)\n    .replace(/=+$/g, \"\")\n    .replace(/\\+/g, \"-\")\n    .replace(/\\//g, \"_\");\n};\n\nexport const scaledThumbnailUrlFor = (url, width, height) => {\n  const urlHostname = new URL(url).hostname;\n\n  if (process.env.RETICULUM_SERVER) {\n    const retHostname = new URL(`https://${process.env.RETICULUM_SERVER}`).hostname;\n    if (retHostname === urlHostname) return url;\n  }\n\n  return `https://${process.env.FARSPARK_SERVER}/thumbnail/${farsparkEncodeUrl(url)}?w=${width}&h=${height}`;\n};\n\nexport const proxiedUrlFor = (url, index = null) => {\n  if (!(url.startsWith(\"http:\") || url.startsWith(\"https:\"))) return url;\n\n  const hasIndex = index !== null;\n\n  if (!hasIndex) {\n    // Skip known domains that do not require CORS proxying.\n    try {\n      const parsedUrl = new URL(url);\n      if (nonCorsProxyDomains.find(domain => parsedUrl.hostname.endsWith(domain))) return url;\n    } catch (e) {\n      // Ignore\n    }\n  }\n\n  if (hasIndex || !process.env.CORS_PROXY_SERVER) {\n    const method = hasIndex ? \"extract\" : \"raw\";\n    return `https://${process.env.FARSPARK_SERVER}/0/${method}/0/0/0/${index || 0}/${farsparkEncodeUrl(url)}`;\n  } else {\n    return `https://${process.env.CORS_PROXY_SERVER}/${url}`;\n  }\n};\n\nexport const getCustomGLTFParserURLResolver = gltfUrl => url => {\n  if (typeof url !== \"string\" || url === \"\") return \"\";\n  if (/^(https?:)?\\/\\//i.test(url)) return url;\n  if (/^data:.*,.*$/i.test(url)) return url;\n  if (/^blob:.*$/i.test(url)) return url;\n\n  if (process.env.CORS_PROXY_SERVER) {\n    // For absolute paths with a CORS proxied gltf URL, re-write the url properly to be proxied\n    const corsProxyPrefix = `https://${process.env.CORS_PROXY_SERVER}/`;\n\n    if (gltfUrl.startsWith(corsProxyPrefix)) {\n      const originalUrl = decodeURIComponent(gltfUrl.substring(corsProxyPrefix.length));\n      const originalUrlParts = originalUrl.split(\"/\");\n\n      // Drop the .gltf filename\n      const path = new URL(url).pathname;\n      const assetUrl = originalUrlParts.slice(0, originalUrlParts.length - 1).join(\"/\") + \"/\" + path;\n      return corsProxyPrefix + assetUrl;\n    }\n  }\n\n  return url;\n};\n\nexport const guessContentType = url => {\n  if (url.startsWith(\"hubs://\") && url.endsWith(\"/video\")) return \"video/vnd.hubs-webrtc\";\n  const extension = new URL(url).pathname.split(\".\").pop();\n  return commonKnownContentTypes[extension];\n};\nconst hubsSceneRegex = /https?:\\/\\/(hubs.local(:\\d+)?|(smoke-)?hubs.mozilla.com)\\/scenes\\/(\\w+)\\/?\\S*/;\nconst hubsAvatarRegex = /https?:\\/\\/(hubs.local(:\\d+)?|(smoke-)?hubs.mozilla.com)\\/avatars\\/(\\w+)\\/?\\S*/;\nconst hubsRoomRegex = /https?:\\/\\/(hubs.local(:\\d+)?|(smoke-)?hubs.mozilla.com)\\/(\\w+)\\/?\\S*/;\nexport const isHubsSceneUrl = hubsSceneRegex.test.bind(hubsSceneRegex);\nexport const isHubsRoomUrl = url => !isHubsSceneUrl(url) && hubsRoomRegex.test(url);\nexport const isHubsDestinationUrl = url => isHubsSceneUrl(url) || isHubsRoomUrl(url);\nexport const isHubsAvatarUrl = hubsAvatarRegex.test.bind(hubsAvatarRegex);\n","import { forEachMaterial } from \"../utils/material-utils\";\nimport cubeMapPosX from \"../assets/images/cubemap/posx.jpg\";\nimport cubeMapNegX from \"../assets/images/cubemap/negx.jpg\";\nimport cubeMapPosY from \"../assets/images/cubemap/posy.jpg\";\nimport cubeMapNegY from \"../assets/images/cubemap/negy.jpg\";\nimport cubeMapPosZ from \"../assets/images/cubemap/posz.jpg\";\nimport cubeMapNegZ from \"../assets/images/cubemap/negz.jpg\";\n\nexport async function createDefaultEnvironmentMap() {\n  const urls = [cubeMapPosX, cubeMapNegX, cubeMapPosY, cubeMapNegY, cubeMapPosZ, cubeMapNegZ];\n  const texture = await new Promise((resolve, reject) =>\n    new THREE.CubeTextureLoader().load(urls, resolve, undefined, reject)\n  );\n  texture.format = THREE.RGBFormat;\n  return texture;\n}\n\nAFRAME.registerComponent(\"environment-map\", {\n  init() {\n    this.environmentMap = null;\n\n    this.updateEnvironmentMap = this.updateEnvironmentMap.bind(this);\n  },\n\n  updateEnvironmentMap(environmentMap) {\n    this.environmentMap = environmentMap;\n    this.applyEnvironmentMap(this.el.object3D);\n  },\n\n  applyEnvironmentMap(object3D) {\n    object3D.traverse(object => {\n      forEachMaterial(object, material => {\n        if (material.isMeshStandardMaterial) {\n          material.envMap = this.environmentMap;\n          material.needsUpdate = true;\n        }\n      });\n    });\n  }\n});\n","module.exports = __webpack_public_path__ + \"assets/images/cubemap/posx-d235fb97df77b607be04b84125f40e7c.jpg\";","module.exports = __webpack_public_path__ + \"assets/images/cubemap/negx-35034574e114423babdea92b6a2eb97a.jpg\";","module.exports = __webpack_public_path__ + \"assets/images/cubemap/posy-d0c4e1e7979d75923d4d8b49c191bc6e.jpg\";","module.exports = __webpack_public_path__ + \"assets/images/cubemap/negy-35808d21d1d17ac1b84d3184e365093b.jpg\";","module.exports = __webpack_public_path__ + \"assets/images/cubemap/posz-de29aa8396196e4b040cd5305e351dbe.jpg\";","module.exports = __webpack_public_path__ + \"assets/images/cubemap/negz-d73d18a8b7994524dc39a6ea3fcf43fc.jpg\";","import { detectOS } from \"detect-browser\";\n\nexport function disableiOSZoom() {\n  if (detectOS(navigator.userAgent) !== \"iOS\") return;\n\n  let lastTouchAtMs = 0;\n\n  document.addEventListener(\"touchmove\", ev => {\n    if (ev.scale === 1) return;\n\n    ev.preventDefault();\n  });\n\n  document.addEventListener(\"touchend\", ev => {\n    const now = new Date().getTime();\n    const isDoubleTouch = now - lastTouchAtMs <= 300;\n    lastTouchAtMs = now;\n\n    if (isDoubleTouch) {\n      ev.preventDefault();\n    }\n  });\n}\n","import Store from \"./storage/store\";\nimport MediaSearchStore from \"./storage/media-search-store\";\n\nexport class App {\n  constructor() {\n    this.scene = null;\n    this.quality = \"low\";\n    this.store = new Store();\n    this.mediaSearchStore = new MediaSearchStore();\n  }\n\n  setQuality(quality) {\n    if (this.quality === quality) {\n      return false;\n    }\n\n    this.quality = quality;\n\n    if (this.scene) {\n      this.scene.dispatchEvent(new CustomEvent(\"quality-changed\", { detail: quality }));\n    }\n\n    return true;\n  }\n}\n","import Airtable from 'airtable';\nAirtable.configure({\n    endpointUrl: 'https://api.airtable.com',\n    apiKey: 'keyOHSVeLr3ryLrL5'\n});\n\nconst base = Airtable.base('appIR0AlHDFG5WR8z');\n\nexport const airtableAssetsInitialState = { DarkLogo: null, Name: null, Icon: null }\nexport const airtableAssets = base('Assets');\n\nexport const airtableMessages = base('Messages').select({\n    view: 'Grid view'\n}).firstPage(async (err, records) => {\n    if (err) { console.error(err); return; }\n    const record = records[0];\n    // console.log(record.get('Motto'))\n    return record;\n\n    // records.forEach(function(record) {\n    //     console.log('Retrieved', record.get('Motto'));\n    // });\n});;\n// .find('recHqITRS7cBMwn9i', (err, record) => record.fields);\n// export const airtableAssets = () => base('Assets')\n\n// export default base;","// removed by extract-text-webpack-plugin\nmodule.exports = {\"preview\":\"avatar-preview__preview__2I8qx\"};","// removed by extract-text-webpack-plugin\nmodule.exports = {\"avatar-landing\":\"avatar__avatar-landing__3bdoO\",\"avatarLanding\":\"avatar__avatar-landing__3bdoO\",\"form-submit\":\"avatar__form-submit__3OEBN\",\"formSubmit\":\"avatar__form-submit__3OEBN\",\"title\":\"avatar__title__PP1dU\",\"attributions\":\"avatar__attributions__1Ej7c\",\"logo\":\"avatar__logo__35vmn\",\"box\":\"avatar__box__vyKNY\",\"selected-message\":\"avatar__selected-message__25S2j\",\"selectedMessage\":\"avatar__selected-message__25S2j\",\"preview\":\"avatar__preview__3T2SV\"};","module.exports = __webpack_public_path__ + \"assets/images/warning_icon-739d2a2ea906737505bcbc2cb51123a8.png\";","module.exports = __webpack_public_path__ + \"assets/images/warning_icon@2x-706e4a4db33f9456bac320e956b4120d.png\";","import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { injectIntl, FormattedMessage } from \"react-intl\";\nimport classNames from \"classnames\";\nimport \"three/examples/js/controls/OrbitControls\";\n\nimport { createDefaultEnvironmentMap } from \"../components/environment-map\";\nimport { loadGLTF } from \"../components/gltf-model-plus\";\nimport { disposeNode } from \"../utils/three-utils\";\nimport { createImageBitmap, disposeImageBitmap } from \"../utils/image-bitmap-utils\";\nimport styles from \"../assets/stylesheets/avatar-preview.scss\";\n\nconst TEXTURE_PROPS = {\n  base_map: [\"map\"],\n  emissive_map: [\"emissiveMap\"],\n  normal_map: [\"normalMap\"],\n  orm_map: [\"aoMap\", \"roughnessMap\", \"metalnessMap\"]\n};\n\nconst ALL_MAPS = Object.keys(TEXTURE_PROPS);\n\n// This should match our aframe renderer=\"antialias: true; colorManagement: true; sortObjects: true;\n// physicallyCorrectLights: true; webgl2: true; multiview: false;\"\nfunction createRenderer(canvas, alpha = false, useDevicePixelRatio = true) {\n  const context = canvas.getContext(\"webgl2\", {\n    alpha,\n    depth: true,\n    antialias: true,\n    premultipliedAlpha: true,\n    preserveDrawingBuffer: false,\n    powerPreference: \"default\"\n  });\n\n  const renderer = new THREE.WebGLRenderer({ alpha, canvas, context });\n  renderer.gammaOutput = true;\n  renderer.gammaFactor = 2.2;\n  renderer.physicallyCorrectLights = true;\n  if (useDevicePixelRatio) {\n    renderer.setPixelRatio(window.devicePixelRatio);\n  }\n  return renderer;\n}\n\nconst createImageBitmapFromURL = url =>\n  fetch(url)\n    .then(r => r.blob())\n    .then(createImageBitmap);\n\nconst ORBIT_ANGLE = new THREE.Euler(-30 * THREE.Math.DEG2RAD, 30 * THREE.Math.DEG2RAD, 0);\nconst DEFAULT_MARGIN = 1;\n\nfunction fitBoxInFrustum(camera, box, center, margin = DEFAULT_MARGIN) {\n  const halfYExtents = Math.max(box.max.y - center.y, center.y - box.min.y);\n  const halfVertFOV = THREE.Math.degToRad(camera.fov / 2);\n  camera.position.set(0, 0, (halfYExtents / Math.tan(halfVertFOV) + box.max.z) * margin);\n  camera.position.applyEuler(ORBIT_ANGLE);\n  camera.position.add(center);\n  camera.lookAt(center);\n}\n\nclass AvatarPreview extends Component {\n  static propTypes = {\n    avatarGltfUrl: PropTypes.string,\n    className: PropTypes.string\n  };\n  constructor(props) {\n    super(props);\n    this.state = { loading: true, error: null };\n    this.avatar = null;\n    this.imageBitmaps = {};\n  }\n\n  componentDidMount = () => {\n    this.scene = new THREE.Scene();\n\n    this.camera = new THREE.PerspectiveCamera(55, this.canvas.clientWidth / this.canvas.clientHeight, 0.1, 1000);\n    this.controls = new THREE.OrbitControls(this.camera, this.canvas);\n    this.controls.enablePan = false;\n\n    const light = new THREE.DirectionalLight(0xf7f6ef, 1);\n    light.position.set(0, 10, 10);\n    this.scene.add(light);\n    this.scene.add(new THREE.HemisphereLight(0xb1e3ff, 0xb1e3ff, 2.5));\n\n    this.camera.position.set(-0.2, 0.5, 0.5);\n    this.camera.matrixAutoUpdate = true;\n\n    this.controls.target.set(0, 0.45, 0);\n    this.controls.update();\n\n    if (this.props.avatarGltfUrl) {\n      this.loadPreviewAvatar(this.props.avatarGltfUrl).then(this.setAvatar);\n    }\n\n    const clock = new THREE.Clock();\n\n    this.snapshotCanvas = document.createElement(\"canvas\");\n    this.snapshotCanvas.width = 720;\n    this.snapshotCanvas.height = 1280;\n    this.snapshotCamera = new THREE.PerspectiveCamera(55, 720 / 1280, 0.1, 1000);\n    this.snapshotCamera.matrixAutoUpdate = true;\n    this.snapshotRenderer = createRenderer(this.snapshotCanvas, true, false);\n    this.snapshotRenderer.setClearAlpha(0);\n\n    this.previewRenderer = createRenderer(this.canvas);\n    this.previewRenderer.setClearColor(0xeaeaea);\n    this.previewRenderer.setAnimationLoop(() => {\n      const dt = clock.getDelta();\n      this.mixer && this.mixer.update(dt);\n      this.previewRenderer.render(this.scene, this.camera);\n    });\n    window.addEventListener(\"resize\", this.resize);\n    this.resize();\n  };\n\n  resize = () => {\n    const width = this.canvas.parentElement.offsetWidth;\n    const height = this.canvas.parentElement.offsetHeight;\n    this.previewRenderer.setSize(width, height);\n    this.camera.aspect = width / height;\n    this.camera.updateProjectionMatrix();\n  };\n\n  setAvatar = avatar => {\n    if (!avatar) return;\n    this.avatar = avatar;\n    this.scene.add(avatar);\n    this.resetCamera();\n    this.setState({ error: null, loading: false });\n  };\n\n  resetCamera = (() => {\n    const box = new THREE.Box3();\n    const center = new THREE.Vector3();\n    return () => {\n      box.setFromObject(this.avatar);\n      box.getCenter(center);\n\n      // Shift the center vertically in order to frame the avatar nicely.\n      center.y = (box.max.y - box.min.y) * 0.6 + box.min.y;\n\n      fitBoxInFrustum(this.camera, box, center);\n      fitBoxInFrustum(this.snapshotCamera, box, center, 0.7);\n\n      this.controls.target.copy(center);\n      this.controls.update();\n    };\n  })();\n\n  componentWillUnmount = () => {\n    // Gotta be particularly careful about disposing things here since we will likely create many avatar\n    // previews during a session and Chrome will eventually discard the oldest webgl context if we leak\n    // contexts by holding on to them directly or indirectly.\n\n    this.scene && this.scene.traverse(disposeNode);\n    if (this.previewRenderer) {\n      this.previewRenderer.dispose();\n      this.previewRenderer.context = null;\n    }\n    if (this.snapshotRenderer) {\n      this.snapshotRenderer.dispose();\n      this.snapshotRenderer.context = null;\n    }\n    if (this.controls) {\n      this.controls.dispose();\n      this.controls.domElement = null;\n    }\n\n    Object.values(this.imageBitmaps).forEach(img => disposeImageBitmap(img));\n    window.removeEventListener(\"resize\", this.resize);\n  };\n\n  componentDidUpdate = async oldProps => {\n    if (oldProps.avatarGltfUrl !== this.props.avatarGltfUrl) {\n      if (this.avatar) {\n        this.scene.remove(this.avatar);\n        this.avatar = null;\n      }\n      if (this.props.avatarGltfUrl) {\n        this.setState({ error: null, loading: true });\n        await this.loadPreviewAvatar(this.props.avatarGltfUrl).then(this.setAvatar);\n      }\n    }\n    this.applyMaps(oldProps, this.props);\n  };\n\n  applyMaps(oldProps, newProps) {\n    return Promise.all(\n      ALL_MAPS.map(mapName => {\n        const applyMap = this.applyMapToPreview.bind(this, mapName);\n        if (oldProps[mapName] != newProps[mapName]) {\n          if (newProps[mapName] instanceof File) {\n            return createImageBitmap(newProps[mapName]).then(applyMap);\n          } else if (newProps[mapName]) {\n            return createImageBitmapFromURL(newProps[mapName]).then(applyMap);\n          } else {\n            return this.revertMap(mapName);\n          }\n        }\n      })\n    );\n  }\n\n  loadPreviewAvatar = async avatarGltfUrl => {\n    let gltf;\n    try {\n      gltf = await loadGLTF(avatarGltfUrl, \"model/gltf\");\n    } catch (e) {\n      this.setState({ loading: false, error: true });\n      return;\n    }\n\n    // On the backend we look for a material called Bot_PBS, here we are looking for a mesh called Avatar.\n    // When we \"officially\" support uploading custom GLTFs we need to decide what we are going to key things on\n    this.previewMesh =\n      gltf.scene.getObjectByName(\"AvatarMesh\") ||\n      gltf.scene.getObjectByName(\"Avatar\") ||\n      gltf.scene.getObjectByName(\"Bot_Skinned\") ||\n      gltf.scene;\n\n    const idleAnimation = gltf.animations && gltf.animations.find(({ name }) => name === \"idle_eyes\");\n    if (idleAnimation) {\n      this.mixer = new THREE.AnimationMixer(this.previewMesh);\n      const action = this.mixer.clipAction(idleAnimation);\n      action.enabled = true;\n      action.setLoop(THREE.LoopRepeat, Infinity).play();\n      this.idleAnimationAction = action;\n    }\n\n    const { material } = this.previewMesh;\n    if (material) {\n      // We delete onUpdate here to opt out of the auto texture cleanup after GPU upload.\n      const getImage = p => delete material[p].onUpdate && material[p].image;\n      this.originalMaps = {\n        base_map: TEXTURE_PROPS[\"base_map\"].map(getImage),\n        emissive_map: TEXTURE_PROPS[\"emissive_map\"].map(getImage),\n        normal_map: TEXTURE_PROPS[\"normal_map\"].map(getImage),\n        orm_map: TEXTURE_PROPS[\"orm_map\"].map(getImage)\n      };\n\n      await Promise.all([\n        this.applyMaps({}, this.props), // Apply initial maps\n        createDefaultEnvironmentMap().then(t => {\n          this.previewMesh.material.envMap = t;\n          this.previewMesh.material.needsUpdate = true;\n        })\n      ]);\n    } else {\n      this.originalMaps = {};\n    }\n\n    return gltf.scene;\n  };\n\n  applyMapToPreview = (name, image) => {\n    if (this.imageBitmaps[name]) {\n      disposeImageBitmap(this.imageBitmaps[name]);\n    }\n    this.imageBitmaps[name] = image;\n    TEXTURE_PROPS[name].forEach(prop => {\n      const texture = this.previewMesh.material[prop];\n      texture.image = image;\n      texture.needsUpdate = true;\n    });\n  };\n\n  revertMap = name => {\n    if (this.imageBitmaps[name]) {\n      disposeImageBitmap(this.imageBitmaps[name]);\n    }\n    delete this.imageBitmaps[name];\n    this.originalMaps[name].forEach((bm, i) => {\n      const texture = this.previewMesh.material[TEXTURE_PROPS[name][i]];\n      texture.image = bm;\n      texture.needsUpdate = true;\n    });\n  };\n\n  snapshot = () => {\n    return new Promise(resolve => {\n      if (this.idleAnimationAction) this.idleAnimationAction.stop();\n      this.snapshotRenderer.render(this.scene, this.snapshotCamera);\n      this.snapshotCanvas.toBlob(blob => {\n        if (this.idleAnimationAction) this.idleAnimationAction.play();\n        resolve(blob);\n      });\n    });\n  };\n\n  render() {\n    return (\n      <div className={classNames(styles.preview, this.props.className)}>\n        {this.state.loading &&\n          !this.state.error && (\n            <div className=\"loader\">\n              <div className=\"loader-center\" />\n            </div>\n          )}\n        {this.state.error &&\n          !this.state.loading && (\n            <div className=\"error\">\n              <img\n                src=\"../assets/images/warning_icon.png\"\n                srcSet=\"../assets/images/warning_icon@2x.png 2x\"\n                className=\"error-icon\"\n              />\n              <FormattedMessage id=\"avatar-preview.loading-failed\" />\n            </div>\n          )}\n        <canvas ref={c => (this.canvas = c)} />\n      </div>\n    );\n  }\n}\n\nexport default injectIntl(AvatarPreview, { withRef: true });\n","// A-Frame blows away any npm debug log filters so this allow the user to set the log filter\n// via the query string.\nimport debug from \"debug\";\nimport qsTruthy from \"./qs_truthy\";\n\nconst qs = new URLSearchParams(location.search);\nconst isDebug = qsTruthy(\"debug\");\nconst logFilter = qs.get(\"log_filter\") || (isDebug && \"naf-janus-adapter:*\");\n\nif (logFilter) {\n  debug.enable(logFilter);\n}\n","const qs = new URLSearchParams(location.search);\n\nexport default function qsTruthy(param) {\n  const val = qs.get(param);\n  // if the param exists but is not set (e.g. \"?foo&bar\"), its value is the empty string.\n  return val === \"\" || /1|on|true|yes/i.test(val);\n}\n","import {airtableMessages} from '../airtable'\n\n// let fields;\n\n// airtableAssets.find('recHqITRS7cBMwn9i', (err, record) => \n//    fields = record.fields\n// )\n\nconsole.log(airtableMessages)\nasync () => {\n\tawait console.log(airtableMessages)\n}\n\nlet motto = airtableMessages && airtableMessages.get('Motto') || 'Learn together, from anywhere.\\nThe future of learning is virtual.\\nEqualizing access to premier quality education.'\n\n\nexport default {\n  \"en\": {\n    \"auth.verified-title\": \"E-Mail Verified!\",\n    \"auth.verified\": \"Your email has been verified!\\nYou can now close this browser tab and return to Hubs.\",\n    \"auth.spoke-verified\": \"You email has been verified!\\nYou can now close this browser tab and return to Spoke.\",\n    \"sign-in.prompt\": \"Sign in to pin objects in rooms.\",\n    \"sign-in.auth-started\":\n      \"Email sent!\\n\\nTo continue, go click on the link in the email using your phone, tablet, or PC.\",\n    \"sign-in.pin\": \"You'll need to sign in to pin objects.\",\n    \"sign-in.pin-complete\": \"You are now signed in.\",\n    \"sign-in.unpin\": \"You'll need to sign in to un-pin objects.\",\n    \"sign-in.unpin-complete\": \"You are now signed in.\",\n    \"sign-in.change-scene\": \"You'll need to sign in to change the scene.\",\n    \"sign-in.change-scene-complete\": \"You are now signed in.\",\n    \"sign-in.rename-room\": \"You'll need to sign in to rename axon park.\",\n    \"sign-in.rename-room-complete\": \"You are now signed in.\",\n    \"sign-in.close-room\": \"You'll need to sign in to close axon park.\",\n    \"sign-in.close-room-complete\": \"You are now signed in.\",\n    \"sign-in.mute-user\": \"You'll need to sign in to mute other users.\",\n    \"sign-in.mute-user-complete\": \"You are now signed in.\",\n    \"sign-in.kick-user\": \"You'll need to sign in to kick other users.\",\n    \"sign-in.kick-user-complete\": \"You are now signed in.\",\n    \"sign-in.create-avatar\": \"You'll need to sign in to create avatars.\",\n    \"sign-in.create-avatar-complete\": \"You are now signed in.\",\n    \"sign-in.favorite-room\": \"You'll need to sign in to add this room to your favorites.\",\n    \"sign-in.favorite-rooms\": \"You'll need to sign in to add favorite rooms.\",\n    \"sign-in.favorite-room-complete\": \"You are now signed in.\",\n    \"sign-in.favorite-rooms-complete\": \"You are now signed in.\",\n    \"sign-in.as\": \"Signed in as\",\n    \"sign-in.in\": \"Sign In\",\n    \"sign-in.out\": \"Sign Out\",\n    \"rename-room.message\": \"Enter the new name for axon park.\",\n    \"rename-room.rename\": \"Rename Axon Park\",\n    \"close-room.message\":\n      \"Closing this room will remove yourself and others from axon park, shutting it down permanently.\\n\\nAre you sure? This action cannot be undone.\",\n    \"close-room.confirm\": \"Yes, Close Axon Park\",\n    \"close-room.cancel\": \"Cancel\",\n    \"entry.room\": \"Immersive Education\",\n    \"entry.enter-room-title\": \"Lobby\",\n    \"entry.enter-room\": \"enter or send to device\",\n    \"entry.leave-room\": \"Leave Axon Park\",\n    \"entry.change-scene\": \"Choose a Scene\",\n    \"entry.in-lobby-notice\": \"You are viewing Axon Park from the lobby.\",\n    \"entry.screen-prefix\": \"Enter on \",\n    \"entry.desktop-screen\": \"Screen\",\n    \"entry.mobile-screen\": \"Phone\",\n    \"entry.mobile-safari\": \"Safari\",\n    \"entry.generic-prefix\": \" \",\n    \"entry.generic-medium\": \"Connected VR Headset\",\n    \"entry.generic-subtitle-desktop\": \"Oculus or SteamVR\",\n    \"entry.gearvr-prefix\": \"Enter on \",\n    \"entry.gearvr-medium\": \"Gear VR\",\n    \"entry.choose-device\": \"Choose Device\",\n    \"entry.device-medium\": \"Send to Device\",\n    \"entry.device-subtitle-desktop\": \"Standalone VR or Phone\",\n    \"entry.device-subtitle-mobile\": \"Standalone VR or PC\",\n    \"entry.device-subtitle-vr\": \"Phone or PC\",\n    \"entry.cardboard\": \"Enter on Google Cardboard\",\n    \"entry.daydream-prefix\": \"Enter on \",\n    \"entry.daydream-medium\": \"Daydream\",\n    \"entry.daydream-via-chrome\": \"Using Google Chrome\",\n    \"entry.invite-others\": \"invite others\",\n    \"entry.share-button\": \"share\",\n    \"entry.desktop.invite-tip\": \"Nobody is here yet. Share this room to get together.\",\n    \"entry.mobile.invite-tip\": \"Share to get together.\",\n    \"entry.invite-team-nag\": \"Invite a hubs team member\",\n    \"entry.enable-screen-sharing\": \"Share my desktop\",\n    \"entry.return-to-vr\": \"Return to VR\",\n    \"entry.enter-in-vr\": \"Enter in VR\",\n    \"entry.open-in-window\": \"Open in Tab\",\n    \"entry.lobby\": \"Lobby\",\n    \"entry.back\": \"Back\",\n    \"entry.notify_me\": \"Notify me when others arrive\",\n    \"entry.mute-on-entry\": \"Mute my microphone\",\n    \"profile.save\": \"Accept\",\n    \"profile.display_name.validation_warning\": \"Alphanumerics and hyphens. At least 3 characters, no more than 32\",\n    \"profile.header\": \"Name & Avatar\",\n    \"profile.terms_of_use\": \"Terms of Use\",\n    \"profile.privacy_notice\": \"Privacy Notice\",\n    \"profile.choose_avatar\": \"Browse Avatars\",\n    \"profile.tabs.legacy\": \"Default\",\n    \"profile.tabs.skinnable\": \"Custom Skin\",\n    \"profile.tabs.url\": \"Custom Model\",\n    \"profile.info\": \"Resources for creating custom avatar models can be found\",\n    \"profile.info-link\": \"here\",\n    \"avatar-editor.info\": \"Resources for creating custom avatar skins can be found\",\n    \"avatar-editor.info-link\": \"here\",\n    \"avatar-preview.loading-failed\": \"Loading failed\\nPlease choose another avatar\",\n    \"media-browser.search-placeholder.scenes\": \"Search Scenes...\",\n    \"media-browser.search-placeholder.avatars\": \"Search Avatars...\",\n    \"media-browser.search-placeholder.videos\": \"Search the web...\",\n    \"media-browser.search-placeholder.images\": \"Search the web...\",\n    \"media-browser.search-placeholder.youtube\": \"Search for videos...\",\n    \"media-browser.search-placeholder.gifs\": \"Search for GIFs...\",\n    \"media-browser.search-placeholder.twitch\": \"Search for streams...\",\n    \"media-browser.search-placeholder.sketchfab\": \"Search for models...\",\n    \"media-browser.search-placeholder.poly\": \"Search for models...\",\n    \"media-browser.search-placeholder.base\": \"Search...\",\n    \"media-browser.favorites-header\": \"Favorite Rooms\",\n    \"media-browser.add_custom_object\": \"Custom URL or File\",\n    \"media-browser.add_custom_scene\": \"Custom Scene\",\n    \"media-browser.add_custom_avatar\": \"Avatar GLB URL\",\n    \"media-browser.privacy_policy\": \"Privacy Policy\",\n    \"media-browser.spoke\": \"Spoke\",\n    \"media-browser.report_issue\": \"Report Issue\",\n    \"media-browser.powered_by.images\": \"Search by Bing | \",\n    \"media-browser.powered_by.videos\": \"Search by Bing | \",\n    \"media-browser.powered_by.youtube\": \"Search by Google | \",\n    \"media-browser.powered_by.gifs\": \"Search by Tenor | \",\n    \"media-browser.powered_by.sketchfab\": \"Search by Sketchfab | \",\n    \"media-browser.powered_by.poly\": \"Search by Google | \",\n    \"media-browser.powered_by.twitch\": \"Search by Twitch | \",\n    \"media-browser.powered_by.scenes\": \"Made with \",\n    \"media-browser.powered_by.avatars\": \" \",\n    \"media-browser.empty.images\": \"No results. Try entering a new search above.\",\n    \"media-browser.empty.videos\": \"No results. Try entering a new search above.\",\n    \"media-browser.empty.youtube\": \"No results. Try entering a new search above.\",\n    \"media-browser.empty.gifs\": \"No result. Try entering a new search above.\",\n    \"media-browser.empty.sketchfab\": \"No results. Try entering a new search above.\",\n    \"media-browser.empty.poly\": \"No results. Try entering a new search above.\",\n    \"media-browser.empty.twitch\": \"No results. Try entering a new search above.\",\n    \"media-browser.empty.favorites\": \"You don't have any favorites. Click a ⭐ to add to your favorites.\",\n    \"media-browser.nav_title.youtube\": \"YouTube\",\n    \"media-browser.nav_title.videos\": \"Videos\",\n    \"media-browser.nav_title.images\": \"Images\",\n    \"media-browser.nav_title.gifs\": \"GIFs\",\n    \"media-browser.nav_title.scenes\": \"Scenes\",\n    \"media-browser.nav_title.avatars\": \"Avatars\",\n    \"media-browser.nav_title.sketchfab\": \"Sketchfab\",\n    \"media-browser.nav_title.poly\": \"Google Poly\",\n    \"media-browser.nav_title.twitch\": \"Twitch\",\n    \"media-browser.create-avatar\": \"Create Avatar\",\n    \"media-browser.create-scene\": \"Create Scene with Spoke\",\n    \"media-browser.hub.joined-prefix\": \"Joined \",\n    \"media-browser.hub.joined-prefix\": \"Visited \",\n    \"audio.title\": \"Audio Setup\",\n    \"audio.talk_to_test\": \"talk\",\n    \"audio.click_to_test\": \"click\",\n    \"audio.subtitle-desktop\": \"Confirm HMD speaker output\",\n    \"audio.subtitle-mobile\": \"Earphones are recommended\",\n    \"audio.enter-now\": \"Enter Now\",\n    \"audio.hmd-mic-warning\": \"Your HMD mic is not chosen\",\n    \"audio.grant-title\": \"Grant mic permissions\",\n    \"audio.grant-subtitle\": \"Mic access needed to be heard by others\",\n    \"audio.granted-title\": \"Mic permissions granted\",\n    \"audio.granted-subtitle\": \"You can still mute yourself in-game\",\n    \"audio.granted-next\": \"Next\",\n    \"exit.subtitle.exited\": \"Your session has ended. Refresh your browser to start a new one.\",\n    \"exit.subtitle.closed\": \"This room is no longer available.\",\n    \"exit.subtitle.denied\": \"You are not permitted to join this room. Please request permission from the room creator.\",\n    \"exit.subtitle.kicked\": \"You have been kicked from axon park.\",\n    \"exit.subtitle.left\": \"You have left axon park.\",\n    \"exit.subtitle.full\": \"This room is full, please try again later.\",\n    \"exit.subtitle.connect_error\": \"Unable to connect to this room, please try again later.\",\n    \"exit.subtitle.version_mismatch\":\n      \"The version you deployed is not available yet. Your browser will refresh in 5 seconds.\",\n    \"autoexit.title\": \"Auto-ending session in \",\n    \"autoexit.title_units\": \" seconds\",\n    \"autoexit.subtitle\": \"You have started another session.\",\n    \"autoexit.cancel\": \"CANCEL\",\n    \"presence.entered_room\": \"entered axon park.\",\n    \"presence.entered_lobby\": \"entered axon park's lobby.\",\n    \"presence.join_lobby\": \"joined the axon park lobby.\",\n    \"presence.join_room\": \"joined axon park.\",\n    \"presence.leave\": \"left.\",\n    \"presence.name_change\": \"is now known as\",\n    \"presence.scene_change\": \"changed the scene to\",\n    \"presence.hub_name_change\": \"changed the name of the room to\",\n    \"presence.in_lobby\": \"Axon Park Lobby\",\n    \"presence.in_room\": \"In Axon Park\",\n    \"home.create_a_room\": \"Initialize Axon Park\",\n    \"home.desktop.add_pwa\": \"Install Desktop App\",\n    \"home.mobile.add_pwa\": \"Add to Home Screen\",\n    \"home.take_a_tour\": \"Take a Tour\",\n    \"home.room_create_options\": \"options\",\n    \"home.room_create_button\": \"Initialize Axon Park\",\n    \"home.create_name.validation_warning\": \"Invalid name, limited to 4 to 64 characters and limited symbols.\",\n    \"home.join_us\": \"Join the Conversation\",\n    \"home.have_code\": \"Have an axon park code?\",\n    \"home.add_to_discord_1\": \"Add the\",\n    \"home.add_to_discord_2\": \"Hubs Bot\",\n    \"home.add_to_discord_3\": \"to Discord\",\n    \"home.create_with_spoke\": \"Create a Scene\",\n    \"home.report_issue\": \"Report Issues\",\n    \"home.source_link\": \"Source\",\n    \"home.whats_new_link\": \"What's New\",\n    \"home.spoke_link\": \"Spoke\",\n    \"home.about_link\": \"About\",\n    \"home.community_link\": \"Community\",\n    \"home.privacy_notice\": \"Privacy Notice\",\n    \"home.terms_of_use\": \"Terms of Use\",\n    \"home.get_updates\": \"Get Updates\",\n    \"home.hero_title\": \"A new way to get together\",\n    \"home.hero_blurb\": motto,\n    \"home.made_with_love\": \"made with 🦆 by \",\n    \"home.environment_author_by\": \" by \",\n    \"dialog.close\": \"close\",\n    \"mailing_list.privacy_label\": \"I'm okay with Mozilla handling my info as explained in\",\n    \"mailing_list.privacy_link\": \"this Privacy Notice\",\n    \"link.link_page_header_entry\": \"Enter your code:\",\n    \"link.link_page_header_headset\": \"Enter Send to Device code:\",\n    \"link.linking_a_headset\": \"Have a letter code?\",\n    \"link.try_again\": \"We couldn't find that code.\\nPlease try again.\",\n    \"help.report_issue\": \"Report an Issue\",\n    \"scene.logo_tagline\": \"A new way to get together\",\n    \"scene.create_button\": \"Create a room with this scene\",\n    \"scene.tweet_button\": \"Share on Twitter\",\n    \"scene.unavailable\": \"This scene is no longer available.\",\n    \"link.in_your_browser\": \"In your device's web browser, go to:\",\n    \"link.enter_code\": \"Then, enter this one-time letter code:\",\n    \"link.do_not_close\":\n      \"Your account and avatar will be transferred to the device.\\nKeep this page open to use this code.\",\n    \"link.connect_headset\": \"Send to Device\",\n    \"link.cancel\": \"cancel\",\n    \"invite.enter_via\": \"Enter via \",\n    \"invite.enter_via_modal\": \"Others may enter via \",\n    \"invite.tweet\": \"tweet\",\n    \"invite.and_enter_code\": \" with code:\",\n    \"invite.or_visit\": \"or share permalink\",\n    \"invite.or_visit_modal\": \"or by visiting permalink\",\n    \"invite.embed\": \"or embed on a page\",\n    \"invite.embed-tip\":\n      \"Please be mindful of where you embed a Hubs room.\\nAnyone who can access the page can enter and create/remove objects.\",\n    \"spoke.primary_tagline\": \"make your space\",\n    \"spoke.secondary_tagline\": \"Create 3D social scenes for \",\n    \"spoke.thank_you\": \"Thank you for downloading Spoke!\",\n    \"spoke.download_win\": \"Download for Windows\",\n    \"spoke.download_macos\": \"Download for Mac\",\n    \"spoke.download_linux\": \"Download for Linux\",\n    \"spoke.download_unsupported\": \"View Releases\",\n    \"spoke.browse_all_versions\": \"Browse All Versions\",\n    \"spoke.beginner_tutorial_button\": \"Learn Spoke in 5 Minutes\",\n    \"spoke.advanced_tutorial_button\": \"Advanced Spoke in 10 minutes\",\n    \"spoke.play_button\": \"Learn Spoke in 5 Minutes\",\n    \"commands.fly\": \"Toggle fly mode.\",\n    \"commands.grow\": \"Increase your avatar's size.\",\n    \"commands.shrink\": \"Decrease your avatar's size.\",\n    \"commands.scene\": \"Change the scene.\",\n    \"commands.rename\": \"Rename the room.\",\n    \"commands.help\": \"Show help.\",\n    \"commands.leave\": \"Disconnect from axon park.\",\n    \"commands.duck\": \"The duck tested well. Quack.\",\n    \"commands.capture\": \"Capture a 15 second video.\",\n    \"commands.debug\": \"Toggle physics debug rendering.\",\n    \"commands.vrstats\": \"Toggle stats in VR.\",\n    \"settings.change-avatar\": \"Set Name & Avatar\",\n    \"settings.change-scene\": \"Choose a Scene\",\n\n    \"settings.favorites\": \"Favorite Rooms\",\n    \"settings.rename-room\": \"Set Axon Park Name...\",\n    \"settings.close-room\": \"Close Axon Park...\",\n    \"settings.room-info\": \"Axon Park Info\",\n    \"settings.create-room\": \"New Axon Park...\",\n\n    \"settings.create-scene\": \"Get Spoke\",\n    \"settings.send-feedback\": \"Send Feedback\",\n    \"settings.whats-new\": \"What's New\",\n    \"settings.features\": \"Help\",\n    \"settings.controls\": \"Controls\",\n    \"settings.community\": \"Join Discord\",\n    \"settings.tips\": \"Show Tips\",\n    \"settings.report\": \"Report Issue\",\n    \"settings.terms\": \"Terms of Use\",\n    \"settings.privacy\": \"Privacy Notice\",\n    \"settings.help\": \"Help\",\n\n    \"settings.row-profile\": \"You\",\n    \"settings.row-room\": \"Axon Park\",\n\n    \"tips.mobile.video_share_mode\": \"Tap to stop sharing video.\",\n    \"tips.mobile.pen_mode\": \"Tap icon again to end drawing.\",\n    \"tips.mobile.mute_mode\": \"You are muted. Tap to unmute.\",\n    \"tips.mobile.freeze_mode\": \"Two-finger tap to hide menus.\",\n    \"tips.mobile.look\": \"Welcome! 👋 Tap and drag to look around.\",\n    \"tips.mobile.locomotion\": \"Great! To move, pinch with two fingers.\",\n    \"tips.mobile.spawn_menu-pre\": \"Use the \",\n    \"tips.mobile.spawn_menu-post\": \"at the top to create objects.\",\n    \"tips.mobile.freeze_gesture\": \"Two-finger tap to show menus.\",\n    \"tips.mobile.object_grab\": \"Drag an object to move or throw it.\",\n    \"tips.mobile.object_rotate_button-pre\": \"Tap and drag \",\n    \"tips.mobile.object_rotate_button-post\": \" to rotate.\",\n    \"tips.mobile.object_scale_button-pre\": \"Tap and drag \",\n    \"tips.mobile.object_scale_button-post\": \" to scale.\",\n    \"tips.mobile.object_recenter_button-pre\": \"Tap \",\n    \"tips.mobile.object_recenter_button-post\": \" to have the object face you.\",\n\n    \"tips.mobile.object_pin\": \"Pin an object to save it to axon park.\",\n    \"tips.mobile.object_pin\": \"Pin an object to save it to axon park.\",\n    \"tips.mobile.invite\": \"Use the Invite button to share axon park.\",\n\n    \"tips.desktop.video_share_mode\": \"You're streaming. Select again to stop sharing video.\",\n    \"tips.desktop.pen_mode\": \"Press ESC or right click to drop pen. Ctrl-Z to undo.\",\n    \"tips.desktop.mirror_mode\": \"Press ESC to end camera mirroring.\",\n    \"tips.desktop.mute_mode\": \"You are muted. Click or press M to un-mute.\",\n    \"tips.desktop.look\": \"Welcome to Hubs! 👋 Click and drag to look around.\",\n    \"tips.desktop.locomotion\": \"Great! Now, use the W A S D keys to move. Hold shift to boost.\",\n    \"tips.desktop.turning\": \"Perfect. Use the Q and E keys to rotate.\",\n    \"tips.desktop.spawn_menu-pre\": \"To create objects, click the \",\n    \"tips.desktop.spawn_menu-post\": \"button at the top of the screen, or press Ctrl 1 through 7.\",\n    \"tips.desktop.freeze_gesture\": \"Press and hold spacebar to show object menus.\",\n    \"tips.desktop.menu_hover\": \"Now, point the cursor at an object to show the menu.\",\n    \"tips.desktop.object_grab\": \"Click and drag an object to move it. Or, flick to throw it!\",\n    \"tips.desktop.object_pin\": \"Pin an object to save it to axon park.\",\n    \"tips.desktop.object_zoom\": \"Scroll to move this object towards and away from you.\",\n    \"tips.desktop.object_rotate_button-pre\": \"Click and drag \",\n    \"tips.desktop.object_rotate_button-post\": \" to rotate the object.\",\n    \"tips.desktop.object_scale_button-pre\": \"Click and drag \",\n    \"tips.desktop.object_scale_button-post\": \" to scale the object.\",\n    \"tips.desktop.object_recenter_button-pre\": \"Click \",\n    \"tips.desktop.object_recenter_button-post\": \" to rotate the object to face you. Helpful if you drop it!\",\n    \"tips.desktop.object_scale\": \"Hold shift and scroll to scale it bigger and smaller.\",\n    \"tips.desktop.pen_color\": \"Use Shift-Q and Shift-E to change the pen color.\",\n    \"tips.desktop.pen_size\": \"Hold Shift and scroll to change the pen size.\",\n    \"tips.desktop.invite\": \"Nobody else is here. Use the Share button at the top to share this room.\",\n    \"tips.desktop.watching\": \"You're in the lobby. Others cannot see or hear you.\",\n    \"tips.watching.back\": \"Enter Room\",\n    \"tips.mobile.watching\": \"You're in the lobby.\",\n    \"tips.watching-exit\": \"Back\",\n    \"loader.entering_lobby\": \"Entering lobby...\",\n    \"loader.loading\": \"Loading \",\n    \"loader.object\": \"object\",\n    \"loader.objects\": \"objects\",\n    \"change-scene-dialog.change-scene\": \"Change Scene\",\n    \"change-scene-dialog.create-in-spoke\": \"Or, create a new scene using Spoke.\",\n    \"change-scene-dialog.new-spoke-project\": \"Launch Spoke\",\n    \"avatar-url-dialog.apply\": \"Apply\",\n    \"interstitial.prompt\": \"Continue\",\n    \"feedback.prompt\": \"Feedback\",\n    \"hide-ui.prompt\": \"Hide All\",\n    \"discord.primary_tagline\":\n      \"Share a virtual room with your community.\\nWatch videos, play with 3D objects, or just hang out.\",\n    \"discord.secondary_tagline\": \"No downloads or sign up. Full VR support too.\",\n    \"discord.contact_us\": \"Invite Bot to Server\",\n    \"discord.community_link\": \"Hubs Discord\",\n    \"discord.splash_tag\": \"Designed for serious businessing.\",\n    \"client-info.kick-button\": \"Kick\",\n    \"client-info.hide-button\": \"Hide\",\n    \"client-info.unhide-button\": \"Un-hide \",\n    \"client-info.mute-button\": \"Mute\",\n    \"client-info.cancel\": \"Cancel\",\n    \"avatar-landing.select\": \"Select\",\n    \"avatar-landing.selected\": \"This is your current avatar\",\n    \"leave-room-dialog.join-room.message\": \"Joining a new room will leave this one. Are you sure?\",\n    \"leave-room-dialog.join-room.confirm\": \"Join Room\",\n    \"leave-room-dialog.create-room.message\": \"Creating a new room will leave this one. Are you sure?\",\n    \"leave-room-dialog.create-room.confirm\": \"Leave Room\",\n    \"embed.load-button\": \"Load Room\",\n    \"embed.presence-warning\": \"This room is embedded, so may be visible to visitors on other websites.\"\n  }\n}\n","import localeData from \"../everyspace/messages.js\";\n// import localeData from \"../assets/translations.data.json\";\nconst navigatorLang = ((navigator.languages && navigator.languages[0]) || navigator.language || navigator.userLanguage)\n  .toLowerCase()\n  .split(/[_-]+/)[0];\nexport const lang = (localeData[navigatorLang] && navigatorLang) || \"en\";\nexport const messages = localeData[lang] || localeData.en;\n","import { avatars } from \"../assets/avatars/avatars.js\";\n\nconst names = [\n  \"Baers-Pochard\",\n  \"Baikal-Teal\",\n  \"Barrows-Goldeneye\",\n  \"Blue-Billed\",\n  \"Blue-Duck\",\n  \"Blue-Winged\",\n  \"Brown-Teal\",\n  \"Bufflehead\",\n  \"Canvasback\",\n  \"Cape-Shoveler\",\n  \"Chestnut-Teal\",\n  \"Chiloe-Wigeon\",\n  \"Cinnamon-Teal\",\n  \"Comb-Duck\",\n  \"Common-Eider\",\n  \"Common-Goldeneye\",\n  \"Common-Merganser\",\n  \"Common-Pochard\",\n  \"Common-Scoter\",\n  \"Common-Shelduck\",\n  \"Cotton-Pygmy\",\n  \"Crested-Duck\",\n  \"Crested-Shelduck\",\n  \"Eatons-Pintail\",\n  \"Falcated\",\n  \"Ferruginous\",\n  \"Freckled-Duck\",\n  \"Gadwall\",\n  \"Garganey\",\n  \"Greater-Scaup\",\n  \"Green-Pygmy\",\n  \"Grey-Teal\",\n  \"Hardhead\",\n  \"Harlequin\",\n  \"Hartlaubs\",\n  \"Hooded-Merganser\",\n  \"Hottentot-Teal\",\n  \"Kelp-Goose\",\n  \"King-Eider\",\n  \"Lake-Duck\",\n  \"Laysan-Duck\",\n  \"Lesser-Scaup\",\n  \"Long-Tailed\",\n  \"Maccoa-Duck\",\n  \"Mallard\",\n  \"Mandarin\",\n  \"Marbled-Teal\",\n  \"Mellers-Duck\",\n  \"Merganser\",\n  \"Northern-Pintail\",\n  \"Orinoco-Goose\",\n  \"Paradise-Shelduck\",\n  \"Plumed-Whistler\",\n  \"Puna-Teal\",\n  \"Pygmy-Goose\",\n  \"Radjah-Shelduck\",\n  \"Red-Billed\",\n  \"Red-Crested\",\n  \"Red-Shoveler\",\n  \"Ring-Necked\",\n  \"Ringed-Teal\",\n  \"Rosy-Billed\",\n  \"Ruddy-Shelduck\",\n  \"Salvadoris-Teal\",\n  \"Scaly-Sided\",\n  \"Shelduck\",\n  \"Shoveler\",\n  \"Silver-Teal\",\n  \"Smew\",\n  \"Spectacled-Eider\",\n  \"Spot-Billed\",\n  \"Spotted-Whistler\",\n  \"Steamerduck\",\n  \"Stellers-Eider\",\n  \"Sunda-Teal\",\n  \"Surf-Scoter\",\n  \"Tufted-Duck\",\n  \"Velvet-Scoter\",\n  \"Wandering-Whistler\",\n  \"Whistling-duck\",\n  \"White-Backed\",\n  \"White-Cheeked\",\n  \"White-Winged\",\n  \"Wigeon\",\n  \"Wood-Duck\",\n  \"Yellow-Billed\"\n];\n\nfunction selectRandom(arr) {\n  return arr[Math.floor(Math.random() * arr.length)];\n}\n\nexport function generateRandomName() {\n  return `${selectRandom(names)}-${Math.floor(10000 + Math.random() * 10000)}`;\n}\n\nexport const avatarIds = avatars.map(av => av.id);\n\nexport function generateDefaultProfile() {\n  return {\n    avatarId: selectRandom(avatarIds)\n  };\n}\n","import { Validator } from \"jsonschema\";\nimport merge from \"deepmerge\";\nimport Cookies from \"js-cookie\";\nimport jwtDecode from \"jwt-decode\";\n\nconst LOCAL_STORE_KEY = \"___hubs_store\";\nconst STORE_STATE_CACHE_KEY = Symbol();\nconst OAUTH_FLOW_CREDENTIALS_KEY = \"ret-oauth-flow-account-credentials\";\nconst validator = new Validator();\nimport { EventTarget } from \"event-target-shim\";\nimport { generateDefaultProfile, generateRandomName } from \"../utils/identity.js\";\n\n// Durable (via local-storage) schema-enforced state that is meant to be consumed via forward data flow.\n// (Think flux but with way less incidental complexity, at least for now :))\nexport const SCHEMA = {\n  id: \"/HubsStore\",\n\n  definitions: {\n    profile: {\n      type: \"object\",\n      additionalProperties: false,\n      properties: {\n        displayName: { type: \"string\", pattern: \"^[A-Za-z0-9-]{3,32}$\" },\n        avatarId: { type: \"string\" },\n        personalAvatarId: { type: \"string\" }\n      }\n    },\n\n    credentials: {\n      type: \"object\",\n      additionalProperties: false,\n      properties: {\n        token: { type: [\"null\", \"string\"] },\n        email: { type: [\"null\", \"string\"] }\n      }\n    },\n\n    activity: {\n      type: \"object\",\n      additionalProperties: false,\n      properties: {\n        hasFoundFreeze: { type: \"boolean\" },\n        hasChangedName: { type: \"boolean\" },\n        hasAcceptedProfile: { type: \"boolean\" },\n        lastEnteredAt: { type: \"string\" },\n        hasPinned: { type: \"boolean\" },\n        hasRotated: { type: \"boolean\" },\n        hasRecentered: { type: \"boolean\" },\n        hasScaled: { type: \"boolean\" },\n        hasHoveredInWorldHud: { type: \"boolean\" },\n        hasOpenedShare: { type: \"boolean\" }\n      }\n    },\n\n    settings: {\n      type: \"object\",\n      additionalProperties: false,\n      properties: {\n        lastUsedMicDeviceId: { type: \"string\" }\n      }\n    },\n\n    // Legacy\n    confirmedDiscordRooms: {\n      type: \"array\",\n      items: { type: \"string\" }\n    },\n\n    confirmedBroadcastedRooms: {\n      type: \"array\",\n      items: { type: \"string\" }\n    },\n\n    uploadPromotionTokens: {\n      type: \"array\",\n      items: {\n        type: \"object\",\n        additionalProperties: false,\n        properties: {\n          fileId: { type: \"string\" },\n          promotionToken: { type: \"string\" }\n        }\n      }\n    },\n\n    creatorAssignmentTokens: {\n      type: \"array\",\n      items: {\n        type: \"object\",\n        additionalProperties: false,\n        properties: {\n          hubId: { type: \"string\" },\n          creatorAssignmentToken: { type: \"string\" }\n        }\n      }\n    },\n\n    embedTokens: {\n      type: \"array\",\n      items: {\n        type: \"object\",\n        additionalProperties: false,\n        properties: {\n          hubId: { type: \"string\" },\n          embedToken: { type: \"string\" }\n        }\n      }\n    }\n  },\n\n  type: \"object\",\n\n  properties: {\n    profile: { $ref: \"#/definitions/profile\" },\n    credentials: { $ref: \"#/definitions/credentials\" },\n    activity: { $ref: \"#/definitions/activity\" },\n    settings: { $ref: \"#/definitions/settings\" },\n    confirmedDiscordRooms: { $ref: \"#/definitions/confirmedDiscordRooms\" }, // Legacy\n    confirmedBroadcastedRooms: { $ref: \"#/definitions/confirmedBroadcastedRooms\" },\n    uploadPromotionTokens: { $ref: \"#/definitions/uploadPromotionTokens\" },\n    creatorAssignmentTokens: { $ref: \"#/definitions/creatorAssignmentTokens\" },\n    embedTokens: { $ref: \"#/definitions/embedTokens\" }\n  },\n\n  additionalProperties: false\n};\n\nexport default class Store extends EventTarget {\n  constructor() {\n    super();\n\n    if (localStorage.getItem(LOCAL_STORE_KEY) === null) {\n      localStorage.setItem(LOCAL_STORE_KEY, JSON.stringify({}));\n    }\n\n    // When storage is updated in another window\n    window.addEventListener(\"storage\", e => {\n      if (e.key !== LOCAL_STORE_KEY) return;\n      delete this[STORE_STATE_CACHE_KEY];\n      this.dispatchEvent(new CustomEvent(\"statechanged\"));\n    });\n\n    this.update({\n      activity: {},\n      settings: {},\n      credentials: {},\n      profile: {},\n      confirmedDiscordRooms: [],\n      confirmedBroadcastedRooms: [],\n      uploadPromotionTokens: [],\n      creatorAssignmentTokens: [],\n      embedTokens: []\n    });\n\n    const oauthFlowCredentials = Cookies.getJSON(OAUTH_FLOW_CREDENTIALS_KEY);\n    if (oauthFlowCredentials) {\n      this.update({ credentials: oauthFlowCredentials });\n      this.resetToRandomLegacyAvatar();\n      Cookies.remove(OAUTH_FLOW_CREDENTIALS_KEY);\n    }\n  }\n\n  // Initializes store with any default bits\n  init = () => {\n    this.update({\n      profile: { ...generateDefaultProfile(), ...(this.state.profile || {}) }\n    });\n\n    // Regenerate name to encourage users to change it.\n    if (!this.state.activity.hasChangedName) {\n      this.update({ profile: { displayName: generateRandomName() } });\n    }\n  };\n\n  resetToRandomLegacyAvatar = () => {\n    this.update({\n      profile: { ...(this.state.profile || {}), ...generateDefaultProfile() }\n    });\n  };\n\n  get state() {\n    if (!this.hasOwnProperty(STORE_STATE_CACHE_KEY)) {\n      this[STORE_STATE_CACHE_KEY] = JSON.parse(localStorage.getItem(LOCAL_STORE_KEY));\n    }\n\n    return this[STORE_STATE_CACHE_KEY];\n  }\n\n  get credentialsAccountId() {\n    if (this.state.credentials.token) {\n      return jwtDecode(this.state.credentials.token).sub;\n    } else {\n      return null;\n    }\n  }\n\n  resetConfirmedBroadcastedRooms() {\n    // merge causing us some annoyance here :(\n    const overwriteMerge = (destinationArray, sourceArray) => sourceArray;\n    this.update({ confirmedBroadcastedRooms: [] }, { arrayMerge: overwriteMerge });\n  }\n\n  resetTipActivityFlags() {\n    this.update({ activity: { hasRotated: false, hasPinned: false, hasRecentered: false, hasScaled: false } });\n  }\n\n  update(newState, mergeOpts) {\n    const finalState = merge(this.state, newState, mergeOpts);\n    const { valid } = validator.validate(finalState, SCHEMA);\n\n    if (!valid) {\n      // Intentionally not including details about the state or validation result here, since we don't want to leak\n      // sensitive data in the error message.\n      throw new Error(`Write to store failed schema validation.`);\n    }\n\n    localStorage.setItem(LOCAL_STORE_KEY, JSON.stringify(finalState));\n    delete this[STORE_STATE_CACHE_KEY];\n\n    this.dispatchEvent(new CustomEvent(\"statechanged\"));\n\n    return finalState;\n  }\n}\n","module.exports = __webpack_public_path__ + \"assets/images/hub-preview-white-ccefba3b70ae589a0ca5ae3230c39299.png\";","const tempVector3 = new THREE.Vector3();\nconst tempQuaternion = new THREE.Quaternion();\n\nexport function getLastWorldPosition(src, target) {\n  src.updateMatrices();\n  target.setFromMatrixPosition(src.matrixWorld);\n  return target;\n}\n\nexport function getLastWorldQuaternion(src, target) {\n  src.updateMatrices();\n  src.matrixWorld.decompose(tempVector3, target, tempVector3);\n  return target;\n}\n\nexport function getLastWorldScale(src, target) {\n  src.updateMatrices();\n  src.matrixWorld.decompose(tempVector3, tempQuaternion, target);\n  return target;\n}\n\nexport function disposeMaterial(mtrl) {\n  if (mtrl.map) mtrl.map.dispose();\n  if (mtrl.lightMap) mtrl.lightMap.dispose();\n  if (mtrl.bumpMap) mtrl.bumpMap.dispose();\n  if (mtrl.normalMap) mtrl.normalMap.dispose();\n  if (mtrl.specularMap) mtrl.specularMap.dispose();\n  if (mtrl.envMap) mtrl.envMap.dispose();\n  mtrl.dispose();\n}\n\nexport function disposeNode(node) {\n  if (!(node instanceof THREE.Mesh)) return;\n\n  if (node.geometry) {\n    node.geometry.dispose();\n  }\n\n  if (node.material) {\n    let materialArray;\n    if (node.material instanceof THREE.MeshFaceMaterial || node.material instanceof THREE.MultiMaterial) {\n      materialArray = node.material.materials;\n    } else if (node.material instanceof Array) {\n      materialArray = node.material;\n    }\n    if (materialArray) {\n      materialArray.forEach(disposeMaterial);\n    } else {\n      disposeMaterial(node.material);\n    }\n  }\n}\n\nexport function setMatrixWorld(object3D, m) {\n  object3D.matrixWorld.copy(m);\n  object3D.matrix = object3D.matrix.getInverse(object3D.parent.matrixWorld).multiply(object3D.matrixWorld);\n  object3D.matrix.decompose(object3D.position, object3D.quaternion, object3D.scale);\n}\n","export function forEachMaterial(object3D, fn) {\n  if (!object3D.material) return;\n\n  if (Array.isArray(object3D.material)) {\n    object3D.material.forEach(fn);\n  } else {\n    fn(object3D.material);\n  }\n}\n\nexport function mapMaterials(object3D, fn) {\n  if (!object3D.material) return;\n\n  if (Array.isArray(object3D.material)) {\n    return object3D.material.map(fn);\n  } else {\n    return fn(object3D.material);\n  }\n}\n","export const avatars = [\n  {\n    id: \"botdefault\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotDefault_Avatar-9f71f8ff22.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botdefault-thumb-42C4C7D3C01D085EAFDAC8BACE591CE6.png\"\n  },\n  {\n    id: \"botbobo\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotBobo_Avatar-f9740a010b.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botbobo-thumb-261278FD5831E9CD89610D15948F23E4.png\"\n  },\n  {\n    id: \"botdom\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotDom_Avatar-0c48bf15a5.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botdom-thumb-1160EB5E81D24F12CE643C520CE1E99E.png\"\n  },\n  {\n    id: \"botgreg\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotGreg_Avatar-98d39797bb.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botgreg-thumb-F2A37F14F9C342EE44DDE9B24DD9B9FC.png\"\n  },\n  {\n    id: \"botguest\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotGuest_Avatar-78cd857332.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botguest-thumb-F7A471250E2C10C2709325C3B02A8BBB.png\"\n  },\n  {\n    id: \"botjim\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotJim_Avatar-d28005a687.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botjim-thumb-A2D195C1A51A082BCED58BD172481B39.png\"\n  },\n  {\n    id: \"botkev\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotKev_Avatar-a95787bb51.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botkev-thumb-90746A7349E3F964C913EA612EE9A53F.png\"\n  },\n  {\n    id: \"botpinky\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotPinky_Avatar-b0b93f8675.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botpinky-thumb-C2E69D4479077766B988DC3EE4F30BE5.png\"\n  },\n  {\n    id: \"botrobert\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotRobert_Avatar-e9554880f3.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botrobert-thumb-9C33F2C752326E2CF4321EAA7BDB4E47.png\"\n  },\n  {\n    id: \"botwoody\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotWoody_Avatar-0140485a23.gltf\",\n    thumbnail: \"https://asset-bundles-prod.reticulum.io/bots/botwoody-thumb-F1F1FA7E21301B5AC1D8872B4ED0CC56.png\"\n  }\n];\n","export const createImageBitmap =\n  window.createImageBitmap ||\n  async function(data) {\n    return new Promise(resolve => {\n      // https://dev.to/nektro/createimagebitmap-polyfill-for-safari-and-edge-228\n      // https://gist.github.com/MonsieurV/fb640c29084c171b4444184858a91bc7\n\n      let srcUrl;\n      if (data instanceof Blob) {\n        srcUrl = URL.createObjectURL(data);\n      } else {\n        const canvas = document.createElement(\"canvas\");\n        const ctx = canvas.getContext(\"2d\");\n        canvas.width = data.width;\n        canvas.height = data.height;\n        ctx.putImageData(data, 0, 0);\n        srcUrl = canvas.toDataURL();\n      }\n      const img = document.createElement(\"img\");\n\n      img.addEventListener(\"load\", () => resolve(img));\n\n      img.src = srcUrl;\n    });\n  };\n\nexport function disposeImageBitmap(imageBitmap) {\n  if (imageBitmap instanceof HTMLImageElement && imageBitmap.src.startsWith(\"blob:\")) {\n    URL.revokeObjectURL(imageBitmap.src);\n  } else {\n    imageBitmap.close && imageBitmap.close();\n  }\n}\n","export default function nextTick() {\n  return new Promise(resolve => {\n    setTimeout(resolve, 0);\n  });\n}\n"],"sourceRoot":""}